====== npm ls tweakpane, tabulator-tables, @simonwep/pickr, golden-layout, localforage ======
scene-designer@1.0.0 /home/ubuntu/scene-designer
├── @simonwep/pickr@1.9.1
├── golden-layout@2.6.0
├── localforage@1.10.0
├── tabulator-tables@6.3.1
└── tweakpane@4.0.5


====== package.json ======
{
  "name": "scene-designer",
  "version": "1.0.0",
  "type": "module",
  "description": "A visual tool to create [Scene] config sections for an ADB automation suite.",
  "scripts": {
    "dev": "webpack serve --mode development",
    "build": "webpack --mode production"
  },
  "dependencies": {
    "@simonwep/pickr": "^1.9.1",
    "golden-layout": "^2.6.0",
    "konva": "^10.0.2",
    "localforage": "^1.10.0",
    "loglevel": "^1.9.2",
    "tabulator-tables": "^6.3.1",
    "tweakpane": "^4.0.5"
  },
  "devDependencies": {
    "css-loader": "^7.1.2",
    "style-loader": "^4.0.0",
    "webpack": "^5.101.3",
    "webpack-cli": "^6.0.1",
    "webpack-dev-server": "^5.2.2"
  }
}

====== webpack.config.js ======
import path from 'path';
import { fileURLToPath } from 'url';

// Needed for __dirname in ESM:
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default {
  entry: './src/layout.js',
  //entry: './tweakpane-test.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist'),
    clean: true
  },
  mode: 'development',
  devServer: {
    static: './dist',
    hot: true,
    port: 3000,
    open: true
  },
  module: {
    rules: [
      {
        test: /\.css$/i,
        use: ['style-loader', 'css-loader'],
      }
    ]
  },
  resolve: {
    extensions: ['.js']
  }
};


====== src directory structure (files & sizes) ======
-rw-rw-r-- 1 ubuntu ubuntu 1.2K Sep 14 17:50 src/main.js
-rw-rw-r-- 1 ubuntu ubuntu 1.3K Sep 14 17:51 src/modules.index.md
-rw-rw-r-- 1 ubuntu ubuntu 13K Sep 14 16:26 src/canvas.js
-rw-rw-r-- 1 ubuntu ubuntu 18K Sep 14 19:41 src/settings.js
-rw-rw-r-- 1 ubuntu ubuntu 2.5K Sep 13 18:45 src/errorlog.js
-rw-rw-r-- 1 ubuntu ubuntu 2.6K Sep 14 17:31 src/global-errors.js
-rw-rw-r-- 1 ubuntu ubuntu 2.7K Sep 14 17:29 src/console-stream.js
-rw-rw-r-- 1 ubuntu ubuntu 5.9K Sep 14 16:28 src/selection.js
-rw-rw-r-- 1 ubuntu ubuntu 6.7K Sep 14 19:48 src/layout.js
-rw-rw-r-- 1 ubuntu ubuntu 7.5K Sep 14 17:28 src/log.js
-rw-rw-r-- 1 ubuntu ubuntu 7.7K Sep 13 08:58 src/sidebar.js_bak
-rw-rw-r-- 1 ubuntu ubuntu 7.7K Sep 14 16:29 src/state.js
-rw-rw-r-- 1 ubuntu ubuntu 8.4K Sep 14 16:27 src/sidebar.js
-rw-rw-r-- 1 ubuntu ubuntu 9.1K Sep 13 08:59 src/settings.js_bak

====== dist directory structure (files & sizes) ======
-rw-rw-r-- 1 ubuntu ubuntu 1.4K Sep 14 22:45 dist/index.html
-rw-rw-r-- 1 ubuntu ubuntu 163 Sep 14 22:40 dist/bundle.js.LICENSE.txt
-rw-rw-r-- 1 ubuntu ubuntu 648K Sep 14 22:40 dist/bundle.js

====== node_modules directory (top-level, filtered) ======
drwxrwxr-x  4 ubuntu ubuntu 4096 Sep 14 21:38 golden-layout
drwxrwxr-x  6 ubuntu ubuntu 4096 Sep 14 21:38 localforage
drwxrwxr-x  6 ubuntu ubuntu 4096 Sep 14 21:38 tabulator-tables
drwxrwxr-x  3 ubuntu ubuntu 4096 Sep 14 21:43 tweakpane

====== All Tweakpane imports in src/ ======
src/settings.js:21:import { Pane } from 'tweakpane';
src/settings.js:308:      Check your webpack and npm dependencies: tweakpane@4.x must be imported as <code>import { Pane } from 'tweakpane'</code>.</div>`;
src/settings.js:340:            <div id="tweakpane-fields-div" style="flex:1 1 0;overflow:auto;padding:0 8px 8px 8px;"></div>
src/settings.js:344:        const fieldsDiv = rootElement.querySelector("#tweakpane-fields-div");
src/settings.js:348:          log("ERROR", "[settings] tweakpane-fields-div not found in DOM");
src/settings.js:349:          rootElement.innerHTML = `<div style="color:red;padding:2em;">Settings panel failed to render (missing tweakpane-fields-div)</div>`;
src/settings.js:401:              // For Pickr, create a div container in the tweakpane

====== All Pickr imports in src/ ======
src/settings.js:20:import Pickr from '@simonwep/pickr';
src/settings.js:62:    type: "pickr",
src/settings.js:68:    type: "pickr",
src/settings.js:369:        const pickrInstances = {};
src/settings.js:400:            } else if (reg.type === "pickr") {
src/settings.js:402:              const pickrDiv = document.createElement("div");
src/settings.js:403:              pickrDiv.id = "pickr-" + key;
src/settings.js:404:              pickrDiv.style.display = "inline-block";
src/settings.js:405:              pickrDiv.style.verticalAlign = "middle";
src/settings.js:406:              pickrDiv.style.marginLeft = "1em";
src/settings.js:413:              row.appendChild(pickrDiv);
src/settings.js:417:                if (pickrInstances[key]) {
src/settings.js:418:                  pickrInstances[key].destroyAndRemove();
src/settings.js:419:                  delete pickrInstances[key];
src/settings.js:421:                pickrInstances[key] = Pickr.create({
src/settings.js:422:                  el: '#' + pickrDiv.id,
src/settings.js:427:                pickrInstances[key].on('change', color => {
src/settings.js:432:                pickrInstances[key].setColor(settingsPOJO[key]);
src/settings.js_bak:54:    type: "pickr",
src/settings.js_bak:60:    type: "pickr",
src/settings.js_bak:223:    } else if (reg.type === "pickr") {
src/settings.js_bak:225:      const pickrDiv = document.createElement("div");
src/settings.js_bak:226:      pickrDiv.className = "pickr";
src/settings.js_bak:227:      pickrDiv.id = "setting-" + reg.key + "-pickr";
src/settings.js_bak:228:      pickrDiv.style.display = "inline-block";
src/settings.js_bak:229:      pickrDiv.style.marginLeft = "0.5em";
src/settings.js_bak:230:      field.append(label, pickrDiv);
src/settings.js_bak:243:          el: '#' + pickrDiv.id,

====== All Tabulator imports in src/ ======
src/sidebar.js:18:import { Tabulator } from 'tabulator-tables';
src/sidebar.js:21:let tabulatorInstance = null;
src/sidebar.js:80:      if (tabulatorInstance) tabulatorInstance.replaceData(makeTableData());
src/sidebar.js:135:    if (tabulatorInstance && typeof tabulatorInstance.destroy === "function") {
src/sidebar.js:136:      log("TRACE", "[sidebar] destroying old tabulatorInstance");
src/sidebar.js:137:      tabulatorInstance.destroy();
src/sidebar.js:138:      tabulatorInstance = null;
src/sidebar.js:142:    tabulatorInstance = new Tabulator(tableDiv, {
src/sidebar.js:164:        tabulatorInstance.replaceData(makeTableData());
src/sidebar.js:185:        if (tabulatorInstance) tabulatorInstance.replaceData(makeTableData());

====== Tweakpane usage in settings.js ======
4: * Settings Panel for Scene Designer (Golden Layout)
21:import { Pane } from 'tweakpane';
151:    key: "showErrorLogPanel",
152:    label: "Show Error Log Panel",
278:export function buildSettingsPanel(rootElement, container) {
279:  log("TRACE", "[settings] buildSettingsPanel entry", {
285:    log("INFO", "[settings] buildSettingsPanel called", {
293:      log("ERROR", "[settings] buildSettingsPanel: rootElement is null or undefined");
298:      log("ERROR", "[settings] buildSettingsPanel: rootElement is not visible (may be hidden)");
302:    log("DEBUG", "[settings] Tweakpane import check", { PaneType: typeof Pane, Pane });
306:    if (typeof Pane !== "function") {
307:      rootElement.innerHTML = `<div style="color:red;padding:2em;">Settings panel failed: Tweakpane (Pane) not loaded as ES module.<br>
308:      Check your webpack and npm dependencies: tweakpane@4.x must be imported as <code>import { Pane } from 'tweakpane'</code>.</div>`;
309:      log("ERROR", "[settings] Pane (Tweakpane) is not a constructor/function! Check import.");
315:        log("TRACE", "[settings] buildSettingsPanel after loadSettings (resolved)", {
350:          log("TRACE", "[settings] buildSettingsPanel exit (missing fieldsDiv)");
356:          pane = new Pane({
364:          log("TRACE", "[settings] buildSettingsPanel exit (Tweakpane failed)");
467:        log("TRACE", "[settings] buildSettingsPanel exit (rendered)");
470:        log("ERROR", "[settings] Error in loadSettings().then for buildSettingsPanel", e);
472:        log("TRACE", "[settings] buildSettingsPanel exit (loadSettings error)");
475:    log("ERROR", "[settings] buildSettingsPanel ERROR", e);
476:    alert("SettingsPanel ERROR: " + e.message);
477:    log("TRACE", "[settings] buildSettingsPanel exit (error)");

====== HTML entry points ======
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scene Designer (Golden Layout Dev)</title>
  <link rel="stylesheet" href="https://unpkg.com/golden-layout@2.6.0/dist/css/goldenlayout-base.css">
  <link rel="stylesheet" href="https://unpkg.com/golden-layout@2.6.0/dist/css/themes/goldenlayout-light-theme.css">
  <style>
    html, body, #gl-root { height: 100%; width: 100%; margin: 0; padding: 0; }
    #gl-root { height: 100vh; width: 100vw; background: #f7f9fc; }
    /* Removed #error-log-box styles: error log is now a panel! */
  </style>
  <!-- BEGIN LOG SETTINGS -->
  <script>
    window._settings = window._settings || {};
    window._settings.DEBUG_LOG_LEVEL = "ERROR";
    window._settings.LOG_OUTPUT_DEST = "console";
    window._externalLogServerURL = "";
    window._externalLogServerToken = "";
  </script>
  <!-- END LOG SETTINGS -->
  <!--
    To inject Eruda for mobile debugging, set INJECT_ERUDA=1 in deploy.sh,
    which will insert the following lines at build/deploy time:
    <script src="https://cdn.jsdelivr.net/npm/eruda"></script>
    <script>eruda.init();</script>
  -->
</head>
<body>
  <div id="gl-root"></div>
  <!-- No legacy color pickers, no error-log-box, no stray DOM -->
  <script src="bundle.js"></script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tweakpane Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    /* Optional: some styling for the pane container */
    #pane-container {
      width: 300px;
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>Tweakpane Webpack Demo</h1>
  <div id="pane-container"></div>

  <script src="bundle.js"></script> 
  <!-- Replace bundle.js with your webpack output file -->

</body>
</html>


====== dist/bundle.js (first 20 and last 20 lines) ======
/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={790:(t,e,i)=>{t.exports=function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return s(e[r][1][t]||t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o=void 0,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,n){(function(t){"use strict";var i,n,s=t.MutationObserver||t.WebKitMutationObserver;if(s){var o=0,r=new s(d),a=t.document.createTextNode("");r.observe(a,{characterData:!0}),i=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){d(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(d,0)};else{var l=new t.MessageChannel;l.port1.onmessage=d,i=function(){l.port2.postMessage(0)}}var h=[];function d(){var t,e;n=!0;for(var i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}n=!1}e.exports=function(t){1!==h.push(t)||n||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var n=t(1);function s(){}var o={},r=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==s&&p(this,t)}function d(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(t,e,i){n(function(){var n;try{n=e(i)}catch(e){return o.reject(t,e)}n===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,n)})}function u(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var i=!1;function n(e){i||(i=!0,o.reject(t,e))}function s(e){i||(i=!0,o.resolve(t,e))}var r=m(function(){e(s,n)});"error"===r.status&&n(r.value)}function m(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}e.exports=h,h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===r)return this;var i=new this.constructor(s);return this.state!==l?c(i,this.state===a?t:e,this.outcome):this.queue.push(new d(i,t,e)),i},d.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},d.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},d.prototype.callRejected=function(t){o.reject(this.promise,t)},d.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},o.resolve=function(t,e){var i=m(u,e);if("error"===i.status)return o.reject(t,i.value);var n=i.value;if(n)p(t,n);else{t.state=a,t.outcome=e;for(var s=-1,r=t.queue.length;++s<r;)t.queue[s].callFulfilled(e)}return t},o.reject=function(t,e){t.state=r,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},h.resolve=function(t){return t instanceof this?t:o.resolve(new this(s),t)},h.reject=function(t){var e=new this(s);return o.reject(e,t)},h.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var r=new Array(i),a=0,l=-1,h=new this(s);++l<i;)d(t[l],l);return h;function d(t,s){e.resolve(t).then(function(t){r[s]=t,++a!==i||n||(n=!0,o.resolve(h,r))},function(t){n||(n=!0,o.reject(h,t))})}},h.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var r=-1,a=new this(s);++r<i;)l(t[r]);return a;function l(t){e.resolve(t).then(function(t){n||(n=!0,o.resolve(a,t))},function(t){n||(n=!0,o.reject(a,t))})}}},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var s=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function o(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if("TypeError"!==s.name)throw s;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var r=Promise;function a(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function l(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function h(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var c="local-forage-detect-blob-support",u=void 0,p={},m=Object.prototype.toString,g="readonly",f="readwrite";function v(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),s=0;s<e;s++)n[s]=t.charCodeAt(s);return i}function b(t){return"boolean"==typeof u?r.resolve(u):function(t){return new r(function(e){var i=t.transaction(c,f),n=o([""]);i.objectStore(c).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return u=t})}function _(t){var e=p[t.name],i={};i.promise=new r(function(t,e){i.resolve=t,i.reject=e}),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then(function(){return i.promise}):e.dbReady=i.promise}function w(t){var e=p[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function y(t,e){var i=p[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function C(t,e){return new r(function(i,n){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);_(t),t.db.close()}var o=[t.name];e&&o.push(t.version);var r=s.open.apply(s,o);e&&(r.onupgradeneeded=function(e){var i=r.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(c)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),r.onerror=function(t){t.preventDefault(),n(r.error)},r.onsuccess=function(){var e=r.result;e.onversionchange=function(t){t.target.close()},i(e),w(t)}})}function x(t){return C(t,!1)}function E(t){return C(t,!0)}function S(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,s=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),s||i){if(i){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function P(t){return o([v(atob(t.data))],{type:t.type})}function k(t){return t&&t.__local_forage_encoded_blob}function I(t){var e=this,i=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return l(i,t,t),i}function R(t,e,i,n){void 0===n&&(n=1);try{var s=t.db.transaction(t.storeName,e);i(null,s)}catch(s){if(n>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return r.resolve().then(function(){if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),E(t)}).then(function(){return function(t){_(t);for(var e=p[t.name],i=e.forages,n=0;n<i.length;n++){var s=i[n];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return t.db=null,x(t).then(function(e){return t.db=e,S(t)?E(t):e}).then(function(n){t.db=e.db=n;for(var s=0;s<i.length;s++)i[s]._dbInfo.db=n}).catch(function(e){throw y(t,e),e})}(t).then(function(){R(t,e,i,n-1)})}).catch(i);i(s)}}var M={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var s=p[i.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},p[i.name]=s),s.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=I);var o=[];function a(){return r.resolve()}for(var l=0;l<s.forages.length;l++){var h=s.forages[l];h!==e&&o.push(h._initReady().catch(a))}var d=s.forages.slice(0);return r.all(o).then(function(){return i.db=s.db,x(i)}).then(function(t){return i.db=t,S(i,e._defaultConfig.version)?E(i):t}).then(function(t){i.db=s.db=t,e._dbInfo=i;for(var n=0;n<d.length;n++){var o=d[n];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version)}})},_support:function(){try{if(!s||!s.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).openCursor(),a=1;r.onsuccess=function(){var i=r.result;if(i){var n=i.value;k(n)&&(n=P(n));var s=t(n,i.key,a++);void 0!==s?e(s):i.continue()}else e()},r.onerror=function(){n(r.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).get(t);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null),k(t)&&(t=P(t)),e(t)},r.onerror=function(){n(r.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){var n=this;t=h(t);var s=new r(function(i,s){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===m.call(e)?b(o.db).then(function(t){return t?e:(i=e,new r(function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)}));var i}):e}).then(function(e){R(n._dbInfo,f,function(o,r){if(o)return s(o);try{var a=r.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);r.oncomplete=function(){void 0===e&&(e=null),i(e)},r.onabort=r.onerror=function(){var t=l.error?l.error:l.transaction.error;s(t)}}catch(t){s(t)}})}).catch(s)});return a(s,i),s},removeItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,f,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(r.error)},o.onabort=function(){var t=r.error?r.error:r.transaction.error;n(t)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,f,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).clear();s.oncomplete=function(){t()},s.onabort=s.onerror=function(){var t=o.error?o.error:o.transaction.error;i(t)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,g,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){i(o.error)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new r(function(e,n){t<0?e(null):i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName),a=!1,l=r.openKeyCursor();l.onsuccess=function(){var i=l.result;i?0===t||a?e(i.key):(a=!0,i.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,g,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).openKeyCursor(),r=[];o.onsuccess=function(){var e=o.result;e?(r.push(e.key),e.continue()):t(r)},o.onerror=function(){i(o.error)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i,n=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName),t.name){var o=t.name===n.name&&this._dbInfo.db?r.resolve(this._dbInfo.db):x(t).then(function(e){var i=p[t.name],n=i.forages;i.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e});i=t.storeName?o.then(function(e){if(e.objectStoreNames.contains(t.storeName)){var i=e.version+1;_(t);var n=p[t.name],o=n.forages;e.close();for(var a=0;a<o.length;a++){var l=o[a];l._dbInfo.db=null,l._dbInfo.version=i}var h=new r(function(e,n){var o=s.open(t.name,i);o.onerror=function(t){o.result.close(),n(t)},o.onupgradeneeded=function(){o.result.deleteObjectStore(t.storeName)},o.onsuccess=function(){var t=o.result;t.close(),e(t)}});return h.then(function(t){n.db=t;for(var e=0;e<o.length;e++){var i=o[e];i._dbInfo.db=t,w(i._dbInfo)}}).catch(function(e){throw(y(t,e)||r.resolve()).catch(function(){}),e})}}):o.then(function(e){_(t);var i=p[t.name],n=i.forages;e.close();for(var o=0;o<n.length;o++)n[o]._dbInfo.db=null;var a=new r(function(e,i){var n=s.deleteDatabase(t.name);n.onerror=function(){var t=n.result;t&&t.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}});return a.then(function(t){i.db=t;for(var e=0;e<n.length;e++)w(n[e]._dbInfo)}).catch(function(e){throw(y(t,e)||r.resolve()).catch(function(){}),e})})}else i=r.reject("Invalid arguments");return a(i,e),i}};var L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",D="arbf",z="blob",O="si08",B="ui08",H="uic8",N="si16",V="si32",F="ur16",G="ui32",W="fl32",j="fl64",U=Object.prototype.toString;function q(t){var e,i,n,s,o,r=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);var h=new ArrayBuffer(r),d=new Uint8Array(h);for(e=0;e<a;e+=4)i=L.indexOf(t[e]),n=L.indexOf(t[e+1]),s=L.indexOf(t[e+2]),o=L.indexOf(t[e+3]),d[l++]=i<<2|n>>4,d[l++]=(15&n)<<4|s>>2,d[l++]=(3&s)<<6|63&o;return h}function $(t){var e,i=new Uint8Array(t),n="";for(e=0;e<i.length;e+=3)n+=L[i[e]>>2],n+=L[(3&i[e])<<4|i[e+1]>>4],n+=L[(15&i[e+1])<<2|i[e+2]>>6],n+=L[63&i[e+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var K={serialize:function(t,e){var i="";if(t&&(i=U.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===U.call(t.buffer))){var n,s=A;t instanceof ArrayBuffer?(n=t,s+=D):(n=t.buffer,"[object Int8Array]"===i?s+=O:"[object Uint8Array]"===i?s+=B:"[object Uint8ClampedArray]"===i?s+=H:"[object Int16Array]"===i?s+=N:"[object Uint16Array]"===i?s+=F:"[object Int32Array]"===i?s+=V:"[object Uint32Array]"===i?s+=G:"[object Float32Array]"===i?s+=W:"[object Float64Array]"===i?s+=j:e(new Error("Failed to get type for BinaryArray"))),e(s+$(n))}else if("[object Blob]"===i){var o=new FileReader;o.onload=function(){var i="~~local_forage_type~"+t.type+"~"+$(this.result);e(A+z+i)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(i){console.error("Couldn't convert value into a JSON string: ",t),e(null,i)}},deserialize:function(t){if(t.substring(0,9)!==A)return JSON.parse(t);var e,i=t.substring(13),n=t.substring(9,13);if(n===z&&T.test(i)){var s=i.match(T);e=s[1],i=i.substring(s[0].length)}var r=q(i);switch(n){case D:return r;case z:return o([r],{type:e});case O:return new Int8Array(r);case B:return new Uint8Array(r);case H:return new Uint8ClampedArray(r);case N:return new Int16Array(r);case F:return new Uint16Array(r);case V:return new Int32Array(r);case G:return new Uint32Array(r);case W:return new Float32Array(r);case j:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:q,bufferToString:$};function X(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function Y(t,e,i,n,s,o){t.executeSql(i,n,s,function(t,r){r.code===r.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],function(t,a){a.rows.length?o(t,r):X(t,e,function(){t.executeSql(i,n,s,o)},o)},o):o(t,r)},o)}function Z(t,e,i,n){var s=this;t=h(t);var o=new r(function(o,r){s.ready().then(function(){void 0===e&&(e=null);var a=e,l=s._dbInfo;l.serializer.serialize(e,function(e,h){h?r(h):l.db.transaction(function(i){Y(i,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],function(){o(a)},function(t,e){r(e)})},function(e){if(e.code===e.QUOTA_ERR){if(n>0)return void o(Z.apply(s,[t,a,i,n-1]));r(e)}})})}).catch(r)});return a(o,i),o}var J={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]="string"!=typeof t[n]?t[n].toString():t[n];var s=new r(function(t,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return n(t)}i.db.transaction(function(s){X(s,i,function(){e._dbInfo=i,t()},function(t,e){n(e)})},n)});return i.serializer=K,s},_support:"function"==typeof openDatabase,iterate:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT * FROM "+s.storeName,[],function(i,n){for(var o=n.rows,r=o.length,a=0;a<r;a++){var l=o.item(a),h=l.value;if(h&&(h=s.serializer.deserialize(h)),void 0!==(h=t(h,l.key,a+1)))return void e(h)}e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[t],function(t,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=s.serializer.deserialize(n)),e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){return Z.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"DELETE FROM "+n.storeName,[],function(){t()},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(e,i){var n=i.rows.item(0).c;t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,i){var n=i.rows.length?i.rows.item(0).key:null;e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"SELECT key FROM "+n.storeName,[],function(e,i){for(var n=[],s=0;s<i.rows.length;s++)n.push(i.rows.item(s).key);t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var n,s=this;return a(n=t.name?new r(function(e){var n;n=t.name===i.name?s._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:n,storeNames:[t.storeName]}):e(function(t){return new r(function(e,i){t.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(i,n){for(var s=[],o=0;o<n.rows.length;o++)s.push(n.rows.item(o).name);e({db:t,storeNames:s})},function(t,e){i(e)})},function(t){i(t)})})}(n))}).then(function(t){return new r(function(e,i){t.db.transaction(function(n){function s(t){return new r(function(e,i){n.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(t,e){i(e)})})}for(var o=[],a=0,l=t.storeNames.length;a<l;a++)o.push(s(t.storeNames[a]));r.all(o).then(function(){e()}).catch(function(t){i(t)})},function(t){i(t)})})}):r.reject("Invalid arguments"),e),n}};function Q(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function tt(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}var et={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=Q(t,this._defaultConfig),tt()?(this._dbInfo=e,e.serializer=K,r.resolve()):r.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=i.ready().then(function(){for(var e=i._dbInfo,n=e.keyPrefix,s=n.length,o=localStorage.length,r=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(n)){var h=localStorage.getItem(l);if(h&&(h=e.serializer.deserialize(h)),void 0!==(h=t(h,l.substring(s),r++)))return h}}});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=i.ready().then(function(){var e=i._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return a(n,e),n},setItem:function(t,e,i){var n=this;t=h(t);var s=n.ready().then(function(){void 0===e&&(e=null);var i=e;return new r(function(s,o){var r=n._dbInfo;r.serializer.serialize(e,function(e,n){if(n)o(n);else try{localStorage.setItem(r.keyPrefix+t,e),s(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})});return a(s,i),s},removeItem:function(t,e){var i=this;t=h(t);var n=i.ready().then(function(){var e=i._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return a(n,e),n},clear:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var n=localStorage.key(i);0===n.indexOf(t)&&localStorage.removeItem(n)}});return a(i,t),i},length:function(t){var e=this.keys().then(function(t){return t.length});return a(e,t),e},key:function(t,e){var i=this,n=i.ready().then(function(){var e,n=i._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e});return a(n,e),n},keys:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo,i=localStorage.length,n=[],s=0;s<i;s++){var o=localStorage.key(s);0===o.indexOf(t.keyPrefix)&&n.push(o.substring(t.keyPrefix.length))}return n});return a(i,t),i},dropInstance:function(t,e){if(e=d.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var n,s=this;return n=t.name?new r(function(e){t.storeName?e(Q(t,s._defaultConfig)):e(t.name+"/")}).then(function(t){for(var e=localStorage.length-1;e>=0;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}}):r.reject("Invalid arguments"),a(n,e),n}},it=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},nt=function(t,e){for(var i=t.length,n=0;n<i;){if(it(t[n],e))return!0;n++}return!1},st=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ot={},rt={},at={INDEXEDDB:M,WEBSQL:J,LOCALSTORAGE:et},lt=[at.INDEXEDDB._driver,at.WEBSQL._driver,at.LOCALSTORAGE._driver],ht=["dropInstance"],dt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ht),ct={description:"",driver:lt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ut(t,e){t[e]=function(){var i=arguments;return t.ready().then(function(){return t[e].apply(t,i)})}}function pt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(st(e[i])?arguments[0][i]=e[i].slice():arguments[0][i]=e[i])}return arguments[0]}var mt=function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),at)if(at.hasOwnProperty(i)){var n=at[i],s=n._driver;this[i]=s,ot[s]||this.defineDriver(n)}this._defaultConfig=pt({},ct),this._config=pt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":n(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var n=new r(function(e,i){try{var n=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(s);for(var o=dt.concat("_initStorage"),l=0,h=o.length;l<h;l++){var d=o[l];if((!nt(ht,d)||t[d])&&"function"!=typeof t[d])return void i(s)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),i=r.reject(e);return a(i,arguments[arguments.length-1]),i}},i=0,n=ht.length;i<n;i++){var s=ht[i];t[s]||(t[s]=e(s))}}();var c=function(i){ot[n]&&console.info("Redefining LocalForage driver: "+n),ot[n]=t,rt[n]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(c,i):c(!!t._support):c(!0)}catch(t){i(t)}});return l(n,e,i),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var n=ot[t]?r.resolve(ot[t]):r.reject(new Error("Driver not found."));return l(n,e,i),n},t.prototype.getSerializer=function(t){var e=r.resolve(K);return l(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return l(i,t,t),i},t.prototype.setDriver=function(t,e,i){var n=this;st(t)||(t=[t]);var s=this._getSupportedDrivers(t);function o(){n._config.driver=n.driver()}function a(t){return n._extend(t),o(),n._ready=n._initStorage(n._config),n._ready}var h=null!==this._driverSet?this._driverSet.catch(function(){return r.resolve()}):r.resolve();return this._driverSet=h.then(function(){var t=s[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then(function(t){n._driver=t._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var s=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(s).then(a).catch(i)}o();var l=new Error("No available storage method found.");return n._driverSet=r.reject(l),n._driverSet}()}}(s)})}).catch(function(){o();var t=new Error("No available storage method found.");return n._driverSet=r.reject(t),n._driverSet}),l(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!rt[t]},t.prototype._extend=function(t){pt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];this.supports(s)&&e.push(s)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=dt.length;t<e;t++)ut(this,dt[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),gt=new mt;e.exports=gt},{3:3}]},{},[4])(4)},931:t=>{var e;self,e=()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.d(e,{default:()=>P});var i={};function n(t,e,i,n,s={}){e instanceof HTMLCollection||e instanceof NodeList?e=Array.from(e):Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);for(const o of e)for(const e of i)o[t](e,n,{capture:!1,...s});return Array.prototype.slice.call(arguments,1)}t.r(i),t.d(i,{adjustableInputNumbers:()=>d,createElementFromString:()=>r,createFromTemplate:()=>a,eventPath:()=>l,off:()=>o,on:()=>s,resolveElement:()=>h});const s=n.bind(null,"addEventListener"),o=n.bind(null,"removeEventListener");function r(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstElementChild}function a(t){const e=(t,e)=>{const i=t.getAttribute(e);return t.removeAttribute(e),i},i=(t,n={})=>{const s=e(t,":obj"),o=e(t,":ref"),r=s?n[s]={}:n;o&&(n[o]=t);for(const n of Array.from(t.children)){const t=e(n,":arr"),s=i(n,t?{}:r);t&&(r[t]||(r[t]=[])).push(Object.keys(s).length?s:n)}return n};return i(r(t))}function l(t){let e=t.path||t.composedPath&&t.composedPath();if(e)return e;let i=t.target.parentElement;for(e=[t.target,i];i=i.parentElement;)e.push(i);return e.push(document,window),e}function h(t){return t instanceof Element?t:"string"==typeof t?t.split(/>>/g).reduce((t,e,i,n)=>(t=t.querySelector(e),i<n.length-1?t.shadowRoot:t),document):null}function d(t,e=t=>t){function i(i){const n=[.001,.01,.1][Number(i.shiftKey||2*i.ctrlKey)]*(i.deltaY<0?1:-1);let s=0,o=t.selectionStart;t.value=t.value.replace(/[\d.]+/g,(t,i)=>i<=o&&i+t.length>=o?(o=i,e(Number(t),n,s)):(s++,t)),t.focus(),t.setSelectionRange(o,o),i.preventDefault(),t.dispatchEvent(new Event("input"))}s(t,"focus",()=>s(window,"wheel",i,{passive:!1})),s(t,"blur",()=>o(window,"wheel",i))}const{min:c,max:u,floor:p,round:m}=Math;function g(t,e,i){e/=100,i/=100;const n=p(t=t/360*6),s=t-n,o=i*(1-e),r=i*(1-s*e),a=i*(1-(1-s)*e),l=n%6;return[255*[i,r,o,o,a,i][l],255*[a,i,i,r,o,o][l],255*[o,o,a,i,i,r][l]]}function f(t,e,i){const n=(2-(e/=100))*(i/=100)/2;return 0!==n&&(e=1===n?0:n<.5?e*i/(2*n):e*i/(2-2*n)),[t,100*e,100*n]}function v(t,e,i){const n=c(t/=255,e/=255,i/=255),s=u(t,e,i),o=s-n;let r,a;if(0===o)r=a=0;else{a=o/s;const n=((s-t)/6+o/2)/o,l=((s-e)/6+o/2)/o,h=((s-i)/6+o/2)/o;t===s?r=h-l:e===s?r=1/3+n-h:i===s&&(r=2/3+l-n),r<0?r+=1:r>1&&(r-=1)}return[360*r,100*a,100*s]}function b(t,e,i,n){return e/=100,i/=100,[...v(255*(1-c(1,(t/=100)*(1-(n/=100))+n)),255*(1-c(1,e*(1-n)+n)),255*(1-c(1,i*(1-n)+n)))]}function _(t,e,i){e/=100;const n=2*(e*=(i/=100)<.5?i:1-i)/(i+e)*100,s=100*(i+e);return[t,isNaN(n)?0:n,s]}function w(t){return v(...t.match(/.{2}/g).map(t=>parseInt(t,16)))}function y(t=0,e=0,i=0,n=1){const s=(t,e)=>(i=-1)=>e(~i?t.map(t=>Number(t.toFixed(i))):t),o={h:t,s:e,v:i,a:n,toHSVA(){const t=[o.h,o.s,o.v,o.a];return t.toString=s(t,t=>`hsva(${t[0]}, ${t[1]}%, ${t[2]}%, ${o.a})`),t},toHSLA(){const t=[...f(o.h,o.s,o.v),o.a];return t.toString=s(t,t=>`hsla(${t[0]}, ${t[1]}%, ${t[2]}%, ${o.a})`),t},toRGBA(){const t=[...g(o.h,o.s,o.v),o.a];return t.toString=s(t,t=>`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${o.a})`),t},toCMYK(){const t=function(t,e,i){const n=g(t,e,i),s=n[0]/255,o=n[1]/255,r=n[2]/255,a=c(1-s,1-o,1-r);return[100*(1===a?0:(1-s-a)/(1-a)),100*(1===a?0:(1-o-a)/(1-a)),100*(1===a?0:(1-r-a)/(1-a)),100*a]}(o.h,o.s,o.v);return t.toString=s(t,t=>`cmyk(${t[0]}%, ${t[1]}%, ${t[2]}%, ${t[3]}%)`),t},toHEXA(){const t=function(t,e,i){return g(t,e,i).map(t=>m(t).toString(16).padStart(2,"0"))}(o.h,o.s,o.v),e=o.a>=1?"":Number((255*o.a).toFixed(0)).toString(16).toUpperCase().padStart(2,"0");return e&&t.push(e),t.toString=()=>`#${t.join("").toUpperCase()}`,t},clone:()=>y(o.h,o.s,o.v,o.a)};return o}const C=t=>Math.max(Math.min(t,1),0);function x(t){const e={options:Object.assign({lock:null,onchange:()=>0,onstop:()=>0},t),_keyboard(t){const{options:i}=e,{type:n,key:s}=t;if(document.activeElement===i.wrapper){const{lock:i}=e.options,o="ArrowUp"===s,r="ArrowRight"===s,a="ArrowDown"===s,l="ArrowLeft"===s;if("keydown"===n&&(o||r||a||l)){let n=0,s=0;"v"===i?n=o||r?1:-1:"h"===i?n=o||r?-1:1:(s=o?-1:a?1:0,n=l?-1:r?1:0),e.update(C(e.cache.x+.01*n),C(e.cache.y+.01*s)),t.preventDefault()}else s.startsWith("Arrow")&&(e.options.onstop(),t.preventDefault())}},_tapstart(t){s(document,["mouseup","touchend","touchcancel"],e._tapstop),s(document,["mousemove","touchmove"],e._tapmove),t.cancelable&&t.preventDefault(),e._tapmove(t)},_tapmove(t){const{options:i,cache:n}=e,{lock:s,element:o,wrapper:r}=i,a=r.getBoundingClientRect();let l=0,h=0;if(t){const e=t&&t.touches&&t.touches[0];l=t?(e||t).clientX:0,h=t?(e||t).clientY:0,l<a.left?l=a.left:l>a.left+a.width&&(l=a.left+a.width),h<a.top?h=a.top:h>a.top+a.height&&(h=a.top+a.height),l-=a.left,h-=a.top}else n&&(l=n.x*a.width,h=n.y*a.height);"h"!==s&&(o.style.left=`calc(${l/a.width*100}% - ${o.offsetWidth/2}px)`),"v"!==s&&(o.style.top=`calc(${h/a.height*100}% - ${o.offsetHeight/2}px)`),e.cache={x:l/a.width,y:h/a.height};const d=C(l/a.width),c=C(h/a.height);switch(s){case"v":return i.onchange(d);case"h":return i.onchange(c);default:return i.onchange(d,c)}},_tapstop(){e.options.onstop(),o(document,["mouseup","touchend","touchcancel"],e._tapstop),o(document,["mousemove","touchmove"],e._tapmove)},trigger(){e._tapmove()},update(t=0,i=0){const{left:n,top:s,width:o,height:r}=e.options.wrapper.getBoundingClientRect();"h"===e.options.lock&&(i=t),e._tapmove({clientX:n+o*t,clientY:s+r*i})},destroy(){const{options:t,_tapstart:i,_keyboard:n}=e;o(document,["keydown","keyup"],n),o([t.wrapper,t.element],"mousedown",i),o([t.wrapper,t.element],"touchstart",i,{passive:!1})}},{options:i,_tapstart:n,_keyboard:r}=e;return s([i.wrapper,i.element],"mousedown",n),s([i.wrapper,i.element],"touchstart",n,{passive:!1}),s(document,["keydown","keyup"],r),e}function E(t={}){t=Object.assign({onchange:()=>0,className:"",elements:[]},t);const e=s(t.elements,"click",e=>{t.elements.forEach(i=>i.classList[e.target===i?"add":"remove"](t.className)),t.onchange(e),e.stopPropagation()});return{destroy:()=>o(...e)}}const S={variantFlipOrder:{start:"sme",middle:"mse",end:"ems"},positionFlipOrder:{top:"tbrl",right:"rltb",bottom:"btrl",left:"lrbt"},position:"bottom",margin:8,padding:0};class P{static utils=i;static version="1.9.1";static I18N_DEFAULTS={"ui:dialog":"color picker dialog","btn:toggle":"toggle color picker dialog","btn:swatch":"color swatch","btn:last-color":"use previous color","btn:save":"Save","btn:cancel":"Cancel","btn:clear":"Clear","aria:btn:save":"save and close","aria:btn:cancel":"cancel and close","aria:btn:clear":"clear and close","aria:input":"color input field","aria:palette":"color selection area","aria:hue":"hue selection slider","aria:opacity":"selection slider"};static DEFAULT_OPTIONS={appClass:null,theme:"classic",useAsButton:!1,padding:8,disabled:!1,comparison:!0,closeOnScroll:!1,outputPrecision:0,lockOpacity:!1,autoReposition:!0,container:"body",components:{interaction:{}},i18n:{},swatches:null,inline:!1,sliders:null,default:"#42445a",defaultRepresentation:null,position:"bottom-middle",adjustableNumbers:!0,showAlways:!1,closeWithKey:"Escape"};_initializingActive=!0;_recalc=!0;_nanopop=null;_root=null;_color=y();_lastColor=y();_swatchColors=[];_setupAnimationFrame=null;_eventListener={init:[],save:[],hide:[],show:[],clear:[],change:[],changestop:[],cancel:[],swatchselect:[]};constructor(t){this.options=t=Object.assign({...P.DEFAULT_OPTIONS},t);const{swatches:e,components:i,theme:n,sliders:s,lockOpacity:o,padding:r}=t;["nano","monolith"].includes(n)&&!s&&(t.sliders="h"),i.interaction||(i.interaction={});const{preview:a,opacity:l,hue:h,palette:d}=i;i.opacity=!o&&l,i.palette=d||a||l||h,this._preBuild(),this._buildComponents(),this._bindEvents(),this._finalBuild(),e&&e.length&&e.forEach(t=>this.addSwatch(t));const{button:c,app:u}=this._root;this._nanopop=((t,e,i)=>{const n="object"!=typeof t||t instanceof HTMLElement?{reference:t,popper:e,...i}:t;return{update(t=n){const{reference:e,popper:i}=Object.assign(n,t);if(!i||!e)throw new Error("Popper- or reference-element missing.");return((t,e,i)=>{const{container:n,arrow:s,margin:o,padding:r,position:a,variantFlipOrder:l,positionFlipOrder:h}={container:document.documentElement.getBoundingClientRect(),...S,...i},{left:d,top:c}=e.style;e.style.left="0",e.style.top="0";const u=t.getBoundingClientRect(),p=e.getBoundingClientRect(),m={t:u.top-p.height-o,b:u.bottom+o,r:u.right+o,l:u.left-p.width-o},g={vs:u.left,vm:u.left+u.width/2-p.width/2,ve:u.left+u.width-p.width,hs:u.top,hm:u.bottom-u.height/2-p.height/2,he:u.bottom-p.height},[f,v="middle"]=a.split("-"),b=h[f],_=l[v],{top:w,left:y,bottom:C,right:x}=n;for(const t of b){const i="t"===t||"b"===t;let n=m[t];const[o,a]=i?["top","left"]:["left","top"],[l,h]=i?[p.height,p.width]:[p.width,p.height],[d,c]=i?[C,x]:[x,C],[f,v]=i?[w,y]:[y,w];if(!(n<f||n+l+r>d))for(const d of _){let m=g[(i?"v":"h")+d];if(!(m<v||m+h+r>c)){if(m-=p[a],n-=p[o],e.style[a]=`${m}px`,e.style[o]=`${n}px`,s){const e=i?u.width/2:u.height/2,r=h/2,c=e>r,p=m+{s:c?r:e,m:r,e:c?r:h-e}[d],g=n+{t:l,b:0,r:0,l}[t];s.style[a]=`${p}px`,s.style[o]=`${g}px`}return t+d}}}return e.style.left=d,e.style.top=c,null})(e,i,n)}}})(c,u,{margin:r}),c.setAttribute("role","button"),c.setAttribute("aria-label",this._t("btn:toggle"));const p=this;this._setupAnimationFrame=requestAnimationFrame(function e(){if(!u.offsetWidth)return requestAnimationFrame(e);p.setColor(t.default),p._rePositioningPicker(),t.defaultRepresentation&&(p._representation=t.defaultRepresentation,p.setColorRepresentation(p._representation)),t.showAlways&&p.show(),p._initializingActive=!1,p._emit("init")})}static create=t=>new P(t);_preBuild(){const{options:t}=this;for(const e of["el","container"])t[e]=h(t[e]);this._root=(t=>{const{components:e,useAsButton:i,inline:n,appClass:s,theme:o,lockOpacity:r}=t.options,l=t=>t?"":'style="display:none" hidden',h=e=>t._t(e),d=a(`\n      <div :ref="root" class="pickr">\n\n        ${i?"":'<button type="button" :ref="button" class="pcr-button"></button>'}\n\n        <div :ref="app" class="pcr-app ${s||""}" data-theme="${o}" ${n?'style="position: unset"':""} aria-label="${h("ui:dialog")}" role="window">\n          <div class="pcr-selection" ${l(e.palette)}>\n            <div :obj="preview" class="pcr-color-preview" ${l(e.preview)}>\n              <button type="button" :ref="lastColor" class="pcr-last-color" aria-label="${h("btn:last-color")}"></button>\n              <div :ref="currentColor" class="pcr-current-color"></div>\n            </div>\n\n            <div :obj="palette" class="pcr-color-palette">\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="palette" class="pcr-palette" tabindex="0" aria-label="${h("aria:palette")}" role="listbox"></div>\n            </div>\n\n            <div :obj="hue" class="pcr-color-chooser" ${l(e.hue)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-hue pcr-slider" tabindex="0" aria-label="${h("aria:hue")}" role="slider"></div>\n            </div>\n\n            <div :obj="opacity" class="pcr-color-opacity" ${l(e.opacity)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-opacity pcr-slider" tabindex="0" aria-label="${h("aria:opacity")}" role="slider"></div>\n            </div>\n          </div>\n\n          <div class="pcr-swatches ${e.palette?"":"pcr-last"}" :ref="swatches"></div>\n\n          <div :obj="interaction" class="pcr-interaction" ${l(Object.keys(e.interaction).length)}>\n            <input :ref="result" class="pcr-result" type="text" spellcheck="false" ${l(e.interaction.input)} aria-label="${h("aria:input")}">\n\n            <input :arr="options" class="pcr-type" data-type="HEXA" value="${r?"HEX":"HEXA"}" type="button" ${l(e.interaction.hex)}>\n            <input :arr="options" class="pcr-type" data-type="RGBA" value="${r?"RGB":"RGBA"}" type="button" ${l(e.interaction.rgba)}>\n            <input :arr="options" class="pcr-type" data-type="HSLA" value="${r?"HSL":"HSLA"}" type="button" ${l(e.interaction.hsla)}>\n            <input :arr="options" class="pcr-type" data-type="HSVA" value="${r?"HSV":"HSVA"}" type="button" ${l(e.interaction.hsva)}>\n            <input :arr="options" class="pcr-type" data-type="CMYK" value="CMYK" type="button" ${l(e.interaction.cmyk)}>\n\n            <input :ref="save" class="pcr-save" value="${h("btn:save")}" type="button" ${l(e.interaction.save)} aria-label="${h("aria:btn:save")}">\n            <input :ref="cancel" class="pcr-cancel" value="${h("btn:cancel")}" type="button" ${l(e.interaction.cancel)} aria-label="${h("aria:btn:cancel")}">\n            <input :ref="clear" class="pcr-clear" value="${h("btn:clear")}" type="button" ${l(e.interaction.clear)} aria-label="${h("aria:btn:clear")}">\n          </div>\n        </div>\n      </div>\n    `),c=d.interaction;return c.options.find(t=>!t.hidden&&!t.classList.add("active")),c.type=()=>c.options.find(t=>t.classList.contains("active")),d})(this),t.useAsButton&&(this._root.button=t.el),t.container.appendChild(this._root.root)}_finalBuild(){const t=this.options,e=this._root;if(t.container.removeChild(e.root),t.inline){const i=t.el.parentElement;t.el.nextSibling?i.insertBefore(e.app,t.el.nextSibling):i.appendChild(e.app)}else t.container.appendChild(e.app);t.useAsButton?t.inline&&t.el.remove():t.el.parentNode.replaceChild(e.root,t.el),t.disabled&&this.disable(),t.comparison||(e.button.style.transition="none",t.useAsButton||(e.preview.lastColor.style.transition="none")),this.hide()}_buildComponents(){const t=this,e=this.options.components,i=(t.options.sliders||"v").repeat(2),[n,s]=i.match(/^[vh]+$/g)?i:[],o=()=>this._color||(this._color=this._lastColor.clone()),r={palette:x({element:t._root.palette.picker,wrapper:t._root.palette.palette,onstop:()=>t._emit("changestop","slider",t),onchange(i,n){if(!e.palette)return;const s=o(),{_root:r,options:a}=t,{lastColor:l,currentColor:h}=r.preview;t._recalc&&(s.s=100*i,s.v=100-100*n,s.v<0&&(s.v=0),t._updateOutput("slider"));const d=s.toRGBA().toString(0);this.element.style.background=d,this.wrapper.style.background=`\n                        linear-gradient(to top, rgba(0, 0, 0, ${s.a}), transparent),\n                        linear-gradient(to left, hsla(${s.h}, 100%, 50%, ${s.a}), rgba(255, 255, 255, ${s.a}))\n                    `,a.comparison?a.useAsButton||t._lastColor||l.style.setProperty("--pcr-color",d):(r.button.style.setProperty("--pcr-color",d),r.button.classList.remove("clear"));const c=s.toHEXA().toString();for(const{el:e,color:i}of t._swatchColors)e.classList[c===i.toHEXA().toString()?"add":"remove"]("pcr-active");h.style.setProperty("--pcr-color",d)}}),hue:x({lock:"v"===s?"h":"v",element:t._root.hue.picker,wrapper:t._root.hue.slider,onstop:()=>t._emit("changestop","slider",t),onchange(i){if(!e.hue||!e.palette)return;const n=o();t._recalc&&(n.h=360*i),this.element.style.backgroundColor=`hsl(${n.h}, 100%, 50%)`,r.palette.trigger()}}),opacity:x({lock:"v"===n?"h":"v",element:t._root.opacity.picker,wrapper:t._root.opacity.slider,onstop:()=>t._emit("changestop","slider",t),onchange(i){if(!e.opacity||!e.palette)return;const n=o();t._recalc&&(n.a=Math.round(100*i)/100),this.element.style.background=`rgba(0, 0, 0, ${n.a})`,r.palette.trigger()}}),selectable:E({elements:t._root.interaction.options,className:"active",onchange(e){t._representation=e.target.getAttribute("data-type").toUpperCase(),t._recalc&&t._updateOutput("swatch")}})};this._components=r}_bindEvents(){const{_root:t,options:e}=this,i=[s(t.interaction.clear,"click",()=>this._clearColor()),s([t.interaction.cancel,t.preview.lastColor],"click",()=>{this.setHSVA(...(this._lastColor||this._color).toHSVA(),!0),this._emit("cancel")}),s(t.interaction.save,"click",()=>{!this.applyColor()&&!e.showAlways&&this.hide()}),s(t.interaction.result,["keyup","input"],t=>{this.setColor(t.target.value,!0)&&!this._initializingActive&&(this._emit("change",this._color,"input",this),this._emit("changestop","input",this)),t.stopImmediatePropagation()}),s(t.interaction.result,["focus","blur"],t=>{this._recalc="blur"===t.type,this._recalc&&this._updateOutput(null)}),s([t.palette.palette,t.palette.picker,t.hue.slider,t.hue.picker,t.opacity.slider,t.opacity.picker],["mousedown","touchstart"],()=>this._recalc=!0,{passive:!0})];if(!e.showAlways){const n=e.closeWithKey;i.push(s(t.button,"click",()=>this.isOpen()?this.hide():this.show()),s(document,"keyup",t=>this.isOpen()&&(t.key===n||t.code===n)&&this.hide()),s(document,["touchstart","mousedown"],e=>{this.isOpen()&&!l(e).some(e=>e===t.app||e===t.button)&&this.hide()},{capture:!0}))}if(e.adjustableNumbers){const e={rgba:[255,255,255,1],hsva:[360,100,100,1],hsla:[360,100,100,1],cmyk:[100,100,100,100]};d(t.interaction.result,(t,i,n)=>{const s=e[this.getColorRepresentation().toLowerCase()];if(s){const e=s[n],o=t+(e>=100?1e3*i:i);return o<=0?0:Number((o<e?o:e).toPrecision(3))}return t})}if(e.autoReposition&&!e.inline){let t=null;const n=this;i.push(s(window,["scroll","resize"],()=>{n.isOpen()&&(e.closeOnScroll&&n.hide(),null===t?(t=setTimeout(()=>t=null,100),requestAnimationFrame(function e(){n._rePositioningPicker(),null!==t&&requestAnimationFrame(e)})):(clearTimeout(t),t=setTimeout(()=>t=null,100)))},{capture:!0}))}this._eventBindings=i}_rePositioningPicker(){const{options:t}=this;if(!t.inline&&!this._nanopop.update({container:document.body.getBoundingClientRect(),position:t.position})){const t=this._root.app,e=t.getBoundingClientRect();t.style.top=(window.innerHeight-e.height)/2+"px",t.style.left=(window.innerWidth-e.width)/2+"px"}}_updateOutput(t){const{_root:e,_color:i,options:n}=this;if(e.interaction.type()){const t=`to${e.interaction.type().getAttribute("data-type")}`;e.interaction.result.value="function"==typeof i[t]?i[t]().toString(n.outputPrecision):""}!this._initializingActive&&this._recalc&&this._emit("change",i,t,this)}_clearColor(t=!1){const{_root:e,options:i}=this;i.useAsButton||e.button.style.setProperty("--pcr-color","rgba(0, 0, 0, 0.15)"),e.button.classList.add("clear"),i.showAlways||this.hide(),this._lastColor=null,this._initializingActive||t||(this._emit("save",null),this._emit("clear"))}_parseLocalColor(t){const{values:e,type:i,a:n}=function(t){t=t.match(/^[a-zA-Z]+$/)?function(t){if("black"===t.toLowerCase())return"#000";const e=document.createElement("canvas").getContext("2d");return e.fillStyle=t,"#000"===e.fillStyle?null:e.fillStyle}(t):t;const e={cmyk:/^cmyk\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)/i,rgba:/^rgba?\D+([\d.]+)(%?)\D+([\d.]+)(%?)\D+([\d.]+)(%?)\D*?(([\d.]+)(%?)|$)/i,hsla:/^hsla?\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D*?(([\d.]+)(%?)|$)/i,hsva:/^hsva?\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D*?(([\d.]+)(%?)|$)/i,hexa:/^#?(([\dA-Fa-f]{3,4})|([\dA-Fa-f]{6})|([\dA-Fa-f]{8}))$/i},i=t=>t.map(t=>/^(|\d+)\.\d+|\d+$/.test(t)?Number(t):void 0);let n;t:for(const s in e)if(n=e[s].exec(t))switch(s){case"cmyk":{const[,t,e,o,r]=i(n);if(t>100||e>100||o>100||r>100)break t;return{values:b(t,e,o,r),type:s}}case"rgba":{let[,t,,e,,o,,,r]=i(n);if(t="%"===n[2]?t/100*255:t,e="%"===n[4]?e/100*255:e,o="%"===n[6]?o/100*255:o,r="%"===n[9]?r/100:r,t>255||e>255||o>255||r<0||r>1)break t;return{values:[...v(t,e,o),r],a:r,type:s}}case"hexa":{let[,t]=n;4!==t.length&&3!==t.length||(t=t.split("").map(t=>t+t).join(""));const e=t.substring(0,6);let i=t.substring(6);return i=i?parseInt(i,16)/255:void 0,{values:[...w(e),i],a:i,type:s}}case"hsla":{let[,t,e,o,,r]=i(n);if(r="%"===n[6]?r/100:r,t>360||e>100||o>100||r<0||r>1)break t;return{values:[..._(t,e,o),r],a:r,type:s}}case"hsva":{let[,t,e,o,,r]=i(n);if(r="%"===n[6]?r/100:r,t>360||e>100||o>100||r<0||r>1)break t;return{values:[t,e,o,r],a:r,type:s}}}return{values:null,type:null}}(t),{lockOpacity:s}=this.options,o=void 0!==n&&1!==n;return e&&3===e.length&&(e[3]=void 0),{values:!e||s&&o?null:e,type:i}}_t(t){return this.options.i18n[t]||P.I18N_DEFAULTS[t]}_emit(t,...e){this._eventListener[t].forEach(t=>t(...e,this))}on(t,e){return this._eventListener[t].push(e),this}off(t,e){const i=this._eventListener[t]||[],n=i.indexOf(e);return~n&&i.splice(n,1),this}addSwatch(t){const{values:e}=this._parseLocalColor(t);if(e){const{_swatchColors:t,_root:i}=this,n=y(...e),o=r(`<button type="button" style="--pcr-color: ${n.toRGBA().toString(0)}" aria-label="${this._t("btn:swatch")}"/>`);return i.swatches.appendChild(o),t.push({el:o,color:n}),this._eventBindings.push(s(o,"click",()=>{this.setHSVA(...n.toHSVA(),!0),this._emit("swatchselect",n),this._emit("change",n,"swatch",this)})),!0}return!1}removeSwatch(t){const e=this._swatchColors[t];if(e){const{el:i}=e;return this._root.swatches.removeChild(i),this._swatchColors.splice(t,1),!0}return!1}applyColor(t=!1){const{preview:e,button:i}=this._root,n=this._color.toRGBA().toString(0);return e.lastColor.style.setProperty("--pcr-color",n),this.options.useAsButton||i.style.setProperty("--pcr-color",n),i.classList.remove("clear"),this._lastColor=this._color.clone(),this._initializingActive||t||this._emit("save",this._color),this}destroy(){cancelAnimationFrame(this._setupAnimationFrame),this._eventBindings.forEach(t=>o(...t)),Object.keys(this._components).forEach(t=>this._components[t].destroy())}destroyAndRemove(){this.destroy();const{root:t,app:e}=this._root;t.parentElement&&t.parentElement.removeChild(t),e.parentElement.removeChild(e),Object.keys(this).forEach(t=>this[t]=null)}hide(){return!!this.isOpen()&&(this._root.app.classList.remove("visible"),this._emit("hide"),!0)}show(){return!this.options.disabled&&!this.isOpen()&&(this._root.app.classList.add("visible"),this._rePositioningPicker(),this._emit("show",this._color),this)}isOpen(){return this._root.app.classList.contains("visible")}setHSVA(t=360,e=0,i=0,n=1,s=!1){const o=this._recalc;if(this._recalc=!1,t<0||t>360||e<0||e>100||i<0||i>100||n<0||n>1)return!1;this._color=y(t,e,i,n);const{hue:r,opacity:a,palette:l}=this._components;return r.update(t/360),a.update(n),l.update(e/100,1-i/100),s||this.applyColor(),o&&this._updateOutput(),this._recalc=o,!0}setColor(t,e=!1){if(null===t)return this._clearColor(e),!0;const{values:i,type:n}=this._parseLocalColor(t);if(i){const t=n.toUpperCase(),{options:s}=this._root.interaction,o=s.find(e=>e.getAttribute("data-type")===t);if(o&&!o.hidden)for(const t of s)t.classList[t===o?"add":"remove"]("active");return!!this.setHSVA(...i,e)&&this.setColorRepresentation(t)}return!1}setColorRepresentation(t){return t=t.toUpperCase(),!!this._root.interaction.options.find(e=>e.getAttribute("data-type").startsWith(t)&&!e.click())}getColorRepresentation(){return this._representation}getColor(){return this._color}getSelectedColor(){return this._lastColor}getRoot(){return this._root}disable(){return this.hide(),this.options.disabled=!0,this._root.button.classList.add("disabled"),this}enable(){return this.options.disabled=!1,this._root.button.classList.remove("disabled"),this}}return e.default})(),t.exports=e()}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";class t extends Error{constructor(t,e,i){super(`${t}: ${e}${void 0===i?"":": "+i}`)}}class e extends t{constructor(t,e){super("Assert",t,e)}}class n extends t{constructor(t,e,i){super("UnreachableCase",t,`${e}${void 0===i?"":": "+i}`)}}class s extends t{constructor(t,e){super("UnexpectedNull",t,e)}}class o extends t{constructor(t,e){super("UnexpectedUndefined",t,e)}}var r,a,l,h,d;!function(t){const e=["settings","hasHeaders","constrainDragToContainer","selectionEnabled","dimensions","borderWidth","minItemHeight","minItemWidth","headerHeight","dragProxyWidth","dragProxyHeight","labels","close","maximise","minimise","popout","content","componentType","componentState","id","width","type","height","isClosable","title","popoutWholeStack","openPopouts","parentId","activeItemIndex","reorderEnabled","borderGrabWidth"],i=[!0,!1,"row","column","stack","component","close","maximise","minimise","open in new window"];function n(t,e){const i={};for(const n in t)if(t.hasOwnProperty(n)){let a;a=e?o(n):r(n);const l=t[n];i[a]=s(l,e)}return i}function s(t,e){return"object"==typeof t?null===t?null:Array.isArray(t)?function(t,e){const i=t.length,n=new Array(i);for(let o=0;o<i;o++){const i=t[o];n[o]=s(i,e)}return n}(t,e):n(t,e):e?function(t){if("string"==typeof t&&1===t.length)return"___"+t;const e=function(t){for(let e=0;e<i.length;e++)if(i[e]===t)return e;return-1}(t);return-1===e?t:e.toString(36)}(t):"string"==typeof(o=t)&&1===o.length?i[parseInt(o,36)]:"string"==typeof o&&"___"===o.substr(0,3)?o[3]:o;var o}function o(t){if("string"==typeof t&&1===t.length)return"___"+t;const i=function(t){for(let i=0;i<e.length;i++)if(e[i]===t)return i;return-1}(t);return-1===i?t:i.toString(36)}function r(t){return 1===t.length?e[parseInt(t,36)]:"___"===t.substr(0,3)?t[3]:t}t.checkInitialise=function(){if(e.length>36)throw new Error("Too many keys in config minifier map")},t.translateObject=n}(r||(r={})),function(t){t.defaultComponentBaseZIndex="auto",t.defaultComponentDragZIndex="32",t.defaultComponentStackMaximisedZIndex="41"}(a||(a={})),function(t){t.width="width",t.height="height"}(l||(l={})),function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(h||(h={})),function(t){t.base="base",t.drag="drag",t.stackMaximised="stackMaximised"}(d||(d={}));const c={base:a.defaultComponentBaseZIndex,drag:a.defaultComponentDragZIndex,stackMaximised:a.defaultComponentStackMaximisedZIndex};var u,p,m,g,f,v,b,_,w,y,C,x,E,S;function P(t){return t.toString(10)+"px"}function k(t){const e=t.replace("px","");return parseFloat(e)}function I(t){return t>="0"&&t<="9"}function R(t,e){const i=P(e);t.style.width=i}function M(t,e){const i=P(e);t.style.height=i}function L(t){return{width:t.offsetWidth,height:t.offsetHeight}}function T(t,e){t.style.display=e?"":"none"}function A(t,e){if(void 0!==e)for(const i in e)if(e.hasOwnProperty(i)){const n=e[i],s=t[i];t[i]=D(s,n)}return t}function D(t,e){if("object"!=typeof e)return e;if(Array.isArray(e)){const t=e.length,i=new Array(t);for(let n=0;n<t;n++){const t=e[n];i[n]=D({},t)}return i}if(null===e)return null;{const i=e;return void 0===t||("object"!=typeof t||Array.isArray(t))?A({},i):A(null===t?{}:t,i)}}function z(){return(1e15*Math.random()).toString(36).replace(".","")}!function(t){function e(t){return!Array.isArray(t)&&null!==t&&"object"==typeof t}t.isJson=function(t){return e(t)},t.isJsonObject=e}(u||(u={})),function(t){t.ground="ground",t.row="row",t.column="column",t.stack="stack",t.component="component"}(p||(p={})),function(t){t.none="none",t.always="always",t.onload="onload"}(m||(m={})),function(t){t.Pixel="px",t.Percent="%",t.Fractional="fr",t.Em="em"}(g||(g={})),function(t){t.tryParse=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:return}},t.format=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:throw new n("SUEF44998",e)}}}(g||(g={})),function(t){t.defaults={type:p.ground,content:[],size:1,sizeUnit:g.Fractional,minSize:void 0,minSizeUnit:g.Pixel,id:"",isClosable:!0},t.createCopy=function(t,e){switch(t.type){case p.ground:case p.row:case p.column:return w.createCopy(t,e);case p.stack:return b.createCopy(t,e);case p.component:return _.createCopy(t);default:throw new n("CICC91354",t.type,"Invalid Config Item type specified")}},t.createDefault=function(t){switch(t){case p.ground:throw new e("CICCDR91562");case p.row:case p.column:return w.createDefault(t);case p.stack:return b.createDefault();case p.component:return _.createDefault();default:throw new n("CICCDD91563",t,"Invalid Config Item type specified")}},t.isComponentItem=function(t){return t.type===p.component},t.isStackItem=function(t){return t.type===p.stack},t.isGroundItem=function(t){return t.type===p.ground}}(f||(f={})),function(t){let e;t.defaultMaximised=!1,function(t){t.createCopy=function(t,e){return void 0===t?void 0:{show:null!=e?e:t.show,popout:t.popout,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}}}(e=t.Header||(t.Header={}))}(v||(v={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=f.createCopy(t[n]);return i}t.defaultActiveItemIndex=0,t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:v.Header.createCopy(t.header)}},t.copyContent=e,t.createDefault=function(){return{type:p.stack,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,maximised:v.defaultMaximised,isClosable:f.defaults.isClosable,activeItemIndex:t.defaultActiveItemIndex,header:void 0}}}(b||(b={})),function(t){t.defaultReorderEnabled=!0,t.resolveComponentTypeName=function(t){const e=t.componentType;return"string"==typeof e?e:void 0},t.createCopy=function(t){return{type:t.type,content:[],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:v.Header.createCopy(t.header),componentType:t.componentType,componentState:D(void 0,t.componentState)}},t.createDefault=function(e="",i,n=""){return{type:p.component,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,maximised:v.defaultMaximised,isClosable:f.defaults.isClosable,reorderEnabled:t.defaultReorderEnabled,title:n,header:void 0,componentType:e,componentState:i}},t.copyComponentType=function(t){return D({},t)}}(_||(_={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=f.createCopy(t[n]);return i}t.isChildItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("CROCOSPCICIC13687",t.type)}},t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,isClosable:t.isClosable}},t.copyContent=e,t.createDefault=function(t){return{type:t,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,isClosable:f.defaults.isClosable}}}(w||(w={})),function(t){t.createCopy=function(t){return f.createCopy(t)},t.isRootItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("CROCOSPCICIC13687",t.type)}}}(y||(y={})),function(t){t.create=function(t){const e=void 0===t?[]:[t];return{type:p.ground,content:e,size:100,sizeUnit:g.Percent,minSize:0,minSizeUnit:g.Pixel,id:"",isClosable:!1,title:"",reorderEnabled:!1}}}(C||(C={})),function(t){let e,i,n;function s(t){return"parentId"in t}!function(t){t.defaults={constrainDragToContainer:!0,reorderEnabled:!0,popoutWholeStack:!1,blockedPopoutsThrowError:!0,closePopoutsOnUnload:!0,responsiveMode:m.none,tabOverlapAllowance:0,reorderOnTabMenuClick:!0,tabControlOffset:10,popInOnClose:!1},t.createCopy=function(t){return{constrainDragToContainer:t.constrainDragToContainer,reorderEnabled:t.reorderEnabled,popoutWholeStack:t.popoutWholeStack,blockedPopoutsThrowError:t.blockedPopoutsThrowError,closePopoutsOnUnload:t.closePopoutsOnUnload,responsiveMode:t.responsiveMode,tabOverlapAllowance:t.tabOverlapAllowance,reorderOnTabMenuClick:t.reorderOnTabMenuClick,tabControlOffset:t.tabControlOffset,popInOnClose:t.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.createCopy=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,defaultMinItemHeight:t.defaultMinItemHeight,defaultMinItemHeightUnit:t.defaultMinItemHeightUnit,defaultMinItemWidth:t.defaultMinItemWidth,defaultMinItemWidthUnit:t.defaultMinItemWidthUnit,headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.defaults={borderWidth:5,borderGrabWidth:5,defaultMinItemHeight:0,defaultMinItemHeightUnit:g.Pixel,defaultMinItemWidth:10,defaultMinItemWidthUnit:g.Pixel,headerHeight:20,dragProxyWidth:300,dragProxyHeight:200}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.createCopy=function(t){return{show:t.show,popout:t.popout,dock:t.dock,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}},t.defaults={show:h.top,popout:"open in new window",dock:"dock",maximise:"maximise",minimise:"minimise",close:"close",tabDropdown:"additional tabs"}}(n=t.Header||(t.Header={})),t.isPopout=s,t.createDefault=function(){return{root:void 0,openPopouts:[],dimensions:t.Dimensions.defaults,settings:t.Settings.defaults,header:t.Header.defaults,resolved:!0}},t.createCopy=function(e){return s(e)?E.createCopy(e):{root:void 0===e.root?void 0:y.createCopy(e.root),openPopouts:t.copyOpenPopouts(e.openPopouts),settings:t.Settings.createCopy(e.settings),dimensions:t.Dimensions.createCopy(e.dimensions),header:t.Header.createCopy(e.header),resolved:e.resolved}},t.copyOpenPopouts=function(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=E.createCopy(t[n]);return i},t.minifyConfig=function(t){return r.translateObject(t,!0)},t.unminifyConfig=function(t){return r.translateObject(t,!1)}}(x||(x={})),function(t){let e;!function(t){t.createCopy=function(t){return{width:t.width,height:t.height,left:t.left,top:t.top}},t.defaults={width:null,height:null,left:null,top:null}}(e=t.Window||(t.Window={})),t.createCopy=function(e){return{root:void 0===e.root?void 0:y.createCopy(e.root),openPopouts:x.copyOpenPopouts(e.openPopouts),settings:x.Settings.createCopy(e.settings),dimensions:x.Dimensions.createCopy(e.dimensions),header:x.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.createCopy(e.window),resolved:e.resolved}}}(E||(E={}));class O extends Error{constructor(t,e){super(e),this.type=t}}class B extends O{constructor(t,e){super("Configuration",t),this.node=e}}class H extends O{constructor(t){super("PopoutBlocked",t)}}class N extends O{constructor(t){super("API",t)}}class V extends O{constructor(t){super("Bind",t)}}!function(t){let i=!1;const n={PopoutCannotBeCreatedWithGroundItemConfig:{id:0,default:"Popout cannot be created with ground ItemConfig"},PleaseRegisterAConstructorFunction:{id:1,default:"Please register a constructor function"},ComponentTypeNotRegisteredAndBindComponentEventHandlerNotAssigned:{id:2,default:"Component type not registered and BindComponentEvent handler not assigned"},ComponentIsAlreadyRegistered:{id:3,default:"Component is already registered"},ComponentIsNotVirtuable:{id:4,default:"Component is not virtuable. Requires rootHtmlElement field/getter"},VirtualComponentDoesNotHaveRootHtmlElement:{id:5,default:'Virtual component does not have getter "rootHtmlElement"'},ItemConfigIsNotTypeComponent:{id:6,default:"ItemConfig is not of type component"},InvalidNumberPartInSizeString:{id:7,default:"Invalid number part in size string"},UnknownUnitInSizeString:{id:8,default:"Unknown unit in size string"},UnsupportedUnitInSizeString:{id:9,default:"Unsupported unit in size string"}};t.idCount=Object.keys(n).length;const s=Object.values(n);t.checkInitialise=function(){if(!i)for(let i=0;i<t.idCount;i++){const t=s[i];if(t.id!==i)throw new e("INSI00110",`${i}: ${t.id}`);F[i]=t.default}i=!0}}(S||(S={}));const F=new Array(S.idCount);var G,W,j,U,q,$,K,X;function Y(t,e){const{numericPart:i,firstNonNumericCharPart:n}=function(t){const e=(t=t.trimStart()).length;if(0===e)return{numericPart:"",firstNonNumericCharPart:""};{let i=e,n=!1;for(let s=0;s<e;s++){const e=t[s];if(!I(e)){if("."!==e){i=s;break}if(n){i=s;break}n=!0}}return{numericPart:t.substring(0,i),firstNonNumericCharPart:t.substring(i).trim()}}}(t),s=Number.parseInt(i,10);if(isNaN(s))throw new B(`${F[7]}: ${t}`);{const i=g.tryParse(n);if(void 0===i)throw new B(`${F[8]}: ${t}`);if(e.includes(i))return{size:s,sizeUnit:i};throw new B(`${F[9]}: ${t}`)}}function Z(t,e){return t.toString(10)+g.format(e)}function J(t,e){return void 0===t?void 0:t.toString(10)+g.format(e)}!function(t){t.resolve=function(t,e){switch(t.type){case p.ground:throw new B("ItemConfig cannot specify type ground",JSON.stringify(t));case p.row:case p.column:return q.resolve(t,e);case p.stack:return j.resolve(t,e);case p.component:return U.resolve(t,e);default:throw new n("UCUICR55499",t.type)}},t.resolveContent=function(e){if(void 0===e)return[];{const i=e.length,n=new Array(i);for(let s=0;s<i;s++)n[s]=t.resolve(e[s],!1);return n}},t.resolveId=function(t){return void 0===t?f.defaults.id:Array.isArray(t)?0===t.length?f.defaults.id:t[0]:t},t.resolveSize=function(t,e,i,n){if(void 0!==t)return Y(t,[g.Percent,g.Fractional]);if(void 0!==e||void 0!==i){if(void 0!==e)return{size:e,sizeUnit:g.Percent};if(void 0!==i)return{size:i,sizeUnit:g.Percent};throw new o("CRS33390")}return n?{size:50,sizeUnit:g.Percent}:{size:f.defaults.size,sizeUnit:f.defaults.sizeUnit}},t.resolveMinSize=function(t,e,i){if(void 0!==t)return Y(t,[g.Pixel]);{const t=void 0!==e;return t||void 0!==i?t?{size:e,sizeUnit:g.Pixel}:{size:i,sizeUnit:g.Pixel}:{size:f.defaults.minSize,sizeUnit:f.defaults.minSizeUnit}}},t.calculateSizeWidthHeightSpecificationType=function(t){return void 0!==t.size?1:void 0!==t.width||void 0!==t.height?2:0},t.isGround=function(t){return t.type===p.ground},t.isRow=function(t){return t.type===p.row},t.isColumn=function(t){return t.type===p.column},t.isStack=function(t){return t.type===p.stack},t.isComponent=function(t){return t.type===p.component}}(G||(G={})),function(t){let e;!function(t){t.resolve=function(t,e){var i;if(void 0!==t||void 0!==e)return{show:null!==(i=null==t?void 0:t.show)&&void 0!==i?i:void 0===e?void 0:!!e&&x.Header.defaults.show,popout:null==t?void 0:t.popout,maximise:null==t?void 0:t.maximise,close:null==t?void 0:t.close,minimise:null==t?void 0:t.minimise,tabDropdown:null==t?void 0:t.tabDropdown}}}(e=t.Header||(t.Header={})),t.resolveIdAndMaximised=function(t){let e,i,n=t.id,s=!1;if(void 0===n)e=f.defaults.id;else if(Array.isArray(n)){const t=n.findIndex(t=>"__glMaximised"===t);t>0&&(s=!0,n=n.splice(t,1)),e=n.length>0?n[0]:f.defaults.id}else e=n;return i=void 0!==t.maximised?t.maximised:s,{id:e,maximised:i}}}(W||(W={})),function(t){function i(t){if(void 0===t)return[];{const i=t.length,n=new Array(i);for(let s=0;s<i;s++){const i=t[s],o=G.resolve(i,!1);if(!f.isComponentItem(o))throw new e("UCUSICRC91114",JSON.stringify(o));n[s]=o}return n}}function n(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=U.fromResolved(e)}return i}t.resolve=function(t,e){var n,s;const{id:o,maximised:r}=W.resolveIdAndMaximised(t),{size:a,sizeUnit:l}=G.resolveSize(t.size,t.width,t.height,e),{size:h,sizeUnit:d}=G.resolveMinSize(t.minSize,t.minWidth,t.minHeight);return{type:p.stack,content:i(t.content),size:a,sizeUnit:l,minSize:h,minSizeUnit:d,id:o,maximised:r,isClosable:null!==(n=t.isClosable)&&void 0!==n?n:f.defaults.isClosable,activeItemIndex:null!==(s=t.activeItemIndex)&&void 0!==s?s:b.defaultActiveItemIndex,header:W.Header.resolve(t.header,t.hasHeaders)}},t.fromResolved=function(t){return{type:p.stack,content:n(t.content),size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:v.Header.createCopy(t.header)}}}(j||(j={})),function(t){t.resolve=function(e,i){var n,s,o;let r=e.componentType;if(void 0===r&&(r=e.componentName),void 0===r)throw new Error("ComponentItemConfig.componentType is undefined");{const{id:a,maximised:l}=W.resolveIdAndMaximised(e);let h;h=void 0===e.title||""===e.title?t.componentTypeToTitle(r):e.title;const{size:d,sizeUnit:c}=G.resolveSize(e.size,e.width,e.height,i),{size:u,sizeUnit:p}=G.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:[],size:d,sizeUnit:c,minSize:u,minSizeUnit:p,id:a,maximised:l,isClosable:null!==(n=e.isClosable)&&void 0!==n?n:f.defaults.isClosable,reorderEnabled:null!==(s=e.reorderEnabled)&&void 0!==s?s:_.defaultReorderEnabled,title:h,header:W.Header.resolve(e.header,e.hasHeaders),componentType:r,componentState:null!==(o=e.componentState)&&void 0!==o?o:{}}}},t.fromResolved=function(t){return{type:p.component,size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:v.Header.createCopy(t.header),componentType:t.componentType,componentState:D(void 0,t.componentState)}},t.componentTypeToTitle=function(t){switch(typeof t){case"string":return t;case"number":case"boolean":return t.toString();default:return""}}}(U||(U={})),function(t){function i(e){const i=e.length,s=new Array(i);for(let o=0;o<i;o++){const i=e[o],r=i.type;let a;switch(r){case p.row:case p.column:a=t.fromResolved(i);break;case p.stack:a=j.fromResolved(i);break;case p.component:a=U.fromResolved(i);break;default:throw new n("ROCICFRC44797",r)}s[o]=a}return s}t.isChildItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("UROCOSPCICIC13687",t.type)}},t.resolve=function(e,i){var n;const{size:s,sizeUnit:o}=G.resolveSize(e.size,e.width,e.height,i),{size:r,sizeUnit:a}=G.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:t.resolveContent(e.content),size:s,sizeUnit:o,minSize:r,minSizeUnit:a,id:G.resolveId(e.id),isClosable:null!==(n=e.isClosable)&&void 0!==n?n:f.defaults.isClosable}},t.fromResolved=function(t){return{type:t.type,content:i(t.content),size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,isClosable:t.isClosable}},t.resolveContent=function(i){if(void 0===i)return[];{const s=i.length,o=new Array(s);let r,a=!1,l=!1;for(let e=0;e<s;e++){const s=i[e];if(!t.isChildItemConfig(s))throw new B("ItemConfig is not Row, Column or Stack",s);if(!l){const t=G.calculateSizeWidthHeightSpecificationType(s);switch(t){case 0:break;case 2:a=!0;break;case 1:l=!0;break;default:throw new n("ROCICRC87556",t)}}o[e]=s}r=!l&&!!a;const h=new Array(s);for(let t=0;t<s;t++){const i=o[t],n=G.resolve(i,r);if(!w.isChildItemConfig(n))throw new e("UROCOSPIC99512",JSON.stringify(n));h[t]=n}return h}}}(q||(q={})),function(t){t.isRootItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("URICIR23687",t.type)}},t.resolve=function(t){if(void 0!==t){const e=G.resolve(t,!1);if(y.isRootItemConfig(e))return e;throw new B("ItemConfig is not Row, Column or Stack",JSON.stringify(t))}},t.fromResolvedOrUndefined=function(t){if(void 0!==t){const e=t.type;switch(e){case p.row:case p.column:return q.fromResolved(t);case p.stack:return j.fromResolved(t);case p.component:return U.fromResolved(t);default:throw new n("RICFROU89921",e)}}}}($||($={})),function(t){let e,i,n;function s(t){return"parentId"in t||"indexInParent"in t||"window"in t}!function(t){t.resolve=function(t){var e,i,n,s,o,r,a,l,h,d;return{constrainDragToContainer:null!==(e=null==t?void 0:t.constrainDragToContainer)&&void 0!==e?e:x.Settings.defaults.constrainDragToContainer,reorderEnabled:null!==(i=null==t?void 0:t.reorderEnabled)&&void 0!==i?i:x.Settings.defaults.reorderEnabled,popoutWholeStack:null!==(n=null==t?void 0:t.popoutWholeStack)&&void 0!==n?n:x.Settings.defaults.popoutWholeStack,blockedPopoutsThrowError:null!==(s=null==t?void 0:t.blockedPopoutsThrowError)&&void 0!==s?s:x.Settings.defaults.blockedPopoutsThrowError,closePopoutsOnUnload:null!==(o=null==t?void 0:t.closePopoutsOnUnload)&&void 0!==o?o:x.Settings.defaults.closePopoutsOnUnload,responsiveMode:null!==(r=null==t?void 0:t.responsiveMode)&&void 0!==r?r:x.Settings.defaults.responsiveMode,tabOverlapAllowance:null!==(a=null==t?void 0:t.tabOverlapAllowance)&&void 0!==a?a:x.Settings.defaults.tabOverlapAllowance,reorderOnTabMenuClick:null!==(l=null==t?void 0:t.reorderOnTabMenuClick)&&void 0!==l?l:x.Settings.defaults.reorderOnTabMenuClick,tabControlOffset:null!==(h=null==t?void 0:t.tabControlOffset)&&void 0!==h?h:x.Settings.defaults.tabControlOffset,popInOnClose:null!==(d=null==t?void 0:t.popInOnClose)&&void 0!==d?d:x.Settings.defaults.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.resolve=function(e){var i,n,s,o,r;const{size:a,sizeUnit:l}=t.resolveDefaultMinItemHeight(e),{size:h,sizeUnit:d}=t.resolveDefaultMinItemWidth(e);return{borderWidth:null!==(i=null==e?void 0:e.borderWidth)&&void 0!==i?i:x.Dimensions.defaults.borderWidth,borderGrabWidth:null!==(n=null==e?void 0:e.borderGrabWidth)&&void 0!==n?n:x.Dimensions.defaults.borderGrabWidth,defaultMinItemHeight:a,defaultMinItemHeightUnit:l,defaultMinItemWidth:h,defaultMinItemWidthUnit:d,headerHeight:null!==(s=null==e?void 0:e.headerHeight)&&void 0!==s?s:x.Dimensions.defaults.headerHeight,dragProxyWidth:null!==(o=null==e?void 0:e.dragProxyWidth)&&void 0!==o?o:x.Dimensions.defaults.dragProxyWidth,dragProxyHeight:null!==(r=null==e?void 0:e.dragProxyHeight)&&void 0!==r?r:x.Dimensions.defaults.dragProxyHeight}},t.fromResolved=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,defaultMinItemHeight:Z(t.defaultMinItemHeight,t.defaultMinItemHeightUnit),defaultMinItemWidth:Z(t.defaultMinItemWidth,t.defaultMinItemWidthUnit),headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.resolveDefaultMinItemHeight=function(t){const e=null==t?void 0:t.defaultMinItemHeight;return void 0===e?{size:x.Dimensions.defaults.defaultMinItemHeight,sizeUnit:x.Dimensions.defaults.defaultMinItemHeightUnit}:Y(e,[g.Pixel])},t.resolveDefaultMinItemWidth=function(t){const e=null==t?void 0:t.defaultMinItemWidth;return void 0===e?{size:x.Dimensions.defaults.defaultMinItemWidth,sizeUnit:x.Dimensions.defaults.defaultMinItemWidthUnit}:Y(e,[g.Pixel])}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.resolve=function(t,e,i){var n,s,o,r,a,l,h,d,c,u,p,m;let g;return g=void 0!==(null==t?void 0:t.show)?t.show:void 0!==e&&void 0!==e.hasHeaders?!!e.hasHeaders&&x.Header.defaults.show:x.Header.defaults.show,{show:g,popout:null!==(s=null!==(n=null==t?void 0:t.popout)&&void 0!==n?n:null==i?void 0:i.popout)&&void 0!==s?s:!1!==(null==e?void 0:e.showPopoutIcon)&&x.Header.defaults.popout,dock:null!==(r=null!==(o=null==t?void 0:t.popin)&&void 0!==o?o:null==i?void 0:i.popin)&&void 0!==r?r:x.Header.defaults.dock,maximise:null!==(l=null!==(a=null==t?void 0:t.maximise)&&void 0!==a?a:null==i?void 0:i.maximise)&&void 0!==l?l:!1!==(null==e?void 0:e.showMaximiseIcon)&&x.Header.defaults.maximise,close:null!==(d=null!==(h=null==t?void 0:t.close)&&void 0!==h?h:null==i?void 0:i.close)&&void 0!==d?d:!1!==(null==e?void 0:e.showCloseIcon)&&x.Header.defaults.close,minimise:null!==(u=null!==(c=null==t?void 0:t.minimise)&&void 0!==c?c:null==i?void 0:i.minimise)&&void 0!==u?u:x.Header.defaults.minimise,tabDropdown:null!==(m=null!==(p=null==t?void 0:t.tabDropdown)&&void 0!==p?p:null==i?void 0:i.tabDropdown)&&void 0!==m?m:x.Header.defaults.tabDropdown}}}(n=t.Header||(t.Header={})),t.isPopout=s,t.resolve=function(e){if(s(e))return X.resolve(e);{let i;return i=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{resolved:!0,root:$.resolve(i),openPopouts:t.resolveOpenPopouts(e.openPopouts),dimensions:t.Dimensions.resolve(e.dimensions),settings:t.Settings.resolve(e.settings),header:t.Header.resolve(e.header,e.settings,e.labels)}}},t.fromResolved=function(e){return{root:$.fromResolvedOrUndefined(e.root),openPopouts:X.fromResolvedArray(e.openPopouts),settings:x.Settings.createCopy(e.settings),dimensions:t.Dimensions.fromResolved(e.dimensions),header:x.Header.createCopy(e.header)}},t.isResolved=function(t){const e=t;return void 0!==e.resolved&&!0===e.resolved},t.resolveOpenPopouts=function(t){if(void 0===t)return[];{const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=X.resolve(t[n]);return i}}}(K||(K={})),function(t){let e;function i(e){const i=e.length,n=new Array(i);for(let s=0;s<i;s++){const i=e[s];n[s]=t.fromResolved(i)}return n}!function(t){t.resolve=function(t,e){var i,n,s,o,r,a,l,h;let d;const c=E.Window.defaults;return d=void 0!==t?{width:null!==(i=t.width)&&void 0!==i?i:c.width,height:null!==(n=t.height)&&void 0!==n?n:c.height,left:null!==(s=t.left)&&void 0!==s?s:c.left,top:null!==(o=t.top)&&void 0!==o?o:c.top}:{width:null!==(r=null==e?void 0:e.width)&&void 0!==r?r:c.width,height:null!==(a=null==e?void 0:e.height)&&void 0!==a?a:c.height,left:null!==(l=null==e?void 0:e.left)&&void 0!==l?l:c.left,top:null!==(h=null==e?void 0:e.top)&&void 0!==h?h:c.top},d},t.fromResolved=function(t){return{width:null===t.width?void 0:t.width,height:null===t.height?void 0:t.height,left:null===t.left?void 0:t.left,top:null===t.top?void 0:t.top}}}(e=t.Window||(t.Window={})),t.resolve=function(e){var i,n;let s;return s=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{root:$.resolve(s),openPopouts:K.resolveOpenPopouts(e.openPopouts),dimensions:K.Dimensions.resolve(e.dimensions),settings:K.Settings.resolve(e.settings),header:K.Header.resolve(e.header,e.settings,e.labels),parentId:null!==(i=e.parentId)&&void 0!==i?i:null,indexInParent:null!==(n=e.indexInParent)&&void 0!==n?n:null,window:t.Window.resolve(e.window,e.dimensions),resolved:!0}},t.fromResolved=function(e){return{root:$.fromResolvedOrUndefined(e.root),openPopouts:i(e.openPopouts),dimensions:K.Dimensions.fromResolved(e.dimensions),settings:x.Settings.createCopy(e.settings),header:x.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.fromResolved(e.window)}},t.fromResolvedArray=i}(X||(X={}));class Q{constructor(){this._allEventSubscriptions=[],this._subscriptionsMap=new Map,this.unbind=this.removeEventListener,this.trigger=this.emit}tryBubbleEvent(t,e){}emit(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)(0,i[t])(...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitUnknown(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)i[t](...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitBaseBubblingEvent(t){const e=new Q.BubblingEvent(t,this);this.emitUnknown(t,e)}emitUnknownBubblingEvent(t){const e=new Q.BubblingEvent(t,this);this.emitUnknown(t,e)}removeEventListener(t,e){const i=e;this.removeUnknownEventListener(t,i)}off(t,e){this.removeEventListener(t,e)}addEventListener(t,e){const i=e;this.addUnknownEventListener(t,i)}on(t,e){this.addEventListener(t,e)}addUnknownEventListener(t,e){if(t===Q.ALL_EVENT)this._allEventSubscriptions.push(e);else{let i=this._subscriptionsMap.get(t);void 0!==i?i.push(e):(i=[e],this._subscriptionsMap.set(t,i))}}removeUnknownEventListener(t,e){if(t===Q.ALL_EVENT)this.removeSubscription(t,this._allEventSubscriptions,e);else{const i=this._subscriptionsMap.get(t);if(void 0===i)throw new Error("No subscribtions to unsubscribe for event "+t);this.removeSubscription(t,i,e)}}removeSubscription(t,e,i){const n=e.indexOf(i);if(n<0)throw new Error("Nothing to unbind for "+t);e.splice(n,1)}emitAllEvent(t,e){const i=this._allEventSubscriptions.length;if(i>0){const n=e.slice();n.unshift(t);const s=this._allEventSubscriptions.slice();for(let t=0;t<i;t++)s[t](...n)}}}!function(t){t.ALL_EVENT="__all",t.headerClickEventName="stackHeaderClick",t.headerTouchStartEventName="stackHeaderTouchStart";class e{constructor(t,e){this._name=t,this._target=e,this._isPropagationStopped=!1}get name(){return this._name}get target(){return this._target}get origin(){return this._target}get isPropagationStopped(){return this._isPropagationStopped}stopPropagation(){this._isPropagationStopped=!0}}t.BubblingEvent=e,t.ClickBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._mouseEvent=i}get mouseEvent(){return this._mouseEvent}},t.TouchStartBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._touchEvent=i}get touchEvent(){return this._touchEvent}}}(Q||(Q={}));class tt extends Q{constructor(t,e,i){super(),this._config=t,this._initialWindowSize=e,this._layoutManager=i,this._isInitialised=!1,this._popoutWindow=null,this.createWindow()}toConfig(){var t,e;if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");const i=this.getGlInstance().saveLayout();let n,s;null===this._popoutWindow?(n=null,s=null):(n=null!==(t=this._popoutWindow.screenX)&&void 0!==t?t:this._popoutWindow.screenLeft,s=null!==(e=this._popoutWindow.screenY)&&void 0!==e?e:this._popoutWindow.screenTop);const o={width:this.getGlInstance().width,height:this.getGlInstance().height,left:n,top:s};return{root:i.root,openPopouts:i.openPopouts,settings:i.settings,dimensions:i.dimensions,header:i.header,window:o,parentId:this._config.parentId,indexInParent:this._config.indexInParent,resolved:!0}}getGlInstance(){if(null===this._popoutWindow)throw new s("BPGGI24693");return this._popoutWindow.__glInstance}getWindow(){if(null===this._popoutWindow)throw new s("BPGW087215");return this._popoutWindow}close(){if(this.getGlInstance())this.getGlInstance().closeWindow();else try{this.getWindow().close()}catch(t){}}popIn(){let t,e=this._config.indexInParent;if(!this._config.parentId)return;const i=A({},this.getGlInstance().saveLayout()).root;if(void 0===i)throw new o("BPPIR19998");const n=this._layoutManager.groundItem;if(void 0===n)throw new o("BPPIG34972");t=n.getItemsByPopInParentId(this._config.parentId)[0],t||(t=n.contentItems.length>0?n.contentItems[0]:n,e=0);const s=this._layoutManager.createAndInitContentItem(i,t);t.addChild(s,e),this._layoutManager.layoutConfig.settings.popInOnClose?this._onClose():this.close()}createWindow(){const t=this.createUrl(),e=Math.floor(1e6*Math.random()).toString(36),i=this.serializeWindowFeatures({width:this._initialWindowSize.width,height:this._initialWindowSize.height,innerWidth:this._initialWindowSize.width,innerHeight:this._initialWindowSize.height,menubar:"no",toolbar:"no",location:"no",personalbar:"no",resizable:"yes",scrollbars:"no",status:"no"});if(this._popoutWindow=globalThis.open(t,e,i),this._popoutWindow)this._popoutWindow.addEventListener("load",()=>this.positionWindow(),{passive:!0}),this._popoutWindow.addEventListener("beforeunload",()=>{this._layoutManager.layoutConfig.settings.popInOnClose?this.popIn():this._onClose()},{passive:!0}),this._checkReadyInterval=setInterval(()=>this.checkReady(),10);else if(!0===this._layoutManager.layoutConfig.settings.blockedPopoutsThrowError)throw new H("Popout blocked")}checkReady(){if(null===this._popoutWindow)throw new s("BPCR01844");this._popoutWindow.__glInstance&&this._popoutWindow.__glInstance.isInitialised&&(this.onInitialised(),void 0!==this._checkReadyInterval&&(clearInterval(this._checkReadyInterval),this._checkReadyInterval=void 0))}serializeWindowFeatures(t){const e=[];for(const i in t)e.push(i+"="+t[i].toString());return e.join(",")}createUrl(){const t="gl-window-config-"+z(),e=x.minifyConfig(this._config);try{localStorage.setItem(t,JSON.stringify(e))}catch(t){throw new Error("Error while writing to localStorage "+function(t){return t instanceof Error?t.message:"string"==typeof t?t:"Unknown Error"}(t))}const i=new URL(location.href);return i.searchParams.set("gl-window",t),i.toString()}positionWindow(){if(null===this._popoutWindow)throw new Error("BrowserPopout.positionWindow: null popoutWindow");this._popoutWindow.moveTo(this._initialWindowSize.left,this._initialWindowSize.top),this._popoutWindow.focus()}onInitialised(){this._isInitialised=!0,this.getGlInstance().on("popIn",()=>this.popIn()),this.emit("initialised")}_onClose(){setTimeout(()=>this.emit("closed"),50)}}class et{constructor(t,e,i,n){this._header=t,this._pushEvent=n,this._clickEventListener=t=>this.onClick(t),this._touchStartEventListener=t=>this.onTouchStart(t),this._element=document.createElement("div"),this._element.classList.add(i),this._element.title=e,this._header.on("destroy",()=>this.destroy()),this._element.addEventListener("click",this._clickEventListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartEventListener,{passive:!0}),this._header.controlsContainerElement.appendChild(this._element)}get element(){return this._element}destroy(){var t;this._element.removeEventListener("click",this._clickEventListener),this._element.removeEventListener("touchstart",this._touchStartEventListener),null===(t=this._element.parentNode)||void 0===t||t.removeChild(this._element)}onClick(t){this._pushEvent(t)}onTouchStart(t){this._pushEvent(t)}}class it extends Q{constructor(t,e){super(),this._eElement=t,this._pointerTracking=!1,this._pointerDownEventListener=t=>this.onPointerDown(t),this._pointerMoveEventListener=t=>this.onPointerMove(t),this._pointerUpEventListener=t=>this.onPointerUp(t),this._timeout=void 0,this._allowableTargets=[t,...e],this._oDocument=document,this._eBody=document.body,this._nDelay=1800,this._nDistance=10,this._nX=0,this._nY=0,this._nOriginalX=0,this._nOriginalY=0,this._dragging=!1,this._eElement.addEventListener("pointerdown",this._pointerDownEventListener,{passive:!0})}destroy(){this.checkRemovePointerTrackingEventListeners(),this._eElement.removeEventListener("pointerdown",this._pointerDownEventListener)}cancelDrag(){this.processDragStop(void 0)}onPointerDown(t){if(this._allowableTargets.includes(t.target)&&t.isPrimary){const e=this.getPointerCoordinates(t);this.processPointerDown(e)}}processPointerDown(t){this._nOriginalX=t.x,this._nOriginalY=t.y,this._oDocument.addEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.addEventListener("pointerup",this._pointerUpEventListener,{passive:!0}),this._pointerTracking=!0,this._timeout=setTimeout(()=>{try{this.startDrag()}catch(t){throw console.error(t),t}},this._nDelay)}onPointerMove(t){this._pointerTracking&&(this.processDragMove(t),t.preventDefault())}processDragMove(t){this._nX=t.pageX-this._nOriginalX,this._nY=t.pageY-this._nOriginalY,!1===this._dragging&&(Math.abs(this._nX)>this._nDistance||Math.abs(this._nY)>this._nDistance)&&this.startDrag(),this._dragging&&this.emit("drag",this._nX,this._nY,t)}onPointerUp(t){this.processDragStop(t)}processDragStop(t){var e;void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this.checkRemovePointerTrackingEventListeners(),!0===this._dragging&&(this._eBody.classList.remove("lm_dragging"),this._eElement.classList.remove("lm_dragging"),null===(e=this._oDocument.querySelector("iframe"))||void 0===e||e.style.setProperty("pointer-events",""),this._dragging=!1,this.emit("dragStop",t))}checkRemovePointerTrackingEventListeners(){this._pointerTracking&&(this._oDocument.removeEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.removeEventListener("pointerup",this._pointerUpEventListener),this._pointerTracking=!1)}startDrag(){var t;void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this._dragging=!0,this._eBody.classList.add("lm_dragging"),this._eElement.classList.add("lm_dragging"),null===(t=this._oDocument.querySelector("iframe"))||void 0===t||t.style.setProperty("pointer-events","none"),this.emit("dragStart",this._nOriginalX,this._nOriginalY)}getPointerCoordinates(t){return{x:t.pageX,y:t.pageY}}}class nt{constructor(t,e,i,n,s){var o;this._layoutManager=t,this._componentItem=e,this._closeEvent=i,this._focusEvent=n,this._dragStartEvent=s,this._isActive=!1,this._tabClickListener=t=>this.onTabClickDown(t),this._tabTouchStartListener=t=>this.onTabTouchStart(t),this._closeClickListener=()=>this.onCloseClick(),this._closeTouchStartListener=()=>this.onCloseTouchStart(),this._dragStartListener=(t,e)=>this.onDragStart(t,e),this._contentItemDestroyListener=()=>this.onContentItemDestroy(),this._tabTitleChangedListener=t=>this.setTitle(t),this._element=document.createElement("div"),this._element.classList.add("lm_tab"),this._titleElement=document.createElement("span"),this._titleElement.classList.add("lm_title"),this._closeElement=document.createElement("div"),this._closeElement.classList.add("lm_close_tab"),this._element.appendChild(this._titleElement),this._element.appendChild(this._closeElement),e.isClosable?this._closeElement.style.display="":this._closeElement.style.display="none",this.setTitle(e.title),this._componentItem.on("titleChanged",this._tabTitleChangedListener),(null!==(o=e.reorderEnabled)&&void 0!==o?o:this._layoutManager.layoutConfig.settings.reorderEnabled)&&this.enableReorder(),this._element.addEventListener("click",this._tabClickListener,{passive:!0}),this._element.addEventListener("touchstart",this._tabTouchStartListener,{passive:!0}),this._componentItem.isClosable?(this._closeElement.addEventListener("click",this._closeClickListener,{passive:!0}),this._closeElement.addEventListener("touchstart",this._closeTouchStartListener,{passive:!0})):(this._closeElement.remove(),this._closeElement=void 0),this._componentItem.setTab(this),this._layoutManager.emit("tabCreated",this)}get isActive(){return this._isActive}get componentItem(){return this._componentItem}get contentItem(){return this._componentItem}get element(){return this._element}get titleElement(){return this._titleElement}get closeElement(){return this._closeElement}get reorderEnabled(){return void 0!==this._dragListener}set reorderEnabled(t){t!==this.reorderEnabled&&(t?this.enableReorder():this.disableReorder())}setTitle(t){this._titleElement.innerText=t,this._element.title=t}setActive(t){t!==this._isActive&&(this._isActive=t,t?this._element.classList.add("lm_active"):this._element.classList.remove("lm_active"))}destroy(){var t,e;this._closeEvent=void 0,this._focusEvent=void 0,this._dragStartEvent=void 0,this._element.removeEventListener("click",this._tabClickListener),this._element.removeEventListener("touchstart",this._tabTouchStartListener),null===(t=this._closeElement)||void 0===t||t.removeEventListener("click",this._closeClickListener),null===(e=this._closeElement)||void 0===e||e.removeEventListener("touchstart",this._closeTouchStartListener),this._componentItem.off("titleChanged",this._tabTitleChangedListener),this.reorderEnabled&&this.disableReorder(),this._element.remove()}setBlurred(){this._element.classList.remove("lm_focused"),this._titleElement.classList.remove("lm_focused")}setFocused(){this._element.classList.add("lm_focused"),this._titleElement.classList.add("lm_focused")}onDragStart(t,e){if(void 0===this._dragListener)throw new o("TODSDLU10093");if(void 0===this._dragStartEvent)throw new o("TODS23309");this._dragStartEvent(t,e,this._dragListener,this.componentItem)}onContentItemDestroy(){void 0!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=void 0)}onTabClickDown(t){const e=t.target;e!==this._element&&e!==this._titleElement||(0===t.button?this.notifyFocus():1===t.button&&this._componentItem.isClosable&&this.notifyClose())}onTabTouchStart(t){t.target===this._element&&this.notifyFocus()}onCloseClick(){this.notifyClose()}onCloseTouchStart(){this.notifyClose()}notifyClose(){if(void 0===this._closeEvent)throw new o("TNC15007");this._closeEvent(this._componentItem)}notifyFocus(){if(void 0===this._focusEvent)throw new o("TNA15007");this._focusEvent(this._componentItem)}enableReorder(){this._dragListener=new it(this._element,[this._titleElement]),this._dragListener.on("dragStart",this._dragStartListener),this._componentItem.on("destroy",this._contentItemDestroyListener)}disableReorder(){if(void 0===this._dragListener)throw new o("TDR87745");this._componentItem.off("destroy",this._contentItemDestroyListener),this._dragListener.off("dragStart",this._dragStartListener),this._dragListener=void 0}}class st{constructor(t,e,i,n,s){this._layoutManager=t,this._componentRemoveEvent=e,this._componentFocusEvent=i,this._componentDragStartEvent=n,this._dropdownActiveChangedEvent=s,this._tabs=[],this._lastVisibleTabIndex=-1,this._dropdownActive=!1,this._element=document.createElement("section"),this._element.classList.add("lm_tabs"),this._dropdownElement=document.createElement("section"),this._dropdownElement.classList.add("lm_tabdropdown_list"),this._dropdownElement.style.display="none"}get tabs(){return this._tabs}get tabCount(){return this._tabs.length}get lastVisibleTabIndex(){return this._lastVisibleTabIndex}get element(){return this._element}get dropdownElement(){return this._dropdownElement}get dropdownActive(){return this._dropdownActive}destroy(){for(let t=0;t<this._tabs.length;t++)this._tabs[t].destroy()}createTab(t,e){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return;const i=new nt(this._layoutManager,t,t=>this.handleTabCloseEvent(t),t=>this.handleTabFocusEvent(t),(t,e,i,n)=>this.handleTabDragStartEvent(t,e,i,n));void 0===e&&(e=this._tabs.length),this._tabs.splice(e,0,i),e<this._element.childNodes.length?this._element.insertBefore(i.element,this._element.childNodes[e]):this._element.appendChild(i.element)}removeTab(t){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return this._tabs[e].destroy(),void this._tabs.splice(e,1);throw new Error("contentItem is not controlled by this header")}processActiveComponentChanged(t){let i=-1;for(let e=0;e<this._tabs.length;e++){const n=this._tabs[e].componentItem===t;this._tabs[e].setActive(n),n&&(i=e)}if(i<0)throw new e("HSACI56632");if(this._layoutManager.layoutConfig.settings.reorderOnTabMenuClick&&-1!==this._lastVisibleTabIndex&&i>this._lastVisibleTabIndex){const t=this._tabs[i];for(let t=i;t>0;t--)this._tabs[t]=this._tabs[t-1];this._tabs[0]=t}}updateTabSizes(t,e){let i=!1;this.tryUpdateTabSizes(i,t,e)||(i=!0,this.tryUpdateTabSizes(i,t,e)),i!==this._dropdownActive&&(this._dropdownActive=i,this._dropdownActiveChangedEvent())}tryUpdateTabSizes(t,e,i){if(this._tabs.length>0){if(void 0===i)throw new Error("non-empty tabs must have active component item");let n=0,s=!1;const o=this._layoutManager.layoutConfig.settings.tabOverlapAllowance,r=this._tabs.indexOf(i.tab),a=this._tabs[r];this._lastVisibleTabIndex=-1;for(let i=0;i<this._tabs.length;i++){const l=this._tabs[i].element;l.parentElement!==this._element&&this._element.appendChild(l);const h=k(getComputedStyle(a.element).marginRight);n+=l.offsetWidth+h;let d=0;if(r<=i)d=n;else{const t=k(getComputedStyle(a.element).marginRight);d=n+a.element.offsetWidth+t}if(d>e){if(s)i===r&&(l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._element&&this._element.appendChild(l));else{let t;if(t=r>0&&r<=i?(d-e)/(i-1):(d-e)/i,t<o){for(let e=0;e<=i;e++){const n=e!==r&&0!==e?"-"+P(t):"";this._tabs[e].element.style.zIndex=P(i-e),this._tabs[e].element.style.marginLeft=n}this._lastVisibleTabIndex=i,l.parentElement!==this._element&&this._element.appendChild(l)}else s=!0}if(s&&i!==r){if(!t)return!1;l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._dropdownElement&&this._dropdownElement.appendChild(l)}}else this._lastVisibleTabIndex=i,l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._element&&this._element.appendChild(l)}}return!0}showAdditionalTabsDropdown(){this._dropdownElement.style.display=""}hideAdditionalTabsDropdown(){this._dropdownElement.style.display="none"}handleTabCloseEvent(t){this._componentRemoveEvent(t)}handleTabFocusEvent(t){this._componentFocusEvent(t)}handleTabDragStartEvent(t,e,i,n){this._componentDragStartEvent(t,e,i,n)}}class ot extends Q{constructor(t,e,i,n,s,o,r,a,l,h,d,c,u){super(),this._layoutManager=t,this._parent=e,this._configClosable=n,this._getActiveComponentItemEvent=s,this._popoutEvent=r,this._maximiseToggleEvent=a,this._clickEvent=l,this._touchStartEvent=h,this._componentRemoveEvent=d,this._componentFocusEvent=c,this._componentDragStartEvent=u,this._clickListener=t=>this.onClick(t),this._touchStartListener=t=>this.onTouchStart(t),this._rowColumnClosable=!0,this._closeButton=null,this._popoutButton=null,this._tabsContainer=new st(this._layoutManager,t=>this.handleTabInitiatedComponentRemoveEvent(t),t=>this.handleTabInitiatedComponentFocusEvent(t),(t,e,i,n)=>this.handleTabInitiatedDragStartEvent(t,e,i,n),()=>this.processTabDropdownActiveChanged()),this._show=i.show,this._popoutEnabled=i.popoutEnabled,this._popoutLabel=i.popoutLabel,this._maximiseEnabled=i.maximiseEnabled,this._maximiseLabel=i.maximiseLabel,this._minimiseEnabled=i.minimiseEnabled,this._minimiseLabel=i.minimiseLabel,this._closeEnabled=i.closeEnabled,this._closeLabel=i.closeLabel,this._tabDropdownEnabled=i.tabDropdownEnabled,this._tabDropdownLabel=i.tabDropdownLabel,this.setSide(i.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this._element.appendChild(this._tabsContainer.element),this._element.appendChild(this._controlsContainerElement),this._element.appendChild(this._tabsContainer.dropdownElement),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartListener,{passive:!0}),this._documentMouseUpListener=()=>this._tabsContainer.hideAdditionalTabsDropdown(),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownEnabled&&(this._tabDropdownButton=new et(this,this._tabDropdownLabel,"lm_tabdropdown",()=>this._tabsContainer.showAdditionalTabsDropdown())),this._popoutEnabled&&(this._popoutButton=new et(this,this._popoutLabel,"lm_popout",()=>this.handleButtonPopoutEvent())),this._maximiseEnabled&&(this._maximiseButton=new et(this,this._maximiseLabel,"lm_maximise",t=>this.handleButtonMaximiseToggleEvent(t))),this._configClosable&&(this._closeButton=new et(this,this._closeLabel,"lm_close",()=>o())),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get lastVisibleTabIndex(){return this._tabsContainer.lastVisibleTabIndex}get element(){return this._element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}destroy(){this.emit("destroy"),this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove()}createTab(t,e){this._tabsContainer.createTab(t,e)}removeTab(t){this._tabsContainer.removeTab(t)}processActiveComponentChanged(t){this._tabsContainer.processActiveComponentChanged(t),this.updateTabSizes()}setSide(t){this._side=t,this._leftRightSided=[h.right,h.left].includes(this._side)}setRowColumnClosable(t){this._rowColumnClosable=t,this.updateClosability()}updateClosability(){let t;if(this._configClosable)if(this._rowColumnClosable){t=!0;const e=this.tabs.length;for(let i=0;i<e;i++)if(!this._tabsContainer.tabs[i].componentItem.isClosable){t=!1;break}}else t=!1;else t=!1;null!==this._closeButton&&T(this._closeButton.element,t),null!==this._popoutButton&&T(this._popoutButton.element,t),this._canRemoveComponent=t||this._tabsContainer.tabCount>1}applyFocusedValue(t){t?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(void 0===this._maximiseButton)throw new o("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(void 0===this._maximiseButton)throw new o("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){if(this._tabsContainer.tabCount>0){const t=this._show?this._layoutManager.layoutConfig.dimensions.headerHeight:0;let e;this._leftRightSided?(this._element.style.height="",this._element.style.width=P(t)):(this._element.style.width="",this._element.style.height=P(t)),e=this._leftRightSided?this._element.offsetHeight-this._controlsContainerElement.offsetHeight-this._tabControlOffset:this._element.offsetWidth-this._controlsContainerElement.offsetWidth-this._tabControlOffset,this._tabsContainer.updateTabSizes(e,this._getActiveComponentItemEvent())}}handleTabInitiatedComponentRemoveEvent(t){if(this._canRemoveComponent){if(void 0===this._componentRemoveEvent)throw new o("HHTCE22294");this._componentRemoveEvent(t)}}handleTabInitiatedComponentFocusEvent(t){if(void 0===this._componentFocusEvent)throw new o("HHTAE22294");this._componentFocusEvent(t)}handleTabInitiatedDragStartEvent(t,e,i,n){if(this._canRemoveComponent){if(void 0===this._componentDragStartEvent)throw new o("HHTDSE22294");this._componentDragStartEvent(t,e,i,n)}else i.cancelDrag()}processTabDropdownActiveChanged(){void 0!==this._tabDropdownButton&&T(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonPopoutEvent(){if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(void 0===this._popoutEvent)throw new o("HHBPOE17834");this._popoutEvent()}else{const t=this._getActiveComponentItemEvent();t&&t.popout()}}handleButtonMaximiseToggleEvent(t){if(void 0===this._maximiseToggleEvent)throw new o("HHBMTE16834");this._maximiseToggleEvent()}onClick(t){t.target===this._element&&this.notifyClick(t)}onTouchStart(t){t.target===this._element&&this.notifyTouchStart(t)}notifyClick(t){if(void 0===this._clickEvent)throw new o("HNHC46834");this._clickEvent(t)}notifyTouchStart(t){if(void 0===this._touchStartEvent)throw new o("HNHTS46834");this._touchStartEvent(t)}}class rt extends Q{constructor(t,e,i,n,s,o,r,a,l){super(),this._config=t,this._parent=e,this._layoutManager=i,this._element=n,this._updateItemConfigEvent=s,this._showEvent=o,this._hideEvent=r,this._focusEvent=a,this._blurEvent=l,this._stackMaximised=!1,this._width=0,this._height=0,this._visible=!0,this._isShownWithZeroDimensions=!0,this._componentType=t.componentType,this._isClosable=t.isClosable,this._initialState=t.componentState,this._state=this._initialState,this._boundComponent=this.layoutManager.bindComponent(this,t),this.updateElementPositionPropertyFromBoundComponent()}get width(){return this._width}get height(){return this._height}get parent(){return this._parent}get componentName(){return this._componentType}get componentType(){return this._componentType}get virtual(){return this._boundComponent.virtual}get component(){return this._boundComponent.component}get tab(){return this._tab}get title(){return this._parent.title}get layoutManager(){return this._layoutManager}get isHidden(){return!this._visible}get visible(){return this._visible}get state(){return this._state}get initialState(){return this._initialState}get element(){return this._element}destroy(){this.releaseComponent(),this.stateRequestEvent=void 0,this.emit("destroy")}getElement(){return this._element}hide(){this._hideEvent()}show(){this._showEvent()}focus(t=!1){this._focusEvent(t)}blur(t=!1){this._blurEvent(t)}setSize(t,i){let n=this._parent;if(n.isColumn||n.isRow||null===n.parent)throw new e("ICSSPRC","ComponentContainer cannot have RowColumn Parent");{let e;do{e=n,n=n.parent}while(null!==n&&!n.isColumn&&!n.isRow);if(null===n)return!1;{const o=n.isColumn?"height":"width",r=this[o];if(null===r)throw new s("ICSSCS11194");{const s=("height"===o?i:t)/(r*(1/(e.size/100)))*100,a=(e.size-s)/(n.contentItems.length-1);for(let t=0;t<n.contentItems.length;t++){const i=n.contentItems[t];i===e?i.size=s:i.size+=a}return n.updateSize(!1),!0}}}}close(){this._isClosable&&(this.emit("close"),this._parent.close())}replaceComponent(t){if(this.releaseComponent(),!G.isComponent(t))throw new Error("ReplaceComponent not passed a component ItemConfig");{const e=U.resolve(t,!1);if(this._initialState=e.componentState,this._state=this._initialState,this._componentType=e.componentType,this._updateItemConfigEvent(e),this._boundComponent=this.layoutManager.bindComponent(this,e),this.updateElementPositionPropertyFromBoundComponent(),this._boundComponent.virtual){if(void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,this._visible),void 0!==this.virtualRectingRequiredEvent){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}this.setBaseLogicalZIndex()}this.emit("stateChanged")}}getState(){return this._state}extendState(t){const e=A(this._state,t);this.setState(e)}setState(t){this._state=t,this._parent.emitBaseBubblingEvent("stateChanged")}setTitle(t){this._parent.setTitle(t)}setTab(t){this._tab=t,this.emit("tab",t)}setVisibility(t){this._boundComponent.virtual&&void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,t),t?this._visible?!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow()):(this._visible=!0,0===this._height&&0===this._width?this._isShownWithZeroDimensions=!0:(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow())):this._visible&&(this._visible=!1,this._isShownWithZeroDimensions=!1,this.emitHide())}setBaseLogicalZIndex(){this.setLogicalZIndex(d.base)}setLogicalZIndex(t){t!==this._logicalZIndex&&(this._logicalZIndex=t,this.notifyVirtualZIndexChangeRequired())}enterDragMode(t,e){this._width=t,this._height=e,R(this._element,t),M(this._element,e),this.setLogicalZIndex(d.drag),this.drag()}exitDragMode(){this.setBaseLogicalZIndex()}enterStackMaximised(){this._stackMaximised=!0,this.setLogicalZIndex(d.stackMaximised)}exitStackMaximised(){this.setBaseLogicalZIndex(),this._stackMaximised=!1}drag(){if(this._boundComponent.virtual&&void 0!==this.virtualRectingRequiredEvent){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}}setSizeToNodeSize(t,e,i){(t!==this._width||e!==this._height||i)&&(this._width=t,this._height=e,R(this._element,t),M(this._element,e),this._boundComponent.virtual?this.addVirtualSizedContainerToLayoutManager():(this.emit("resize"),this.checkShownFromZeroDimensions()))}notifyVirtualRectingRequired(){void 0!==this.virtualRectingRequiredEvent&&(this.virtualRectingRequiredEvent(this,this._width,this._height),this.emit("resize"),this.checkShownFromZeroDimensions())}notifyVirtualZIndexChangeRequired(){if(void 0!==this.virtualZIndexChangeRequiredEvent){const t=this._logicalZIndex,e=c[t];this.virtualZIndexChangeRequiredEvent(this,t,e)}}updateElementPositionPropertyFromBoundComponent(){this._boundComponent.virtual?this._element.style.position="static":this._element.style.position=""}addVirtualSizedContainerToLayoutManager(){this._layoutManager.beginVirtualSizedContainerAdding();try{this._layoutManager.addVirtualSizedContainer(this)}finally{this._layoutManager.endVirtualSizedContainerAdding()}}checkShownFromZeroDimensions(){!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.emitShow())}emitShow(){this.emit("shown"),this.emit("show")}emitHide(){this.emit("hide")}releaseComponent(){this._stackMaximised&&this.exitStackMaximised(),this.emit("beforeComponentRelease",this._boundComponent.component),this.layoutManager.unbindComponent(this,this._boundComponent.virtual,this._boundComponent.component)}}class at extends Q{constructor(t,e,i,n){super(),this.layoutManager=t,this._parent=i,this._element=n,this._popInParentIds=[],this._type=e.type,this._id=e.id,this._isInitialised=!1,this.isGround=!1,this.isRow=!1,this.isColumn=!1,this.isStack=!1,this.isComponent=!1,this.size=e.size,this.sizeUnit=e.sizeUnit,this.minSize=e.minSize,this.minSizeUnit=e.minSizeUnit,this._isClosable=e.isClosable,this._pendingEventPropagations={},this._throttledEvents=["stateChanged"],this._contentItems=this.createContentItems(e.content)}get type(){return this._type}get id(){return this._id}set id(t){this._id=t}get popInParentIds(){return this._popInParentIds}get parent(){return this._parent}get contentItems(){return this._contentItems}get isClosable(){return this._isClosable}get element(){return this._element}get isInitialised(){return this._isInitialised}static isStack(t){return t.isStack}static isComponentItem(t){return t.isComponent}static isComponentParentableItem(t){return t.isStack||t.isGround}removeChild(t,e=!1){const i=this._contentItems.indexOf(t);if(-1===i)throw new Error("Can't remove child item. Unknown content item");if(e||this._contentItems[i].destroy(),this._contentItems.splice(i,1),this._contentItems.length>0)this.updateSize(!1);else if(!this.isGround&&!0===this._isClosable){if(null===this._parent)throw new s("CIUC00874");this._parent.removeChild(this)}}addChild(t,e,i){return null!=e||(e=this._contentItems.length),this._contentItems.splice(e,0,t),t.setParent(this),!0===this._isInitialised&&!1===t._isInitialised&&t.init(),e}replaceChild(t,i,n=!1){const o=this._contentItems.indexOf(t),r=t._element.parentNode;if(-1===o)throw new e("CIRCI23232","Can't replace child. oldChild is not child of this");if(null===r)throw new s("CIRCP23232");if(r.replaceChild(i._element,t._element),!0===n&&(t._parent=null,t.destroy()),this._contentItems[o]=i,i.setParent(this),i.size=t.size,i.sizeUnit=t.sizeUnit,i.minSize=t.minSize,i.minSizeUnit=t.minSizeUnit,null===i._parent)throw new s("CIRCNC45699");!0===i._parent._isInitialised&&!1===i._isInitialised&&i.init(),this.updateSize(!1)}remove(){if(null===this._parent)throw new s("CIR11110");this._parent.removeChild(this)}popout(){const t=z(),e=this.layoutManager.createPopoutFromContentItem(this,void 0,t,void 0);return this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this._contentItems,e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=e.toConfig()}return i}highlightDropZone(t,e,i){const n=this.layoutManager.dropTargetIndicator;if(null===n)throw new s("ACIHDZ5593");n.highlightArea(i,1)}onDrop(t,e){this.addChild(t)}show(){this.layoutManager.beginSizeInvalidation();try{T(this._element,!0);for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].show()}finally{this.layoutManager.endSizeInvalidation()}}destroy(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].destroy();this._contentItems=[],this.emitBaseBubblingEvent("beforeItemDestroyed"),this._element.remove(),this.emitBaseBubblingEvent("itemDestroyed")}getElementArea(t){const e=(t=null!=t?t:this._element).getBoundingClientRect(),i=e.top+document.body.scrollTop,n=e.left+document.body.scrollLeft,s=e.width,o=e.height;return{x1:n,y1:i,x2:n+s,y2:i+o,surface:s*o,contentItem:this}}init(){this._isInitialised=!0,this.emitBaseBubblingEvent("itemCreated"),this.emitUnknownBubblingEvent(this.type+"Created")}setParent(t){this._parent=t}addPopInParentId(t){this.popInParentIds.includes(t)||this.popInParentIds.push(t)}initContentItems(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].init()}hide(){this.layoutManager.beginSizeInvalidation();try{T(this._element,!1)}finally{this.layoutManager.endSizeInvalidation()}}updateContentItemsSize(t){for(let e=0;e<this._contentItems.length;e++)this._contentItems[e].updateSize(t)}createContentItems(t){const e=t.length,i=new Array(e);for(let e=0;e<t.length;e++)i[e]=this.layoutManager.createContentItem(t[e],this);return i}propagateEvent(t,e){if(1===e.length){const i=e[0];i instanceof Q.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}tryBubbleEvent(t,e){if(1===e.length){const i=e[0];i instanceof Q.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}scheduleEventPropagationToLayoutManager(t,e){-1===this._throttledEvents.indexOf(t)?this.layoutManager.emitUnknown(t,e):!0!==this._pendingEventPropagations[t]&&(this._pendingEventPropagations[t]=!0,globalThis.requestAnimationFrame(()=>this.propagateEventToLayoutManager(t,e)))}propagateEventToLayoutManager(t,e){this._pendingEventPropagations[t]=!1,this.layoutManager.emitUnknown(t,e)}}class lt extends at{constructor(t,e,i){super(t,e,i,document.createElement("div")),this._parentItem=i,this._focused=!1,this.isComponent=!0,this._reorderEnabled=e.reorderEnabled,this.applyUpdatableConfig(e),this._initialWantMaximise=e.maximised;const n=document.createElement("div");n.classList.add("lm_content"),this.element.appendChild(n),this._container=new rt(e,this,t,n,t=>this.handleUpdateItemConfigEvent(t),()=>this.show(),()=>this.hide(),t=>this.focus(t),t=>this.blur(t))}get componentName(){return this._container.componentType}get componentType(){return this._container.componentType}get reorderEnabled(){return this._reorderEnabled}get initialWantMaximise(){return this._initialWantMaximise}get component(){return this._container.component}get container(){return this._container}get parentItem(){return this._parentItem}get headerConfig(){return this._headerConfig}get title(){return this._title}get tab(){return this._tab}get focused(){return this._focused}destroy(){this._container.destroy(),super.destroy()}applyUpdatableConfig(t){this.setTitle(t.title),this._headerConfig=t.header}toConfig(){const t=this._container.stateRequestEvent,e=void 0===t?this._container.state:t();return{type:p.component,content:[],size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,maximised:!1,isClosable:this.isClosable,reorderEnabled:this._reorderEnabled,title:this._title,header:v.Header.createCopy(this._headerConfig),componentType:_.copyComponentType(this.componentType),componentState:e}}close(){if(null===this.parent)throw new s("CIC68883");this.parent.removeChild(this,!1)}enterDragMode(t,e){R(this.element,t),M(this.element,e),this._container.enterDragMode(t,e)}exitDragMode(){this._container.exitDragMode()}enterStackMaximised(){this._container.enterStackMaximised()}exitStackMaximised(){this._container.exitStackMaximised()}drag(){this._container.drag()}updateSize(t){this.updateNodeSize(t)}init(){this.updateNodeSize(!1),super.init(),this._container.emit("open"),this.initContentItems()}setTitle(t){this._title=t,this.emit("titleChanged",t),this.emit("stateChanged")}setTab(t){this._tab=t,this.emit("tab",t),this._container.setTab(t)}hide(){super.hide(),this._container.setVisibility(!1)}show(){super.show(),this._container.setVisibility(!0)}focus(t=!1){this.parentItem.setActiveComponentItem(this,!0,t)}setFocused(t){this._focused=!0,this.tab.setFocused(),t||this.emitBaseBubblingEvent("focus")}blur(t=!1){this._focused&&this.layoutManager.setFocusedComponentItem(void 0,t)}setBlurred(t){this._focused=!1,this.tab.setBlurred(),t||this.emitBaseBubblingEvent("blur")}setParent(t){this._parentItem=t,super.setParent(t)}handleUpdateItemConfigEvent(t){this.applyUpdatableConfig(t)}updateNodeSize(t){if("none"!==this.element.style.display){const{width:e,height:i}=L(this.element);this._container.setSizeToNodeSize(e,i,t)}}}class ht extends at{constructor(){super(...arguments),this._focused=!1}get focused(){return this._focused}setFocusedValue(t){this._focused=t}}class dt extends ht{constructor(t,e,i){var n,s,o,r,a,l,d,c,u,p,m,g,f,v,b,_,w,y,C;super(t,e,i,dt.createElement(document)),this._headerSideChanged=!1,this._resizeListener=()=>this.handleResize(),this._maximisedListener=()=>this.handleMaximised(),this._minimisedListener=()=>this.handleMinimised(),this._headerConfig=e.header;const x=t.layoutConfig.header,E=e.content;let S;S=1!==E.length?void 0:E[0].header,this._initialWantMaximise=e.maximised,this._initialActiveItemIndex=null!==(n=e.activeItemIndex)&&void 0!==n?n:0;const P=null!==(r=null!==(o=null===(s=this._headerConfig)||void 0===s?void 0:s.show)&&void 0!==o?o:null==S?void 0:S.show)&&void 0!==r?r:x.show,k=null!==(d=null!==(l=null===(a=this._headerConfig)||void 0===a?void 0:a.popout)&&void 0!==l?l:null==S?void 0:S.popout)&&void 0!==d?d:x.popout,I=null!==(p=null!==(u=null===(c=this._headerConfig)||void 0===c?void 0:c.maximise)&&void 0!==u?u:null==S?void 0:S.maximise)&&void 0!==p?p:x.maximise,R=null!==(f=null!==(g=null===(m=this._headerConfig)||void 0===m?void 0:m.close)&&void 0!==g?g:null==S?void 0:S.close)&&void 0!==f?f:x.close,M=null!==(_=null!==(b=null===(v=this._headerConfig)||void 0===v?void 0:v.minimise)&&void 0!==b?b:null==S?void 0:S.minimise)&&void 0!==_?_:x.minimise,L=null!==(C=null!==(y=null===(w=this._headerConfig)||void 0===w?void 0:w.tabDropdown)&&void 0!==y?y:null==S?void 0:S.tabDropdown)&&void 0!==C?C:x.tabDropdown;this._maximisedEnabled=!1!==I;const T={show:!1!==P,side:!1===P?h.top:P,popoutEnabled:!1!==k,popoutLabel:!1===k?"":k,maximiseEnabled:this._maximisedEnabled,maximiseLabel:!1===I?"":I,closeEnabled:!1!==R,closeLabel:!1===R?"":R,minimiseEnabled:!0,minimiseLabel:M,tabDropdownEnabled:!1!==L,tabDropdownLabel:!1===L?"":L};this._header=new ot(t,this,T,e.isClosable&&!1!==R,()=>this.getActiveComponentItem(),()=>this.remove(),()=>this.handlePopoutEvent(),()=>this.toggleMaximise(),t=>this.handleHeaderClickEvent(t),t=>this.handleHeaderTouchStartEvent(t),t=>this.handleHeaderComponentRemoveEvent(t),t=>this.handleHeaderComponentFocusEvent(t),(t,e,i,n)=>this.handleHeaderComponentStartDragEvent(t,e,i,n)),this.isStack=!0,this._childElementContainer=document.createElement("section"),this._childElementContainer.classList.add("lm_items"),this.on("resize",this._resizeListener),this._maximisedEnabled&&(this.on("maximised",this._maximisedListener),this.on("minimised",this._minimisedListener)),this.element.appendChild(this._header.element),this.element.appendChild(this._childElementContainer),this.setupHeaderPosition(),this._header.updateClosability()}get childElementContainer(){return this._childElementContainer}get header(){return this._header}get headerShow(){return this._header.show}get headerSide(){return this._header.side}get headerLeftRightSided(){return this._header.leftRightSided}get contentAreaDimensions(){return this._contentAreaDimensions}get initialWantMaximise(){return this._initialWantMaximise}get isMaximised(){return this===this.layoutManager.maximisedStack}get stackParent(){if(!this.parent)throw new Error("Stack should always have a parent");return this.parent}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(!0===this.isInitialised)return;this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();const t=this.contentItems,e=t.length;if(e>0){if(this._initialActiveItemIndex<0||this._initialActiveItemIndex>=e)throw new Error(`ActiveItemIndex out of range: ${this._initialActiveItemIndex} id: ${this.id}`);for(let i=0;i<e;i++){const e=t[i];if(!(e instanceof lt))throw new Error(`Stack Content Item is not of type ComponentItem: ${i} id: ${this.id}`);this._header.createTab(e,i),e.hide(),e.container.setBaseLogicalZIndex()}this.setActiveComponentItem(t[this._initialActiveItemIndex],!1),this._header.updateTabSizes()}this._header.updateClosability(),this.initContentItems()}setActiveContentItem(t){if(!at.isComponentItem(t))throw new Error("Stack.setActiveContentItem: item is not a ComponentItem");this.setActiveComponentItem(t,!1)}setActiveComponentItem(t,e,i=!1){if(this._activeComponentItem!==t){if(-1===this.contentItems.indexOf(t))throw new Error("componentItem is not a child of this stack");this.layoutManager.beginSizeInvalidation();try{void 0!==this._activeComponentItem&&this._activeComponentItem.hide(),this._activeComponentItem=t,this._header.processActiveComponentChanged(t),t.show()}finally{this.layoutManager.endSizeInvalidation()}this.emit("activeContentItemChanged",t),this.layoutManager.emit("activeContentItemChanged",t),this.emitStateChangedEvent()}(this.focused||e)&&this.layoutManager.setFocusedComponentItem(t,i)}getActiveContentItem(){var t;return null!==(t=this.getActiveComponentItem())&&void 0!==t?t:null}getActiveComponentItem(){return this._activeComponentItem}focusActiveContentItem(){var t;null===(t=this._activeComponentItem)||void 0===t||t.focus()}setFocusedValue(t){this._header.applyFocusedValue(t),super.setFocusedValue(t)}setRowColumnClosable(t){this._header.setRowColumnClosable(t)}newComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.newItem(s,n)}addComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItem(s,n)}newItem(t,e){return e=this.addItem(t,e),this.contentItems[e]}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e)}addChild(t,i,n=!1){if(void 0!==i&&i>this.contentItems.length)throw i-=1,new e("SAC99728");if(t instanceof lt)return i=super.addChild(t,i),this._childElementContainer.appendChild(t.element),this._header.createTab(t,i),this.setActiveComponentItem(t,n),this._header.updateTabSizes(),this.updateSize(!1),t.container.setBaseLogicalZIndex(),this._header.updateClosability(),this.emitStateChangedEvent(),i;throw new e("SACC88532")}removeChild(t,e){const i=t,n=this.contentItems.indexOf(i),s=1===this.contentItems.length;if(this._activeComponentItem===i&&(i.focused&&i.blur(),!s)){const t=0===n?1:n-1;this.setActiveComponentItem(this.contentItems[t],!1)}this._header.removeTab(i),super.removeChild(i,e),s||this._header.updateClosability(),this.emitStateChangedEvent()}toggleMaximise(){this.isMaximised?this.minimise():this.maximise()}maximise(){if(!this.isMaximised){this.layoutManager.setMaximisedStack(this);const t=this.contentItems,i=t.length;for(let n=0;n<i;n++){const i=t[n];if(!(i instanceof lt))throw new e("SMAXI87773");i.enterStackMaximised()}this.emitStateChangedEvent()}}minimise(){if(this.isMaximised){this.layoutManager.setMaximisedStack(void 0);const t=this.contentItems,i=t.length;for(let n=0;n<i;n++){const i=t[n];if(!(i instanceof lt))throw new e("SMINI87773");i.exitStackMaximised()}this.emitStateChangedEvent()}}destroy(){var t;(null===(t=this._activeComponentItem)||void 0===t?void 0:t.focused)&&this._activeComponentItem.blur(),super.destroy(),this.off("resize",this._resizeListener),this._maximisedEnabled&&(this.off("maximised",this._maximisedListener),this.off("minimised",this._minimisedListener)),this._header.destroy()}toConfig(){let t;if(this._activeComponentItem&&(t=this.contentItems.indexOf(this._activeComponentItem),t<0))throw new Error("active component item not found in stack");if(this.contentItems.length>0&&void 0===t)throw new Error("expected non-empty stack to have an active component item");return{type:"stack",content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable,maximised:this.isMaximised,header:this.createHeaderConfig(),activeItemIndex:t}}onDrop(t,e){if("header"===this._dropSegment){if(this.resetHeaderDropZone(),void 0===this._dropIndex)throw new o("SODDI68990");return void this.addChild(t,this._dropIndex)}if("body"===this._dropSegment)return void this.addChild(t,0,!0);const i="top"===this._dropSegment||"bottom"===this._dropSegment,n="left"===this._dropSegment||"right"===this._dropSegment,s="top"===this._dropSegment||"left"===this._dropSegment,r=i&&this.stackParent.isColumn||n&&this.stackParent.isRow;if(t.isComponent){const e=b.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createAndInitContentItem(e,this);i.addChild(t),t=i}if(t.type===p.row||t.type===p.column){const e=b.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}if(r){const e=this.stackParent.contentItems.indexOf(this);this.stackParent.addChild(t,s?e:e+1,!0),this.size*=.5,t.size=this.size,t.sizeUnit=this.sizeUnit,this.stackParent.updateSize(!1)}else{const e=i?p.column:p.row,n=f.createDefault(e),o=this.layoutManager.createContentItem(n,this);this.stackParent.replaceChild(this,o),o.addChild(t,s?0:void 0,!0),o.addChild(this,s?void 0:0,!0),this.size=50,t.size=50,t.sizeUnit=g.Percent,o.updateSize(!1)}}highlightDropZone(t,e){for(const i in this._contentAreaDimensions){const n=i,s=this._contentAreaDimensions[n].hoverArea;if(s.x1<t&&s.x2>t&&s.y1<e&&s.y2>e)return void("header"===n?(this._dropSegment="header",this.highlightHeaderDropZone(this._header.leftRightSided?e:t)):(this.resetHeaderDropZone(),this.highlightBodyDropZone(n)))}}getArea(){if("none"===this.element.style.display)return null;const t=super.getElementArea(this._header.element),e=super.getElementArea(this._childElementContainer);if(null===t||null===e)throw new s("SGAHC13086");const i=e.x2-e.x1,n=e.y2-e.y1;return this._contentAreaDimensions={header:{hoverArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},highlightArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}}},0===this.contentItems.length?(this._contentAreaDimensions.body={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}},super.getElementArea(this.element)):(this._contentAreaDimensions.left={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x1+.25*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x1+.5*i,y2:e.y2}},this._contentAreaDimensions.top={hoverArea:{x1:e.x1+.25*i,y1:e.y1,x2:e.x1+.75*i,y2:e.y1+.5*n},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y1+.5*n}},this._contentAreaDimensions.right={hoverArea:{x1:e.x1+.75*i,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1+.5*i,y1:e.y1,x2:e.x2,y2:e.y2}},this._contentAreaDimensions.bottom={hoverArea:{x1:e.x1+.25*i,y1:e.y1+.5*n,x2:e.x1+.75*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1+.5*n,x2:e.x2,y2:e.y2}},super.getElementArea(this.element))}positionHeader(t){this._header.side!==t&&(this._header.setSide(t),this._headerSideChanged=!0,this.setupHeaderPosition())}updateNodeSize(){if("none"!==this.element.style.display){const t=L(this.element);this._header.show&&(t[this._header.leftRightSided?l.width:l.height]-=this.layoutManager.layoutConfig.dimensions.headerHeight),this._childElementContainer.style.width=P(t.width),this._childElementContainer.style.height=P(t.height);for(let e=0;e<this.contentItems.length;e++)this.contentItems[e].element.style.width=P(t.width),this.contentItems[e].element.style.height=P(t.height);this.emit("resize"),this.emitStateChangedEvent()}}highlightHeaderDropZone(t){const e=this._header.lastVisibleTabIndex+1,i=this._header.tabsContainerElement.childNodes,n=new Array(e);let o=0,r=0;for(;r<e;){const t=i[o++];t!==this.layoutManager.tabDropPlaceholder&&(n[r++]=t)}const a=this.layoutManager.dropTargetIndicator;if(null===a)throw new s("SHHDZDTI97110");let l;if(0===e){const t=this._header.element.getBoundingClientRect(),e=t.top+document.body.scrollTop,i=t.left+document.body.scrollLeft;l={x1:i,x2:i+100,y1:e+t.height-20,y2:e+t.height},this._dropIndex=0}else{let i,s,o,r,a=0,h=!1;do{r=n[a];const e=r.getBoundingClientRect(),l=e.top+document.body.scrollTop,d=e.left+document.body.scrollLeft;this._header.leftRightSided?(s=l,i=d,o=e.height):(s=d,i=l,o=e.width),t>=s&&t<s+o?h=!0:a++}while(a<e&&!h);if(!1===h&&t<s)return;t<s+o/2?(this._dropIndex=a,r.insertAdjacentElement("beforebegin",this.layoutManager.tabDropPlaceholder)):(this._dropIndex=Math.min(a+1,e),r.insertAdjacentElement("afterend",this.layoutManager.tabDropPlaceholder));const d=this.layoutManager.tabDropPlaceholder.getBoundingClientRect(),c=d.top+document.body.scrollTop,u=d.left+document.body.scrollLeft,p=d.width;if(this._header.leftRightSided){const t=c;l={x1:i,x2:i+r.clientHeight,y1:t,y2:t+p}}else l={x1:u,x2:u+p,y1:i,y2:i+r.clientHeight}}a.highlightArea(l,0)}resetHeaderDropZone(){this.layoutManager.tabDropPlaceholder.remove()}setupHeaderPosition(){T(this._header.element,this._header.show),this.element.classList.remove("lm_left","lm_right","lm_bottom"),this._header.leftRightSided&&this.element.classList.add("lm_"+this._header.side),this.updateSize(!1)}highlightBodyDropZone(t){if(void 0===this._contentAreaDimensions)throw new o("SHBDZC82265");{const e=this._contentAreaDimensions[t].highlightArea,i=this.layoutManager.dropTargetIndicator;if(null===i)throw new s("SHBDZD96110");i.highlightArea(e,1),this._dropSegment=t}}handleResize(){this._header.updateTabSizes()}handleMaximised(){this._header.processMaximised()}handleMinimised(){this._header.processMinimised()}handlePopoutEvent(){this.popout()}handleHeaderClickEvent(t){const e=Q.headerClickEventName,i=new Q.ClickBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderTouchStartEvent(t){const e=Q.headerTouchStartEventName,i=new Q.TouchStartBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderComponentRemoveEvent(t){this.removeChild(t,!1)}handleHeaderComponentFocusEvent(t){this.setActiveComponentItem(t,!0)}handleHeaderComponentStartDragEvent(t,e,i,n){!0===this.isMaximised&&this.toggleMaximise(),this.layoutManager.startComponentDrag(t,e,i,n,this)}createHeaderConfig(){if(this._headerSideChanged){const t=!!this._header.show&&this._header.side;let e=v.Header.createCopy(this._headerConfig,t);return void 0===e&&(e={show:t,popout:void 0,maximise:void 0,close:void 0,minimise:void 0,tabDropdown:void 0}),e}return v.Header.createCopy(this._headerConfig)}emitStateChangedEvent(){this.emitBaseBubblingEvent("stateChanged")}}!function(t){t.createElement=function(t){const e=t.createElement("div");return e.classList.add("lm_item"),e.classList.add("lm_stack"),e}}(dt||(dt={}));class ct extends Q{constructor(t,e,i,n,o,r){if(super(),this._dragListener=i,this._layoutManager=n,this._componentItem=o,this._originalParent=r,this._area=null,this._lastValidArea=null,this._dragListener.on("drag",(t,e,i)=>this.onDrag(t,e,i)),this._dragListener.on("dragStop",()=>this.onDrop()),this.createDragProxyElements(t,e),null===this._componentItem.parent)throw new s("DPC10097");this._componentItemFocused=this._componentItem.focused,this._componentItemFocused&&this._componentItem.blur(),this._componentItem.parent.removeChild(this._componentItem,!0),this.setDimensions(),document.body.appendChild(this._element),this.determineMinMaxXY(),this._layoutManager.calculateItemAreas(),this.setDropPosition(t,e)}get element(){return this._element}createDragProxyElements(t,e){this._element=document.createElement("div"),this._element.classList.add("lm_dragProxy");const i=document.createElement("div");i.classList.add("lm_header");const n=document.createElement("div");n.classList.add("lm_tabs");const s=document.createElement("div");s.classList.add("lm_tab");const o=document.createElement("span");o.classList.add("lm_title"),s.appendChild(o),n.appendChild(s),i.appendChild(n),this._proxyContainerElement=document.createElement("div"),this._proxyContainerElement.classList.add("lm_content"),this._element.appendChild(i),this._element.appendChild(this._proxyContainerElement),this._originalParent instanceof dt&&this._originalParent.headerShow&&(this._sided=this._originalParent.headerLeftRightSided,this._element.classList.add("lm_"+this._originalParent.headerSide),[h.right,h.bottom].indexOf(this._originalParent.headerSide)>=0&&this._proxyContainerElement.insertAdjacentElement("afterend",i)),this._element.style.left=P(t),this._element.style.top=P(e),s.setAttribute("title",this._componentItem.title),o.insertAdjacentText("afterbegin",this._componentItem.title),this._proxyContainerElement.appendChild(this._componentItem.element)}determineMinMaxXY(){const t=this._layoutManager.groundItem;if(void 0===t)throw new o("DPDMMXY73109");{const e=t.element.getBoundingClientRect();this._minX=e.left+document.body.scrollLeft,this._minY=e.top+document.body.scrollTop,this._maxX=this._minX+e.width,this._maxY=this._minY+e.height}}onDrag(t,e,i){const n=i.pageX,s=i.pageY;this.setDropPosition(n,s),this._componentItem.drag()}setDropPosition(t,e){this._layoutManager.layoutConfig.settings.constrainDragToContainer&&(t<=this._minX?t=Math.ceil(this._minX):t>=this._maxX&&(t=Math.floor(this._maxX)),e<=this._minY?e=Math.ceil(this._minY):e>=this._maxY&&(e=Math.floor(this._maxY))),this._element.style.left=P(t),this._element.style.top=P(e),this._area=this._layoutManager.getArea(t,e),null!==this._area&&(this._lastValidArea=this._area,this._area.contentItem.highlightDropZone(t,e,this._area))}onDrop(){const t=this._layoutManager.dropTargetIndicator;if(null===t)throw new s("DPOD30011");let e;t.hide(),this._componentItem.exitDragMode(),null!==this._area?(e=this._componentItem,this._area.contentItem.onDrop(e,this._area)):null!==this._lastValidArea?(e=this._componentItem,this._lastValidArea.contentItem.onDrop(e,this._lastValidArea)):this._originalParent?(e=this._componentItem,this._originalParent.addChild(e)):this._componentItem.destroy(),this._element.remove(),this._layoutManager.emit("itemDropped",this._componentItem),this._componentItemFocused&&void 0!==e&&e.focus()}setDimensions(){const t=this._layoutManager.layoutConfig.dimensions;if(void 0===t)throw new Error("DragProxy.setDimensions: dimensions undefined");let e=t.dragProxyWidth,i=t.dragProxyHeight;if(void 0===e||void 0===i)throw new Error("DragProxy.setDimensions: width and/or height undefined");const n=!1===this._layoutManager.layoutConfig.header.show?0:t.headerHeight;this._element.style.width=P(e),this._element.style.height=P(i),e-=this._sided?n:0,i-=this._sided?0:n,this._proxyContainerElement.style.width=P(e),this._proxyContainerElement.style.height=P(i),this._componentItem.enterDragMode(e,i),this._componentItem.show()}}class ut{constructor(t,e,i){this._isVertical=t,this._size=e,this._grabSize=i<this._size?this._size:i,this._element=document.createElement("div"),this._element.classList.add("lm_splitter");const n=document.createElement("div");n.classList.add("lm_drag_handle");const s=this._grabSize-this._size,o=s/2;this._isVertical?(n.style.top=P(-o),n.style.height=P(this._size+s),this._element.classList.add("lm_vertical"),this._element.style.height=P(this._size)):(n.style.left=P(-o),n.style.width=P(this._size+s),this._element.classList.add("lm_horizontal"),this._element.style.width=P(this._size)),this._element.appendChild(n),this._dragListener=new it(this._element,[n])}get element(){return this._element}destroy(){this._element.remove()}on(t,e){this._dragListener.on(t,e)}}class pt extends at{constructor(t,i,n,s){switch(super(i,n,s,pt.createElement(document,t)),this._rowOrColumnParent=s,this._splitter=[],this.isRow=!t,this.isColumn=t,this._childElementContainer=this.element,this._splitterSize=i.layoutConfig.dimensions.borderWidth,this._splitterGrabSize=i.layoutConfig.dimensions.borderGrabWidth,this._isColumn=t,this._dimension=t?"height":"width",this._splitterPosition=null,this._splitterMinPosition=null,this._splitterMaxPosition=null,n.type){case p.row:case p.column:this._configType=n.type;break;default:throw new e("ROCCCT00925")}}newComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.newItem(s,n)}addComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItem(s,n)}newItem(t,e){e=this.addItem(t,e);const i=this.contentItems[e];return at.isStack(i)&&G.isComponent(t)?i.contentItems[0]:i}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e,!1)}addChild(t,e,i){if(void 0===e&&(e=this.contentItems.length),this.contentItems.length>0){const i=this.createSplitter(Math.max(0,e-1)).element;e>0?(this.contentItems[e-1].element.insertAdjacentElement("afterend",i),i.insertAdjacentElement("afterend",t.element)):(this.contentItems[0].element.insertAdjacentElement("beforebegin",i),i.insertAdjacentElement("beforebegin",t.element))}else this._childElementContainer.appendChild(t.element);super.addChild(t,e);const n=1/this.contentItems.length*100;if(!0===i)return this.emitBaseBubblingEvent("stateChanged"),e;for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];if(i===t)t.size=n;else{const t=i.size*=(100-n)/100;i.size=t}}return this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),e}removeChild(t,e){const i=this.contentItems.indexOf(t),n=Math.max(i-1,0);if(-1===i)throw new Error("Can't remove child. ContentItem is not child of this Row or Column");if(this._splitter[n]&&(this._splitter[n].destroy(),this._splitter.splice(n,1)),super.removeChild(t,e),1===this.contentItems.length&&!0===this.isClosable){const t=this.contentItems[0];this.contentItems.length=0,this._rowOrColumnParent.replaceChild(this,t,!0)}else this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}replaceChild(t,e){const i=t.size;super.replaceChild(t,e),e.size=i,this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();for(let t=0;t<this.contentItems.length-1;t++)this.contentItems[t].element.insertAdjacentElement("afterend",this.createSplitter(t).element);this.initContentItems()}}toConfig(){return{type:this.type,content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable}}setParent(t){this._rowOrColumnParent=t,super.setParent(t)}updateNodeSize(){this.contentItems.length>0&&(this.calculateRelativeSizes(),this.setAbsoluteSizes()),this.emitBaseBubblingEvent("stateChanged"),this.emit("resize")}setAbsoluteSizes(){const t=this.calculateAbsoluteSizes();for(let e=0;e<this.contentItems.length;e++)t.additionalPixel-e>0&&t.itemSizes[e]++,this._isColumn?(R(this.contentItems[e].element,t.crossAxisSize),M(this.contentItems[e].element,t.itemSizes[e])):(R(this.contentItems[e].element,t.itemSizes[e]),M(this.contentItems[e].element,t.crossAxisSize))}calculateAbsoluteSizes(){const t=(this.contentItems.length-1)*this._splitterSize,{width:i,height:n}=L(this.element);let s,o;this._isColumn?(s=n-t,o=i):(s=i-t,o=n);let r=0;const a=[];for(let t=0;t<this.contentItems.length;t++){const i=this.contentItems[t];let n;if(i.sizeUnit!==g.Percent)throw new e("ROCCAS6692");n=Math.floor(s*(i.size/100)),r+=n,a.push(n)}return{itemSizes:a,additionalPixel:Math.floor(s-r),totalSize:s,crossAxisSize:o}}calculateRelativeSizes(){let t=0;const i=[];let n=0;for(let s=0;s<this.contentItems.length;s++){const o=this.contentItems[s];switch(o.sizeUnit){case g.Percent:t+=o.size;break;case g.Fractional:i.push(o),n+=o.size;break;default:throw new e("ROCCRS49110",JSON.stringify(o))}}if(100!==Math.round(t)){if(Math.round(t)<100&&i.length>0){const e=100-t;for(let t=0;t<i.length;t++){const s=i[t];s.size=e*(s.size/n),s.sizeUnit=g.Percent}return void this.respectMinItemSize()}if(Math.round(t)>100&&i.length>0){for(let t=0;t<i.length;t++){const e=i[t];e.size=e.size/n*50,e.sizeUnit=g.Percent}t+=50}for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];i.size=i.size/t*100}this.respectMinItemSize()}else this.respectMinItemSize()}respectMinItemSize(){const t=this.calculateContentItemMinSize(this);if(!(t<=0||this.contentItems.length<=1)){let e=0,i=0;const n=[],s=[],o=this.calculateAbsoluteSizes();for(let r=0;r<o.itemSizes.length;r++){const a=o.itemSizes[r];let l;a<t?(i+=t-a,l={size:t}):(e+=a-t,l={size:a},n.push(l)),s.push(l)}if(0===i||i>e)return;{const r=i/e;let a=i;for(let e=0;e<n.length;e++){const i=n[e],s=Math.round((i.size-t)*r);a-=s,i.size-=s}0!==a&&(s[s.length-1].size-=a);for(let t=0;t<this.contentItems.length;t++)this.contentItems[t].size=s[t].size/o.totalSize*100}}}createSplitter(t){const e=new ut(this._isColumn,this._splitterSize,this._splitterGrabSize);return e.on("drag",(t,i)=>this.onSplitterDrag(e,t,i)),e.on("dragStop",()=>this.onSplitterDragStop(e)),e.on("dragStart",()=>this.onSplitterDragStart(e)),this._splitter.splice(t,0,e),e}getSplitItems(t){const e=this._splitter.indexOf(t);return{before:this.contentItems[e],after:this.contentItems[e+1]}}calculateContentItemMinSize(t){const i=t.minSize;if(void 0!==i){if(t.minSizeUnit===g.Pixel)return i;throw new e("ROCGMD98831",JSON.stringify(t))}{const t=this.layoutManager.layoutConfig.dimensions;return this._isColumn?t.defaultMinItemHeight:t.defaultMinItemWidth}}calculateContentItemsTotalMinSize(t){let e=0;for(const i of t)e+=this.calculateContentItemMinSize(i);return e}onSplitterDragStart(t){const e=this.getSplitItems(t),i=k(e.before.element.style[this._dimension]),n=k(e.after.element.style[this._dimension]),s=this.calculateContentItemsTotalMinSize(e.before.contentItems),o=this.calculateContentItemsTotalMinSize(e.after.contentItems);this._splitterPosition=0,this._splitterMinPosition=-1*(i-s),this._splitterMaxPosition=n-o}onSplitterDrag(t,e,i){let n=this._isColumn?i:e;if(null===this._splitterMinPosition||null===this._splitterMaxPosition)throw new s("ROCOSD59226");n=Math.max(n,this._splitterMinPosition),n=Math.min(n,this._splitterMaxPosition),this._splitterPosition=n;const o=P(n);this._isColumn?t.element.style.top=o:t.element.style.left=o}onSplitterDragStop(t){if(null===this._splitterPosition)throw new s("ROCOSDS66932");{const e=this.getSplitItems(t),i=k(e.before.element.style[this._dimension]),n=k(e.after.element.style[this._dimension]),s=(this._splitterPosition+i)/(i+n),o=e.before.size+e.after.size;e.before.size=s*o,e.after.size=(1-s)*o,t.element.style.top=P(0),t.element.style.left=P(0),globalThis.requestAnimationFrame(()=>this.updateSize(!1))}}}!function(t){t.getElementDimensionSize=function(t,e){return"width"===e?function(t){return t.offsetWidth}(t):function(t){return t.offsetHeight}(t)},t.setElementDimensionSize=function(t,e,i){return"width"===e?R(t,i):M(t,i)},t.createElement=function(t,e){const i=t.createElement("div");return i.classList.add("lm_item"),e?i.classList.add("lm_column"):i.classList.add("lm_row"),i}}(pt||(pt={}));class mt extends ht{constructor(t,e,i){super(t,C.create(e),null,mt.createElement(document)),this.isGround=!0,this._childElementContainer=this.element,this._containerElement=i;let n=null;for(;;){const t=n?n.previousSibling:this._containerElement.lastChild;if(!(t instanceof Element&&t.classList.contains("lm_content")))break;n=t}this._containerElement.insertBefore(this.element,n)}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init(),this.initContentItems()}}loadRoot(t){if(this.clearRoot(),void 0!==t){const e=this.layoutManager.createAndInitContentItem(t,this);this.addChild(e,0)}}clearRoot(){const t=this.contentItems;switch(t.length){case 0:return;case 1:return void t[0].remove();default:throw new e("GILR07721")}}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1);let n;if(n=this.contentItems.length>0?this.contentItems[0]:this,n.isComponent)throw new Error("Cannot add item as child to ComponentItem");{const t=this.layoutManager.createAndInitContentItem(i,n);return e=n.addChild(t,e),n===this?-1:e}}loadComponentAsRoot(t){this.clearRoot();const e=G.resolve(t,!1);if(e.maximised)throw new Error("Root Component cannot be maximised");{const t=new lt(this.layoutManager,e,this);t.init(),this.addChild(t,0)}}addChild(t,e){if(this.contentItems.length>0)throw new Error("Ground node can only have a single child");return this._childElementContainer.appendChild(t.element),e=super.addChild(t,e),this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this.contentItems,i=t.length,n=new Array(i);for(let s=0;s<i;s++){const i=t[s].toConfig();if(!y.isRootItemConfig(i))throw new e("RCCC66832");n[s]=i}return n}setSize(t,e){void 0===t||void 0===e?this.updateSize(!1):(R(this.element,t),M(this.element,e),this.contentItems.length>0&&(R(this.contentItems[0].element,t),M(this.contentItems[0].element,e)),this.updateContentItemsSize(!1))}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}createSideAreas(){const t=mt.Area.oppositeSides,e=new Array(Object.keys(t).length);let i=0;for(const n in t){const o=n,r=this.getElementArea();if(null===r)throw new s("RCSA77553");r.side=o,"2"===t[o][1]?r[o]=r[t[o]]-50:r[o]=r[t[o]]+50,r.surface=(r.x2-r.x1)*(r.y2-r.y1),e[i++]=r}return e}highlightDropZone(t,e,i){this.layoutManager.tabDropPlaceholder.remove(),super.highlightDropZone(t,e,i)}onDrop(t,e){if(t.isComponent){const e=b.createDefault(),i=t;e.header=v.Header.createCopy(i.headerConfig);const n=this.layoutManager.createAndInitContentItem(e,this);n.addChild(t),t=n}if(0===this.contentItems.length)this.addChild(t);else{if(t.type===p.row||t.type===p.column){const e=b.createDefault(),i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}const i="x"==e.side[0]?p.row:p.column,n="2"==e.side[1],s=this.contentItems[0];if(s instanceof pt&&s.type===i){const e=s.contentItems[n?0:s.contentItems.length-1];s.addChild(t,n?0:void 0,!0),e.size*=.5,t.size=e.size,t.sizeUnit=g.Percent,s.updateSize(!1)}else{const e=f.createDefault(i),o=this.layoutManager.createContentItem(e,this);this.replaceChild(s,o),o.addChild(t,n?0:void 0,!0),o.addChild(s,n?void 0:0,!0),s.size=50,t.size=50,t.sizeUnit=g.Percent,o.updateSize(!1)}}}dock(){throw new e("GID87731")}validateDocking(){throw new e("GIVD87732")}getAllContentItems(){const t=[this];return this.deepGetAllContentItems(this.contentItems,t),t}getConfigMaximisedItems(){const t=[];return this.deepFilterContentItems(this.contentItems,t,t=>!(!at.isStack(t)||!t.initialWantMaximise)||!(!at.isComponentItem(t)||!t.initialWantMaximise)),t}getItemsByPopInParentId(t){const e=[];return this.deepFilterContentItems(this.contentItems,e,e=>e.popInParentIds.includes(t)),e}toConfig(){throw new Error("Cannot generate GroundItem config")}setActiveComponentItem(t,e,i){}updateNodeSize(){const{width:t,height:e}=L(this._containerElement);R(this.element,t),M(this.element,e),this.contentItems.length>0&&(R(this.contentItems[0].element,t),M(this.contentItems[0].element,e))}deepGetAllContentItems(t,e){for(let i=0;i<t.length;i++){const n=t[i];e.push(n),this.deepGetAllContentItems(n.contentItems,e)}}deepFilterContentItems(t,e,i){for(let n=0;n<t.length;n++){const s=t[n];i(s)&&e.push(s),this.deepFilterContentItems(s.contentItems,e,i)}}}!function(t){let e;!function(t){t.oppositeSides={y2:"y1",x2:"x1",y1:"y2",x1:"x2"}}(e=t.Area||(t.Area={})),t.createElement=function(t){const e=t.createElement("div");return e.classList.add("lm_goldenlayout"),e.classList.add("lm_item"),e.classList.add("lm_root"),e}}(mt||(mt={}));class gt{constructor(t,e,i,n,s,o,r){this._layoutManager=t,this._element=e,this._extraAllowableChildTargets=i,this._componentTypeOrFtn=n,this._componentState=s,this._title=o,this._id=r,this._dragListener=null,this._dummyGroundContainer=document.createElement("div");const a=w.createDefault("row");this._dummyGroundContentItem=new mt(this._layoutManager,a,this._dummyGroundContainer),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new it(this._element,this._extraAllowableChildTargets),this._dragListener.on("dragStart",(t,e)=>this.onDragStart(t,e)),this._dragListener.on("dragStop",()=>this.onDragStop())}onDragStart(t,e){var i;const n="component";let o;if("function"==typeof this._componentTypeOrFtn){const t=this._componentTypeOrFtn();o=gt.isDragSourceComponentItemConfig(t)?{type:n,componentState:t.state,componentType:t.type,title:null!==(i=t.title)&&void 0!==i?i:this._title}:t}else o={type:n,componentState:this._componentState,componentType:this._componentTypeOrFtn,title:this._title,id:this._id};const r=U.resolve(o,!1),a=new lt(this._layoutManager,r,this._dummyGroundContentItem);if(this._dummyGroundContentItem.contentItems.push(a),null===this._dragListener)throw new s("DSODSD66746");{const i=new ct(t,e,this._dragListener,this._layoutManager,a,this._dummyGroundContentItem),n=this._layoutManager.transitionIndicator;if(null===n)throw new s("DSODST66746");n.transitionElements(this._element,i.element)}}onDragStop(){this.createDragListener()}removeDragListener(){null!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=null)}}!function(t){t.isDragSourceComponentItemConfig=function(t){return!("componentType"in t)}}(gt||(gt={}));class ft{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_dropTargetIndicator");const t=document.createElement("div");t.classList.add("lm_inner"),this._element.appendChild(t),document.body.appendChild(this._element)}destroy(){this._element.remove()}highlightArea(t,e){this._element.style.left=P(t.x1+e),this._element.style.top=P(t.y1+e),this._element.style.width=P(t.x2-t.x1-e),this._element.style.height=P(t.y2-t.y1-e),this._element.style.display="block"}hide(){T(this._element,!1)}}class vt{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_transition_indicator"),document.body.appendChild(this._element),this._toElement=null,this._fromDimensions=null,this._totalAnimationDuration=200,this._animationStartTime=null}destroy(){this._element.remove()}transitionElements(t,e){}nextAnimationFrame(){}measure(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:t.offsetWidth,height:t.offsetHeight}}}class bt extends Q{constructor(t){super(),this._layoutManager=t,this._childEventListener=t=>this.onEventFromChild(t),globalThis.addEventListener(bt.ChildEventName,this._childEventListener,{passive:!0})}emit(t,...e){"userBroadcast"===t?this.emitUserBroadcast(...e):super.emit(t,...e)}emitUserBroadcast(...t){this.handleUserBroadcastEvent("userBroadcast",t)}destroy(){globalThis.removeEventListener(bt.ChildEventName,this._childEventListener)}handleUserBroadcastEvent(t,e){this._layoutManager.isSubWindow?this.propagateToParent(t,e):this.propagateToThisAndSubtree(t,e)}onEventFromChild(t){const e=t.detail;this.handleUserBroadcastEvent(e.eventName,e.args)}propagateToParent(t,e){const i={bubbles:!0,cancelable:!0,detail:{layoutManager:this._layoutManager,eventName:t,args:e}},n=new CustomEvent(bt.ChildEventName,i),o=globalThis.opener;if(null===o)throw new s("EHPTP15778");o.dispatchEvent(n)}propagateToThisAndSubtree(t,e){this.emitUnknown(t,...e);for(let i=0;i<this._layoutManager.openPopouts.length;i++){const n=this._layoutManager.openPopouts[i].getGlInstance();n&&n.eventHub.propagateToThisAndSubtree(t,e)}}}!function(t){t.ChildEventName="gl_child_event"}(bt||(bt={}));class _t extends Q{constructor(t){super(),this.resizeWithContainerAutomatically=!1,this.resizeDebounceInterval=100,this.resizeDebounceExtendedWhenPossible=!0,this._isInitialised=!1,this._groundItem=void 0,this._openPopouts=[],this._dropTargetIndicator=null,this._transitionIndicator=null,this._itemAreas=[],this._maximisePlaceholder=_t.createMaximisePlaceElement(document),this._tabDropPlaceholder=_t.createTabDropPlaceholderElement(document),this._dragSources=[],this._updatingColumnsResponsive=!1,this._firstLoad=!0,this._eventHub=new bt(this),this._width=null,this._height=null,this._virtualSizedContainers=[],this._virtualSizedContainerAddingBeginCount=0,this._sizeInvalidationBeginCount=0,this._resizeObserver=new ResizeObserver(()=>this.handleContainerResize()),this._windowBeforeUnloadListener=()=>this.onBeforeUnload(),this._windowBeforeUnloadListening=!1,this._maximisedStackBeforeDestroyedListener=t=>this.cleanupBeforeMaximisedStackDestroyed(t),this.isSubWindow=t.isSubWindow,this._constructorOrSubWindowLayoutConfig=t.constructorOrSubWindowLayoutConfig,S.checkInitialise(),r.checkInitialise(),void 0!==t.containerElement&&(this._containerElement=t.containerElement)}get container(){return this._containerElement}get isInitialised(){return this._isInitialised}get groundItem(){return this._groundItem}get root(){return this._groundItem}get openPopouts(){return this._openPopouts}get dropTargetIndicator(){return this._dropTargetIndicator}get transitionIndicator(){return this._transitionIndicator}get width(){return this._width}get height(){return this._height}get eventHub(){return this._eventHub}get rootItem(){if(void 0===this._groundItem)throw new Error("Cannot access rootItem before init");return 0===this._groundItem.contentItems.length?void 0:this._groundItem.contentItems[0]}get focusedComponentItem(){return this._focusedComponentItem}get tabDropPlaceholder(){return this._tabDropPlaceholder}get maximisedStack(){return this._maximisedStack}get deprecatedConstructor(){return!this.isSubWindow&&void 0!==this._constructorOrSubWindowLayoutConfig}destroy(){if(this._isInitialised){this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1),!0===this.layoutConfig.settings.closePopoutsOnUnload&&this.closeAllOpenPopouts(),this._resizeObserver.disconnect(),this.checkClearResizeTimeout(),void 0!==this._groundItem&&this._groundItem.destroy(),this._tabDropPlaceholder.remove(),null!==this._dropTargetIndicator&&this._dropTargetIndicator.destroy(),null!==this._transitionIndicator&&this._transitionIndicator.destroy(),this._eventHub.destroy();for(const t of this._dragSources)t.destroy();this._dragSources=[],this._isInitialised=!1}}minifyConfig(t){return x.minifyConfig(t)}unminifyConfig(t){return x.unminifyConfig(t)}init(){let t;if(this.setContainer(),this._dropTargetIndicator=new ft,this._transitionIndicator=new vt,this.updateSizeFromContainer(),this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new o("LMIU07155");{const i=this._constructorOrSubWindowLayoutConfig.root;if(void 0===i)throw new e("LMIC07156");if(!G.isComponent(i))throw new e("LMIC07157");t=i;const n=K.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},n),{root:void 0})}}else void 0===this._constructorOrSubWindowLayoutConfig?this.layoutConfig=x.createDefault():this.layoutConfig=K.resolve(this._constructorOrSubWindowLayoutConfig);const i=this.layoutConfig;this._groundItem=new mt(this,i.root,this._containerElement),this._groundItem.init(),this.checkLoadedLayoutMaximiseItem(),this._resizeObserver.observe(this._containerElement),this._isInitialised=!0,this.adjustColumnsResponsive(),this.emit("initialised"),void 0!==t&&this.loadComponentAsRoot(t)}loadLayout(t){if(!this.isInitialised)throw new Error("GoldenLayout: Need to call init() if LayoutConfig with defined root passed to constructor");if(void 0===this._groundItem)throw new o("LMLL11119");this.createSubWindows(),this.layoutConfig=K.resolve(t),this._groundItem.loadRoot(this.layoutConfig.root),this.checkLoadedLayoutMaximiseItem(),this.adjustColumnsResponsive()}saveLayout(){if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");if(void 0===this._groundItem)throw new o("LMTC18244");{const t=this._groundItem.calculateConfigContent();let e;e=1!==t.length?void 0:t[0],this.reconcilePopoutWindows();const i=[];for(let t=0;t<this._openPopouts.length;t++)i.push(this._openPopouts[t].toConfig());return{root:e,openPopouts:i,settings:x.Settings.createCopy(this.layoutConfig.settings),dimensions:x.Dimensions.createCopy(this.layoutConfig.dimensions),header:x.Header.createCopy(this.layoutConfig.header),resolved:!0}}}clear(){if(void 0===this._groundItem)throw new o("LMCL11129");this._groundItem.clearRoot()}toConfig(){return this.saveLayout()}newComponent(t,i,n){const s=this.newComponentAtLocation(t,i,n);if(void 0===s)throw new e("LMNC65588");return s}newComponentAtLocation(t,i,n,s){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const o=this.addComponentAtLocation(t,i,n,s);if(void 0===o)return;{const t=o.parentItem.contentItems[o.index];if(at.isComponentItem(t))return t;throw new e("LMNC992877533")}}}addComponent(t,i,n){const s=this.addComponentAtLocation(t,i,n);if(void 0===s)throw new e("LMAC99943");return s}addComponentAtLocation(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItemAtLocation(s,n)}newItem(t){const i=this.newItemAtLocation(t);if(void 0===i)throw new e("LMNC65588");return i}newItemAtLocation(t,e){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const i=this.addItemAtLocation(t,e);if(void 0===i)return;return i.parentItem.contentItems[i.index]}}addItem(t){const i=this.addItemAtLocation(t);if(void 0===i)throw new e("LMAI99943");return i}addItemAtLocation(t,i){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{void 0===i&&(i=_t.defaultLocationSelectors);const s=this.findFirstLocation(i);if(void 0===s)return;{let i,o=s.parentItem;switch(o.type){case p.ground:i=o.addItem(t,s.index),i>=0?o=this._groundItem.contentItems[0]:i=0;break;case p.row:case p.column:i=o.addItem(t,s.index);break;case p.stack:if(G.isComponent(t)){i=o.addItem(t,s.index);break}throw Error(F[6]);case p.component:throw new e("LMAIALC87444602");default:throw new n("LMAIALU98881733",o.type)}if(G.isComponent(t)){const t=o.contentItems[i];at.isStack(t)&&(o=t,i=0)}return s.parentItem=o,s.index=i,s}}}loadComponentAsRoot(t){if(void 0===this._groundItem)throw new Error("Cannot add item before init");this._groundItem.loadComponentAsRoot(t)}updateSize(t,e){this.setSize(t,e)}setSize(t,e){if(this._width=t,this._height=e,!0===this._isInitialised){if(void 0===this._groundItem)throw new o("LMUS18881");if(this._groundItem.setSize(this._width,this._height),this._maximisedStack){const{width:t,height:e}=L(this._containerElement);R(this._maximisedStack.element,t),M(this._maximisedStack.element,e),this._maximisedStack.updateSize(!1)}this.adjustColumnsResponsive()}}beginSizeInvalidation(){this._sizeInvalidationBeginCount++}endSizeInvalidation(){0===--this._sizeInvalidationBeginCount&&this.updateSizeFromContainer()}updateSizeFromContainer(){const{width:t,height:e}=L(this._containerElement);this.setSize(t,e)}updateRootSize(t=!1){if(void 0===this._groundItem)throw new o("LMURS28881");this._groundItem.updateSize(t)}createAndInitContentItem(t,e){const i=this.createContentItem(t,e);return i.init(),i}createContentItem(t,e){if("string"!=typeof t.type)throw new B("Missing parameter 'type'",JSON.stringify(t));return!f.isComponentItem(t)||e instanceof dt||!e||!0===this.isSubWindow&&e instanceof mt||(t={type:p.stack,content:[t],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:0,header:void 0}),this.createContentItemFromConfig(t,e)}findFirstComponentItemById(t){if(void 0===this._groundItem)throw new o("LMFFCIBI82446");return this.findFirstContentItemTypeByIdRecursive(p.component,t,this._groundItem)}createPopout(t,e,i,n){return t instanceof at?this.createPopoutFromContentItem(t,e,i,n):this.createPopoutFromItemConfig(t,e,i,n)}createPopoutFromContentItem(t,e,i,n){let o=t.parent,r=t;for(;null!==o&&1===o.contentItems.length&&!o.isGround;)r=o,o=o.parent;if(null===o)throw new s("LMCPFCI00834");{if(void 0===n&&(n=o.contentItems.indexOf(r)),null!==i&&o.addPopInParentId(i),void 0===e){const i=globalThis.screenX||globalThis.screenLeft,n=globalThis.screenY||globalThis.screenTop,s=t.element.offsetLeft,o=t.element.offsetTop,{width:r,height:a}=L(t.element);e={left:i+s,top:n+o,width:r,height:a}}const s=t.toConfig();if(t.remove(),y.isRootItemConfig(s))return this.createPopoutFromItemConfig(s,e,i,n);throw new Error(`${F[0]}`)}}beginVirtualSizedContainerAdding(){0===++this._virtualSizedContainerAddingBeginCount&&(this._virtualSizedContainers.length=0)}addVirtualSizedContainer(t){this._virtualSizedContainers.push(t)}endVirtualSizedContainerAdding(){if(0===--this._virtualSizedContainerAddingBeginCount){const t=this._virtualSizedContainers.length;if(t>0){this.fireBeforeVirtualRectingEvent(t);for(let e=0;e<t;e++)this._virtualSizedContainers[e].notifyVirtualRectingRequired();this.fireAfterVirtualRectingEvent(),this._virtualSizedContainers.length=0}}}fireBeforeVirtualRectingEvent(t){void 0!==this.beforeVirtualRectingEvent&&this.beforeVirtualRectingEvent(t)}fireAfterVirtualRectingEvent(){void 0!==this.afterVirtualRectingEvent&&this.afterVirtualRectingEvent()}createPopoutFromItemConfig(t,e,i,n){const s=this.toConfig(),o={root:t,openPopouts:[],settings:s.settings,dimensions:s.dimensions,header:s.header,window:e,parentId:i,indexInParent:n,resolved:!0};return this.createPopoutFromPopoutLayoutConfig(o)}createPopoutFromPopoutLayoutConfig(t){var e,i,n,s;const o=t.window,r={left:null!==(e=o.left)&&void 0!==e?e:globalThis.screenX||globalThis.screenLeft+20,top:null!==(i=o.top)&&void 0!==i?i:globalThis.screenY||globalThis.screenTop+20,width:null!==(n=o.width)&&void 0!==n?n:500,height:null!==(s=o.height)&&void 0!==s?s:309},a=new tt(t,r,this);return a.on("initialised",()=>this.emit("windowOpened",a)),a.on("closed",()=>this.reconcilePopoutWindows()),this._openPopouts.push(a),this.layoutConfig.settings.closePopoutsOnUnload&&!this._windowBeforeUnloadListening&&(globalThis.addEventListener("beforeunload",this._windowBeforeUnloadListener,{passive:!0}),this._windowBeforeUnloadListening=!0),a}closeAllOpenPopouts(){for(let t=0;t<this._openPopouts.length;t++)this._openPopouts[t].close();this._openPopouts.length=0,this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1)}newDragSource(t,e,i,n,s){const o=new gt(this,t,[],e,i,n,s);return this._dragSources.push(o),o}removeDragSource(t){!function(t,e){const i=e.indexOf(t);if(-1===i)throw new Error("Can't remove item from array. Item is not in the array");e.splice(i,1)}(t,this._dragSources),t.destroy()}startComponentDrag(t,e,i,n,s){new ct(t,e,i,this,n,s)}focusComponent(t,e=!1){t.focus(e)}clearComponentFocus(t=!1){this.setFocusedComponentItem(void 0,t)}setFocusedComponentItem(t,e=!1){if(t!==this._focusedComponentItem){let i;if(void 0===t||(i=t.parentItem),void 0!==this._focusedComponentItem){const t=this._focusedComponentItem;this._focusedComponentItem=void 0,t.setBlurred(e);const n=t.parentItem;i===n?i=void 0:n.setFocusedValue(!1)}void 0!==t&&(this._focusedComponentItem=t,t.setFocused(e),void 0!==i&&i.setFocusedValue(!0))}}createContentItemFromConfig(t,i){switch(t.type){case p.ground:throw new e("LMCCIFC68871");case p.row:return new pt(!1,this,t,i);case p.column:return new pt(!0,this,t,i);case p.stack:return new dt(this,t,i);case p.component:return new lt(this,t,i);default:throw new n("CCC913564",t.type,"Invalid Config Item type specified")}}setMaximisedStack(t){void 0===t?void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack():t!==this._maximisedStack&&(void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack(),this.processMaximiseStack(t))}checkMinimiseMaximisedStack(){void 0!==this._maximisedStack&&this._maximisedStack.minimise()}cleanupBeforeMaximisedStackDestroyed(t){null!==this._maximisedStack&&this._maximisedStack===t.target&&(this._maximisedStack.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),this._maximisedStack=void 0)}closeWindow(){globalThis.setTimeout(()=>globalThis.close(),1)}getArea(t,e){let i=null,n=1/0;for(let s=0;s<this._itemAreas.length;s++){const o=this._itemAreas[s];t>=o.x1&&t<o.x2&&e>=o.y1&&e<o.y2&&n>o.surface&&(n=o.surface,i=o)}return i}calculateItemAreas(){const t=this.getAllContentItems(),e=this._groundItem;if(void 0===e)throw new o("LMCIAR44365");if(1===t.length){const t=e.getElementArea();if(null===t)throw new s("LMCIARA44365");return void(this._itemAreas=[t])}e.contentItems[0].isStack?this._itemAreas=[]:this._itemAreas=e.createSideAreas();for(let e=0;e<t.length;e++){const i=t[e];if(at.isStack(i)){const t=i.getArea();if(null===t)continue;{this._itemAreas.push(t);const e=i.contentAreaDimensions;if(void 0===e)throw new o("LMCIASC45599");{const t=e.header.highlightArea,n=(t.x2-t.x1)*(t.y2-t.y1),s={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,contentItem:i,surface:n};this._itemAreas.push(s)}}}}}checkLoadedLayoutMaximiseItem(){if(void 0===this._groundItem)throw new o("LMCLLMI43432");{const t=this._groundItem.getConfigMaximisedItems();if(t.length>0){let i=t[0];if(at.isComponentItem(i)){const t=i.parent;if(null===t)throw new s("LMXLLMI69999");i=t}if(!at.isStack(i))throw new e("LMCLLMI19993");i.maximise()}}}processMaximiseStack(t){if(this._maximisedStack=t,t.on("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.element.classList.add("lm_maximised"),t.element.insertAdjacentElement("afterend",this._maximisePlaceholder),void 0===this._groundItem)throw new o("LMMXI19993");{this._groundItem.element.prepend(t.element);const{width:e,height:i}=L(this._containerElement);R(t.element,e),M(t.element,i),t.updateSize(!0),t.focusActiveContentItem(),this._maximisedStack.emit("maximised"),this.emit("stateChanged")}}processMinimiseMaximisedStack(){if(void 0===this._maximisedStack)throw new e("LMMMS74422");{const t=this._maximisedStack;if(null===t.parent)throw new s("LMMI13668");t.element.classList.remove("lm_maximised"),this._maximisePlaceholder.insertAdjacentElement("afterend",t.element),this._maximisePlaceholder.remove(),this.updateRootSize(!0),this._maximisedStack=void 0,t.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.emit("minimised"),this.emit("stateChanged")}}reconcilePopoutWindows(){const t=[];for(let e=0;e<this._openPopouts.length;e++)!1===this._openPopouts[e].getWindow().closed?t.push(this._openPopouts[e]):this.emit("windowClosed",this._openPopouts[e]);this._openPopouts.length!==t.length&&(this._openPopouts=t,this.emit("stateChanged"))}getAllContentItems(){if(void 0===this._groundItem)throw new o("LMGACI13130");return this._groundItem.getAllContentItems()}createSubWindows(){for(let t=0;t<this.layoutConfig.openPopouts.length;t++){const e=this.layoutConfig.openPopouts[t];this.createPopoutFromPopoutLayoutConfig(e)}}handleContainerResize(){this.resizeWithContainerAutomatically&&this.processResizeWithDebounce()}processResizeWithDebounce(){this.resizeDebounceExtendedWhenPossible&&this.checkClearResizeTimeout(),void 0===this._resizeTimeoutId&&(this._resizeTimeoutId=setTimeout(()=>{this._resizeTimeoutId=void 0,this.beginSizeInvalidation(),this.endSizeInvalidation()},this.resizeDebounceInterval))}checkClearResizeTimeout(){void 0!==this._resizeTimeoutId&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=void 0)}setContainer(){var t;const e=document.body,i=null!==(t=this._containerElement)&&void 0!==t?t:e;if(i===e){this.resizeWithContainerAutomatically=!0;const t=document.documentElement;t.style.height="100%",t.style.margin="0",t.style.padding="0",t.style.overflow="clip",e.style.height="100%",e.style.margin="0",e.style.padding="0",e.style.overflow="clip"}this._containerElement=i}onBeforeUnload(){this.destroy()}adjustColumnsResponsive(){if(void 0===this._groundItem)throw new o("LMACR20883");if(this._firstLoad=!1,this.useResponsiveLayout()&&!this._updatingColumnsResponsive&&this._groundItem.contentItems.length>0&&this._groundItem.contentItems[0].isRow){if(void 0===this._groundItem||null===this._width)throw new o("LMACR77412");{const t=this._groundItem.contentItems[0].contentItems.length;if(t<=1)return;{const i=this.layoutConfig.dimensions.defaultMinItemWidth;if(t*i<=this._width)return;{this._updatingColumnsResponsive=!0;const n=t-Math.max(Math.floor(this._width/i),1),s=this._groundItem.contentItems[0],o=this.getAllStacks();if(0===o.length)throw new e("LMACRS77413");{const t=o[0];for(let e=0;e<n;e++){const e=s.contentItems[s.contentItems.length-1];this.addChildContentItemsToContainer(t,e)}this._updatingColumnsResponsive=!1}}}}}}useResponsiveLayout(){const t=this.layoutConfig.settings,e=t.responsiveMode===m.always,i=t.responsiveMode===m.onload&&this._firstLoad;return e||i}addChildContentItemsToContainer(t,e){const i=e.contentItems;if(e instanceof dt)for(let n=0;n<i.length;n++){const s=i[n];e.removeChild(s,!0),t.addChild(s)}else for(let e=0;e<i.length;e++){const n=i[e];this.addChildContentItemsToContainer(t,n)}}getAllStacks(){if(void 0===this._groundItem)throw new o("LMFASC52778");{const t=[];return this.findAllStacksRecursive(t,this._groundItem),t}}findFirstContentItemType(t){if(void 0===this._groundItem)throw new o("LMFFCIT82446");return this.findFirstContentItemTypeRecursive(t,this._groundItem)}findFirstContentItemTypeRecursive(t,e){const i=e.contentItems,n=i.length;if(0!==n){for(let e=0;e<n;e++){const n=i[e];if(n.type===t)return n}for(let e=0;e<n;e++){const n=i[e],s=this.findFirstContentItemTypeRecursive(t,n);if(void 0!==s)return s}}}findFirstContentItemTypeByIdRecursive(t,e,i){const n=i.contentItems,s=n.length;if(0!==s){for(let i=0;i<s;i++){const s=n[i];if(s.type===t&&s.id===e)return s}for(let i=0;i<s;i++){const s=n[i],o=this.findFirstContentItemTypeByIdRecursive(t,e,s);if(void 0!==o)return o}}}findAllStacksRecursive(t,e){const i=e.contentItems;for(let e=0;e<i.length;e++){const n=i[e];n instanceof dt?t.push(n):n.isComponent||this.findAllStacksRecursive(t,n)}}findFirstLocation(t){const e=t.length;for(let i=0;i<e;i++){const e=t[i],n=this.findLocation(e);if(void 0!==n)return n}}findLocation(t){const e=t.index;switch(t.typeId){case 0:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem,i=t.contentItems,n=i.length;if(void 0===e)return{parentItem:t,index:n};{const s=i.indexOf(this._focusedComponentItem)+e;return s<0||s>n?void 0:{parentItem:t,index:s}}}case 1:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem;return this.tryCreateLocationFromParentItem(t,e)}case 2:{const t=this.findFirstContentItemType(p.stack);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 3:{let t=this.findFirstContentItemType(p.row);return void 0!==t?this.tryCreateLocationFromParentItem(t,e):(t=this.findFirstContentItemType(p.column),void 0!==t?this.tryCreateLocationFromParentItem(t,e):void 0)}case 4:{const t=this.findFirstContentItemType(p.row);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 5:{const t=this.findFirstContentItemType(p.column);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 6:if(void 0===this._groundItem)throw new o("LMFLRIF18244");return void 0!==this.rootItem?void 0:void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;case 7:if(void 0===this._groundItem)throw new o("LMFLF18244");{const t=this._groundItem.contentItems;if(0===t.length)return void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;{const i=t[0];return this.tryCreateLocationFromParentItem(i,e)}}}}tryCreateLocationFromParentItem(t,e){const i=t.contentItems.length;return void 0===e?{parentItem:t,index:i}:e<0||e>i?void 0:{parentItem:t,index:e}}}!function(t){t.createMaximisePlaceElement=function(t){const e=t.createElement("div");return e.classList.add("lm_maximise_place"),e},t.createTabDropPlaceholderElement=function(t){const e=t.createElement("div");return e.classList.add("lm_drop_tab_placeholder"),e},t.defaultLocationSelectors=[{typeId:1,index:void 0},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}],t.afterFocusedItemIfPossibleLocationSelectors=[{typeId:0,index:1},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}]}(_t||(_t={}));class wt extends _t{constructor(t,e,i,n){if(super(wt.createLayoutManagerConstructorParameters(t,e)),this._bindComponentEventHanlderPassedInConstructor=!1,this._creationTimeoutPassed=!1,void 0!==e&&"function"==typeof e&&(this.bindComponentEvent=e,this._bindComponentEventHanlderPassedInConstructor=!0,void 0!==i&&(this.unbindComponentEvent=i)),!this._bindComponentEventHanlderPassedInConstructor&&this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new o("VLC98823");{const t=K.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},t),{root:void 0})}}!0!==n&&(this.deprecatedConstructor||this.init())}destroy(){this.bindComponentEvent=void 0,this.unbindComponentEvent=void 0,super.destroy()}init(){if(this._bindComponentEventHanlderPassedInConstructor||"loading"!==document.readyState&&null!==document.body){if(!this._bindComponentEventHanlderPassedInConstructor&&!0===this.isSubWindow&&!this._creationTimeoutPassed)return setTimeout(()=>this.init(),7),void(this._creationTimeoutPassed=!0);!0===this.isSubWindow&&(this._bindComponentEventHanlderPassedInConstructor||this.clearHtmlAndAdjustStylesForSubWindow(),window.__glInstance=this),super.init()}else document.addEventListener("DOMContentLoaded",()=>this.init(),{passive:!0})}clearHtmlAndAdjustStylesForSubWindow(){const t=document.head,e=new Array(4);e[0]=document.querySelectorAll("body link"),e[1]=document.querySelectorAll("body style"),e[2]=document.querySelectorAll("template"),e[3]=document.querySelectorAll(".gl_keep");for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++){const i=n[e];t.appendChild(i)}}const i=document.body;i.innerHTML="",i.style.visibility="visible",this.checkAddDefaultPopinButton(),document.body.offsetHeight}checkAddDefaultPopinButton(){if(this.layoutConfig.settings.popInOnClose)return!1;{const t=document.createElement("div");t.classList.add("lm_popin"),t.setAttribute("title",this.layoutConfig.header.dock);const e=document.createElement("div");e.classList.add("lm_icon");const i=document.createElement("div");return i.classList.add("lm_bg"),t.appendChild(e),t.appendChild(i),t.addEventListener("click",()=>this.emit("popIn")),document.body.appendChild(t),!0}}bindComponent(t,e){if(void 0!==this.bindComponentEvent)return this.bindComponentEvent(t,e);if(void 0!==this.getComponentEvent)return{virtual:!1,component:this.getComponentEvent(t,e)};{const t=`${F[2]}: ${JSON.stringify(e)}`;throw new V(t)}}unbindComponent(t,e,i){if(void 0!==this.unbindComponentEvent)this.unbindComponentEvent(t);else if(!e&&void 0!==this.releaseComponentEvent){if(void 0===i)throw new o("VCUCRCU333998");this.releaseComponentEvent(t,i)}}}!function(t){let e=!1;t.createLayoutManagerConstructorParameters=function(t,i){const n=e?null:new URL(document.location.href).searchParams.get("gl-window");e=!0;const s=null!==n;let o,r;if(null!==n){const e=localStorage.getItem(n);if(null===e)throw new Error("Null gl-window Config");localStorage.removeItem(n);const i=JSON.parse(e),s=x.unminifyConfig(i);r=K.fromResolved(s),t instanceof HTMLElement&&(o=t)}else void 0===t?r=void 0:t instanceof HTMLElement?(r=void 0,o=t):r=t,void 0===o&&i instanceof HTMLElement&&(o=i);return{constructorOrSubWindowLayoutConfig:r,isSubWindow:s,containerElement:o}}}(wt||(wt={}));class yt extends wt{constructor(t,e,i){super(t,e,i,!0),this._componentTypesMap=new Map,this._registeredComponentMap=new Map,this._virtuableComponentMap=new Map,this._containerVirtualRectingRequiredEventListener=(t,e,i)=>this.handleContainerVirtualRectingRequiredEvent(t,e,i),this._containerVirtualVisibilityChangeRequiredEventListener=(t,e)=>this.handleContainerVirtualVisibilityChangeRequiredEvent(t,e),this._containerVirtualZIndexChangeRequiredEventListener=(t,e,i)=>this.handleContainerVirtualZIndexChangeRequiredEvent(t,e,i),this.deprecatedConstructor||this.init()}registerComponent(t,e,i=!1){if("function"!=typeof e)throw new N("registerComponent() componentConstructorOrFactoryFtn parameter is not a function");if(e.hasOwnProperty("prototype")){const n=e;this.registerComponentConstructor(t,n,i)}else{const n=e;this.registerComponentFactoryFunction(t,n,i)}}registerComponentConstructor(t,e,i=!1){if("function"!=typeof e)throw new Error(F[1]);if(void 0!==this._componentTypesMap.get(t))throw new V(`${F[3]}: ${t}`);this._componentTypesMap.set(t,{constructor:e,factoryFunction:void 0,virtual:i})}registerComponentFactoryFunction(t,e,i=!1){if("function"!=typeof e)throw new V("Please register a constructor function");if(void 0!==this._componentTypesMap.get(t))throw new V(`${F[3]}: ${t}`);this._componentTypesMap.set(t,{constructor:void 0,factoryFunction:e,virtual:i})}registerComponentFunction(t){this.registerGetComponentConstructorCallback(t)}registerGetComponentConstructorCallback(t){if("function"!=typeof t)throw new Error("Please register a callback function");void 0!==this._getComponentConstructorFtn&&console.warn("Multiple component functions are being registered.  Only the final registered function will be used."),this._getComponentConstructorFtn=t}getRegisteredComponentTypeNames(){const t=this._componentTypesMap.keys();return Array.from(t)}getComponentInstantiator(t){let e;const i=_.resolveComponentTypeName(t);return void 0!==i&&(e=this._componentTypesMap.get(i)),void 0===e&&void 0!==this._getComponentConstructorFtn&&(e={constructor:this._getComponentConstructorFtn(t),factoryFunction:void 0,virtual:!1}),e}bindComponent(t,i){let n;const s=_.resolveComponentTypeName(i);let r;if(void 0!==s&&(n=this._componentTypesMap.get(s)),void 0===n&&void 0!==this._getComponentConstructorFtn&&(n={constructor:this._getComponentConstructorFtn(i),factoryFunction:void 0,virtual:!1}),void 0!==n){const a=n.virtual;let l,h;l=void 0===i.componentState?void 0:D({},i.componentState);const d=n.constructor;if(void 0!==d)h=new d(t,l,a);else{const i=n.factoryFunction;if(void 0===i)throw new e("LMBCFFU10008");h=i(t,l,a)}if(a){if(void 0===h)throw new o("GLBCVCU988774");{const e=h,i=e.rootHtmlElement;if(void 0===i)throw new V(`${F[5]}: ${s}`);!function(t){const e="absolute";t.style.position!==e&&(t.style.position=e)}(i),this.container.appendChild(i),this._virtuableComponentMap.set(t,e),t.virtualRectingRequiredEvent=this._containerVirtualRectingRequiredEventListener,t.virtualVisibilityChangeRequiredEvent=this._containerVirtualVisibilityChangeRequiredEventListener,t.virtualZIndexChangeRequiredEvent=this._containerVirtualZIndexChangeRequiredEventListener}}this._registeredComponentMap.set(t,h),r={virtual:n.virtual,component:h}}else r=super.bindComponent(t,i);return r}unbindComponent(t,i,n){if(void 0===this._registeredComponentMap.get(t))super.unbindComponent(t,i,n);else{const i=this._virtuableComponentMap.get(t);if(void 0!==i){const n=i.rootHtmlElement;if(void 0===n)throw new e("GLUC77743",t.title);this.container.removeChild(n),this._virtuableComponentMap.delete(t)}}}fireBeforeVirtualRectingEvent(t){this._goldenLayoutBoundingClientRect=this.container.getBoundingClientRect(),super.fireBeforeVirtualRectingEvent(t)}handleContainerVirtualRectingRequiredEvent(t,e,i){const n=this._virtuableComponentMap.get(t);if(void 0===n)throw new o("GLHCSCE55933");{const s=n.rootHtmlElement;if(void 0===s)throw new V(F[4]+" "+t.title);{const n=t.element.getBoundingClientRect(),o=n.left-this._goldenLayoutBoundingClientRect.left;s.style.left=P(o);const r=n.top-this._goldenLayoutBoundingClientRect.top;s.style.top=P(r),R(s,e),M(s,i)}}}handleContainerVirtualVisibilityChangeRequiredEvent(t,e){const i=this._virtuableComponentMap.get(t);if(void 0===i)throw new o("GLHCVVCRE55934");{const n=i.rootHtmlElement;if(void 0===n)throw new V(F[4]+" "+t.title);T(n,e)}}handleContainerVirtualZIndexChangeRequiredEvent(t,e,i){const n=this._virtuableComponentMap.get(t);if(void 0===n)throw new o("GLHCVZICRE55935");{const e=n.rootHtmlElement;if(void 0===e)throw new V(F[4]+" "+t.title);e.style.zIndex=i}}}const Ct={silent:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,TRACE:5};let xt="INFO",Et="console",St="",Pt="";const kt=[];function It(t){xt=Tt(t)}function Rt(t){["console","server","both"].includes(t)&&(Et=t)}function Mt(t){St=t||""}function Lt(t){Pt=t||""}function Tt(t){if(!t)return"INFO";const e=String(t).toUpperCase();return"OFF"===e||"SILENT"===e?"silent":e in Ct||Ct.hasOwnProperty(e)?e:"INFO"}function At(t){const e=Tt(t);return Ct[e]??99}function Dt(t){if(t instanceof Error)return`[Error: ${t.message}]${t.stack?"\n"+t.stack:""}`;try{const e=new WeakSet;return JSON.stringify(t,function(t,i){if("object"==typeof i&&null!==i){if(e.has(i))return"[Cyclic]";e.add(i)}return i})}catch(e){return"object"==typeof t&&null!==t?"[Unserializable Object: "+(t.constructor?.name||"Object")+"]":String(t)}}function zt(t){try{if("undefined"!=typeof Element&&t instanceof Element)return`<${t.tagName.toLowerCase()} id="${t.id}" class="${t.className}">`;if(t&&t.constructor&&t.constructor.name&&/Container|Layout|Panel|Manager/.test(t.constructor.name))return`[${t.constructor.name}]`;if(t&&t._id&&t._type)return`{type:"${t._type}", id:"${t._id}"}`;if("object"==typeof t&&null!==t){const e={};for(const i in t)"object"!=typeof t[i]&&"function"!=typeof t[i]&&(e[i]=t[i]);if(Object.keys(e).length>0)return e}return t}catch(e){return`[Unserializable: ${t&&t.constructor&&t.constructor.name}]`}}function Ot(t,...e){if(!(At(t)>At(xt))){if("console"===Et||"both"===Et){const i=String(t).toUpperCase(),n=e.map(zt);"undefined"!=typeof console&&("ERROR"===i&&console.error?console.error("[log]",t,...n):"WARN"===i&&console.warn?console.warn("[log]",t,...n):"INFO"===i&&console.info?console.info("[log]",t,...n):"DEBUG"===i&&console.debug||"TRACE"===i&&console.debug?console.debug("[log]",t,...n):console.log&&console.log("[log]",t,...n))}"server"!==Et&&"both"!==Et||!St||async function(t,...e){if(St)try{const i={level:t,message:e.map(Dt).join(" "),timestamp:(new Date).toISOString(),page:"object"==typeof location&&location.pathname,userAgent:"object"==typeof navigator&&navigator.userAgent,token:Pt};await fetch(St,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(i){"undefined"!=typeof console&&console.error&&console.error("[log]",t,"Failed to stream log",...e,i)}}(t,...e);for(const i of kt)try{"function"==typeof i?i(t,...e):i&&"function"==typeof i.sinkLog&&i.sinkLog(t,...e)}catch(t){"undefined"!=typeof console&&console.warn&&console.warn("[log]","Log sink error",t)}}}"undefined"!=typeof window&&(window.log=Ot,window.setLogLevel=It,window.setLogDestination=Rt,window.setLogServerURL=Mt,window.setLogServerToken=Lt,window.LOG_LEVELS=Ct);const Bt={imageObj:null,imageURL:null,sceneName:"",sceneLogic:"AND",shapes:[],selectedShape:null,selectedShapes:[],transformer:null,konvaStage:null,konvaLayer:null,konvaDiv:null,multiDrag:{moving:!1,dragOrigin:null,origPositions:null},settings:{},settingsRegistry:[],logLevel:"ERROR",logDest:"console",_subscribers:[]};function Ht(t={}){Ot("TRACE","[state] notifySubscribers entry",t);for(const e of Bt._subscribers)try{e(Bt,t)}catch(t){Ot("ERROR","[state] Subscriber error",t)}Ot("TRACE","[state] notifySubscribers exit")}function Nt(t){Ot("TRACE","[state] setSelectedShapes() entry",t),Bt.selectedShapes=Array.isArray(t)?t:[],Bt.selectedShape=1===Bt.selectedShapes.length?Bt.selectedShapes[0]:null,Ht({type:"selection",selectedShapes:Bt.selectedShapes}),Ot("DEBUG","[state] setSelectedShapes: selection updated",Bt.selectedShapes),Ot("TRACE","[state] setSelectedShapes() exit")}function Vt(t,e=null){Ot("TRACE","[state] setImage() entry",{url:t,imgObj:e}),Bt.imageURL=t||null,Bt.imageObj=e||null,Ht({type:"image",imageURL:Bt.imageURL,imageObj:Bt.imageObj}),Ot("DEBUG","[state] setImage: image updated",{url:Bt.imageURL,imgObj:!!Bt.imageObj}),Ot("TRACE","[state] setImage() exit")}function Ft(t){Ot("TRACE","[state] setSettings() entry",t),Bt.settings={...Bt.settings,...t},Ht({type:"settings",settings:Bt.settings}),Ot("DEBUG","[state] setSettings: settings updated",Bt.settings),Ot("TRACE","[state] setSettings() exit")}function Gt(t,e){Ot("TRACE","[state] setSetting() entry",{key:t,value:e}),Bt.settings[t]=e,Ht({type:"setting",key:t,value:e}),Ot("DEBUG","[state] setSetting: setting updated",{key:t,value:e}),Ot("TRACE","[state] setSetting() exit")}function Wt(t){Ot("TRACE","[state] getSetting() entry",{key:t});const e=Bt.settings[t];return Ot("TRACE","[state] getSetting() exit",{value:e}),e}Ot("INFO","[state] state.js module loaded and ready."),"undefined"!=typeof window&&(window.AppState=Bt,window.setShapes=function(t){Ot("TRACE","[state] setShapes() entry",t),Bt.shapes=Array.isArray(t)?t:[],Ht({type:"shapes",shapes:Bt.shapes}),Ot("DEBUG","[state] setShapes: shapes updated",Bt.shapes),Ot("TRACE","[state] setShapes() exit")},window.setSelectedShapes=Nt,window.addShape=function(t){Ot("TRACE","[state] addShape() entry",t),t?(Bt.shapes.push(t),Ht({type:"addShape",shape:t}),Ot("DEBUG","[state] addShape: shape added",t),Ot("TRACE","[state] addShape() exit")):Ot("TRACE","[state] addShape() exit (no shape)")},window.removeShape=function(t){Ot("TRACE","[state] removeShape() entry",t),t?(Bt.shapes=Bt.shapes.filter(e=>e!==t),Ht({type:"removeShape",shape:t}),Ot("DEBUG","[state] removeShape: shape removed",t),Ot("TRACE","[state] removeShape() exit")):Ot("TRACE","[state] removeShape() exit (no shape)")},window.setSceneName=function(t){Ot("TRACE","[state] setSceneName() entry",t),Bt.sceneName=t||"",Ht({type:"sceneName",sceneName:Bt.sceneName}),Ot("DEBUG","[state] setSceneName: sceneName updated",Bt.sceneName),Ot("TRACE","[state] setSceneName() exit")},window.setSceneLogic=function(t){Ot("TRACE","[state] setSceneLogic() entry",t),Bt.sceneLogic=["AND","OR"].includes(t)?t:"AND",Ht({type:"sceneLogic",sceneLogic:Bt.sceneLogic}),Ot("DEBUG","[state] setSceneLogic: sceneLogic updated",Bt.sceneLogic),Ot("TRACE","[state] setSceneLogic() exit")},window.setImage=Vt,window.setSettings=Ft,window.setSetting=Gt,window.getSetting=Wt,window.subscribeAppState=function(t){return Ot("TRACE","[state] subscribe() entry",t),"function"!=typeof t?(Ot("TRACE","[state] subscribe() exit (not a function)"),()=>{}):(Bt._subscribers.push(t),Ot("TRACE","[state] subscribe() exit (subscribed)"),()=>{const e=Bt._subscribers.indexOf(t);-1!==e&&Bt._subscribers.splice(e,1),Ot("TRACE","[state] unsubscribe() called",t)})});class jt{constructor(t){this.table=t}reloadData(t,e,i){return this.table.dataLoader.load(t,void 0,void 0,void 0,e,i)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(t){return this.table.modules.layout.layout(t)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(t){return this.table.eventBus.subscribed(t)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(t){return this.table.externalEvents.subscribed(t)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(t){return this.table.options[t]}setOption(t,e){return void 0!==e&&(this.table.options[t]=e),this.table.options[t]}deprecationCheck(t,e,i){return this.table.deprecationAdvisor.check(t,e,i)}deprecationCheckMsg(t,e){return this.table.deprecationAdvisor.checkMsg(t,e)}deprecationMsg(t){return this.table.deprecationAdvisor.msg(t)}module(t){return this.table.module(t)}}class Ut{static elVisible(t){return!(t.offsetWidth<=0&&t.offsetHeight<=0)}static elOffset(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(t,e,i){var n,s=t?e.split(t):[e],o=s.length;for(let t=0;t<o&&(n=i=i[s[t]],i);t++);return n}static deepClone(t,e,i=[]){var n={}.__proto__,s=[].__proto__;for(var o in e||(e=Object.assign(Array.isArray(t)?[]:{},t)),t){let r,a,l=t[o];null==l||"object"!=typeof l||l.__proto__!==n&&l.__proto__!==s||(r=i.findIndex(t=>t.subject===l),r>-1?e[o]=i[r].copy:(a=Object.assign(Array.isArray(l)?[]:{},l),i.unshift({subject:l,copy:a}),e[o]=this.deepClone(l,a,i)))}return e}}let qt=class t extends jt{constructor(t,e,i){super(t),this.element=e,this.container=this._lookupContainer(),this.parent=i,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var t=this.table.options.popupContainer;return"string"==typeof t?(t=document.querySelector(t))||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)"):!0===t&&(t=this.table.element),t&&!this._checkContainerIsParent(t)&&(t=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),t||(t=document.body),t}_checkContainerIsParent(t,e=this.table.element){return t===e||!!e.parentNode&&this._checkContainerIsParent(t,e.parentNode)}renderCallback(t){this.renderedCallback=t}containerEventCoords(t){var e=!(t instanceof MouseEvent),i=e?t.touches[0].pageX:t.pageX,n=e?t.touches[0].pageY:t.pageY;if(this.container!==document.body){let t=Ut.elOffset(this.container);i-=t.left,n-=t.top}return{x:i,y:n}}elementPositionCoords(t,e="right"){var i,n,s,o=Ut.elOffset(t);switch(this.container!==document.body&&(i=Ut.elOffset(this.container),o.left-=i.left,o.top-=i.top),e){case"right":n=o.left+t.offsetWidth,s=o.top-1;break;case"bottom":n=o.left,s=o.top+t.offsetHeight;break;case"left":n=o.left,s=o.top-1;break;case"top":n=o.left,s=o.top;break;case"center":n=o.left+t.offsetWidth/2,s=o.top+t.offsetHeight/2}return{x:n,y:s,offset:o}}show(t,e){var i,n,s,o,r;return this.destroyed||this.table.destroyed||(t instanceof HTMLElement?(s=t,o=(r=this.elementPositionCoords(t,e)).offset,i=r.x,n=r.y):"number"==typeof t?(o={top:0,left:0},i=t,n=e):(i=(r=this.containerEventCoords(t)).x,n=r.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=i+"px",this.container.appendChild(this.element),"function"==typeof this.renderedCallback&&this.renderedCallback(),this._fitToScreen(i,n,s,o,e),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",t=>{t.stopPropagation()})),this}_fitToScreen(t,e,i,n,s){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(t+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",this.element.style.right=i?this.container.offsetWidth-n.left+"px":this.container.offsetWidth-t+"px",this.reversedX=!0);let r=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);e+this.element.offsetHeight>r&&(i?this.element.style.top="bottom"===s?parseInt(this.element.style.top)-this.element.offsetHeight-i.offsetHeight-1+"px":parseInt(this.element.style.top)-this.element.offsetHeight+i.offsetHeight+1+"px":this.element.style.height=r+"px")}isVisible(){return this.visible}hideOnBlur(t){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=t),this}_escapeCheck(t){27==t.keyCode&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(t=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!t&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new t(this.table,e,this),this.childPopup}};class $t extends jt{constructor(t,e){super(t),this._handler=null}initialize(){}registerTableOption(t,e){this.table.optionsList.register(t,e)}registerColumnOption(t,e){this.table.columnManager.optionsList.register(t,e)}registerTableFunction(t,e){void 0===this.table[t]?this.table[t]=(...i)=>(this.table.initGuard(t),e(...i)):console.warn("Unable to bind table function, name already in use",t)}registerComponentFunction(t,e,i){return this.table.componentFunctionBinder.bind(t,e,i)}registerDataHandler(t,e){this.table.rowManager.registerDataPipelineHandler(t,e),this._handler=t}registerDisplayHandler(t,e){this.table.rowManager.registerDisplayPipelineHandler(t,e),this._handler=t}displayRows(t){var e,i=this.table.rowManager.displayRows.length-1;if(this._handler&&(e=this.table.rowManager.displayPipeline.findIndex(t=>t.handler===this._handler))>-1&&(i=e),t&&(i+=t),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(t,e){e||(e=this._handler),e&&this.table.rowManager.refreshActiveData(e,!1,t)}footerAppend(t){return this.table.footerManager.append(t)}footerPrepend(t){return this.table.footerManager.prepend(t)}footerRemove(t){return this.table.footerManager.remove(t)}popup(t,e){return new qt(this.table,t,e)}alert(t,e){return this.table.alertManager.alert(t,e)}clearAlert(){return this.table.alertManager.clear()}}class Kt{constructor(t){return this._cell=t,new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._cell.table.componentFunctionBinder.handle("cell",t._cell,e)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(t){return this._cell.row.getData(t)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(t,e){void 0===e&&(e=!0),this._cell.setValue(t,e)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Xt extends jt{constructor(t,e){super(t.table),this.table=t.table,this.column=t,this.row=e,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var t=this.element,e=this.column.getField();t.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(t.style.display="inline-flex",t.style.alignItems={top:"flex-start",bottom:"flex-end",middle:"center"}[this.column.vertAlign]||"",this.column.hozAlign&&(t.style.justifyContent={left:"flex-start",right:"flex-end",center:"center"}[this.column.hozAlign]||"")),e&&t.setAttribute("tabulator-field",e),this.column.definition.cssClass&&this.column.definition.cssClass.split(" ").forEach(e=>{t.classList.add(e)}),this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var t;switch(typeof(t=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value))){case"object":if(t instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(t)}else this.element.innerHTML="",null!=t&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",t);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=t}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(t){return this.loaded||(this.loaded=!0,t||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(t,e,i){this.setValueProcessData(t,e,i)&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(t,e,i){var n=!1;return(this.value!==t||i)&&(n=!0,e&&(t=this.chain("cell-value-changing",[this,t],null,t))),this.setValueActual(t),n&&this.dispatch("cell-value-changed",this),n}setValueActual(t){this.oldValue=this.value,this.value=t,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,t),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new Kt(this)),this.component}}class Yt{constructor(t){return this._column=t,this.type="ColumnComponent",new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._column.table.componentFunctionBinder.handle("column",t._column,e)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var t=[];return this._column.cells.forEach(function(e){t.push(e.getComponent())}),t}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(t){t.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(t){t.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var t=[];return this._column.columns.length&&this._column.columns.forEach(function(e){t.push(e.getComponent())}),t}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(t,e){return this._column.table.columnManager.scrollToColumn(this._column,t,e)}getTable(){return this._column.table}move(t,e){var i=this._column.table.columnManager.findColumn(t);i?this._column.table.columnManager.moveColumn(this._column,i,e):console.warn("Move Error - No matching column found:",i)}getNextColumn(){var t=this._column.nextColumn();return!!t&&t.getComponent()}getPrevColumn(){var t=this._column.prevColumn();return!!t&&t.getComponent()}updateDefinition(t){return this._column.updateDefinition(t)}getWidth(){return this._column.getWidth()}setWidth(t){var e;return e=!0===t?this._column.reinitializeWidth(!0):this._column.setWidth(t),this._column.table.columnManager.rerenderColumns(!0),e}}var Zt={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Jt extends jt{static defaultOptionList=Zt;constructor(t,e,i){super(e.table),this.definition=t,this.parent=e,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=i,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((t,e)=>{var i=new Jt(t,this);this.attachColumn(i)}),this.checkColumnVisibility()):e.registerColumnField(this),this._initialize()}createElement(){var t=document.createElement("div");switch(t.classList.add("tabulator-col"),t.setAttribute("role","columnheader"),t.setAttribute("aria-sort","none"),this.isRowHeader&&t.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":t.style.justifyContent="center";break;case"bottom":t.style.justifyContent="flex-end"}return t}createGroupElement(){var t=document.createElement("div");return t.classList.add("tabulator-col-group-cols"),t}mapDefinitions(){var t=this.table.options.columnDefaults;if(t)for(let e in t)void 0===this.definition[e]&&(this.definition[e]=t[e]);this.definition=this.table.columnManager.optionsList.generate(Jt.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(t=>{-1===Jt.defaultOptionList.indexOf(t)&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",t)})}setField(t){this.field=t,this.fieldStructure=t?this.table.options.nestedFieldSeparator?t.split(this.table.options.nestedFieldSeparator):[t]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(t){this.parent.registerColumnPosition(t)}registerColumnField(t){this.parent.registerColumnField(t)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(t){t.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var t=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);t.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),"flip"===t.headerVertical&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var t=this.definition;this.dispatch("column-layout",this),void 0!==t.visible&&(t.visible?this.show(!0):this.hide(!0)),t.cssClass&&t.cssClass.split(" ").forEach(t=>{this.element.classList.add(t)}),t.field&&this.element.setAttribute("tabulator-field",t.field),this.setMinWidth(parseInt(t.minWidth)),t.maxInitialWidth&&(this.maxInitialWidth=parseInt(t.maxInitialWidth)),t.maxWidth&&this.setMaxWidth(parseInt(t.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var t=document.createElement("div");return t.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),t.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),t}_buildColumnHeaderTitle(){var t=this.definition,e=document.createElement("div");if(e.classList.add("tabulator-col-title"),t.headerWordWrap&&e.classList.add("tabulator-col-title-wrap"),t.editableTitle){var i=document.createElement("input");i.classList.add("tabulator-title-editor"),i.addEventListener("click",t=>{t.stopPropagation(),i.focus()}),i.addEventListener("mousedown",t=>{t.stopPropagation()}),i.addEventListener("change",()=>{t.title=i.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),e.appendChild(i),t.field?this.langBind("columns|"+t.field,e=>{i.value=e||t.title||"&nbsp;"}):i.value=t.title||"&nbsp;"}else t.field?this.langBind("columns|"+t.field,i=>{this._formatColumnHeaderTitle(e,i||t.title||"&nbsp;")}):this._formatColumnHeaderTitle(e,t.title||"&nbsp;");return e}_formatColumnHeaderTitle(t,e){var i=this.chain("column-format",[this,e,t],null,()=>e);switch(typeof i){case"object":i instanceof Node?t.appendChild(i):(t.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",i));break;case"undefined":t.innerHTML="";break;default:t.innerHTML=i}}_buildGroupHeader(){this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass&&this.definition.cssClass.split(" ").forEach(t=>{this.element.classList.add(t)}),this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(t){return t[this.field]}_getNestedData(t){var e,i=t,n=this.fieldStructure,s=n.length;for(let t=0;t<s&&(e=i=i[n[t]],i);t++);return e}_setFlatData(t,e){this.field&&(t[this.field]=e)}_setNestedData(t,e){var i=t,n=this.fieldStructure,s=n.length;for(let t=0;t<s;t++)if(t==s-1)i[n[t]]=e;else{if(!i[n[t]]){if(void 0===e)break;i[n[t]]={}}i=i[n[t]]}}attachColumn(t){this.groupElement?(this.columns.push(t),this.groupElement.appendChild(t.getElement()),t.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(t,e){var i=this.parent.isGroup?this.parent.getGroupElement().clientHeight:e||this.parent.getHeadersElement().clientHeight;this.element.style.height=i+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=i-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(e){e.verticalAlign(t)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(t){t.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this}getLastColumn(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this}getColumns(t){var e=[];return t?this.columns.forEach(t=>{e.push(t),e=e.concat(t.getColumns(!0))}):e=this.columns,e}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(t){var e=[];return this.isGroup&&t&&(this.columns.forEach(function(t){e.push(t.getDefinition(!0))}),this.definition.columns=e),this.definition}checkColumnVisibility(){var t=!1;this.columns.forEach(function(e){e.visible&&(t=!0)}),t?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(t,e){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.show()}),this.isGroup||null!==this.width||this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,e),t||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(t,e){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.hide()}),this.dispatch("column-hide",this,e),t||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var t=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(e){e.visible&&(t+=e.getWidth())}),this.contentElement.style.maxWidth=t-1+"px",this.table.initialized&&(this.element.style.width=t+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(t){var e=this.columns.indexOf(t);e>-1&&this.columns.splice(e,1),this.columns.length||this.delete()}setWidth(t){this.widthFixed=!0,this.setWidthActual(t)}setWidthActual(t){isNaN(t)&&(t=Math.floor(this.table.element.clientWidth/100*parseInt(t))),t=Math.max(this.minWidth,t),this.maxWidth&&(t=Math.min(this.maxWidth,t)),this.width=t,this.widthStyled=t?t+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(t){t.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var t=[];this.cells.forEach(function(e){e.row.heightInitialized&&(null!==e.row.getElement().offsetParent?(t.push(e.row),e.row.clearCellHeight()):e.row.heightInitialized=!1)}),t.forEach(function(t){t.calcHeight()}),t.forEach(function(t){t.setCellHeight()})}getWidth(){var t=0;return this.isGroup?this.columns.forEach(function(e){e.visible&&(t+=e.getWidth())}):t=this.width,t}getLeftOffset(){var t=this.element.offsetLeft;return this.parent.isGroup&&(t+=this.parent.getLeftOffset()),t}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(t){this.maxWidth&&t>this.maxWidth&&(t=this.maxWidth,console.warn("the minWidth ("+t+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=t,this.minWidthStyled=t?t+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(t){t.setMinWidth()})}setMaxWidth(t){this.minWidth&&t<this.minWidth&&(t=this.minWidth,console.warn("the maxWidth ("+t+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=t,this.maxWidthStyled=t?t+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(t){t.setMaxWidth()})}delete(){return new Promise((t,e)=>{this.isGroup&&this.columns.forEach(function(t){t.delete()}),this.dispatch("column-delete",this);var i=this.cells.length;for(let t=0;t<i;t++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),t()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(t){var e=new Xt(this,t);return this.cells.push(e),e}nextColumn(){var t=this.table.columnManager.findColumnIndex(this);return t>-1&&this._nextVisibleColumn(t+1)}_nextVisibleColumn(t){var e=this.table.columnManager.getColumnByIndex(t);return!e||e.visible?e:this._nextVisibleColumn(t+1)}prevColumn(){var t=this.table.columnManager.findColumnIndex(this);return t>-1&&this._prevVisibleColumn(t-1)}_prevVisibleColumn(t){var e=this.table.columnManager.getColumnByIndex(t);return!e||e.visible?e:this._prevVisibleColumn(t-1)}reinitializeWidth(t){this.widthFixed=!1,void 0===this.definition.width||t||this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(t),this.dispatch("column-width-fit-after",this)}fitToData(t){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(t=>{t.clearWidth()}));var e=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(t=>{var i=t.getWidth();i>e&&(e=i)}),e)){var i=e+1;t?this.setWidth(i):(this.maxInitialWidth&&!t&&(i=Math.min(i,this.maxInitialWidth)),this.setWidthActual(i))}}}updateDefinition(t){var e;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(e=Object.assign({},this.getDefinition()),e=Object.assign(e,t),this.table.columnManager.addColumn(e,!1,this).then(t=>(e.field==this.field&&(this.field=!1),this.delete().then(()=>t.getComponent()))))}deleteCell(t){var e=this.cells.indexOf(t);e>-1&&this.cells.splice(e,1)}getComponent(){return this.component||(this.component=new Yt(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Jt&&this.parent.getComponent()}}class Qt{constructor(t){return this._row=t,new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._row.table.componentFunctionBinder.handle("row",t._row,e)}})}getData(t){return this._row.getData(t)}getElement(){return this._row.getElement()}getCells(){var t=[];return this._row.getCells().forEach(function(e){t.push(e.getComponent())}),t}getCell(t){var e=this._row.getCell(t);return!!e&&e.getComponent()}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(t){return this._row.watchPosition(t)}delete(){return this._row.delete()}scrollTo(t,e){return this._row.table.rowManager.scrollToRow(this._row,t,e)}move(t,e){this._row.moveToRow(t,e)}update(t){return this._row.updateData(t)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var t=this._row.nextRow();return t?t.getComponent():t}getPrevRow(){var t=this._row.prevRow();return t?t.getComponent():t}}class te extends jt{constructor(t,e,i="row"){super(e.table),this.parent=e,this.data={},this.type=i,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(t)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var t=document.createElement("div");t.classList.add("tabulator-row"),t.setAttribute("role","row"),this.element=t}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(t,e){if(this.create(),!this.initialized||t){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,e),t&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,e)}rendered(){this.cells.forEach(t=>{t.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&null!==this.element.offsetParent&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(t){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&null!==this.element.offsetParent&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(t){var e=0,i=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(i=this.calcMinHeight(),e=this.calcMaxHeight(),this.height=t?Math.max(e,i):this.manualHeight?this.height:Math.max(e,i)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var t=0;return this.cells.forEach(function(e){var i=e.getHeight();i>t&&(t=i)}),t}setCellHeight(){this.cells.forEach(function(t){t.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(t){t.clearHeight()})}normalizeHeight(t){t&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(t),this.setCellHeight()}setHeight(t,e){(this.height!=t||e)&&(this.manualHeight=!0,this.height=t,this.heightStyled=t?t+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(t){var e=this.cells.indexOf(t);e>-1&&this.cells.splice(e,1)}setData(t){this.data=this.chain("row-data-init-before",[this,t],void 0,t),this.dispatch("row-data-init-after",this)}updateData(t){var e,i=this.element&&Ut.elVisible(this.element),n={};return new Promise((s,o)=>{"string"==typeof t&&(t=JSON.parse(t)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,t)),e=this.chain("row-data-changing",[this,n,t],null,t);for(let t in e)this.data[t]=e[t];this.dispatch("row-data-save-after",this);for(let n in t)this.table.columnManager.getColumnsByFieldRoot(n).forEach(t=>{let n=this.getCell(t.getField());if(n){let s=t.getFieldValue(e);n.getValue()!==s&&(n.setValueProcessData(s),i&&n.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,t),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),s()})}getData(t){return t?this.chain("row-data-retrieve",[this,t],null,this.data):this.data}getCell(t){return t=this.table.columnManager.findColumn(t),this.initialized||0!==this.cells.length||this.generateCells(),this.cells.find(function(e){return e.column===t})}getCellIndex(t){return this.cells.findIndex(function(e){return e===t})}findCell(t){return this.cells.find(e=>e.element===t)}getCells(){return this.initialized||0!==this.cells.length||this.generateCells(),this.cells}nextRow(){return this.table.rowManager.nextDisplayRow(this,!0)||!1}prevRow(){return this.table.rowManager.prevDisplayRow(this,!0)||!1}moveToRow(t,e){var i=this.table.rowManager.findRow(t);i?(this.table.rowManager.moveRowActual(this,i,!e),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",t)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(t){this.detachModules(),this.table.rowManager.deleteRow(this,t),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var t=this.cells.length;for(let e=0;e<t;e++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return!!this.isDisplayed()&&this.position}setPosition(t){t!=this.position&&(this.position=t,this.positionWatchers.forEach(t=>{t(this.position)}))}watchPosition(t){this.positionWatchers.push(t),t(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Qt(this)),this.component}}var ee={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class ie{constructor(t,e,i={}){this.table=t,this.msgType=e,this.registeredDefaults=Object.assign({},i)}register(t,e){this.registeredDefaults[t]=e}generate(t,e={}){var i=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||!0===e.debugInvalidOptions;Object.assign(i,t);for(let t in e)i.hasOwnProperty(t)||(n&&console.warn("Invalid "+this.msgType+" option:",t),i[t]=e.key);for(let t in i)t in e?i[t]=e[t]:Array.isArray(i[t])?i[t]=Object.assign([],i[t]):"object"==typeof i[t]&&null!==i[t]?i[t]=Object.assign({},i[t]):void 0===i[t]&&delete i[t];return i}}class ne extends jt{constructor(t){super(t),this.elementVertical=t.rowManager.element,this.elementHorizontal=t.columnManager.element,this.tableElement=t.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(t){}renderRows(){}renderColumns(){}rerenderRows(t){t&&t()}rerenderColumns(t,e){}renderRowCells(t){}rerenderRowCells(t,e){}scrollColumns(t,e){}scrollRows(t,e){}resize(){}scrollToRow(t){}scrollToRowNearestTop(t){}visibleRows(t){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(t,e){var i=t.getElement();e%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(t){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(t,e,i){var n=this.rows().indexOf(t),s=t.getElement(),o=0;return new Promise((r,a)=>{if(n>-1){if(void 0===i&&(i=this.table.options.scrollToRowIfVisible),!i&&Ut.elVisible(s)&&(o=Ut.elOffset(s).top-Ut.elOffset(this.elementVertical).top)>0&&o<this.elementVertical.clientHeight-s.offsetHeight)return r(),!1;switch(void 0===e&&(e=this.table.options.scrollToRowPosition),"nearest"===e&&(e=this.scrollToRowNearestTop(t)?"top":"bottom"),this.scrollToRow(t),e){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(s.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-s.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-s.offsetTop)+s.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+s.offsetHeight;break;case"top":this.elementVertical.scrollTop=s.offsetTop}r()}else console.warn("Scroll Error - Row not visible"),a("Scroll Error - Row not visible")})}}class se extends ne{constructor(t){super(t)}renderRowCells(t,e){const i=document.createDocumentFragment();t.cells.forEach(t=>{i.appendChild(t.getElement())}),t.element.appendChild(i),e||t.cells.forEach(t=>{t.cellRendered()})}reinitializeColumnWidths(t){t.forEach(function(t){t.reinitializeWidth()})}}class oe extends ne{constructor(t){super(t),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){"fitDataTable"==this.options("layout")&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(t,e){this.dataChange()}scrollColumns(t,e){this.scrollLeft!=t&&(this.scrollLeft=t,this.scroll(t-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var t=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(e=>{if(e.visible){var i=e.getWidth();i>t&&(t=i)}}),this.windowBuffer=2*t}rerenderColumns(t,e){var i={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;t&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(t=>{var e,i={};t.visible&&(t.modules.frozen||(e=t.getWidth(),i.leftPos=n,i.rightPos=n+e,i.width=e,this.isFitData&&(i.fitDataCheck=!t.modules.vdomHoz||t.modules.vdomHoz.fitDataCheck),n+e>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(-1==this.leftCol&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):-1!==this.leftCol&&(this.vDomPadRight+=e),this.columns.push(t),t.modules.vdomHoz=i,n+=e))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,e||t&&!this.reinitChanged(i)||this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(t){if(this.initialized)this.initializeRow(t);else{const e=document.createDocumentFragment();t.cells.forEach(t=>{e.appendChild(t.getElement())}),t.element.appendChild(e),t.cells.forEach(t=>{t.cellRendered()})}}rerenderRowCells(t,e){this.reinitializeRow(t,e)}reinitializeColumnWidths(t){for(let t=this.leftCol;t<=this.rightCol;t++){let e=this.columns[t];e&&e.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var t,e,i=!1;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(t=>{!t.definition.width&&t.visible&&(i=!0)}),i&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,t=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0])){e=t.getElement(),t.generateCells(),this.tableElement.appendChild(e);for(let i=0;i<t.cells.length;i++){let n=t.cells[i];e.appendChild(n.getElement()),n.column.reinitializeWidth()}e.parentNode.removeChild(e),this.rerenderColumns(!1,!0)}}else"fitColumns"===this.options("layout")&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(t){var e=!0;return t.cols.length!==this.columns.length||t.leftCol!==this.leftCol||t.rightCol!==this.rightCol||(t.cols.forEach((t,i)=>{t!==this.columns[i]&&(e=!1)}),!e)}reinitializeRows(){var t=this.getVisibleRows(),e=this.table.rowManager.getRows().filter(e=>!t.includes(e));t.forEach(t=>{this.reinitializeRow(t,!0)}),e.forEach(t=>{t.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(t){this.vDomScrollPosLeft+=t,this.vDomScrollPosRight+=t,Math.abs(t)>this.windowBuffer/2?this.rerenderColumns():t>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(t,e,i){for(let n=t;n<e;n++){let t=this.columns[n];t.modules.vdomHoz.leftPos+=i,t.modules.vdomHoz.rightPos+=i}}addColRight(){for(var t=!1,e=!0;e;){let i=this.columns[this.rightCol+1];i&&i.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);t.getElement().insertBefore(e.getElement(),t.getCell(this.columns[this.rightCol]).getElement().nextSibling),e.cellRendered()}}),this.fitDataColActualWidthCheck(i),this.rightCol++,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=i.getWidth()):e=!1}t&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var t=!1,e=!0;e;){let i=this.columns[this.leftCol-1];if(i)if(i.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);t.getElement().insertBefore(e.getElement(),t.getCell(this.columns[this.leftCol]).getElement()),e.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=i.getWidth();let e=this.fitDataColActualWidthCheck(i);e&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+e,this.vDomPadRight-=e)}else e=!1;else e=!1}t&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var t=!1,e=!0;e;){let i=this.columns[this.rightCol];i&&i.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);try{t.getElement().removeChild(e.getElement())}catch(t){console.warn("Could not removeColRight",t.message)}}}),this.vDomPadRight+=i.getWidth(),this.rightCol--,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.rightCol=this.rightCol)})):e=!1}t&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var t=!1,e=!0;e;){let i=this.columns[this.leftCol];i&&i.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);try{t.getElement().removeChild(e.getElement())}catch(t){console.warn("Could not removeColLeft",t.message)}}}),this.vDomPadLeft+=i.getWidth(),this.leftCol++,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.leftCol=this.leftCol)})):e=!1}t&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(t){var e,i;return t.modules.vdomHoz.fitDataCheck&&(t.reinitializeWidth(),(i=(e=t.getWidth())-t.modules.vdomHoz.width)&&(t.modules.vdomHoz.rightPos+=i,t.modules.vdomHoz.width=e,this.colPositionAdjust(this.columns.indexOf(t)+1,this.columns.length,i)),t.modules.vdomHoz.fitDataCheck=!1),i}initializeRow(t){if("group"!==t.type){t.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(e=>{this.appendCell(t,e)});for(let e=this.leftCol;e<=this.rightCol;e++)this.appendCell(t,this.columns[e]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(e=>{this.appendCell(t,e)})}}appendCell(t,e){if(e&&e.visible){let i=t.getCell(e);t.getElement().appendChild(i.getElement()),i.cellRendered()}}reinitializeRow(t,e){if("group"!==t.type&&(e||!t.modules.vdomHoz||t.modules.vdomHoz.leftCol!==this.leftCol||t.modules.vdomHoz.rightCol!==this.rightCol)){for(var i=t.getElement();i.firstChild;)i.removeChild(i.firstChild);this.initializeRow(t)}}}class re extends jt{constructor(t){super(t),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new ie(this.table,"column definition",Zt),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(t){this.table.rtl?this.headersElement.style.marginLeft=t+"px":this.headersElement.style.marginRight=t+"px"}initializeRenderer(){var t,e={virtual:oe,basic:se};(t="string"==typeof this.table.options.renderHorizontal?e[this.table.options.renderHorizontal]:this.table.options.renderHorizontal)?(this.renderer=new t(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var t=document.createElement("div");return t.classList.add("tabulator-headers"),t.setAttribute("role","row"),t}createHeaderContentsElement(){var t=document.createElement("div");return t.classList.add("tabulator-header-contents"),t.setAttribute("role","rowgroup"),t}createHeaderElement(){var t=document.createElement("div");return t.classList.add("tabulator-header"),t.setAttribute("role","rowgroup"),this.table.options.headerVisible||t.classList.add("tabulator-header-hidden"),t}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(t){this.contentsElement.scrollLeft=t,this.scrollLeft=t,this.renderer.scrollColumns(t)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",t=>{var e;t.deltaX&&(e=this.contentsElement.scrollLeft+t.deltaX,this.table.rowManager.scrollHorizontal(e),this.table.columnManager.scrollHorizontal(e))})}generateColumnsFromRowData(t){var e=[],i={},n="full"===this.table.options.autoColumns?t:[t[0]],s=this.table.options.autoColumnsDefinitions;if(t&&t.length){if(n.forEach(t=>{Object.keys(t).forEach((n,s)=>{let o,r=t[n];i[n]?!0!==i[n]&&void 0!==r&&(i[n].sorter=this.calculateSorterFromValue(r),i[n]=!0):(o={field:n,title:n,sorter:this.calculateSorterFromValue(r)},e.splice(s,0,o),i[n]=void 0!==r||o)})}),s)switch(typeof s){case"function":this.table.options.columns=s.call(this.table,e);break;case"object":Array.isArray(s)?e.forEach(t=>{var e=s.find(e=>e.field===t.field);e&&Object.assign(t,e)}):e.forEach(t=>{s[t.field]&&Object.assign(t,s[t.field])}),this.table.options.columns=e}else this.table.options.columns=e;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(t){var e;switch(typeof t){case"undefined":e="string";break;case"boolean":e="boolean";break;case"number":e="number";break;case"object":e=Array.isArray(t)?"array":"string";break;default:e=isNaN(t)||""===t?t.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?"alphanum":"string":"number"}return e}setColumns(t,e){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Jt(!0===this.table.options.rowHeader?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),t.forEach((t,e)=>{this._addColumn(t)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(t,e,i){var n=new Jt(t,this),s=n.getElement(),o=i?this.findColumnIndex(i):i;if(!e||!this.rowHeader||i&&i!==this.rowHeader||(e=!1,i=this.rowHeader,o=0),i&&o>-1){var r=i.getTopColumn(),a=this.columns.indexOf(r),l=r.getElement();e?(this.columns.splice(a,0,n),l.parentNode.insertBefore(s,l)):(this.columns.splice(a+1,0,n),l.parentNode.insertBefore(s,l.nextSibling))}else e?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(t){t.definition.field&&(this.columnsByField[t.definition.field]=t)}registerColumnPosition(t){this.columnsByIndex.push(t)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(t){t.reRegisterPosition()})}verticalAlignHeaders(){var t=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(t=>{t.clearVerticalAlign()}),this.columns.forEach(e=>{var i=e.getHeight();i>t&&(t=i)}),this.headersElement.style.height=t+"px",this.columns.forEach(e=>{e.verticalAlign(this.table.options.columnHeaderVertAlign,t)}),this.table.rowManager.adjustTableSize())}findColumn(t){var e;return"object"!=typeof t?this.columnsByField[t]||!1:t instanceof Jt?t:t instanceof Yt?t._getSelf()||!1:"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&(e=[],this.columns.forEach(t=>{e.push(t),e=e.concat(t.getColumns(!0))}),e.find(e=>e.element===t)||!1)}getColumnByField(t){return this.columnsByField[t]}getColumnsByFieldRoot(t){var e=[];return Object.keys(this.columnsByField).forEach(i=>{(this.table.options.nestedFieldSeparator?i.split(this.table.options.nestedFieldSeparator)[0]:i)===t&&e.push(this.columnsByField[i])}),e}getColumnByIndex(t){return this.columnsByIndex[t]}getFirstVisibleColumn(){var t=this.columnsByIndex.findIndex(t=>t.visible);return t>-1&&this.columnsByIndex[t]}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(t=>t.visible)}getColumns(){return this.columns}findColumnIndex(t){return this.columnsByIndex.findIndex(e=>t===e)}getRealColumns(){return this.columnsByIndex}traverse(t){this.columnsByIndex.forEach((e,i)=>{t(e,i)})}getDefinitions(t){var e=[];return this.columnsByIndex.forEach(i=>{(!t||t&&i.visible)&&e.push(i.getDefinition())}),e}getDefinitionTree(){var t=[];return this.columns.forEach(e=>{t.push(e.getDefinition(!0))}),t}getComponents(t){var e=[];return(t?this.columns:this.columnsByIndex).forEach(t=>{e.push(t.getComponent())}),e}getWidth(){var t=0;return this.columnsByIndex.forEach(e=>{e.visible&&(t+=e.getWidth())}),t}moveColumn(t,e,i){e.element.parentNode.insertBefore(t.element,e.element),i&&e.element.parentNode.insertBefore(e.element,t.element),this.moveColumnActual(t,e,i),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(t,e,i){t.parent.isGroup?this._moveColumnInArray(t.parent.columns,t,e,i):this._moveColumnInArray(this.columns,t,e,i),this._moveColumnInArray(this.columnsByIndex,t,e,i,!0),this.rerenderColumns(!0),this.dispatch("column-moved",t,e,i),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",t.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(t,e,i,n,s){var o,r=t.indexOf(e);r>-1&&(t.splice(r,1),(o=t.indexOf(i))>-1?n&&(o+=1):o=r,t.splice(o,0,e),s&&(this.chain("column-moving-rows",[e,i,n],null,[])||[]).concat(this.table.rowManager.rows).forEach(function(t){if(t.cells.length){var e=t.cells.splice(r,1)[0];t.cells.splice(o,0,e)}}))}scrollToColumn(t,e,i){var n=0,s=t.getLeftOffset(),o=0,r=t.getElement();return new Promise((a,l)=>{if(void 0===e&&(e=this.table.options.scrollToColumnPosition),void 0===i&&(i=this.table.options.scrollToColumnIfVisible),t.visible){switch(e){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=r.clientWidth-this.headersElement.clientWidth}if(!i&&s>0&&s+r.offsetWidth<this.element.clientWidth)return!1;n=s+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),a()}else console.warn("Scroll Error - Column not visible"),l("Scroll Error - Column not visible")})}generateCells(t){var e=[];return this.columnsByIndex.forEach(i=>{e.push(i.generateCell(t))}),e}getFlexBaseWidth(){var t=this.table.element.clientWidth,e=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(t-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(i){var n,s,o;i.visible&&(n=i.definition.width||0,s=parseInt(i.minWidth),o="string"==typeof n?n.indexOf("%")>-1?t/100*parseInt(n):parseInt(n):n,e+=o>s?o:s)}),e}addColumn(t,e,i){return new Promise((n,s)=>{var o=this._addColumn(t,e,i);this._reIndexColumns(),this.dispatch("column-add",t,e,i),"fitColumns"!=this.layoutMode()&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(t){var e,i=t.getField();i&&delete this.columnsByField[i],(e=this.columnsByIndex.indexOf(t))>-1&&this.columnsByIndex.splice(e,1),(e=this.columns.indexOf(t))>-1&&this.columns.splice(e,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(t,e){this.redrawBlock?(!1===t||!0===t&&null===this.redrawBlockUpdate)&&(this.redrawBlockUpdate=t):this.renderer.rerenderColumns(t,e)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(t){Ut.elVisible(this.element)&&this.verticalAlignHeaders(),t&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",t)||this.layoutRefresh(t),this.dispatch("table-redraw",t),this.table.footerManager.redraw()}}class ae extends ne{constructor(t){super(t),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var t=this.tableElement;t.firstChild;)t.removeChild(t.firstChild);t.scrollTop=0,t.scrollLeft=0,t.style.minWidth="",t.style.minHeight="",t.style.display="",t.style.visibility=""}renderRows(){var t=this.tableElement,e=!0,i=document.createDocumentFragment(),n=this.rows();n.forEach((t,n)=>{this.styleRow(t,n),t.initialize(!1,!0),"group"!==t.type&&(e=!1),i.appendChild(t.getElement())}),t.appendChild(i),n.forEach(t=>{t.rendered(),t.heightInitialized||t.calcHeight(!0)}),n.forEach(t=>{t.heightInitialized||t.setCellHeight()}),t.style.minWidth=e?this.table.columnManager.getWidth()+"px":""}rerenderRows(t){this.clearRows(),t&&t(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(t){var e=Ut.elOffset(t.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-e)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-e))}scrollToRow(t){var e=t.getElement();this.elementVertical.scrollTop=Ut.elOffset(e).top-Ut.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(t){return this.rows()}}class le extends ne{constructor(t){super(t),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var t=this.tableElement;t.firstChild;)t.removeChild(t.firstChild);t.style.paddingTop="",t.style.paddingBottom="",t.style.minHeight="",t.style.display="",t.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(t){for(var e=this.elementVertical.scrollTop,i=!1,n=!1,s=this.table.rowManager.scrollLeft,o=this.rows(),r=this.vDomTop;r<=this.vDomBottom;r++)if(o[r]){var a=e-o[r].getElement().offsetTop;if(!(!1===n||Math.abs(a)<n))break;n=a,i=r}o.forEach(t=>{t.deinitializeHeight()}),t&&t(),this.rows().length?this._virtualRenderFill(!1===i?this.rows.length-1:i,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(s)}scrollColumns(t){this.table.rowManager.scrollHorizontal(t)}scrollRows(t,e){var i=t-this.vDomScrollPosTop,n=t-this.vDomScrollPosBottom,s=2*this.vDomWindowBuffer,o=this.rows();if(this.scrollTop=t,-i>s||n>s){var r=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(r)}else e?(i<0&&this._addTopRow(o,-i),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),i>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,i):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(t){var e=this.rows().indexOf(t);return!(Math.abs(this.vDomTop-e)>Math.abs(this.vDomBottom-e))}scrollToRow(t){var e=this.rows().indexOf(t);e>-1&&this._virtualRenderFill(e,!0)}visibleRows(t){var e=this.elementVertical.scrollTop,i=this.elementVertical.clientHeight+e,n=!1,s=0,o=0,r=this.rows();if(t)s=this.vDomTop,o=this.vDomBottom;else for(var a=this.vDomTop;a<=this.vDomBottom;a++)if(r[a])if(n){if(!(i-r[a].getElement().offsetTop>=0))break;o=a}else if(e-r[a].getElement().offsetTop>=0)s=a;else{if(n=!0,!(i-r[a].getElement().offsetTop>=0))break;o=a}return r.slice(s,o+1)}_virtualRenderFill(t,e,i){var n,s,o=this.tableElement,r=this.elementVertical,a=0,l=0,h=0,d=0,c=0,u=0,p=this.rows(),m=p.length,g=0,f=[],v=0,b=0,_=this.table.rowManager.fixedHeight,w=this.elementVertical.clientHeight,y=this.table.options.rowHeight,C=!0;if(i=i||0,t=t||0){for(;o.firstChild;)o.removeChild(o.firstChild);(d=(m-t+1)*this.vDomRowHeight)<w&&(t-=Math.ceil((w-d)/this.vDomRowHeight))<0&&(t=0),t-=a=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),t)}else this.clear();if(m&&Ut.elVisible(this.elementVertical)){for(this.vDomTop=t,this.vDomBottom=t-1,_||this.table.options.maxHeight?(y&&(b=w/y+this.vDomWindowBuffer/y),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=m;(b==m||l<=w+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(f=[],s=document.createDocumentFragment(),u=0;u<b&&this.vDomBottom<m-1;)n=p[g=this.vDomBottom+1],this.styleRow(n,g),n.initialize(!1,!0),n.heightInitialized||this.table.options.rowHeight||n.clearCellHeight(),s.appendChild(n.getElement()),f.push(n),this.vDomBottom++,u++;if(!f.length)break;o.appendChild(s),f.forEach(t=>{t.rendered(),t.heightInitialized||t.calcHeight(!0)}),f.forEach(t=>{t.heightInitialized||t.setCellHeight()}),f.forEach(t=>{h=t.getHeight(),v<a?c+=h:l+=h,h>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*h),v++}),C=this.table.rowManager.adjustTableSize(),w=this.elementVertical.clientHeight,C&&(_||this.table.options.maxHeight)&&(y=l/v,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w/y+this.vDomWindowBuffer/y)))}t?(this.vDomTopPad=e?this.vDomRowHeight*this.vDomTop+i:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-l-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((l+c)/v),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=c+l+this.vDomBottomPad-w),o.style.paddingTop=this.vDomTopPad+"px",o.style.paddingBottom=this.vDomBottomPad+"px",e&&(this.scrollTop=this.vDomTopPad+c+i-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-w:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-w),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&e&&(this.scrollTop+=this.elementVertical.offsetHeight-w),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,r.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(t,e){for(var i=this.tableElement,n=[],s=0,o=this.vDomTop-1,r=0,a=!0;a;)if(this.vDomTop){let l,h,d=t[o];d&&r<this.vDomMaxRenderChain?(l=d.getHeight()||this.vDomRowHeight,h=d.initialized,e>=l?(this.styleRow(d,o),i.insertBefore(d.getElement(),i.firstChild),d.initialized&&d.heightInitialized||n.push(d),d.initialize(),h||(l=d.getElement().offsetHeight,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*l)),e-=l,s+=l,this.vDomTop--,o--,r++):a=!1):a=!1}else a=!1;for(let t of n)t.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomTopPad-=s,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),i.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=s)}_removeTopRow(t,e){for(var i=[],n=0,s=0,o=!0;o;){let r,a=t[this.vDomTop];a&&s<this.vDomMaxRenderChain?(r=a.getHeight()||this.vDomRowHeight,e>=r?(this.vDomTop++,e-=r,n+=r,i.push(a),s++):o=!1):o=!1}for(let t of i){let e=t.getElement();e.parentNode&&e.parentNode.removeChild(e)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(t,e){for(var i=this.tableElement,n=[],s=0,o=this.vDomBottom+1,r=0,a=!0;a;){let l,h,d=t[o];d&&r<this.vDomMaxRenderChain?(l=d.getHeight()||this.vDomRowHeight,h=d.initialized,e>=l?(this.styleRow(d,o),i.appendChild(d.getElement()),d.initialized&&d.heightInitialized||n.push(d),d.initialize(),h||(l=d.getElement().offsetHeight,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*l)),e-=l,s+=l,this.vDomBottom++,o++,r++):a=!1):a=!1}for(let t of n)t.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomBottomPad-=s,(this.vDomBottomPad<0||o==t.length-1)&&(this.vDomBottomPad=0),i.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=s)}_removeBottomRow(t,e){for(var i=[],n=0,s=0,o=!0;o;){let r,a=t[this.vDomBottom];a&&s<this.vDomMaxRenderChain?(r=a.getHeight()||this.vDomRowHeight,e>=r?(this.vDomBottom--,e-=r,n+=r,i.push(a),s++):o=!1):o=!1}for(let t of i){let e=t.getElement();e.parentNode&&e.parentNode.removeChild(e)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(t){for(let e of t)e.calcHeight();for(let e of t)e.setCellHeight()}}class he extends jt{constructor(t){super(t),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var t=document.createElement("div");return t.classList.add("tabulator-tableholder"),t.setAttribute("tabindex",0),t}createTableElement(){var t=document.createElement("div");return t.classList.add("tabulator-table"),t.setAttribute("role","rowgroup"),t}initializePlaceholder(){var t=this.table.options.placeholder;if("function"==typeof t&&(t=t.call(this.table)),t=this.chain("placeholder",[t],t,t)||t){let e=document.createElement("div");if(e.classList.add("tabulator-placeholder"),"string"==typeof t){let i=document.createElement("div");i.classList.add("tabulator-placeholder-contents"),i.innerHTML=t,e.appendChild(i),this.placeholderContents=i}else"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?(e.appendChild(t),this.placeholderContents=t):(console.warn("Invalid placeholder provided, must be string or HTML Element",t),this.el=null);this.placeholder=e}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var t=this.element.scrollLeft,e=this.scrollLeft>t,i=this.element.scrollTop,n=this.scrollTop>i;this.scrollLeft!=t&&(this.scrollLeft=t,this.dispatch("scroll-horizontal",t,e),this.dispatchExternal("scrollHorizontal",t,e),this._positionPlaceholder()),this.scrollTop!=i&&(this.scrollTop=i,this.renderer.scrollRows(i,n),this.dispatch("scroll-vertical",i,n),this.dispatchExternal("scrollVertical",i,n))})}findRow(t){return"object"!=typeof t?void 0!==t&&(this.rows.find(e=>e.data[this.table.options.index]==t)||!1):t instanceof te?t:t instanceof Qt?t._getSelf()||!1:"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&this.rows.find(e=>e.getElement()===t)||!1}getRowFromDataObject(t){return this.rows.find(e=>e.data===t)||!1}getRowFromPosition(t){return this.getDisplayRows().find(e=>"row"===e.type&&e.getPosition()===t&&e.isDisplayed())}scrollToRow(t,e,i){return this.renderer.scrollToRowPosition(t,e,i)}setData(t,e,i){return new Promise((n,s)=>{e&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(t,!0):this.reRenderInPosition(()=>{this._setDataActual(t)}):(this.table.options.autoColumns&&i&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(t),this.resetScroll(),this._setDataActual(t)),n()})}_setDataActual(t,e){this.dispatchExternal("dataProcessing",t),this._wipeElements(),Array.isArray(t)?(this.dispatch("data-processing",t),t.forEach((t,e)=>{if(t&&"object"==typeof t){var i=new te(t,this);this.rows.push(i)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",t)}),this.refreshActiveData(!1,!1,e),this.dispatch("data-processed",t),this.dispatchExternal("dataProcessed",t)):console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ",typeof t,"\nData:     ",t)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(t=>{t.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(t,e){var i=this.rows.indexOf(t),n=this.activeRows.indexOf(t);n>-1&&this.activeRows.splice(n,1),i>-1&&this.rows.splice(i,1),this.setActiveRows(this.activeRows),this.displayRowIterator(e=>{var i=e.indexOf(t);i>-1&&e.splice(i,1)}),e||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",t.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(t,e,i,n){return this.addRowActual(t,e,i,n)}addRows(t,e,i,n){var s=[];return new Promise((o,r)=>{e=this.findAddRowPos(e),Array.isArray(t)||(t=[t]),(void 0===i&&e||void 0!==i&&!e)&&t.reverse(),t.forEach((t,n)=>{var o=this.addRow(t,e,i,!0);s.push(o),this.dispatch("row-added",o,t,e,i)}),this.refreshActiveData(!!n&&"displayPipeline",!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(s)})}findAddRowPos(t){return void 0===t&&(t=this.table.options.addRowPos),"pos"===t&&(t=!0),"bottom"===t&&(t=!1),t}addRowActual(t,e,i,n){var s,o,r=t instanceof te?t:new te(t||{},this),a=this.findAddRowPos(e),l=-1;return i||(o=this.chain("row-adding-position",[r,a],null,{index:i,top:a}),i=o.index,a=o.top),void 0!==i&&(i=this.findRow(i)),(i=this.chain("row-adding-index",[r,i,a],null,i))&&(l=this.rows.indexOf(i)),i&&l>-1?(s=this.activeRows.indexOf(i),this.displayRowIterator(function(t){var e=t.indexOf(i);e>-1&&t.splice(a?e:e+1,0,r)}),s>-1&&this.activeRows.splice(a?s:s+1,0,r),this.rows.splice(a?l:l+1,0,r)):a?(this.displayRowIterator(function(t){t.unshift(r)}),this.activeRows.unshift(r),this.rows.unshift(r)):(this.displayRowIterator(function(t){t.push(r)}),this.activeRows.push(r),this.rows.push(r)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",r.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),r}moveRow(t,e,i){this.dispatch("row-move",t,e,i),this.moveRowActual(t,e,i),this.regenerateRowPositions(),this.dispatch("row-moved",t,e,i),this.dispatchExternal("rowMoved",t.getComponent())}moveRowActual(t,e,i){this.moveRowInArray(this.rows,t,e,i),this.moveRowInArray(this.activeRows,t,e,i),this.displayRowIterator(n=>{this.moveRowInArray(n,t,e,i)}),this.dispatch("row-moving",t,e,i)}moveRowInArray(t,e,i,n){var s,o,r;if(e!==i&&((s=t.indexOf(e))>-1&&(t.splice(s,1),(o=t.indexOf(i))>-1?n?t.splice(o+1,0,e):t.splice(o,0,e):t.splice(s,0,e)),t===this.getDisplayRows())){r=o>s?o:s+1;for(let e=s<o?s:o;e<=r;e++)t[e]&&this.styleRow(t[e],e)}}clearData(){this.setData([])}getRowIndex(t){return this.findRowIndex(t,this.rows)}getDisplayRowIndex(t){var e=this.getDisplayRows().indexOf(t);return e>-1&&e}nextDisplayRow(t,e){var i=this.getDisplayRowIndex(t),n=!1;return!1!==i&&i<this.displayRowsCount-1&&(n=this.getDisplayRows()[i+1]),!n||n instanceof te&&"row"==n.type?n:this.nextDisplayRow(n,e)}prevDisplayRow(t,e){var i=this.getDisplayRowIndex(t),n=!1;return i&&(n=this.getDisplayRows()[i-1]),!e||!n||n instanceof te&&"row"==n.type?n:this.prevDisplayRow(n,e)}findRowIndex(t,e){var i;return!!((t=this.findRow(t))&&(i=e.indexOf(t))>-1)&&i}getData(t,e){var i=[];return this.getRows(t).forEach(function(t){"row"==t.type&&i.push(t.getData(e||"data"))}),i}getComponents(t){var e=[];return this.getRows(t).forEach(function(t){e.push(t.getComponent())}),e}getDataCount(t){return this.getRows(t).length}scrollHorizontal(t){this.scrollLeft=t,this.element.scrollLeft=t,this.dispatch("scroll-horizontal",t)}registerDataPipelineHandler(t,e){void 0!==e?(this.dataPipeline.push({handler:t,priority:e}),this.dataPipeline.sort((t,e)=>t.priority-e.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(t,e){void 0!==e?(this.displayPipeline.push({handler:t,priority:e}),this.displayPipeline.sort((t,e)=>t.priority-e.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(t,e,i){var n=this.table,s="",o=0,r=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if("function"==typeof t)if((o=this.dataPipeline.findIndex(e=>e.handler===t))>-1)s="dataPipeline",e&&(o==this.dataPipeline.length-1?s="display":o++);else{if(!((o=this.displayPipeline.findIndex(e=>e.handler===t))>-1))return void console.error("Unable to refresh data, invalid handler provided",t);s="displayPipeline",e&&(o==this.displayPipeline.length-1?s="end":o++)}else s=t||"all",o=0;if(this.redrawBlock)return void((!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===s&&o<this.redrawBlockRestoreConfig.index||r.indexOf(s)<r.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:t,skipStage:e,renderInPosition:i,stage:s,index:o}));Ut.elVisible(this.element)?i?this.reRenderInPosition(this.refreshPipelines.bind(this,t,s,o,i)):(this.refreshPipelines(t,s,o,i),t||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(t,s,o,i),this.dispatch("data-refreshed")}}refreshPipelines(t,e,i,n){switch(this.dispatch("data-refreshing"),t&&this.activeRowsPipeline[0]||(this.activeRowsPipeline[0]=this.rows.slice(0)),e){case"all":case"dataPipeline":for(let t=i;t<this.dataPipeline.length;t++){let e=this.dataPipeline[t].handler(this.activeRowsPipeline[t].slice(0));this.activeRowsPipeline[t+1]=e||this.activeRowsPipeline[t].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":i=0,this.resetDisplayRows();case"displayPipeline":for(let t=i;t<this.displayPipeline.length;t++){let e=this.displayPipeline[t].handler((t?this.getDisplayRows(t-1):this.activeRows).slice(0),n);this.setDisplayRows(e||this.getDisplayRows(t-1).slice(0),t)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var t=this.getDisplayRows(),e=1;t.forEach(t=>{"row"===t.type&&(t.setPosition(e),e++)})}setActiveRows(t){this.activeRows=this.activeRows=Object.assign([],t),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(t,e){this.displayRows[e]=t,e==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(t){return void 0===t?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[t]||[]}getVisibleRows(t,e){var i=Object.assign([],this.renderer.visibleRows(!e));return t&&(i=this.chain("rows-visible",[e],i,i)),i}displayRowIterator(t){this.activeRowsPipeline.forEach(t),this.displayRows.forEach(t),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(t){var e=[];switch(t){case"active":e=this.activeRows;break;case"display":e=this.table.rowManager.getDisplayRows();break;case"visible":e=this.getVisibleRows(!1,!0);break;default:e=this.chain("rows-retrieve",t,null,this.rows)||this.rows}return e}reRenderInPosition(t){this.redrawBlock?t?t():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(t),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var t=0;this.element.scrollHeight>this.element.clientHeight&&(t=this.element.offsetWidth-this.element.clientWidth),t!==this.scrollbarWidth&&(this.scrollbarWidth=t,this.dispatch("scrollbar-vertical",t))}initializeRenderer(){var t,e={virtual:le,basic:ae};(t="string"==typeof this.table.options.renderVertical?e[this.table.options.renderVertical]:this.table.options.renderVertical)?(this.renderMode=this.table.options.renderVertical,this.renderer=new t(this.table,this.element,this.tableElement),this.renderer.initialize(),!this.table.element.clientHeight&&!this.table.options.height||this.table.options.minHeight&&this.table.options.maxHeight?this.fixedHeight=!1:this.fixedHeight=!0):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(t,e){var i=t.getElement();e%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}normalizeHeight(t){this.activeRows.forEach(function(e){e.normalizeHeight(t)})}adjustTableSize(){let t,e=this.element.clientHeight,i=!1;if("fill"===this.renderer.verticalFillMode){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){t=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const e="calc(100% - "+n+"px)";this.element.style.minHeight=t||"calc(100% - "+n+"px)",this.element.style.height=e,this.element.style.maxHeight=e}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),this.fixedHeight||e==this.element.clientHeight||(i=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),i}reinitialize(){this.rows.forEach(function(t){t.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(t){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,t?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,"ie"===this.table.browser){var t=document.createEvent("Event");t.initEvent("scroll",!1,!0),this.element.dispatchEvent(t)}else this.element.dispatchEvent(new Event("scroll"))}}class de extends jt{constructor(t){super(t),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var t=document.createElement("div");return t.classList.add("tabulator-footer"),t}createContainerElement(){var t=document.createElement("div");return t.classList.add("tabulator-footer-contents"),this.element.appendChild(t),t}initializeElement(){this.table.options.footerElement&&("string"==typeof this.table.options.footerElement?"<"===this.table.options.footerElement[0]?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(t){this.activate(),this.containerElement.appendChild(t),this.table.rowManager.adjustTableSize()}prepend(t){this.activate(),this.element.insertBefore(t,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(t){t.parentNode.removeChild(t),this.deactivate()}deactivate(t){this.element.firstChild&&!t||(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class ce extends jt{constructor(t){super(t),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var t={};this.listeners.forEach(e=>{t[e]={handler:null,components:[]}}),this.listeners=t}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(t=>{this.pseudoTrackers[t].subscriber=this.pseudoMouseEnter.bind(this,t),this.subscribe(t+"-mouseover",this.pseudoTrackers[t].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(t,e,i){this.pseudoTrackers[t].target!==i&&(this.pseudoTrackers[t].target&&this.dispatch(t+"-mouseleave",e,this.pseudoTrackers[t].target),this.pseudoMouseLeave(t,e),this.pseudoTrackers[t].target=i,this.dispatch(t+"-mouseenter",e,i))}pseudoMouseLeave(t,e){var i=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};(i=i.filter(e=>{var i=n[t];return e!==t&&(!i||i&&!i.includes(e))})).forEach(t=>{var i=this.pseudoTrackers[t].target;this.pseudoTrackers[t].target&&(this.dispatch(t+"-mouseleave",e,i),this.pseudoTrackers[t].target=null)})}bindSubscriptionWatchers(){var t=Object.keys(this.listeners),e=Object.values(this.componentMap);for(let i of e)for(let e of t){let t=i+"-"+e;this.subscriptionChange(t,this.subscriptionChanged.bind(this,i,e))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(t,e,i){var n=this.listeners[e].components,s=n.indexOf(t),o=!1;i?-1===s&&(n.push(t),o=!0):this.subscribed(t+"-"+e)||s>-1&&(n.splice(s,1),o=!0),"mouseenter"!==e&&"mouseleave"!==e||this.pseudoTracking||this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let t in this.listeners){let e=this.listeners[t];e.components.length?e.handler||(e.handler=this.track.bind(this,t),this.el.addEventListener(t,e.handler)):e.handler&&(this.el.removeEventListener(t,e.handler),e.handler=null)}}track(t,e){var i=e.composedPath&&e.composedPath()||e.path,n=this.findTargets(i);n=this.bindComponents(t,n),this.triggerEvents(t,e,n),!this.pseudoTracking||"mouseover"!=t&&"mouseleave"!=t||Object.keys(n).length||this.pseudoMouseLeave("none",e)}findTargets(t){var e={};let i=Object.keys(this.componentMap);for(let n of t){let t=n.classList?[...n.classList]:[];if(t.filter(t=>this.abortClasses.includes(t)).length)break;let s=t.filter(t=>i.includes(t));for(let t of s)e[this.componentMap[t]]||(e[this.componentMap[t]]=n)}return e.group&&e.group===e.row&&delete e.row,e}bindComponents(t,e){var i=Object.keys(e).reverse(),n=this.listeners[t],s={},o={},r={};for(let t of i){let i,o=e[t],a=this.previousTargets[t];if(a&&a.target===o)i=a.component;else switch(t){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(i=this.table.rowManager.getVisibleRows(!0).find(t=>t.getElement()===o),e.row&&e.row.parentNode&&e.row.parentNode.closest(".tabulator-row")&&(e[t]=!1));break;case"column":n.components.includes("column")&&(i=this.table.columnManager.findColumn(o));break;case"cell":n.components.includes("cell")&&(s.row instanceof te?i=s.row.findCell(o):e.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"))}i&&(s[t]=i,r[t]={target:o,component:i})}return this.previousTargets=r,Object.keys(e).forEach(t=>{let e=s[t];o[t]=e}),o}triggerEvents(t,e,i){var n=this.listeners[t];for(let s in i)i[s]&&n.components.includes(s)&&this.dispatch(s+"-"+t,e,i[s])}clearWatchers(){for(let t in this.listeners){let e=this.listeners[t];e.handler&&(this.el.removeEventListener(t,e.handler),e.handler=null)}}}class ue{constructor(t){this.table=t,this.bindings={}}bind(t,e,i){this.bindings[t]||(this.bindings[t]={}),this.bindings[t][e]?console.warn("Unable to bind component handler, a matching function name is already bound",t,e,i):this.bindings[t][e]=i}handle(t,e,i){if(this.bindings[t]&&this.bindings[t][i]&&"function"==typeof this.bindings[t][i].bind)return this.bindings[t][i].bind(null,e);"then"===i||"string"!=typeof i||i.startsWith("_")||this.table.options.debugInvalidComponentFuncs&&console.error("The "+t+" component does not have a "+i+" function, have you checked that you have the correct Tabulator module installed?")}}class pe extends jt{constructor(t){super(t),this.requestOrder=0,this.loading=!1}initialize(){}load(t,e,i,n,s,o){var r=++this.requestOrder;return this.table.destroyed?Promise.resolve():(this.dispatchExternal("dataLoading",t),!t||0!=t.indexOf("{")&&0!=t.indexOf("[")||(t=JSON.parse(t)),this.confirm("data-loading",[t,e,i,s])?(this.loading=!0,s||this.alertLoader(),e=this.chain("data-params",[t,i,s],e||{},e||{}),e=this.mapParams(e,this.table.options.dataSendParams),this.chain("data-load",[t,e,i,s],!1,Promise.resolve([])).then(t=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{Array.isArray(t)||"object"!=typeof t||(t=this.mapParams(t,this.objectInvert(this.table.options.dataReceiveParams)));var e=this.chain("data-loaded",[t],null,t);r==this.requestOrder?(this.clearAlert(),!1!==e&&(this.dispatchExternal("dataLoaded",e),this.table.rowManager.setData(e,n,void 0===o?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(t=>{console.error("Data Load Error: ",t),this.dispatchExternal("dataLoadError",t),s||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})):(this.dispatchExternal("dataLoaded",t),t||(t=[]),this.table.rowManager.setData(t,n,void 0===o?!n:o),Promise.resolve()))}mapParams(t,e){var i={};for(let n in t)i[e.hasOwnProperty(n)?e[n]:n]=t[n];return i}objectInvert(t){var e={};for(let i in t)e[t[i]]=i;return e}blockActiveLoad(){this.requestOrder++}alertLoader(){("function"==typeof this.table.options.dataLoader?this.table.options.dataLoader():this.table.options.dataLoader)&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class me{constructor(t,e,i){this.table=t,this.events={},this.optionsList=e||{},this.subscriptionNotifiers={},this.dispatch=i?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=i}subscriptionChange(t,e){this.subscriptionNotifiers[t]||(this.subscriptionNotifiers[t]=[]),this.subscriptionNotifiers[t].push(e),this.subscribed(t)&&this._notifySubscriptionChange(t,!0)}subscribe(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e),this._notifySubscriptionChange(t,!0)}unsubscribe(t,e){var i;if(this.events[t]){if(e){if(!((i=this.events[t].findIndex(t=>t===e))>-1))return void console.warn("Cannot remove event, no matching event found:",t,e);this.events[t].splice(i,1)}else delete this.events[t];this._notifySubscriptionChange(t,!1)}else console.warn("Cannot remove event, no events set on:",t)}subscribed(t){return this.events[t]&&this.events[t].length}_notifySubscriptionChange(t,e){var i=this.subscriptionNotifiers[t];i&&i.forEach(t=>{t(e)})}_dispatch(){var t,e=Array.from(arguments),i=e.shift();return this.events[i]&&this.events[i].forEach((i,n)=>{let s=i.apply(this.table,e);n||(t=s)}),t}_debugDispatch(){var t=Array.from(arguments),e=t[0];return t[0]="ExternalEvent:"+t[0],(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._dispatch(...arguments)}}class ge{constructor(t){this.events={},this.subscriptionNotifiers={},this.dispatch=t?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=t?this._debugChain.bind(this):this._chain.bind(this),this.confirm=t?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=t}subscriptionChange(t,e){this.subscriptionNotifiers[t]||(this.subscriptionNotifiers[t]=[]),this.subscriptionNotifiers[t].push(e),this.subscribed(t)&&this._notifySubscriptionChange(t,!0)}subscribe(t,e,i=1e4){this.events[t]||(this.events[t]=[]),this.events[t].push({callback:e,priority:i}),this.events[t].sort((t,e)=>t.priority-e.priority),this._notifySubscriptionChange(t,!0)}unsubscribe(t,e){var i;if(this.events[t]){if(e){if(!((i=this.events[t].findIndex(t=>t.callback===e))>-1))return void console.warn("Cannot remove event, no matching event found:",t,e);this.events[t].splice(i,1)}this._notifySubscriptionChange(t,!1)}else console.warn("Cannot remove event, no events set on:",t)}subscribed(t){return this.events[t]&&this.events[t].length}_chain(t,e,i,n){var s=i;return Array.isArray(e)||(e=[e]),this.subscribed(t)?(this.events[t].forEach((t,i)=>{s=t.callback.apply(this,e.concat([s]))}),s):"function"==typeof n?n():n}_confirm(t,e){var i=!1;return Array.isArray(e)||(e=[e]),this.subscribed(t)&&this.events[t].forEach((t,n)=>{t.callback.apply(this,e)&&(i=!0)}),i}_notifySubscriptionChange(t,e){var i=this.subscriptionNotifiers[t];i&&i.forEach(t=>{t(e)})}_dispatch(){var t=Array.from(arguments),e=t.shift();this.events[e]&&this.events[e].forEach(e=>{e.callback.apply(this,t)})}_debugDispatch(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._dispatch(...arguments)}_debugChain(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._chain(...arguments)}_debugConfirm(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._confirm(...arguments)}}class fe extends jt{constructor(t){super(t)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(t,e,i){var n="";return void 0===this.options(t)||(n="Deprecated Setup Option - Use of the %c"+t+"%c option is now deprecated",e?(n=n+", Please use the %c"+e+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),i&&(this.table.options[e]=this.table.options[t])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1)}checkMsg(t,e){return void 0===this.options(t)||(this._warnUser("%cDeprecated Setup Option - Use of the %c"+t+" %c option is now deprecated, "+e,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1)}msg(t){this._warnUser(t)}}class ve extends jt{constructor(t){super(t),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(t,e,i){if(!Array.isArray(t))return e?this.lookupProp(t,e,i):this.lookupKey(t,i);for(const i of t){var n=this.lookup(i,e,!0);if(n)break}if(n)return n;this.error(t)}lookupProp(t,e,i){var n;return this.props[t]&&this.props[t][e]?this.props[t][e]:(n=this.lookupKey(t,i))?(this.props[t]||(this.props[t]={}),this.props[t][e]=n[e]||n,this.props[t][e]):void 0}lookupKey(t,e){var i;return this.deps[t]?i=this.deps[t]:window[t]?(this.deps[t]=window[t],i=this.deps[t]):e||this.error(t),i}error(t){console.error("Unable to find dependency",t,"Please check documentation and ensure you have imported the required library into your project")}}function be(t,e){t.forEach(function(t){t.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}var _e={fitData:function(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitDataFill:be,fitDataTable:be,fitDataStretch:function(t,e){var i=0,n=this.table.rowManager.element.clientWidth,s=0,o=!1;t.forEach((t,e)=>{t.widthFixed||t.reinitializeWidth(),(this.table.options.responsiveLayout?t.modules.responsive.visible:t.visible)&&(o=t),t.visible&&(i+=t.getWidth())}),o?(s=n-i+o.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(o.setWidth(0),this.table.modules.responsiveLayout.update()),s>0?o.setWidth(s):o.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitColumns:function(t,e){var i,n,s=this.table.rowManager.element.getBoundingClientRect().width,o=0,r=0,a=0,l=[],h=[],d=0,c=0;function u(t){return"string"==typeof t?t.indexOf("%")>-1?s/100*parseInt(t):parseInt(t):t}function p(t,e,i,n){var s=[],o=0,r=0,l=0,h=a,d=0,c=0,m=[];function g(t){return i*(t.column.definition.widthGrow||1)}function f(t){return u(t.width)-i*(t.column.definition.widthShrink||0)}return t.forEach(function(t,o){var r=n?f(t):g(t);t.column.minWidth>=r?s.push(t):t.column.maxWidth&&t.column.maxWidth<r?(t.width=t.column.maxWidth,e-=t.column.maxWidth,(h-=n?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1)&&(i=Math.floor(e/h))):(m.push(t),c+=n?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1)}),s.length?(s.forEach(function(t){o+=n?t.width-t.column.minWidth:t.column.minWidth,t.width=t.column.minWidth}),r=e-o,l=c?Math.floor(r/c):r,d=p(m,r,l,n)):(d=c?e-Math.floor(e/c)*c:e,m.forEach(function(t){t.width=n?f(t):g(t)})),d}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(s-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(t){var e,i,n;t.visible&&(e=t.definition.width,i=parseInt(t.minWidth),e?(n=u(e),o+=n>i?n:i,t.definition.widthShrink&&(h.push({column:t,width:n>i?n:i}),d+=t.definition.widthShrink)):(l.push({column:t,width:0}),a+=t.definition.widthGrow||1))}),r=s-o,i=Math.floor(r/a),c=p(l,r,i,!1),l.length&&c>0&&(l[l.length-1].width+=c),l.forEach(function(t){r-=t.width}),(n=Math.abs(c)+r)>0&&d&&(c=p(h,n,Math.floor(n/d),!0)),c&&h.length&&(h[h.length-1].width-=c),l.forEach(function(t){t.column.setWidth(t.width)}),h.forEach(function(t){t.column.setWidth(t.width)})}};class we extends $t{static moduleName="layout";static modes=_e;constructor(t){super(t,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var t=this.table.options.layout;we.modes[t]?this.mode=t:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+t),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(t){t.definition.widthGrow&&(t.definition.widthGrow=Number(t.definition.widthGrow)),t.definition.widthShrink&&(t.definition.widthShrink=Number(t.definition.widthShrink))}getMode(){return this.mode}layout(t){var e=this.table.columnManager.columnsByIndex.find(t=>t.definition.variableHeight||"textarea"===t.definition.formatter);this.dispatch("layout-refreshing"),we.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,t),e&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var ye={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class Ce extends $t{static moduleName="localize";static langs=ye;constructor(t){super(t),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ut.deepClone(Ce.langs),!1!==this.table.options.columnDefaults.headerFilterPlaceholder&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let t in this.table.options.langs)this.installLang(t,this.table.options.langs[t]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(t){this.langList.default.headerFilters.default=t}installLang(t,e){this.langList[t]?this._setLangProp(this.langList[t],e):this.langList[t]=e}_setLangProp(t,e){for(let i in e)t[i]&&"object"==typeof t[i]?this._setLangProp(t[i],e[i]):t[i]=e[i]}setLocale(t){if(!0===(t=t||"default")&&navigator.language&&(t=navigator.language.toLowerCase()),t&&!this.langList[t]){let e=t.split("-")[0];this.langList[e]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",t,e),t=e):(console.warn("Localization Error - Matching locale not found, using default: ",t),t="default")}this.locale=t,this.lang=Ut.deepClone(this.langList.default||{}),"default"!=t&&function t(e,i){for(var n in e)"object"==typeof e[n]?(i[n]||(i[n]={}),t(e[n],i[n])):i[n]=e[n]}(this.langList[t],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(t){return this.locale}getLang(t){return t?this.langList[t]:this.lang}getText(t,e){var i=(e?t+"|"+e:t).split("|");return this._getLangElement(i,this.locale)||""}_getLangElement(t,e){var i=this.lang;return t.forEach(function(t){var e;i&&(e=i[t],i=void 0!==e&&e)}),i}bind(t,e){this.bindings[t]||(this.bindings[t]=[]),this.bindings[t].push(e),e(this.getText(t),this.lang)}_executeBindings(){for(let t in this.bindings)this.bindings[t].forEach(e=>{e(this.getText(t),this.lang)})}}var xe=Object.freeze({__proto__:null,CommsModule:class extends $t{static moduleName="comms";constructor(t){super(t)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(t){var e=[];return this.table.constructor.registry.lookupTable(t).forEach(t=>{this.table!==t&&e.push(t)}),e}send(t,e,i,n){var s=this.getConnections(t);s.forEach(t=>{t.tableComms(this.table.element,e,i,n)}),!s.length&&t&&console.warn("Table Connection Error - No tables matching selector found",t)}receive(t,e,i,n){if(this.table.modExists(e))return this.table.modules[e].commsReceived(t,i,n);console.warn("Inter-table Comms Error - no such module:",e)}},LayoutModule:we,LocalizeModule:Ce});class Ee{static registry={tables:[],register(t){Ee.registry.tables.push(t)},deregister(t){var e=Ee.registry.tables.indexOf(t);e>-1&&Ee.registry.tables.splice(e,1)},lookupTable(t,e){var i,n,s=[];if("string"==typeof t){if((i=document.querySelectorAll(t)).length)for(var o=0;o<i.length;o++)(n=Ee.registry.matchElement(i[o]))&&s.push(n)}else"undefined"!=typeof HTMLElement&&t instanceof HTMLElement||t instanceof Ee?(n=Ee.registry.matchElement(t))&&s.push(n):Array.isArray(t)?t.forEach(function(t){s=s.concat(Ee.registry.lookupTable(t))}):e||console.warn("Table Connection Error - Invalid Selector",t);return s},matchElement:t=>Ee.registry.tables.find(function(e){return t instanceof Ee?e===t:e.element===t})};static findTable(t){var e=Ee.registry.lookupTable(t,!0);return!(Array.isArray(e)&&!e.length)&&e}}class Se extends Ee{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(t){Se.modulesRegistered||(Se.modulesRegistered=!0,Se._registerModules(xe,!0),t&&Se._registerModules(t))}static _extendModule(t,e,i){if(Se.moduleBindings[t]){var n=Se.moduleBindings[t][e];if(n)if("object"==typeof i)for(let t in i)n[t]=i[t];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",e)}else console.warn("Module Error - module does not exist:",t)}static _registerModules(t,e){var i=Object.values(t);e&&i.forEach(t=>{t.prototype.moduleCore=!0}),Se._registerModule(i)}static _registerModule(t){Array.isArray(t)||(t=[t]),t.forEach(t=>{Se._registerModuleBinding(t),Se._registerModuleExtensions(t)})}static _registerModuleBinding(t){t.moduleName?Se.moduleBindings[t.moduleName]=t:console.error("Unable to bind module, no moduleName defined",t.moduleName)}static _registerModuleExtensions(t){var e=t.moduleExtensions;if(t.moduleExtensions)for(let t in e){let i=e[t];if(Se.moduleBindings[t])for(let e in i)Se._extendModule(t,e,i[e]);else{Se.moduleExtensions[t]||(Se.moduleExtensions[t]={});for(let e in i)Se.moduleExtensions[t][e]||(Se.moduleExtensions[t][e]={}),Object.assign(Se.moduleExtensions[t][e],i[e])}}Se._extendModuleFromQueue(t)}static _extendModuleFromQueue(t){var e=Se.moduleExtensions[t.moduleName];if(e)for(let i in e)Se._extendModule(t.moduleName,i,e[i])}_bindModules(){var t=[],e=[],i=[];for(var n in this.modules={},Se.moduleBindings){let s=Se.moduleBindings[n],o=new s(this);this.modules[n]=o,s.prototype.moduleCore?this.modulesCore.push(o):s.moduleInitOrder?s.moduleInitOrder<0?t.push(o):e.push(o):i.push(o)}t.sort((t,e)=>t.moduleInitOrder>e.moduleInitOrder?1:-1),e.sort((t,e)=>t.moduleInitOrder>e.moduleInitOrder?1:-1),this.modulesRegular=t.concat(i.concat(e))}}class Pe extends jt{constructor(t){super(t),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var t=document.createElement("div");return t.classList.add("tabulator-alert"),t}_createMsgElement(){var t=document.createElement("div");return t.classList.add("tabulator-alert-msg"),t.setAttribute("role","alert"),t}_typeClass(){return"tabulator-alert-state-"+this.type}alert(t,e="msg"){if(t){for(this.clear(),this.dispatch("alert-show",e),this.type=e;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),"function"==typeof t&&(t=t()),t instanceof HTMLElement?this.msgElement.appendChild(t):this.msgElement.innerHTML=t,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class ke extends Se{static defaultOptions=ee;static extendModule(){ke.initializeModuleBinder(),ke._extendModule(...arguments)}static registerModule(){ke.initializeModuleBinder(),ke._registerModule(...arguments)}constructor(t,e,i){super(),ke.initializeModuleBinder(i),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new ue(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new fe(this),this.optionsList=new ie(this,"table constructor"),this.dependencyRegistry=new ve(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(t)&&(this.initializeCoreSystems(e),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(t){return"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?(this.element=t,!0):"string"==typeof t?(this.element=document.querySelector(t),!!this.element||(console.error("Tabulator Creation Error - no element found matching selector: ",t),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",t),!1)}initializeCoreSystems(t){this.columnManager=new re(this),this.rowManager=new he(this),this.footerManager=new de(this),this.dataLoader=new pe(this),this.alertManager=new Pe(this),this._bindModules(),this.options=this.optionsList.generate(ke.defaultOptions,t),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new me(this,this.options,this.options.debugEventsExternal),this.eventBus=new ge(this.options.debugEventsInternal),this.interactionMonitor=new ce(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var t=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==t.direction)break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var t,e=this.element,i=this.options;if("TABLE"===e.tagName){this.originalElement=this.element,t=document.createElement("div");var n=e.attributes;for(var s in n)"object"==typeof n[s]&&t.setAttribute(n[s].name,n[s].value);e.parentNode.replaceChild(t,e),this.element=e=t}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),!1!==i.minHeight&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),!1!==i.maxHeight&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var t=this.element,e=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(t=>{t.initialize()}),t.appendChild(this.columnManager.getElement()),t.appendChild(this.rowManager.getElement()),e.footerElement&&this.footerManager.activate(),e.autoColumns&&e.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(t=>{t.initialize()}),this.columnManager.setColumns(e.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var t=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();t.firstChild;)t.removeChild(t.firstChild);t.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var t=navigator.userAgent||navigator.vendor||window.opera;t.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):t.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):t.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):t.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.slice(0,4))}initGuard(t,e){var i,n;return this.options.debugInitialization&&!this.initialized&&(t||(t=" "==(n="Error"==(i=(new Error).stack.split("\n"))[0]?i[2]:i[1])[0]?n.trim().split(" ")[1].split(".")[1]:n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+t+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(e?" "+e:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(t,e,i){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(t,e,i,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(t){return this.rowManager.getData(t)}getDataCount(t){return this.rowManager.getDataCount(t)}replaceData(t,e,i){return this.initGuard(),this.dataLoader.load(t,e,i,!0,!0)}updateData(t){var e=0;return this.initGuard(),new Promise((i,n)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t&&t.length>0?t.forEach(t=>{var s=this.rowManager.findRow(t[this.options.index]);s?(e++,s.updateData(t).then(()=>{--e||i()}).catch(e=>{n("Update Error - Unable to update row",t,e)})):n("Update Error - Unable to find row",t)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(t,e,i){return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t?this.rowManager.addRows(t,e,i).then(t=>{var e=[];t.forEach(function(t){e.push(t.getComponent())}),n(e)}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}updateOrAddData(t){var e=[],i=0;return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t&&t.length>0?t.forEach(t=>{var s=this.rowManager.findRow(t[this.options.index]);i++,s?s.updateData(t).then(()=>{i--,e.push(s.getComponent()),i||n(e)}):this.rowManager.addRows(t).then(t=>{i--,e.push(t[0].getComponent()),i||n(e)})}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}getRow(t){var e=this.rowManager.findRow(t);return e?e.getComponent():(console.warn("Find Error - No matching row found:",t),!1)}getRowFromPosition(t){var e=this.rowManager.getRowFromPosition(t);return e?e.getComponent():(console.warn("Find Error - No matching row found:",t),!1)}deleteRow(t){var e=[];this.initGuard(),Array.isArray(t)||(t=[t]);for(let i of t){let t=this.rowManager.findRow(i,!0);if(!t)return console.error("Delete Error - No matching row found:",i),Promise.reject("Delete Error - No matching row found");e.push(t)}return e.sort((t,e)=>this.rowManager.rows.indexOf(t)>this.rowManager.rows.indexOf(e)?1:-1),e.forEach(t=>{t.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(t,e,i){return this.initGuard(),"string"==typeof t&&(t=JSON.parse(t)),this.rowManager.addRows(t,e,i,!0).then(t=>t[0].getComponent())}updateOrAddRow(t,e){var i=this.rowManager.findRow(t);return this.initGuard(),"string"==typeof e&&(e=JSON.parse(e)),i?i.updateData(e).then(()=>i.getComponent()):this.rowManager.addRows(e).then(t=>t[0].getComponent())}updateRow(t,e){var i=this.rowManager.findRow(t);return this.initGuard(),"string"==typeof e&&(e=JSON.parse(e)),i?i.updateData(e).then(()=>Promise.resolve(i.getComponent())):(console.warn("Update Error - No matching row found:",t),Promise.reject("Update Error - No matching row found"))}scrollToRow(t,e,i){var n=this.rowManager.findRow(t);return n?this.rowManager.scrollToRow(n,e,i):(console.warn("Scroll Error - No matching row found:",t),Promise.reject("Scroll Error - No matching row found"))}moveRow(t,e,i){var n=this.rowManager.findRow(t);this.initGuard(),n?n.moveToRow(e,i):console.warn("Move Error - No matching row found:",t)}getRows(t){return this.rowManager.getComponents(t)}getRowPosition(t){var e=this.rowManager.findRow(t);return e?e.getPosition():(console.warn("Position Error - No matching row found:",t),!1)}setColumns(t){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(t)}getColumns(t){return this.columnManager.getComponents(t)}getColumn(t){var e=this.columnManager.findColumn(t);return e?e.getComponent():(console.warn("Find Error - No matching column found:",t),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Show Error - No matching column found:",t),!1;e.show()}hideColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Hide Error - No matching column found:",t),!1;e.hide()}toggleColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Visibility Toggle Error - No matching column found:",t),!1;e.visible?e.hide():e.show()}addColumn(t,e,i){var n=this.columnManager.findColumn(i);return this.initGuard(),this.columnManager.addColumn(t,e,n).then(t=>t.getComponent())}deleteColumn(t){var e=this.columnManager.findColumn(t);return this.initGuard(),e?e.delete():(console.warn("Column Delete Error - No matching column found:",t),Promise.reject())}updateColumnDefinition(t,e){var i=this.columnManager.findColumn(t);return this.initGuard(),i?i.updateDefinition(e):(console.warn("Column Update Error - No matching column found:",t),Promise.reject())}moveColumn(t,e,i){var n=this.columnManager.findColumn(t),s=this.columnManager.findColumn(e);this.initGuard(),n?s?this.columnManager.moveColumn(n,s,i):console.warn("Move Error - No matching column found:",s):console.warn("Move Error - No matching column found:",t)}scrollToColumn(t,e,i){return new Promise((n,s)=>{var o=this.columnManager.findColumn(t);return o?this.columnManager.scrollToColumn(o,e,i):(console.warn("Scroll Error - No matching column found:",t),Promise.reject("Scroll Error - No matching column found"))})}redraw(t){this.initGuard(),this.columnManager.redraw(t),this.rowManager.redraw(t)}setHeight(t){this.options.height=isNaN(t)?t:t+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(t,e){this.externalEvents.subscribe(t,e)}off(t,e){this.externalEvents.unsubscribe(t,e)}dispatchEvent(){Array.from(arguments).shift(),this.externalEvents.dispatch(...arguments)}alert(t,e){this.initGuard(),this.alertManager.alert(t,e)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(t,e){return!!this.modules[t]||(e&&console.error("Tabulator Module Not Installed: "+t),!1)}module(t){var e=this.modules[t];return e||console.error("Tabulator module not installed: "+t),e}}var Ie=ke;let Re=null;function Me(t){Ot("TRACE","[sidebar] colorSwatchCell entry",{color:t});const e=`<div style="background:${(t&&"function"==typeof t?t():t)||"transparent"};border:1px solid #bbb;width:20px;height:20px;display:inline-block;border-radius:4px;"></div>`;return Ot("TRACE","[sidebar] colorSwatchCell exit",{html:e}),e}const Le=Math.PI/180,Te="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},Ae={_global:Te,version:"10.0.2",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>Ae.angleDeg?t*Le:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>Ae.DD.isDragging,isTransforming(){var t,e;return null!==(e=null===(t=Ae.Transformer)||void 0===t?void 0:t.isTransforming())&&void 0!==e&&e},isDragReady:()=>!!Ae.DD.node,releaseCanvasOnDestroy:!0,document:Te.document,_injectGlobal(t){void 0!==Te.Konva&&console.error("Severa Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),Te.Konva=t}},De=t=>{Ae[t.prototype.getClassName()]=t};Ae._injectGlobal(Ae);const ze=()=>{if("undefined"==typeof document)throw new Error('Konva.js unsupported environment.\n\nLooks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.\n\nTo use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.\n\nbash: npm install canvas\njs: import "konva/canvas-backend";\n\nor\n\nbash: npm install skia-canvas\njs: import "konva/skia-backend";\n')};class Oe{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new Oe(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){const e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,s=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,r=this.m[1]*-i+this.m[3]*e;return this.m[0]=n,this.m[1]=s,this.m[2]=o,this.m[3]=r,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){const i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,s=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=i,this.m[1]=n,this.m[2]=s,this.m[3]=o,this}multiply(t){const e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],s=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,s=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r,this}getMatrix(){return this.m}decompose(){const t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],s=t*n-e*i,o={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){const r=Math.sqrt(t*t+e*e);o.rotation=e>0?Math.acos(t/r):-Math.acos(t/r),o.scaleX=r,o.scaleY=s/r,o.skewX=(t*i+e*n)/s,o.skewY=0}else if(0!=i||0!=n){const r=Math.sqrt(i*i+n*n);o.rotation=Math.PI/2-(n>0?Math.acos(-i/r):-Math.acos(i/r)),o.scaleX=s/r,o.scaleY=r,o.skewX=0,o.skewY=(t*i+e*n)/s}return o.rotation=je._getRotation(o.rotation),o}}const Be=Math.PI/180,He=180/Math.PI,Ne="Konva error: ",Ve={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},Fe=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let Ge=[];const We="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},je={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;const e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){Ge.push(t),1===Ge.length&&We(function(){const t=Ge;Ge=[],t.forEach(function(t){t()})})},createCanvasElement(){ze();const t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>(ze(),document.createElement("img")),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){const i=je.createImageElement();i.onload=function(){e(i)},i.src=t},_rgbToHex:(t,e,i)=>((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){let t=(16777215*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return"#"+t},getRGB(t){let e;return t in Ve?(e=Ve[t],{r:e[0],g:e[1],b:e[2]}):"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=Fe.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",je._namedColorToRBA(t)||je._hex3ColorToRGBA(t)||je._hex4ColorToRGBA(t)||je._hex6ColorToRGBA(t)||je._hex8ColorToRGBA(t)||je._rgbColorToRGBA(t)||je._rgbaColorToRGBA(t)||je._hslColorToRGBA(t)),_namedColorToRBA(t){const e=Ve[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){const e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){const e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...i]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),n=Number(i[0])/360,s=Number(i[1])/100,o=Number(i[2])/100;let r,a,l;if(0===s)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};r=o<.5?o*(1+s):o+s-o*s;const h=2*o-r,d=[0,0,0];for(let t=0;t<3;t++)a=n+1/3*-(t-1),a<0&&a++,a>1&&a--,l=6*a<1?h+6*(r-h)*a:2*a<1?r:3*a<2?h+(r-h)*(2/3-a)*6:h,d[t]=255*l;return{r:Math.round(d[0]),g:Math.round(d[1]),b:Math.round(d[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){const e={};for(const i in t)this._isPlainObject(t[i])?e[i]=this.cloneObject(t[i]):this._isArray(t[i])?e[i]=this.cloneArray(t[i]):e[i]=t[i];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*Be,radToDeg:t=>t*He,_degToRad:t=>(je.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),je.degToRad(t)),_radToDeg:t=>(je.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),je.radToDeg(t)),_getRotation:t=>Ae.angleDeg?je.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(Ne+t)},error(t){console.error(Ne+t)},warn(t){Ae.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(const i in t)e(i,t[i])},_inRange:(t,e,i)=>e<=t&&t<i,_getProjectionToSegment(t,e,i,n,s,o){let r,a,l;const h=(t-i)*(t-i)+(e-n)*(e-n);if(0==h)r=t,a=e,l=(s-i)*(s-i)+(o-n)*(o-n);else{const d=((s-t)*(i-t)+(o-e)*(n-e))/h;d<0?(r=t,a=e,l=(t-s)*(t-s)+(e-o)*(e-o)):d>1?(r=i,a=n,l=(i-s)*(i-s)+(n-o)*(n-o)):(r=t+d*(i-t),a=e+d*(n-e),l=(r-s)*(r-s)+(a-o)*(a-o))}return[r,a,l]},_getProjectionToLine(t,e,i){const n=je.cloneObject(t);let s=Number.MAX_VALUE;return e.forEach(function(o,r){if(!i&&r===e.length-1)return;const a=e[(r+1)%e.length],l=je._getProjectionToSegment(o.x,o.y,a.x,a.y,t.x,t.y),h=l[0],d=l[1],c=l[2];c<s&&(n.x=h,n.y=d,s=c)}),n},_prepareArrayForTween(t,e,i){const n=[],s=[];if(t.length>e.length){const i=e;e=t,t=i}for(let e=0;e<t.length;e+=2)n.push({x:t[e],y:t[e+1]});for(let t=0;t<e.length;t+=2)s.push({x:e[t],y:e[t+1]});const o=[];return s.forEach(function(t){const e=je._getProjectionToLine(t,n,i);o.push(e.x),o.push(e.y)}),o},_prepareToStringify(t){let e;t.visitedByCircularReferenceRemoval=!0;for(const i in t)if(t.hasOwnProperty(i)&&t[i]&&"object"==typeof t[i])if(e=Object.getOwnPropertyDescriptor(t,i),t[i].visitedByCircularReferenceRemoval||je._isElement(t[i])){if(!e.configurable)return null;delete t[i]}else if(null===je._prepareToStringify(t[i])){if(!e.configurable)return null;delete t[i]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(const i in e)t[i]=e[i];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){Ae.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,i,n){let s=e<0?e:0,o=i<0?i:0;e=Math.abs(e),i=Math.abs(i);let r=0,a=0,l=0,h=0;"number"==typeof n?r=a=l=h=Math.min(n,e/2,i/2):(r=Math.min(n[0]||0,e/2,i/2),a=Math.min(n[1]||0,e/2,i/2),h=Math.min(n[2]||0,e/2,i/2),l=Math.min(n[3]||0,e/2,i/2)),t.moveTo(s+r,o),t.lineTo(s+e-a,o),t.arc(s+e-a,o+a,a,3*Math.PI/2,0,!1),t.lineTo(s+e,o+i-h),t.arc(s+e-h,o+i-h,h,0,Math.PI/2,!1),t.lineTo(s+l,o+i),t.arc(s+l,o+i-l,l,Math.PI/2,Math.PI,!1),t.lineTo(s,o+r),t.arc(s+r,o+r,r,Math.PI,3*Math.PI/2,!1)},drawRoundedPolygonPath(t,e,i,n,s){n=Math.abs(n);for(let o=0;o<i;o++){const r=e[(o-1+i)%i],a=e[o],l=e[(o+1)%i],h={x:a.x-r.x,y:a.y-r.y},d={x:l.x-a.x,y:l.y-a.y},c=Math.hypot(h.x,h.y),u=Math.hypot(d.x,d.y);let p;p="number"==typeof s?s:o<s.length?s[o]:0,p=n*Math.cos(Math.PI/i)*Math.min(1,p/n*2);const m={x:h.x/c,y:h.y/c},g={x:d.x/u,y:d.y/u},f={x:a.x-m.x*p,y:a.y-m.y*p},v={x:a.x+g.x*p,y:a.y+g.y*p};0===o?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y),t.arcTo(a.x,a.y,v.x,v.y,p)}}},Ue=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let qe,$e=null;function Ke(){if(null!==$e)return $e;try{const t=je.createCanvasElement().getContext("2d");return t?!!t&&"filter"in t:($e=!1,!1)}catch(t){return $e=!1,!1}}class Xe{constructor(t){this.canvas=t,Ae.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){let i,n,s,o,r=this.traceArr,a=r.length,l="";for(i=0;i<a;i++)n=r[i],s=n.method,s?(o=n.args,l+=s,t?l+="()":je._isArray(o[0])?l+="(["+o.join(",")+"])":(e&&(o=o.map(t=>"number"==typeof t?Math.floor(t):t)),l+="("+o.join(",")+")")):(l+=n.property,t||(l+="="+n.val)),l+=";";return l}clearTrace(){this.traceArr=[]}_trace(t){let e,i=this.traceArr;i.push(t),e=i.length,e>=100&&i.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){const e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}_applyMiterLimit(t){const e=t.attrs.miterLimit;null!=e&&this.setAttr("miterLimit",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,n,s,o){this._context.arc(t,e,i,n,s,o)}arcTo(t,e,i,n,s){this._context.arcTo(t,e,i,n,s)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,n,s,o){this._context.bezierCurveTo(t,e,i,n,s,o)}clearRect(t,e,i,n){this._context.clearRect(t,e,i,n)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){const i=arguments;return 2===i.length?this._context.createImageData(t,e):1===i.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,i,n){return this._context.createLinearGradient(t,e,i,n)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,n,s,o){return this._context.createRadialGradient(t,e,i,n,s,o)}drawImage(t,e,i,n,s,o,r,a,l){const h=arguments,d=this._context;3===h.length?d.drawImage(t,e,i):5===h.length?d.drawImage(t,e,i,n,s):9===h.length&&d.drawImage(t,e,i,n,s,o,r,a,l)}ellipse(t,e,i,n,s,o,r,a){this._context.ellipse(t,e,i,n,s,o,r,a)}isPointInPath(t,e,i,n){return i?this._context.isPointInPath(i,t,e,n):this._context.isPointInPath(t,e,n)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,i,n){this._context.fillRect(t,e,i,n)}strokeRect(t,e,i,n){this._context.strokeRect(t,e,i,n)}fillText(t,e,i,n){n?this._context.fillText(t,e,i,n):this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,n){return this._context.getImageData(t,e,i,n)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,n){this._context.rect(t,e,i,n)}roundRect(t,e,i,n,s){this._context.roundRect(t,e,i,n,s)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,n){this._context.quadraticCurveTo(t,e,i,n)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,n,s,o){this._context.setTransform(t,e,i,n,s,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,i,n){this._context.strokeText(t,e,i,n)}transform(t,e,i,n,s,o){this._context.transform(t,e,i,n,s,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let t,e,i=this,n=Ue.length,s=this.setAttr;const o=function(t){let n,s=i[t];i[t]=function(){return e=function(t){const e=[],i=t.length,n=je;for(let s=0;s<i;s++){let i=t[s];n._isNumber(i)?i=Math.round(1e3*i)/1e3:n._isString(i)||(i+=""),e.push(i)}return e}(Array.prototype.slice.call(arguments,0)),n=s.apply(i,arguments),i._trace({method:t,args:e}),n}};for(t=0;t<n;t++)o(Ue[t]);i.setAttr=function(){s.apply(i,arguments);const t=arguments[0];let e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),i._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"].forEach(function(t){Object.defineProperty(Xe.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class Ye extends Xe{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){const e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),i=t.getFillPriority();if(e&&"color"===i)return void this._fillColor(t);const n=t.getFillPatternImage();if(n&&"pattern"===i)return void this._fillPattern(t);const s=t.getFillLinearGradientColorStops();if(s&&"linear-gradient"===i)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===i?this._fillRadialGradient(t):e?this._fillColor(t):n?this._fillPattern(t):s?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(let t=0;t<n.length;t+=2)s.addColorStop(n[t],n[t+1]);this.setAttr("strokeStyle",s)}}_stroke(t){const e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}}_applyShadow(t){var e,i,n;const s=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(i=t.getShadowBlur())&&void 0!==i?i:5,r=null!==(n=t.getShadowOffset())&&void 0!==n?n:{x:0,y:0},a=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),h=a.x*l,d=a.y*l;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",o*Math.min(Math.abs(h),Math.abs(d))),this.setAttr("shadowOffsetX",r.x*h),this.setAttr("shadowOffsetY",r.y*d)}}class Ze extends Xe{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const e=t.getStrokeScaleEnabled();if(!e){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t);const i=t.hitStrokeWidth(),n="auto"===i?t.strokeWidth():i;this.setAttr("lineWidth",n),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}class Je{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const e=(t||{}).pixelRatio||Ae.pixelRatio||function(){if(qe)return qe;const t=je.createCanvasElement(),e=t.getContext("2d");return qe=(Ae._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),je.releaseCanvas(t),qe}();this.pixelRatio=e,this._canvas=je.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return je.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class Qe extends Je{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new Ye(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}function ti(){const t=je.createCanvasElement();t.width=1,t.height=1;const e=t.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,1,1),e.fillStyle="rgba(255,0,255,1)",e.fillRect(0,0,1,1);const i=e.getImageData(0,0,1,1).data;return!(255===i[0]&&0===i[1]&&255===i[2]&&255===i[3])}function ei(){var t,e;return"undefined"!=typeof navigator&&null!==(e=null===(t=navigator.brave)||void 0===t?void 0:t.isBrave())&&void 0!==e&&e}let ii=!1;class ni extends Je{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new Ze(this),this.setSize(t.width,t.height),ei()&&ti()&&!ii&&(ii=!0,je.error('Looks like you have "Brave shield" enabled in your browser. It breaks KonvaJS internals. Please disable it. You may need to ask your users to do the same.')),ei()&&ti()}}const si={get isDragging(){let t=!1;return si._dragElements.forEach(e=>{"dragging"===e.dragStatus&&(t=!0)}),t},justDragged:!1,get node(){let t;return si._dragElements.forEach(e=>{t=e.node}),t},_dragElements:new Map,_drag(t){const e=[];si._dragElements.forEach((i,n)=>{const{node:s}=i,o=s.getStage();o.setPointersPositions(t),void 0===i.pointerId&&(i.pointerId=je._getFirstPointerId(t));const r=o._changedPointerPositions.find(t=>t.id===i.pointerId);if(r){if("dragging"!==i.dragStatus){const e=s.dragDistance();if(Math.max(Math.abs(r.x-i.startPointerPos.x),Math.abs(r.y-i.startPointerPos.y))<e)return;if(s.startDrag({evt:t}),!s.isDragging())return}s._setDragPosition(t,i),e.push(s)}}),e.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)})},_endDragBefore(t){const e=[];si._dragElements.forEach(i=>{const{node:n}=i,s=n.getStage();if(t&&s.setPointersPositions(t),!s._changedPointerPositions.find(t=>t.id===i.pointerId))return;"dragging"!==i.dragStatus&&"stopped"!==i.dragStatus||(si.justDragged=!0,Ae._mouseListenClick=!1,Ae._touchListenClick=!1,Ae._pointerListenClick=!1,i.dragStatus="stopped");const o=i.node.getLayer()||i.node instanceof Ae.Stage&&i.node;o&&-1===e.indexOf(o)&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(t){si._dragElements.forEach((e,i)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&si._dragElements.delete(i)})}};function oi(t){return je._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||je._isBoolean(t)?t:Object.prototype.toString.call(t)}function ri(t){return t>255?255:t<0?0:Math.round(t)}function ai(){if(Ae.isUnminified)return function(t,e){return je._isNumber(t)||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function li(t){if(Ae.isUnminified)return function(e,i){let n=je._isNumber(e),s=je._isArray(e)&&e.length==t;return n||s||je.warn(oi(e)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function hi(){if(Ae.isUnminified)return function(t,e){return je._isNumber(t)||"auto"===t||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function di(){if(Ae.isUnminified)return function(t,e){return je._isString(t)||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function ci(){if(Ae.isUnminified)return function(t,e){const i=je._isString(t),n="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return i||n||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function ui(){if(Ae.isUnminified)return function(t,e){return!0===t||!1===t||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}Ae.isBrowser&&(window.addEventListener("mouseup",si._endDragBefore,!0),window.addEventListener("touchend",si._endDragBefore,!0),window.addEventListener("touchcancel",si._endDragBefore,!0),window.addEventListener("mousemove",si._drag),window.addEventListener("touchmove",si._drag),window.addEventListener("mouseup",si._endDragAfter,!1),window.addEventListener("touchend",si._endDragAfter,!1),window.addEventListener("touchcancel",si._endDragAfter,!1));const pi="get",mi="set",gi={addGetterSetter(t,e,i,n,s){gi.addGetter(t,e,i),gi.addSetter(t,e,n,s),gi.addOverloadedGetterSetter(t,e)},addGetter(t,e,i){const n=pi+je._capitalize(e);t.prototype[n]=t.prototype[n]||function(){const t=this.attrs[e];return void 0===t?i:t}},addSetter(t,e,i,n){const s=mi+je._capitalize(e);t.prototype[s]||gi.overWriteSetter(t,e,i,n)},overWriteSetter(t,e,i,n){const s=mi+je._capitalize(e);t.prototype[s]=function(t){return i&&null!=t&&(t=i.call(this,t,e)),this._setAttr(e,t),n&&n.call(this),this}},addComponentsGetterSetter(t,e,i,n,s){const o=i.length,r=je._capitalize,a=pi+r(e),l=mi+r(e);t.prototype[a]=function(){const t={};for(let n=0;n<o;n++){const s=i[n];t[s]=this.getAttr(e+r(s))}return t};const h=function(t){if(Ae.isUnminified)return function(e,i){return null==e||je.isObject(e)||je.warn(oi(e)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+t),e}}(i);t.prototype[l]=function(t){const o=this.attrs[e];n&&(t=n.call(this,t,e)),h&&h.call(this,t,e);for(const i in t)t.hasOwnProperty(i)&&this._setAttr(e+r(i),t[i]);return t||i.forEach(t=>{this._setAttr(e+r(t),void 0)}),this._fireChangeEvent(e,o,t),s&&s.call(this),this},gi.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){const i=je._capitalize(e),n=mi+i,s=pi+i;t.prototype[e]=function(){return arguments.length?(this[n](arguments[0]),this):this[s]()}},addDeprecatedGetterSetter(t,e,i,n){je.error("Adding deprecated "+e);const s=pi+je._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[s]=function(){je.error(o);const t=this.attrs[e];return void 0===t?i:t},gi.addSetter(t,e,n,function(){je.error(o)}),gi.addOverloadedGetterSetter(t,e)},backCompat(t,e){je.each(e,function(e,i){const n=t.prototype[i],s=pi+je._capitalize(e),o=mi+je._capitalize(e);function r(){n.apply(this,arguments),je.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+i+'" instead.')}t.prototype[e]=r,t.prototype[s]=r,t.prototype[o]=r})},afterSetFilter(){this._filterUpToDate=!1}};function fi(t){const e=/(\w+)\(([^)]+)\)/g;let i;for(;null!==(i=e.exec(t));){const[,t,e]=i;switch(t){case"blur":{const t=parseFloat(e.replace("px",""));return function(e){this.blurRadius(.5*t);const i=Ae.Filters;i&&i.Blur&&i.Blur.call(this,e)}}case"brightness":{const t=e.includes("%")?parseFloat(e)/100:parseFloat(e);return function(e){this.brightness(t);const i=Ae.Filters;i&&i.Brightness&&i.Brightness.call(this,e)}}case"contrast":{const t=parseFloat(e);return function(e){const i=100*(Math.sqrt(t)-1);this.contrast(i);const n=Ae.Filters;n&&n.Contrast&&n.Contrast.call(this,e)}}case"grayscale":return function(t){const e=Ae.Filters;e&&e.Grayscale&&e.Grayscale.call(this,t)};case"sepia":return function(t){const e=Ae.Filters;e&&e.Sepia&&e.Sepia.call(this,t)};case"invert":return function(t){const e=Ae.Filters;e&&e.Invert&&e.Invert.call(this,t)};default:je.warn(`CSS filter "${t}" is not supported in fallback mode. Consider using function filters for better compatibility.`)}}return()=>{}}const vi="absoluteOpacity",bi="allEventListeners",_i="absoluteTransform",wi="absoluteScale",yi="canvas",Ci="listening",xi="Shape",Ei=" ",Si="stage",Pi="transform",ki="visible",Ii=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ei);let Ri=1;class Mi{constructor(t){this._id=Ri++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==Pi&&t!==_i||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){let i=this._cache.get(t);return(void 0===i||(t===Pi||t===_i)&&!0===i.dirty)&&(i=e.call(this),this._cache.set(t,i)),i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){const i=e.map(t=>t+"Change.konva").join(Ei);this.on(i,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get(yi)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===_i&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(yi)){const{scene:t,filter:e,hit:i,buffer:n}=this._cache.get(yi);je.releaseCanvas(t,e,i,n),this._cache.delete(yi)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){const e=t||{};let i={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let n=Math.ceil(e.width||i.width),s=Math.ceil(e.height||i.height),o=e.pixelRatio,r=void 0===e.x?Math.floor(i.x):e.x,a=void 0===e.y?Math.floor(i.y):e.y,l=e.offset||0,h=e.drawBorder||!1,d=e.hitCanvasPixelRatio||1;if(!n||!s)return void je.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");n+=2*l+(Math.abs(Math.round(i.x)-r)>.5?1:0),s+=2*l+(Math.abs(Math.round(i.y)-a)>.5?1:0),r-=l,a-=l;const c=new Qe({pixelRatio:o,width:n,height:s}),u=new Qe({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),p=new ni({pixelRatio:d,width:n,height:s}),m=c.getContext(),g=p.getContext(),f=new Qe({width:c.width/c.pixelRatio+Math.abs(r),height:c.height/c.pixelRatio+Math.abs(a),pixelRatio:c.pixelRatio}),v=f.getContext();return p.isCache=!0,c.isCache=!0,this._cache.delete(yi),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(c.getContext()._context.imageSmoothingEnabled=!1,u.getContext()._context.imageSmoothingEnabled=!1),m.save(),g.save(),v.save(),m.translate(-r,-a),g.translate(-r,-a),v.translate(-r,-a),f.x=r,f.y=a,this._isUnderCache=!0,this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(wi),this.drawScene(c,this,f),this.drawHit(p,this),this._isUnderCache=!1,m.restore(),g.restore(),h&&(m.save(),m.beginPath(),m.rect(0,0,n,s),m.closePath(),m.setAttr("strokeStyle","red"),m.setAttr("lineWidth",5),m.stroke(),m.restore()),this._cache.set(yi,{scene:c,filter:u,hit:p,buffer:f,x:r,y:a}),this._requestDraw(),this}isCached(){return this._cache.has(yi)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){const i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let n=1/0,s=1/0,o=-1/0,r=-1/0;const a=this.getAbsoluteTransform(e);return i.forEach(function(t){const e=a.point(t);void 0===n&&(n=o=e.x,s=r=e.y),n=Math.min(n,e.x),s=Math.min(s,e.y),o=Math.max(o,e.x),r=Math.max(r,e.y)}),{x:n,y:s,width:o-n,height:r-s}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);const i=this._getCachedSceneCanvas(),n=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/n,i.height/n),t.restore()}_drawCachedHitCanvas(t){const e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t,e,i,n,s=this.filters(),o=this._getCanvasCache(),r=o.scene,a=o.filter,l=a.getContext();if(!s||0===s.length)return r;if(this._filterUpToDate)return a;let h=!0;for(let t=0;t<s.length;t++)if("string"==typeof s[t]&&Ke(),"string"!=typeof s[t]||!Ke()){h=!1;break}const d=r.pixelRatio;if(a.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio),h){const t=s.join(" ");return l.save(),l.setAttr("filter",t),l.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),l.restore(),this._filterUpToDate=!0,a}try{for(t=s.length,l.clear(),l.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),e=l.getImageData(0,0,a.getWidth(),a.getHeight()),i=0;i<t;i++)n=s[i],"string"==typeof n&&(n=fi(n)),n.call(this,e),l.putImageData(e,0,0)}catch(t){je.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,a}on(t,e){if(this._cache&&this._cache.delete(bi),3===arguments.length)return this._delegate.apply(this,arguments);const i=t.split(Ei);for(let t=0;t<i.length;t++){const n=i[t].split("."),s=n[0],o=n[1]||"";this.eventListeners[s]||(this.eventListeners[s]=[]),this.eventListeners[s].push({name:o,handler:e})}return this}off(t,e){let i,n,s,o,r,a,l=(t||"").split(Ei),h=l.length;if(this._cache&&this._cache.delete(bi),!t)for(n in this.eventListeners)this._off(n);for(i=0;i<h;i++)if(s=l[i],o=s.split("."),r=o[0],a=o[1],r)this.eventListeners[r]&&this._off(r,a,e);else for(n in this.eventListeners)this._off(n,a,e);return this}dispatchEvent(t){const e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){const n=this;this.on(t,function(t){const s=t.target.findAncestors(e,!0,n);for(let e=0;e<s.length;e++)(t=je.cloneObject(t)).currentTarget=s[e],i.call(s[e],t)})}remove(){return this.isDragging()&&this.stopDrag(),si._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(_i),this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(wi),this._clearSelfAndDescendantCache(Si),this._clearSelfAndDescendantCache(ki),this._clearSelfAndDescendantCache(Ci)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const e="get"+je._capitalize(t);return je._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];for(;t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,i;if(!t)return this;for(e in t)"children"!==e&&(i="set"+je._capitalize(e),je._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(Ci,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(ki,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);const i=this.getLayer();let n=!1;si._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===i)&&(n=!0)});const s=!e&&!Ae.hitOnDragEnabled&&(n||Ae.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t,e,i,n,s=this.getDepth(),o=this,r=0;const a=this.getStage();return"Stage"!==o.nodeType&&a&&function a(l){for(t=[],e=l.length,i=0;i<e;i++)n=l[i],r++,n.nodeType!==xi&&(t=t.concat(n.getChildren().slice())),n._id===o._id&&(i=e);t.length>0&&t[0].getDepth()<=s&&a(t)}(a.getChildren()),r}getDepth(){let t=0,e=this.parent;for(;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Pi),this._clearSelfAndDescendantCache(_i)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const e=t.getPointerPosition();if(!e)return null;const i=this.getAbsoluteTransform().copy();return i.invert(),i.point(e)}getAbsolutePosition(t){let e=!1,i=this.parent;for(;i;){if(i.isCached()){e=!0;break}i=i.parent}e&&!t&&(t=!0);const n=this.getAbsoluteTransform(t).getMatrix(),s=new Oe,o=this.offset();return s.m=n.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(t){const{x:e,y:i,...n}=this._clearTransform();this.attrs.x=e,this.attrs.y=i,this._clearCache(Pi);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(t.x,t.y),t={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(n),this.setPosition({x:t.x,y:t.y}),this._clearCache(Pi),this._clearSelfAndDescendantCache(_i),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let e=t.x,i=t.y,n=this.x(),s=this.y();return void 0!==e&&(n+=e),void 0!==i&&(s+=i),this.setPosition({x:n,y:s}),this}_eachAncestorReverse(t,e){let i,n,s=[],o=this.getParent();if(!e||e._id!==this._id){for(s.unshift(this);o&&(!e||o._id!==e._id);)s.unshift(o),o=o.parent;for(i=s.length,n=0;n<i;n++)t(s[n])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return je.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return je.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return je.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return je.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return je.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&je.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(vi,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t,e,i,n,s,o=this.getAttrs();const r={attrs:{},className:this.getClassName()};for(t in o)e=o[t],s=je.isObject(e)&&!je._isPlainObject(e)&&!je._isArray(e),s||(i="function"==typeof this[t]&&this[t],delete o[t],n=i?i.call(this):null,o[t]=e,n!==e&&(r.attrs[t]=e));return je._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){const n=[];e&&this._isMatch(t)&&n.push(this);let s=this.parent;for(;s;){if(s===i)return n;s._isMatch(t)&&n.push(s),s=s.parent}return n}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);let e,i,n=t.replace(/ /g,"").split(","),s=n.length;for(e=0;e<s;e++)if(i=n[e],je.isValidSelector(i)||(je.warn('Selector "'+i+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),je.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),je.warn("Konva is awesome, right?")),"#"===i.charAt(0)){if(this.id()===i.slice(1))return!0}else if("."===i.charAt(0)){if(this.hasName(i.slice(1)))return!0}else if(this.className===i||this.nodeType===i)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(Si,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,e={},i){return e.target=e.target||this,i?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(_i,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new Oe,this._eachAncestorReverse(function(t){const i=t.transformsEnabled();"all"===i?e.multiply(t.getTransform()):"position"===i&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())},t),e;{e=this._cache.get(_i)||new Oe,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();const t=this.transformsEnabled();if("all"===t)e.multiply(this.getTransform());else if("position"===t){const t=this.attrs.x||0,i=this.attrs.y||0,n=this.attrs.offsetX||0,s=this.attrs.offsetY||0;e.translate(t-n,i-s)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;for(;e;)e._isUnderCache&&(t=e),e=e.getParent();const i=this.getAbsoluteTransform(t).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Pi,this._getTransform)}_getTransform(){var t,e;const i=this._cache.get(Pi)||new Oe;i.reset();const n=this.x(),s=this.y(),o=Ae.getAngle(this.rotation()),r=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,a=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,l=this.attrs.skewX||0,h=this.attrs.skewY||0,d=this.attrs.offsetX||0,c=this.attrs.offsetY||0;return 0===n&&0===s||i.translate(n,s),0!==o&&i.rotate(o),0===l&&0===h||i.skew(l,h),1===r&&1===a||i.scale(r,a),0===d&&0===c||i.translate(-1*d,-1*c),i.dirty=!1,i}clone(t){let e,i,n,s,o,r=je.cloneObject(this.attrs);for(e in t)r[e]=t[e];const a=new this.constructor(r);for(e in this.eventListeners)for(i=this.eventListeners[e],n=i.length,s=0;s<n;s++)o=i[s],o.name.indexOf("konva")<0&&(a.eventListeners[e]||(a.eventListeners[e]=[]),a.eventListeners[e].push(o));return a}_toKonvaCanvas(t){t=t||{};const e=this.getClientRect(),i=this.getStage(),n=void 0!==t.x?t.x:Math.floor(e.x),s=void 0!==t.y?t.y:Math.floor(e.y),o=t.pixelRatio||1,r=new Qe({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:o}),a=r.getContext(),l=new Qe({width:r.width/r.pixelRatio+Math.abs(n),height:r.height/r.pixelRatio+Math.abs(s),pixelRatio:r.pixelRatio});return!1===t.imageSmoothingEnabled&&(a._context.imageSmoothingEnabled=!1),a.save(),(n||s)&&a.translate(-1*n,-1*s),this.drawScene(r,void 0,l),a.restore(),r}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){const e=(t=t||{}).mimeType||null,i=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,i);return t.callback&&t.callback(n),n}toImage(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,je._urlToImage(this.toDataURL(t),function(t){e(t),null==i||i(t)})}catch(t){i(t)}})}toBlob(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==i||i(t)},null==t?void 0:t.mimeType,null==t?void 0:t.quality)}catch(t){i(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Ae.dragDistance}_off(t,e,i){let n,s,o,r=this.eventListeners[t];for(n=0;n<r.length;n++)if(s=r[n].name,o=r[n].handler,!("konva"===s&&"konva"!==e||e&&s!==e||i&&i!==o)){if(r.splice(n,1),0===r.length){delete this.eventListeners[t];break}n--}}_fireChangeEvent(t,e,i){this._fire(t+"Change",{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){const e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){const e=(this.name()||"").split(/\s/g),i=e.indexOf(t);return-1!==i&&(e.splice(i,1),this.name(e.join(" "))),this}setAttr(t,e){const i=this["set"+je._capitalize(t)];return je._isFunction(i)?i.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(Ae.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){const i=this.attrs[t];(i!==e||je.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e),this._requestDraw())}_setComponentAttr(t,e,i){let n;void 0!==i&&(n=this.attrs[t],n||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=i,this._fireChangeEvent(t,n,i))}_fireAndBubble(t,e,i){e&&this.nodeType===xi&&(e.target=this);const n=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(-1===n.indexOf(t)||!(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||"Stage"===this.nodeType&&!i)){this._fire(t,e);const s=-1!==n.indexOf(t)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!s&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,i,n;const s=null!==(e=this._cache.get(bi))&&void 0!==e?e:{};let o=null==s?void 0:s[t];if(void 0===o){o=[];let e=Object.getPrototypeOf(this);for(;e;){const s=null!==(n=null===(i=e.eventListeners)||void 0===i?void 0:i[t])&&void 0!==n?n:[];o.push(...s),e=Object.getPrototypeOf(e)}s[t]=o,this._cache.set(bi,s)}return o}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const i=this._getProtoListeners(t);if(i)for(let t=0;t<i.length;t++)i[t].handler.call(this,e);const n=this.eventListeners[t];if(n)for(let t=0;t<n.length;t++)n[t].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const e=t?t.pointerId:void 0,i=this.getStage(),n=this.getAbsolutePosition();if(!i)return;const s=i._getPointerById(e)||i._changedPointerPositions[0]||n;si._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-n.x,y:s.y-n.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){si._dragElements.has(this._id)||this._createDragElement(t),si._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const i=this.getStage()._getPointerById(e.pointerId);if(!i)return;let n={x:i.x-e.offset.x,y:i.y-e.offset.y};const s=this.dragBoundFunc();if(void 0!==s){const e=s.call(this,n,t);e?n=e:je.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===n.x&&this._lastPos.y===n.y||(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}stopDrag(t){const e=si._dragElements.get(this._id);e&&(e.dragStatus="stopped"),si._endDragBefore(t),si._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=si._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(void 0===t.evt.button||Ae.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let e=!1;si._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(e=!0)}),e||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=si._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,i=t&&"ready"===t.dragStatus;e?this.stopDrag():i&&si._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return je.haveIntersection(i,this.getClientRect())}static create(t,e){return je._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){let i,n,s,o=Mi.prototype.getClassName.call(t),r=t.children;if(e&&(t.attrs.container=e),Ae[o]||(je.warn('Can not find a node with class name "'+o+'". Fallback to "Shape".'),o="Shape"),i=new(0,Ae[o])(t.attrs),r)for(n=r.length,s=0;s<n;s++)i.add(Mi._createNode(r[s]));return i}}Mi.prototype.nodeType="Node",Mi.prototype._attrsAffectingSize=[],Mi.prototype.eventListeners={},Mi.prototype.on.call(Mi.prototype,Ii,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(Pi),this._clearSelfAndDescendantCache(_i))}),Mi.prototype.on.call(Mi.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ki)}),Mi.prototype.on.call(Mi.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Ci)}),Mi.prototype.on.call(Mi.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(vi)});const Li=gi.addGetterSetter;Li(Mi,"zIndex"),Li(Mi,"absolutePosition"),Li(Mi,"position"),Li(Mi,"x",0,ai()),Li(Mi,"y",0,ai()),Li(Mi,"globalCompositeOperation","source-over",di()),Li(Mi,"opacity",1,ai()),Li(Mi,"name","",di()),Li(Mi,"id","",di()),Li(Mi,"rotation",0,ai()),gi.addComponentsGetterSetter(Mi,"scale",["x","y"]),Li(Mi,"scaleX",1,ai()),Li(Mi,"scaleY",1,ai()),gi.addComponentsGetterSetter(Mi,"skew",["x","y"]),Li(Mi,"skewX",0,ai()),Li(Mi,"skewY",0,ai()),gi.addComponentsGetterSetter(Mi,"offset",["x","y"]),Li(Mi,"offsetX",0,ai()),Li(Mi,"offsetY",0,ai()),Li(Mi,"dragDistance",void 0,ai()),Li(Mi,"width",0,ai()),Li(Mi,"height",0,ai()),Li(Mi,"listening",!0,ui()),Li(Mi,"preventDefault",!0,ui()),Li(Mi,"filters",void 0,function(t){return this._filterUpToDate=!1,t}),Li(Mi,"visible",!0,ui()),Li(Mi,"transformsEnabled","all",di()),Li(Mi,"size"),Li(Mi,"dragBoundFunc"),Li(Mi,"draggable",!1,ui()),gi.backCompat(Mi,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Ti extends Mi{constructor(){super(...arguments),this.children=[]}getChildren(t){const e=this.children||[];return t?e.filter(t):e}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(let e=0;e<t.length;e++)this.add(t[e]);return this}const e=t[0];return e.getParent()?(e.moveTo(this),this):(this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){const i=[];return this._descendants(n=>{const s=n._isMatch(t);return s&&i.push(n),!(!s||!e)}),i}_descendants(t){let e=!1;const i=this.getChildren();for(const n of i){if(e=t(n),e)return!0;if(n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1}toObject(){const t=Mi.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();for(;e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){const e=Mi.prototype.clone.call(this,t);return this.getChildren().forEach(function(t){e.add(t.clone())}),e}getAllIntersections(t){const e=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(t)&&e.push(i)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach(function(e){e._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach(function(t,e){t.index=e}),this._requestDraw()}drawScene(t,e,i){const n=this.getLayer(),s=t||n&&n.getCanvas(),o=s&&s.getContext(),r=this._getCanvasCache(),a=r&&r.scene,l=s&&s.isCache;if(!this.isVisible()&&!l)return this;if(a){o.save();const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",s,e,i);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;const i=this.getLayer(),n=t||i&&i.hitCanvas,s=n&&n.getContext(),o=this._getCanvasCache();if(o&&o.hit){s.save();const t=this.getAbsoluteTransform(e).getMatrix();s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",n,e);return this}_drawChildren(t,e,i,n){var s;const o=e&&e.getContext(),r=this.clipWidth(),a=this.clipHeight(),l=this.clipFunc(),h="number"==typeof r&&"number"==typeof a||l,d=i===this;if(h){o.save();const t=this.getAbsoluteTransform(i);let e,n=t.getMatrix();if(o.transform(n[0],n[1],n[2],n[3],n[4],n[5]),o.beginPath(),l)e=l.call(this,o,this);else{const t=this.clipX(),e=this.clipY();o.rect(t||0,e||0,r,a)}o.clip.apply(o,e),n=t.copy().invert().getMatrix(),o.transform(n[0],n[1],n[2],n[3],n[4],n[5])}const c=!d&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;c&&(o.save(),o._applyGlobalCompositeOperation(this)),null===(s=this.children)||void 0===s||s.forEach(function(s){s[t](e,i,n)}),c&&o.restore(),h&&o.restore()}getClientRect(t={}){var e;const i=t.skipTransform,n=t.relativeTo;let s,o,r,a,l={x:1/0,y:1/0,width:0,height:0};const h=this;null===(e=this.children)||void 0===e||e.forEach(function(e){if(!e.visible())return;const i=e.getClientRect({relativeTo:h,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===i.width&&0===i.height||(void 0===s?(s=i.x,o=i.y,r=i.x+i.width,a=i.y+i.height):(s=Math.min(s,i.x),o=Math.min(o,i.y),r=Math.max(r,i.x+i.width),a=Math.max(a,i.y+i.height)))});const d=this.find("Shape");let c=!1;for(let t=0;t<d.length;t++)if(d[t]._isVisible(this)){c=!0;break}return l=c&&void 0!==s?{x:s,y:o,width:r-s,height:a-o}:{x:0,y:0,width:0,height:0},i?l:this._transformedRect(l,n)}}gi.addComponentsGetterSetter(Ti,"clip",["x","y","width","height"]),gi.addGetterSetter(Ti,"clipX",void 0,ai()),gi.addGetterSetter(Ti,"clipY",void 0,ai()),gi.addGetterSetter(Ti,"clipWidth",void 0,ai()),gi.addGetterSetter(Ti,"clipHeight",void 0,ai()),gi.addGetterSetter(Ti,"clipFunc");const Ai=new Map,Di=void 0!==Ae._global.PointerEvent;function zi(t){return Ai.get(t)}function Oi(t){return{evt:t,pointerId:t.pointerId}}function Bi(t,e){return Ai.get(t)===e}function Hi(t,e){Ni(t),e.getStage()&&(Ai.set(t,e),Di&&e._fire("gotpointercapture",Oi(new PointerEvent("gotpointercapture"))))}function Ni(t,e){const i=Ai.get(t);if(!i)return;const n=i.getStage();n&&n.content,Ai.delete(t),Di&&i._fire("lostpointercapture",Oi(new PointerEvent("lostpointercapture")))}const Vi="mouseleave",Fi="mouseover",Gi="mouseenter",Wi="mousemove",ji="mousedown",Ui="mouseup",qi="pointermove",$i="pointerdown",Ki="pointerup",Xi="pointercancel",Yi="pointerout",Zi="pointerleave",Ji="pointerover",Qi="pointerenter",tn="contextmenu",en="touchstart",nn="touchend",sn="touchmove",on="touchcancel",rn="wheel",an=[[Gi,"_pointerenter"],[ji,"_pointerdown"],[Wi,"_pointermove"],[Ui,"_pointerup"],[Vi,"_pointerleave"],[en,"_pointerdown"],[sn,"_pointermove"],[nn,"_pointerup"],[on,"_pointercancel"],[Fi,"_pointerover"],[rn,"_wheel"],[tn,"_contextmenu"],[$i,"_pointerdown"],[qi,"_pointermove"],[Ki,"_pointerup"],[Xi,"_pointercancel"],[Zi,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],ln={mouse:{[Yi]:"mouseout",[Zi]:Vi,[Ji]:Fi,[Qi]:Gi,[qi]:Wi,[$i]:ji,[Ki]:Ui,[Xi]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[Yi]:"touchout",[Zi]:"touchleave",[Ji]:"touchover",[Qi]:"touchenter",[qi]:sn,[$i]:en,[Ki]:nn,[Xi]:on,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[Yi]:Yi,[Zi]:Zi,[Ji]:Ji,[Qi]:Qi,[qi]:qi,[$i]:$i,[Ki]:Ki,[Xi]:Xi,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},hn=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",dn=t=>{const e=hn(t);return"pointer"===e?Ae.pointerEventsEnabled&&ln.pointer:"touch"===e?ln.touch:"mouse"===e?ln.mouse:void 0};function cn(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&je.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const un=[];class pn extends Ti{constructor(t){super(cn(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),un.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{cn(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),i="FastLayer"===t.getType();e||i||je.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){let e;if("."===t.charAt(0)){const e=t.slice(1);t=document.getElementsByClassName(e)[0]}else e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e);if(!t)throw"Can not find container in document with id "+e}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const t=this.children,e=t.length;for(let i=0;i<e;i++)t[i].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),Ti.prototype.clone.call(this,t)}destroy(){super.destroy();const t=this.content;t&&je._isInDocument(t)&&this.container().removeChild(t);const e=un.indexOf(this);return e>-1&&un.splice(e,1),je.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(je.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t={...t}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();const e=new Qe({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),i=e.getContext()._context,n=this.children;return(t.x||t.y)&&i.translate(-1*t.x,-1*t.y),n.forEach(function(e){if(!e.isVisible())return;const n=e._toKonvaCanvas(t);i.drawImage(n._canvas,t.x,t.y,n.getWidth()/n.getPixelRatio(),n.getHeight()/n.getPixelRatio())}),e}getIntersection(t){if(!t)return null;const e=this.children;for(let i=e.length-1;i>=0;i--){const n=e[i].getIntersection(t);if(n)return n}return null}_resizeDOM(){const t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(i=>{i.setSize({width:t,height:e}),i.draw()})}add(t,...e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}super.add(t);const i=this.children.length;return i>5&&je.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),Ae.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return Bi(t,this)}setPointerCapture(t){Hi(t,this)}releaseCapture(t){Ni(t)}getLayers(){return this.children}_bindContentEvents(){Ae.isBrowser&&an.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=dn(t.type);e&&this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=dn(t.type);e&&this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);const n=this._getTargetShape(i),s=!(Ae.isDragging()||Ae.isTransforming())||Ae.hitOnDragEnabled;n&&s?(n._fireAndBubble(e.pointerout,{evt:t}),n._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null):s&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);let n=!1;this._changedPointerPositions.forEach(s=>{const o=this.getIntersection(s);if(si.justDragged=!1,Ae["_"+i+"ListenClick"]=!0,!o||!o.isListening())return void(this[i+"ClickStartShape"]=void 0);Ae.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[i+"ClickStartShape"]=o,o._fireAndBubble(e.pointerdown,{evt:t,pointerId:s.id}),n=!0;const r=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&r&&t.preventDefault()}),n||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){const e=dn(t.type),i=hn(t.type);if(!e)return;const n=t.type.indexOf("touch")>=0||"touch"===t.pointerType;if(Ae.isDragging()&&si.node.preventDefault()&&t.cancelable&&n&&t.preventDefault(),this.setPointersPositions(t),(Ae.isDragging()||Ae.isTransforming())&&!Ae.hitOnDragEnabled)return;const s={};let o=!1;const r=this._getTargetShape(i);this._changedPointerPositions.forEach(n=>{const a=zi(n.id)||this.getIntersection(n),l=n.id,h={evt:t,pointerId:l},d=r!==a;if(d&&r&&(r._fireAndBubble(e.pointerout,{...h},a),r._fireAndBubble(e.pointerleave,{...h},a)),a){if(s[a._id])return;s[a._id]=!0}a&&a.isListening()?(o=!0,d&&(a._fireAndBubble(e.pointerover,{...h},r),a._fireAndBubble(e.pointerenter,{...h},r),this[i+"targetShape"]=a),a._fireAndBubble(e.pointermove,{...h})):r&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[i+"targetShape"]=null)}),o||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);const n=this[i+"ClickStartShape"],s=this[i+"ClickEndShape"],o={};let r=!1;this._changedPointerPositions.forEach(a=>{const l=zi(a.id)||this.getIntersection(a);if(l){if(l.releaseCapture(a.id),o[l._id])return;o[l._id]=!0}const h=a.id,d={evt:t,pointerId:h};let c=!1;Ae["_"+i+"InDblClickWindow"]?(c=!0,clearTimeout(this[i+"DblTimeout"])):si.justDragged||(Ae["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){Ae["_"+i+"InDblClickWindow"]=!1},Ae.dblClickWindow),l&&l.isListening()?(r=!0,this[i+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,{...d}),Ae["_"+i+"ListenClick"]&&n&&n===l&&(l._fireAndBubble(e.pointerclick,{...d}),c&&s&&s===l&&l._fireAndBubble(e.pointerdblclick,{...d}))):(this[i+"ClickEndShape"]=null,r||(this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r=!0),Ae["_"+i+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:h}),c&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:h}))}),r||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Ae["_"+i+"ListenClick"]=!1,t.cancelable&&"touch"!==i&&"pointer"!==i&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(tn,{evt:t}):this._fire(tn,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(rn,{evt:t}):this._fire(rn,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=zi(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(Ki,Oi(t)),Ni(t.pointerId)}_lostpointercapture(t){Ni(t.pointerId)}setPointersPositions(t){const e=this._getContentPosition();let i=null,n=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})):(i=(t.clientX-e.left)/e.scaleX,n=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:i,y:n},this._pointerPositions=[{x:i,y:n,id:je._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:n,id:je._getFirstPointerId(t)}])}_setPointerPosition(t){je.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new Qe({width:this.width(),height:this.height()}),this.bufferHitCanvas=new ni({pixelRatio:1,width:this.width(),height:this.height()}),!Ae.isBrowser)return;const t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return je.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}pn.prototype.nodeType="Stage",De(pn),gi.addGetterSetter(pn,"container"),Ae.isBrowser&&document.addEventListener("visibilitychange",()=>{un.forEach(t=>{t.batchDraw()})});const mn="hasShadow",gn="shadowRGBA",fn="patternImage",vn="linearGradient",bn="radialGradient";let _n;function wn(){return _n||(_n=je.createCanvasElement().getContext("2d"),_n)}const yn={};class Cn extends Mi{constructor(t){let e;for(super(t);e=je.getRandomColor(),!e||e in yn;);this.colorKey=e,yn[e]=this}getContext(){return je.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return je.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(mn,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(fn,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=wn().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new Oe;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(Ae.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=e.getMatrix(),n="undefined"==typeof DOMMatrix?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(n)}return t}}_getLinearGradient(){return this._getCache(vn,this.__getLinearGradient)}__getLinearGradient(){const t=this.fillLinearGradientColorStops();if(t){const e=wn(),i=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),s=e.createLinearGradient(i.x,i.y,n.x,n.y);for(let e=0;e<t.length;e+=2)s.addColorStop(t[e],t[e+1]);return s}}_getRadialGradient(){return this._getCache(bn,this.__getRadialGradient)}__getRadialGradient(){const t=this.fillRadialGradientColorStops();if(t){const e=wn(),i=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),s=e.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius());for(let e=0;e<t.length;e+=2)s.addColorStop(t[e],t[e+1]);return s}}getShadowRGBA(){return this._getCache(gn,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const t=je.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){const e=this.getStage();if(!e)return!1;const i=e.bufferHitCanvas;return i.getContext().clear(),this.drawHit(i,void 0,!0),i.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return Mi.prototype.destroy.call(this),delete yn[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(null!==(e=this.attrs.perfectDrawEnabled)&&void 0!==e&&!e)return!1;const i=t||this.hasFill(),n=this.hasStroke(),s=1!==this.getAbsoluteOpacity();if(i&&n&&s)return!0;const o=this.hasShadow(),r=this.shadowForStrokeEnabled();return!!(i&&n&&o&&r)}setStrokeHitEnabled(t){je.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,i=this.getParent();for(;i;){if(i.isCached()){e=!0;break}i=i.getParent()}const n=t.skipTransform,s=t.relativeTo||e&&this.getStage()||void 0,o=this.getSelfRect(),r=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,a=o.width+r,l=o.height+r,h=!t.skipShadow&&this.hasShadow(),d=h?this.shadowOffsetX():0,c=h?this.shadowOffsetY():0,u=a+Math.abs(d),p=l+Math.abs(c),m=h&&this.shadowBlur()||0,g={width:u+2*m,height:p+2*m,x:-(r/2+m)+Math.min(d,0)+o.x,y:-(r/2+m)+Math.min(c,0)+o.y};return n?g:this._transformedRect(g,s)}drawScene(t,e,i){const n=this.getLayer(),s=(t||n.getCanvas()).getContext(),o=this._getCanvasCache(),r=this.getSceneFunc(),a=this.hasShadow();let l;const h=e===this;if(!this.isVisible()&&!h)return this;if(o){s.save();const t=this.getAbsoluteTransform(e).getMatrix();return s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!r)return this;if(s.save(),this._useBufferCanvas()){l=this.getStage();const t=i||l.bufferCanvas,n=t.getContext();n.clear(),n.save(),n._applyLineJoin(this),n._applyMiterLimit(this);const o=this.getAbsoluteTransform(e).getMatrix();n.transform(o[0],o[1],o[2],o[3],o[4],o[5]),r.call(this,n,this),n.restore();const h=t.pixelRatio;a&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(t._canvas,t.x||0,t.y||0,t.width/h,t.height/h)}else{if(s._applyLineJoin(this),s._applyMiterLimit(this),!h){const t=this.getAbsoluteTransform(e).getMatrix();s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}a&&s._applyShadow(this),r.call(this,s,this)}return s.restore(),this}drawHit(t,e,i=!1){if(!this.shouldDrawHit(e,i))return this;const n=this.getLayer(),s=t||n.hitCanvas,o=s&&s.getContext(),r=this.hitFunc()||this.sceneFunc(),a=this._getCanvasCache(),l=a&&a.hit;if(this.colorKey||je.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){o.save();const t=this.getAbsoluteTransform(e).getMatrix();return o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!r)return this;if(o.save(),o._applyLineJoin(this),o._applyMiterLimit(this),this!==e){const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return r.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){const e=this._getCanvasCache(),i=this._getCachedSceneCanvas(),n=e.hit,s=n.getContext(),o=n.getWidth(),r=n.getHeight();s.clear(),s.drawImage(i._canvas,0,0,o,r);try{const e=s.getImageData(0,0,o,r),i=e.data,n=i.length,a=je._hexToRgb(this.colorKey);for(let e=0;e<n;e+=4)i[e+3]>t?(i[e]=a.r,i[e+1]=a.g,i[e+2]=a.b,i[e+3]=255):i[e+3]=0;s.putImageData(e,0,0)}catch(t){je.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return Bi(t,this)}setPointerCapture(t){Hi(t,this)}releaseCapture(t){Ni(t)}}Cn.prototype._fillFunc=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Cn.prototype._strokeFunc=function(t){t.stroke()},Cn.prototype._fillFuncHit=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Cn.prototype._strokeFuncHit=function(t){t.stroke()},Cn.prototype._centroid=!1,Cn.prototype.nodeType="Shape",De(Cn),Cn.prototype.eventListeners={},Cn.prototype.on.call(Cn.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(mn)}),Cn.prototype.on.call(Cn.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(gn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(fn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(vn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(bn)}),gi.addGetterSetter(Cn,"stroke",void 0,ci()),gi.addGetterSetter(Cn,"strokeWidth",2,ai()),gi.addGetterSetter(Cn,"fillAfterStrokeEnabled",!1),gi.addGetterSetter(Cn,"hitStrokeWidth","auto",hi()),gi.addGetterSetter(Cn,"strokeHitEnabled",!0,ui()),gi.addGetterSetter(Cn,"perfectDrawEnabled",!0,ui()),gi.addGetterSetter(Cn,"shadowForStrokeEnabled",!0,ui()),gi.addGetterSetter(Cn,"lineJoin"),gi.addGetterSetter(Cn,"lineCap"),gi.addGetterSetter(Cn,"miterLimit"),gi.addGetterSetter(Cn,"sceneFunc"),gi.addGetterSetter(Cn,"hitFunc"),gi.addGetterSetter(Cn,"dash"),gi.addGetterSetter(Cn,"dashOffset",0,ai()),gi.addGetterSetter(Cn,"shadowColor",void 0,di()),gi.addGetterSetter(Cn,"shadowBlur",0,ai()),gi.addGetterSetter(Cn,"shadowOpacity",1,ai()),gi.addComponentsGetterSetter(Cn,"shadowOffset",["x","y"]),gi.addGetterSetter(Cn,"shadowOffsetX",0,ai()),gi.addGetterSetter(Cn,"shadowOffsetY",0,ai()),gi.addGetterSetter(Cn,"fillPatternImage"),gi.addGetterSetter(Cn,"fill",void 0,ci()),gi.addGetterSetter(Cn,"fillPatternX",0,ai()),gi.addGetterSetter(Cn,"fillPatternY",0,ai()),gi.addGetterSetter(Cn,"fillLinearGradientColorStops"),gi.addGetterSetter(Cn,"strokeLinearGradientColorStops"),gi.addGetterSetter(Cn,"fillRadialGradientStartRadius",0),gi.addGetterSetter(Cn,"fillRadialGradientEndRadius",0),gi.addGetterSetter(Cn,"fillRadialGradientColorStops"),gi.addGetterSetter(Cn,"fillPatternRepeat","repeat"),gi.addGetterSetter(Cn,"fillEnabled",!0),gi.addGetterSetter(Cn,"strokeEnabled",!0),gi.addGetterSetter(Cn,"shadowEnabled",!0),gi.addGetterSetter(Cn,"dashEnabled",!0),gi.addGetterSetter(Cn,"strokeScaleEnabled",!0),gi.addGetterSetter(Cn,"fillPriority","color"),gi.addComponentsGetterSetter(Cn,"fillPatternOffset",["x","y"]),gi.addGetterSetter(Cn,"fillPatternOffsetX",0,ai()),gi.addGetterSetter(Cn,"fillPatternOffsetY",0,ai()),gi.addComponentsGetterSetter(Cn,"fillPatternScale",["x","y"]),gi.addGetterSetter(Cn,"fillPatternScaleX",1,ai()),gi.addGetterSetter(Cn,"fillPatternScaleY",1,ai()),gi.addComponentsGetterSetter(Cn,"fillLinearGradientStartPoint",["x","y"]),gi.addComponentsGetterSetter(Cn,"strokeLinearGradientStartPoint",["x","y"]),gi.addGetterSetter(Cn,"fillLinearGradientStartPointX",0),gi.addGetterSetter(Cn,"strokeLinearGradientStartPointX",0),gi.addGetterSetter(Cn,"fillLinearGradientStartPointY",0),gi.addGetterSetter(Cn,"strokeLinearGradientStartPointY",0),gi.addComponentsGetterSetter(Cn,"fillLinearGradientEndPoint",["x","y"]),gi.addComponentsGetterSetter(Cn,"strokeLinearGradientEndPoint",["x","y"]),gi.addGetterSetter(Cn,"fillLinearGradientEndPointX",0),gi.addGetterSetter(Cn,"strokeLinearGradientEndPointX",0),gi.addGetterSetter(Cn,"fillLinearGradientEndPointY",0),gi.addGetterSetter(Cn,"strokeLinearGradientEndPointY",0),gi.addComponentsGetterSetter(Cn,"fillRadialGradientStartPoint",["x","y"]),gi.addGetterSetter(Cn,"fillRadialGradientStartPointX",0),gi.addGetterSetter(Cn,"fillRadialGradientStartPointY",0),gi.addComponentsGetterSetter(Cn,"fillRadialGradientEndPoint",["x","y"]),gi.addGetterSetter(Cn,"fillRadialGradientEndPointX",0),gi.addGetterSetter(Cn,"fillRadialGradientEndPointY",0),gi.addGetterSetter(Cn,"fillPatternRotation",0),gi.addGetterSetter(Cn,"fillRule",void 0,di()),gi.backCompat(Cn,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const xn=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],En=xn.length;class Sn extends Ti{constructor(t){super(t),this.canvas=new Qe,this.hitCanvas=new ni({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Mi.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Mi.prototype.moveUp.call(this))return!1;const t=this.getStage();return!(!t||!t.content||(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),0))}moveDown(){if(Mi.prototype.moveDown.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Mi.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const t=this.getNativeCanvasElement();return Mi.prototype.remove.call(this),t&&t.parentNode&&je._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&je.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t={...t}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),Mi.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){je.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){je.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,je.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,i=!1;for(;;){for(let n=0;n<En;n++){const s=xn[n],o=this._getIntersection({x:t.x+s.x*e,y:t.y+s.y*e}),r=o.shape;if(r)return r;if(i=!!o.antialiased,!o.antialiased)break}if(!i)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=i[3];if(255===n){const t=je._rgbToHex(i[0],i[1],i[2]),e=yn["#"+t];return e?{shape:e}:{antialiased:!0}}return n>0?{antialiased:!0}:{}}drawScene(t,e,i){const n=this.getLayer(),s=t||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&s.getContext().clear(),Ti.prototype.drawScene.call(this,s,e,i),this._fire("draw",{node:this}),this}drawHit(t,e){const i=this.getLayer(),n=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),Ti.prototype.drawHit.call(this,n,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){je.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return je.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return je.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Sn.prototype.nodeType="Layer",De(Sn),gi.addGetterSetter(Sn,"imageSmoothingEnabled",!0),gi.addGetterSetter(Sn,"clearBeforeDraw",!0),gi.addGetterSetter(Sn,"hitGraphEnabled",!0,ui());class Pn extends Sn{constructor(t){super(t),this.listening(!1),je.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Pn.prototype.nodeType="FastLayer",De(Pn);class kn extends Ti{_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&je.throw("You may only add groups and shapes to groups.")}}kn.prototype.nodeType="Group",De(kn);const In=Te.performance&&Te.performance.now?function(){return Te.performance.now()}:function(){return(new Date).getTime()};class Rn{constructor(t,e){this.id=Rn.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:In(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,i=e.length;for(let n=0;n<i;n++)if(e[n]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const t=Rn.animations,e=t.length;for(let i=0;i<e;i++)if(t[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=In(),Rn._addAnimation(this),this}stop(){return Rn._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,i=this.animations,n=i.length;for(let t=0;t<n;t++)if(i[t].id===e){this.animations.splice(t,1);break}}static _runFrames(){const t={},e=this.animations;for(let i=0;i<e.length;i++){const n=e[i],s=n.layers,o=n.func;n._updateFrameObject(In());const r=s.length;let a;if(a=!o||!1!==o.call(n,n.frame),a)for(let e=0;e<r;e++){const i=s[e];void 0!==i._id&&(t[i._id]=i)}}for(const e in t)t.hasOwnProperty(e)&&t[e].batchDraw()}static _animationLoop(){const t=Rn;t.animations.length?(t._runFrames(),je.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,je.requestAnimFrame(this._animationLoop))}}Rn.animations=[],Rn.animIdCounter=0,Rn.animRunning=!1;const Mn={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Ln=["fill","stroke","shadowColor"];let Tn=0;class An{constructor(t,e,i,n,s,o,r){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=r,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=s-this.begin,this.pause()}fire(t){const e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class Dn{constructor(t){const e=this,i=t.node,n=i._id,s=t.easing||zn.Linear,o=!!t.yoyo;let r,a;r=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=i,this._id=Tn++;const l=i.getLayer()||(i instanceof Ae.Stage?i.getLayers():null);for(a in l||je.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Rn(function(){e.tween.onEnterFrame()},l),this.tween=new An(a,function(t){e._tweenFunc(t)},s,0,1,1e3*r,o),this._addListeners(),Dn.attrs[n]||(Dn.attrs[n]={}),Dn.attrs[n][this._id]||(Dn.attrs[n][this._id]={}),Dn.tweens[n]||(Dn.tweens[n]={}),t)void 0===Mn[a]&&this._addAttr(a,t[a]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){const i=this.node,n=i._id;let s,o,r,a,l;const h=Dn.tweens[n][t];h&&delete Dn.attrs[n][h][t];let d=i.getAttr(t);if(je._isArray(e))if(s=[],o=Math.max(e.length,d.length),"points"===t&&e.length!==d.length&&(e.length>d.length?(a=d,d=je._prepareArrayForTween(d,e,i.closed())):(r=e,e=je._prepareArrayForTween(e,d,i.closed()))),0===t.indexOf("fill"))for(let t=0;t<o;t++)if(t%2==0)s.push(e[t]-d[t]);else{const i=je.colorToRGBA(d[t]);l=je.colorToRGBA(e[t]),d[t]=i,s.push({r:l.r-i.r,g:l.g-i.g,b:l.b-i.b,a:l.a-i.a})}else for(let t=0;t<o;t++)s.push(e[t]-d[t]);else-1!==Ln.indexOf(t)?(d=je.colorToRGBA(d),l=je.colorToRGBA(e),s={r:l.r-d.r,g:l.g-d.g,b:l.b-d.b,a:l.a-d.a}):s=e-d;Dn.attrs[n][this._id][t]={start:d,diff:s,end:e,trueEnd:r,trueStart:a},Dn.tweens[n][t]=this._id}_tweenFunc(t){const e=this.node,i=Dn.attrs[e._id][this._id];let n,s,o,r,a,l,h,d;for(n in i){if(s=i[n],o=s.start,r=s.diff,d=s.end,je._isArray(o))if(a=[],h=Math.max(o.length,d.length),0===n.indexOf("fill"))for(l=0;l<h;l++)l%2==0?a.push((o[l]||0)+r[l]*t):a.push("rgba("+Math.round(o[l].r+r[l].r*t)+","+Math.round(o[l].g+r[l].g*t)+","+Math.round(o[l].b+r[l].b*t)+","+(o[l].a+r[l].a*t)+")");else for(l=0;l<h;l++)a.push((o[l]||0)+r[l]*t);else a=-1!==Ln.indexOf(n)?"rgba("+Math.round(o.r+r.r*t)+","+Math.round(o.g+r.g*t)+","+Math.round(o.b+r.b*t)+","+(o.a+r.a*t)+")":o+r*t;e.setAttr(n,a)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const t=this.node,e=Dn.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const t=this.node,e=Dn.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const t=this.node._id,e=this._id,i=Dn.tweens[t];this.pause(),this.anim&&this.anim.stop();for(const e in i)delete Dn.tweens[t][e];delete Dn.attrs[t][e],Dn.tweens[t]&&(0===Object.keys(Dn.tweens[t]).length&&delete Dn.tweens[t],0===Object.keys(Dn.attrs[t]).length&&delete Dn.attrs[t])}}Dn.attrs={},Dn.tweens={},Mi.prototype.to=function(t){const e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new Dn(t).play()};const zn={BackEaseIn(t,e,i,n){const s=1.70158;return i*(t/=n)*t*((s+1)*t-s)+e},BackEaseOut(t,e,i,n){const s=1.70158;return i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},BackEaseInOut(t,e,i,n){let s=1.70158;return(t/=n/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e},ElasticEaseIn(t,e,i,n,s,o){let r=0;return 0===t?e:1===(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,i,n,s,o){let r=0;return 0===t?e:1===(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-r)*(2*Math.PI)/o)+i+e)},ElasticEaseInOut(t,e,i,n,s,o){let r=0;return 0===t?e:2==(t/=n/2)?e+i:(o||(o=n*(.3*1.5)),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*-.5+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*.5+i+e)},BounceEaseOut:(t,e,i,n)=>(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,i,n)=>i-zn.BounceEaseOut(n-t,0,i,n)+e,BounceEaseInOut:(t,e,i,n)=>t<n/2?.5*zn.BounceEaseIn(2*t,0,i,n)+e:.5*zn.BounceEaseOut(2*t-n,0,i,n)+.5*i+e,EaseIn:(t,e,i,n)=>i*(t/=n)*t+e,EaseOut:(t,e,i,n)=>-i*(t/=n)*(t-2)+e,EaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,i,n)=>i*(t/=n)*t*t*t*t+e,StrongEaseOut:(t,e,i,n)=>i*((t=t/n-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,i,n)=>i*t/n+e},On=je._assign(Ae,{Util:je,Transform:Oe,Node:Mi,Container:Ti,Stage:pn,stages:un,Layer:Sn,FastLayer:Pn,Group:kn,DD:si,Shape:Cn,shapes:yn,Animation:Rn,Tween:Dn,Easings:zn,Context:Xe,Canvas:Je});class Bn extends Cn{_sceneFunc(t){const e=Ae.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),i=this.clockwise(),n=Ae.getAngle(i?360-this.angle():this.angle()),s=Math.cos(Math.min(n,Math.PI)),o=Math.sin(Math.min(Math.max(Math.PI,n),3*Math.PI/2)),r=Math.sin(Math.min(n,Math.PI/2)),a=s*(s>0?t:e),l=o*(o>0?t:e),h=r*(r>0?e:t);return{x:a,y:i?-1*h:l,width:1*e-a,height:h-l}}}function Hn(t,e,i,n,s,o,r){const a=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)),l=Math.sqrt(Math.pow(s-i,2)+Math.pow(o-n,2)),h=r*a/(a+l),d=r*l/(a+l);return[i-h*(s-t),n-h*(o-e),i+d*(s-t),n+d*(o-e)]}function Nn(t,e){const i=t.length,n=[];for(let s=2;s<i-2;s+=2){const i=Hn(t[s-2],t[s-1],t[s],t[s+1],t[s+2],t[s+3],e);isNaN(i[0])||(n.push(i[0]),n.push(i[1]),n.push(t[s]),n.push(t[s+1]),n.push(i[2]),n.push(i[3]))}return n}Bn.prototype._centroid=!0,Bn.prototype.className="Arc",Bn.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],De(Bn),gi.addGetterSetter(Bn,"innerRadius",0,ai()),gi.addGetterSetter(Bn,"outerRadius",0,ai()),gi.addGetterSetter(Bn,"angle",0,ai()),gi.addGetterSetter(Bn,"clockwise",!1,ui());class Vn extends Cn{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){const e=this.points(),i=e.length,n=this.tension(),s=this.closed(),o=this.bezier();if(!i)return;let r=0;if(t.beginPath(),t.moveTo(e[0],e[1]),0!==n&&i>4){const n=this.getTensionPoints(),o=n.length;for(r=s?0:4,s||t.quadraticCurveTo(n[0],n[1],n[2],n[3]);r<o-2;)t.bezierCurveTo(n[r++],n[r++],n[r++],n[r++],n[r++],n[r++]);s||t.quadraticCurveTo(n[o-2],n[o-1],e[i-2],e[i-1])}else if(o)for(r=2;r<i;)t.bezierCurveTo(e[r++],e[r++],e[r++],e[r++],e[r++],e[r++]);else for(r=2;r<i;r+=2)t.lineTo(e[r],e[r+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Nn(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),e=t.length,i=this.tension(),n=Hn(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),s=Hn(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),o=Nn(t,i);return[n[2],n[3]].concat(o).concat([s[0],s[1],t[e-2],t[e-1],s[2],s[3],n[0],n[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points();let e,i,n=t[0],s=t[0],o=t[1],r=t[1];for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),s=Math.max(s,e),o=Math.min(o,i),r=Math.max(r,i);return{x:n,y:o,width:s-n,height:r-o}}}Vn.prototype.className="Line",Vn.prototype._attrsAffectingSize=["points","bezier","tension"],De(Vn),gi.addGetterSetter(Vn,"closed",!1),gi.addGetterSetter(Vn,"bezier",!1),gi.addGetterSetter(Vn,"tension",0,ai()),gi.addGetterSetter(Vn,"points",[],function(){if(Ae.isUnminified)return function(t,e){const i=Int8Array?Object.getPrototypeOf(Int8Array):null;return i&&t instanceof i||(je._isArray(t)?t.forEach(function(t){je._isNumber(t)||je.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());const Fn=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],Gn=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Wn=[[1],[1,1],[1,2,1],[1,3,3,1]],jn=(t,e,i)=>{let n,s;const o=i/2;n=0;for(let i=0;i<20;i++)s=o*Fn[20][i]+o,n+=Gn[20][i]*qn(t,e,s);return o*n},Un=(t,e,i)=>{void 0===i&&(i=1);const n=t[0]-2*t[1]+t[2],s=e[0]-2*e[1]+e[2],o=2*t[1]-2*t[0],r=2*e[1]-2*e[0],a=4*(n*n+s*s),l=4*(n*o+s*r),h=o*o+r*r;if(0===a)return i*Math.sqrt(Math.pow(t[2]-t[0],2)+Math.pow(e[2]-e[0],2));const d=l/(2*a),c=i+d,u=h/a-d*d,p=c*c+u>0?Math.sqrt(c*c+u):0,m=d*d+u>0?Math.sqrt(d*d+u):0,g=d+Math.sqrt(d*d+u)!==0?u*Math.log(Math.abs((c+p)/(d+m))):0;return Math.sqrt(a)/2*(c*p-d*m+g)};function qn(t,e,i){const n=$n(1,i,t),s=$n(1,i,e),o=n*n+s*s;return Math.sqrt(o)}const $n=(t,e,i)=>{const n=i.length-1;let s,o;if(0===n)return 0;if(0===t){o=0;for(let t=0;t<=n;t++)o+=Wn[n][t]*Math.pow(1-e,n-t)*Math.pow(e,t)*i[t];return o}s=new Array(n);for(let t=0;t<n;t++)s[t]=n*(i[t+1]-i[t]);return $n(t-1,e,s)},Kn=(t,e,i)=>{let n=1,s=t/e,o=(t-i(s))/e,r=0;for(;n>.001;){const a=i(s+o),l=Math.abs(t-a)/e;if(l<n)n=l,s+=o;else{const r=i(s-o),a=Math.abs(t-r)/e;a<n?(n=a,s-=o):o/=2}if(r++,r>500)break}return s};class Xn extends Cn{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Xn.parsePathData(this.data()),this.pathLength=Xn.getPathLength(this.dataArray)}_sceneFunc(t){const e=this.dataArray;t.beginPath();let i=!1;for(let n=0;n<e.length;n++){const s=e[n].command,o=e[n].points;switch(s){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":const e=o[0],n=o[1],s=o[2],r=o[3],a=o[4],l=o[5],h=o[6],d=o[7],c=s>r?s:r,u=s>r?1:s/r,p=s>r?r/s:1;t.translate(e,n),t.rotate(h),t.scale(u,p),t.arc(0,0,c,a,a+l,1-d),t.scale(1/u,1/p),t.rotate(-h),t.translate(-e,-n);break;case"z":i=!0,t.closePath()}}i||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){let t=[];this.dataArray.forEach(function(e){if("A"===e.command){const i=e.points[4],n=e.points[5],s=e.points[4]+n;let o=Math.PI/180;if(Math.abs(i-s)<o&&(o=Math.abs(i-s)),n<0)for(let n=i-o;n>s;n-=o){const i=Xn.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}else for(let n=i+o;n<s;n+=o){const i=Xn.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}}else if("C"===e.command)for(let i=0;i<=1;i+=.01){const n=Xn.getPointOnCubicBezier(i,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(n.x,n.y)}else t=t.concat(e.points)});let e,i,n=t[0],s=t[0],o=t[1],r=t[1];for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],isNaN(e)||(n=Math.min(n,e),s=Math.max(s,e)),isNaN(i)||(o=Math.min(o,i),r=Math.max(r,i));return{x:n,y:o,width:s-n,height:r-o}}getLength(){return this.pathLength}getPointAtLength(t){return Xn.getPointAtLengthOfDataArray(t,this.dataArray)}static getLineLength(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))}static getPathLength(t){let e=0;for(let i=0;i<t.length;++i)e+=t[i].pathLength;return e}static getPointAtLengthOfDataArray(t,e){let i,n=0,s=e.length;if(!s)return null;for(;n<s&&t>e[n].pathLength;)t-=e[n].pathLength,++n;if(n===s)return i=e[n-1].points.slice(-2),{x:i[0],y:i[1]};if(t<.01)return"M"===e[n].command?(i=e[n].points.slice(0,2),{x:i[0],y:i[1]}):{x:e[n].start.x,y:e[n].start.y};const o=e[n],r=o.points;switch(o.command){case"L":return Xn.getPointOnLine(t,o.start.x,o.start.y,r[0],r[1]);case"C":return Xn.getPointOnCubicBezier(Kn(t,Xn.getPathLength(e),t=>jn([o.start.x,r[0],r[2],r[4]],[o.start.y,r[1],r[3],r[5]],t)),o.start.x,o.start.y,r[0],r[1],r[2],r[3],r[4],r[5]);case"Q":return Xn.getPointOnQuadraticBezier(Kn(t,Xn.getPathLength(e),t=>Un([o.start.x,r[0],r[2]],[o.start.y,r[1],r[3]],t)),o.start.x,o.start.y,r[0],r[1],r[2],r[3]);case"A":const i=r[0],n=r[1],s=r[2],a=r[3],l=r[5],h=r[6];let d=r[4];return d+=l*t/o.pathLength,Xn.getPointOnEllipticalArc(i,n,s,a,d,h)}return null}static getPointOnLine(t,e,i,n,s,o,r){o=null!=o?o:e,r=null!=r?r:i;const a=this.getLineLength(e,i,n,s);if(a<1e-10)return{x:e,y:i};if(n===e)return{x:o,y:r+(s>i?t:-t)};const l=(s-i)/(n-e),h=Math.sqrt(t*t/(1+l*l))*(n<e?-1:1),d=l*h;if(Math.abs(r-i-l*(o-e))<1e-10)return{x:o+h,y:r+d};const c=((o-e)*(n-e)+(r-i)*(s-i))/(a*a),u=e+c*(n-e),p=i+c*(s-i),m=this.getLineLength(o,r,u,p),g=Math.sqrt(t*t-m*m),f=Math.sqrt(g*g/(1+l*l))*(n<e?-1:1);return{x:u+f,y:p+l*f}}static getPointOnCubicBezier(t,e,i,n,s,o,r,a,l){function h(t){return t*t*t}function d(t){return 3*t*t*(1-t)}function c(t){return 3*t*(1-t)*(1-t)}function u(t){return(1-t)*(1-t)*(1-t)}return{x:a*h(t)+o*d(t)+n*c(t)+e*u(t),y:l*h(t)+r*d(t)+s*c(t)+i*u(t)}}static getPointOnQuadraticBezier(t,e,i,n,s,o,r){function a(t){return t*t}function l(t){return 2*t*(1-t)}function h(t){return(1-t)*(1-t)}return{x:o*a(t)+n*l(t)+e*h(t),y:r*a(t)+s*l(t)+i*h(t)}}static getPointOnEllipticalArc(t,e,i,n,s,o){const r=Math.cos(o),a=Math.sin(o),l=i*Math.cos(s),h=n*Math.sin(s);return{x:t+(l*r-h*a),y:e+(l*a+h*r)}}static parsePathData(t){if(!t)return[];let e=t;const i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(let t=0;t<i.length;t++)e=e.replace(new RegExp(i[t],"g"),"|"+i[t]);const n=e.split("|"),s=[],o=[];let r=0,a=0;const l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let h;for(let t=1;t<n.length;t++){let e=n[t],i=e.charAt(0);for(e=e.slice(1),o.length=0;h=l.exec(e);)o.push(h[0]);let d=[],c="A"===i||"a"===i?0:-1;for(let t=0,e=o.length;t<e;t++){const e=o[t];if("00"!==e)if(c>=0){if(3===c){if(/^[01]{2}\d+(?:\.\d+)?$/.test(e)){d.push(parseInt(e[0],10)),d.push(parseInt(e[1],10)),d.push(parseFloat(e.slice(2))),c+=3,c>=7&&(c-=7);continue}if("11"===e||"10"===e||"01"===e){d.push(parseInt(e[0],10)),d.push(parseInt(e[1],10)),c+=2,c>=7&&(c-=7);continue}if("0"===e||"1"===e){d.push(parseInt(e,10)),c+=1,c>=7&&(c-=7);continue}}else if(4===c){if(/^[01]\d+(?:\.\d+)?$/.test(e)){d.push(parseInt(e[0],10)),d.push(parseFloat(e.slice(1))),c+=2,c>=7&&(c-=7);continue}if("0"===e||"1"===e){d.push(parseInt(e,10)),c+=1,c>=7&&(c-=7);continue}}const t=parseFloat(e);isNaN(t)?d.push(0):d.push(t),c+=1,c>=7&&(c-=7)}else{const t=parseFloat(e);isNaN(t)?d.push(0):d.push(t)}else d.push(0,0),c>=0&&(c+=2,c>=7&&(c-=7))}for(;d.length>0&&!isNaN(d[0]);){let t="",e=[];const n=r,o=a;let l,h,c,u,p,m,g,f,v,b;switch(i){case"l":r+=d.shift(),a+=d.shift(),t="L",e.push(r,a);break;case"L":r=d.shift(),a=d.shift(),e.push(r,a);break;case"m":const n=d.shift(),o=d.shift();if(r+=n,a+=o,t="M",s.length>2&&"z"===s[s.length-1].command)for(let t=s.length-2;t>=0;t--)if("M"===s[t].command){r=s[t].points[0]+n,a=s[t].points[1]+o;break}e.push(r,a),i="l";break;case"M":r=d.shift(),a=d.shift(),t="M",e.push(r,a),i="L";break;case"h":r+=d.shift(),t="L",e.push(r,a);break;case"H":r=d.shift(),t="L",e.push(r,a);break;case"v":a+=d.shift(),t="L",e.push(r,a);break;case"V":a=d.shift(),t="L",e.push(r,a);break;case"C":e.push(d.shift(),d.shift(),d.shift(),d.shift()),r=d.shift(),a=d.shift(),e.push(r,a);break;case"c":e.push(r+d.shift(),a+d.shift(),r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="C",e.push(r,a);break;case"S":h=r,c=a,l=s[s.length-1],"C"===l.command&&(h=r+(r-l.points[2]),c=a+(a-l.points[3])),e.push(h,c,d.shift(),d.shift()),r=d.shift(),a=d.shift(),t="C",e.push(r,a);break;case"s":h=r,c=a,l=s[s.length-1],"C"===l.command&&(h=r+(r-l.points[2]),c=a+(a-l.points[3])),e.push(h,c,r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="C",e.push(r,a);break;case"Q":e.push(d.shift(),d.shift()),r=d.shift(),a=d.shift(),e.push(r,a);break;case"q":e.push(r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="Q",e.push(r,a);break;case"T":h=r,c=a,l=s[s.length-1],"Q"===l.command&&(h=r+(r-l.points[0]),c=a+(a-l.points[1])),r=d.shift(),a=d.shift(),t="Q",e.push(h,c,r,a);break;case"t":h=r,c=a,l=s[s.length-1],"Q"===l.command&&(h=r+(r-l.points[0]),c=a+(a-l.points[1])),r+=d.shift(),a+=d.shift(),t="Q",e.push(h,c,r,a);break;case"A":u=d.shift(),p=d.shift(),m=d.shift(),g=d.shift(),f=d.shift(),v=r,b=a,r=d.shift(),a=d.shift(),t="A",e=this.convertEndpointToCenterParameterization(v,b,r,a,g,f,u,p,m);break;case"a":u=d.shift(),p=d.shift(),m=d.shift(),g=d.shift(),f=d.shift(),v=r,b=a,r+=d.shift(),a+=d.shift(),t="A",e=this.convertEndpointToCenterParameterization(v,b,r,a,g,f,u,p,m)}s.push({command:t||i,points:e,start:{x:n,y:o},pathLength:this.calcLength(n,o,t||i,e)})}"z"!==i&&"Z"!==i||s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(t,e,i,n){let s,o,r,a;const l=Xn;switch(i){case"L":return l.getLineLength(t,e,n[0],n[1]);case"C":return jn([t,n[0],n[2],n[4]],[e,n[1],n[3],n[5]],1);case"Q":return Un([t,n[0],n[2]],[e,n[1],n[3]],1);case"A":s=0;const i=n[4],h=n[5],d=n[4]+h;let c=Math.PI/180;if(Math.abs(i-d)<c&&(c=Math.abs(i-d)),o=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],i,0),h<0)for(a=i-c;a>d;a-=c)r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),o=r;else for(a=i+c;a<d;a+=c)r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),o=r;return r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],d,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),s}return 0}static convertEndpointToCenterParameterization(t,e,i,n,s,o,r,a,l){const h=l*(Math.PI/180),d=Math.cos(h)*(t-i)/2+Math.sin(h)*(e-n)/2,c=-1*Math.sin(h)*(t-i)/2+Math.cos(h)*(e-n)/2,u=d*d/(r*r)+c*c/(a*a);u>1&&(r*=Math.sqrt(u),a*=Math.sqrt(u));let p=Math.sqrt((r*r*(a*a)-r*r*(c*c)-a*a*(d*d))/(r*r*(c*c)+a*a*(d*d)));s===o&&(p*=-1),isNaN(p)&&(p=0);const m=p*r*c/a,g=p*-a*d/r,f=(t+i)/2+Math.cos(h)*m-Math.sin(h)*g,v=(e+n)/2+Math.sin(h)*m+Math.cos(h)*g,b=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},_=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(b(t)*b(e))},w=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(_(t,e))},y=w([1,0],[(d-m)/r,(c-g)/a]),C=[(d-m)/r,(c-g)/a],x=[(-1*d-m)/r,(-1*c-g)/a];let E=w(C,x);return _(C,x)<=-1&&(E=Math.PI),_(C,x)>=1&&(E=0),0===o&&E>0&&(E-=2*Math.PI),1===o&&E<0&&(E+=2*Math.PI),[f,v,r,a,y,E,h,o]}}Xn.prototype.className="Path",Xn.prototype._attrsAffectingSize=["data"],De(Xn),gi.addGetterSetter(Xn,"data");class Yn extends Vn{_sceneFunc(t){super._sceneFunc(t);const e=2*Math.PI,i=this.points();let n=i;const s=0!==this.tension()&&i.length>4;s&&(n=this.getTensionPoints());const o=this.pointerLength(),r=i.length;let a,l;if(s){const t=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],i[r-2],i[r-1]],e=Xn.calcLength(n[n.length-4],n[n.length-3],"C",t),s=Xn.getPointOnQuadraticBezier(Math.min(1,1-o/e),t[0],t[1],t[2],t[3],t[4],t[5]);a=i[r-2]-s.x,l=i[r-1]-s.y}else a=i[r-2]-i[r-4],l=i[r-1]-i[r-3];const h=(Math.atan2(l,a)+e)%e,d=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(i[r-2],i[r-1]),t.rotate(h),t.moveTo(0,0),t.lineTo(-o,d/2),t.lineTo(-o,-d/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(i[0],i[1]),s?(a=(n[0]+n[2])/2-i[0],l=(n[1]+n[3])/2-i[1]):(a=i[2]-i[0],l=i[3]-i[1]),t.rotate((Math.atan2(-l,-a)+e)%e),t.moveTo(0,0),t.lineTo(-o,d/2),t.lineTo(-o,-d/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){const e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x,y:t.y-e,width:t.width,height:t.height+2*e}}}Yn.prototype.className="Arrow",De(Yn),gi.addGetterSetter(Yn,"pointerLength",10,ai()),gi.addGetterSetter(Yn,"pointerWidth",10,ai()),gi.addGetterSetter(Yn,"pointerAtBeginning",!1),gi.addGetterSetter(Yn,"pointerAtEnding",!0);class Zn extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}Zn.prototype._centroid=!0,Zn.prototype.className="Circle",Zn.prototype._attrsAffectingSize=["radius"],De(Zn),gi.addGetterSetter(Zn,"radius",0,ai());class Jn extends Cn{_sceneFunc(t){const e=this.radiusX(),i=this.radiusY();t.beginPath(),t.save(),e!==i&&t.scale(1,i/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}Jn.prototype.className="Ellipse",Jn.prototype._centroid=!0,Jn.prototype._attrsAffectingSize=["radiusX","radiusY"],De(Jn),gi.addComponentsGetterSetter(Jn,"radius",["x","y"]),gi.addGetterSetter(Jn,"radiusX",0,ai()),gi.addGetterSetter(Jn,"radiusY",0,ai());class Qn extends Cn{constructor(t){super(t),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",this._loadListener)}_removeImageLoad(t){t&&t.removeEventListener&&t.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const t=!!this.cornerRadius(),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),i=this.getHeight(),n=this.cornerRadius(),s=this.attrs.image;let o;if(s){const t=this.attrs.cropWidth,n=this.attrs.cropHeight;o=t&&n?[s,this.cropX(),this.cropY(),t,n,0,0,e,i]:[s,0,0,e,i]}(this.hasFill()||this.hasStroke()||n)&&(t.beginPath(),n?je.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),s&&(n&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){const e=this.width(),i=this.height(),n=this.cornerRadius();t.beginPath(),n?je.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,i=null){const n=je.createImageElement();n.onload=function(){const t=new Qn({image:n});e(t)},n.onerror=i,n.crossOrigin="Anonymous",n.src=t}}Qn.prototype.className="Image",De(Qn),gi.addGetterSetter(Qn,"cornerRadius",0,li(4)),gi.addGetterSetter(Qn,"image"),gi.addComponentsGetterSetter(Qn,"crop",["x","y","width","height"]),gi.addGetterSetter(Qn,"cropX",0,ai()),gi.addGetterSetter(Qn,"cropY",0,ai()),gi.addGetterSetter(Qn,"cropWidth",0,ai()),gi.addGetterSetter(Qn,"cropHeight",0,ai());const ts=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],es="up",is="right",ns="down",ss="left",os=ts.length;class rs extends kn{constructor(t){super(t),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){let e,i=this;const n=function(){i._sync()};for(e=0;e<os;e++)t.on(ts[e]+"Change.konva",n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let t,e,i,n,s,o,r,a=this.getText(),l=this.getTag();if(a&&l){switch(t=a.width(),e=a.height(),i=l.pointerDirection(),n=l.pointerWidth(),r=l.pointerHeight(),s=0,o=0,i){case es:s=t/2,o=-1*r;break;case is:s=t+n,o=e/2;break;case ns:s=t/2,o=e+r;break;case ss:s=-1*n,o=e/2}l.setAttrs({x:-1*s,y:-1*o,width:t,height:e}),a.setAttrs({x:-1*s,y:-1*o})}}}rs.prototype.className="Label",De(rs);class as extends Cn{_sceneFunc(t){const e=this.width(),i=this.height(),n=this.pointerDirection(),s=this.pointerWidth(),o=this.pointerHeight(),r=this.cornerRadius();let a=0,l=0,h=0,d=0;"number"==typeof r?a=l=h=d=Math.min(r,e/2,i/2):(a=Math.min(r[0]||0,e/2,i/2),l=Math.min(r[1]||0,e/2,i/2),d=Math.min(r[2]||0,e/2,i/2),h=Math.min(r[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(a,0),n===es&&(t.lineTo((e-s)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+s)/2,0)),t.lineTo(e-l,0),t.arc(e-l,l,l,3*Math.PI/2,0,!1),n===is&&(t.lineTo(e,(i-o)/2),t.lineTo(e+s,i/2),t.lineTo(e,(i+o)/2)),t.lineTo(e,i-d),t.arc(e-d,i-d,d,0,Math.PI/2,!1),n===ns&&(t.lineTo((e+s)/2,i),t.lineTo(e/2,i+o),t.lineTo((e-s)/2,i)),t.lineTo(h,i),t.arc(h,i-h,h,Math.PI/2,Math.PI,!1),n===ss&&(t.lineTo(0,(i+o)/2),t.lineTo(-1*s,i/2),t.lineTo(0,(i-o)/2)),t.lineTo(0,a),t.arc(a,a,a,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){let t=0,e=0,i=this.pointerWidth(),n=this.pointerHeight(),s=this.pointerDirection(),o=this.width(),r=this.height();return s===es?(e-=n,r+=n):s===ns?r+=n:s===ss?(t-=1.5*i,o+=i):s===is&&(o+=1.5*i),{x:t,y:e,width:o,height:r}}}as.prototype.className="Tag",De(as),gi.addGetterSetter(as,"pointerDirection","none"),gi.addGetterSetter(as,"pointerWidth",0,ai()),gi.addGetterSetter(as,"pointerHeight",0,ai()),gi.addGetterSetter(as,"cornerRadius",0,li(4));class ls extends Cn{_sceneFunc(t){const e=this.cornerRadius(),i=this.width(),n=this.height();t.beginPath(),e?je.drawRoundedRectPath(t,i,n,e):t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}}ls.prototype.className="Rect",De(ls),gi.addGetterSetter(ls,"cornerRadius",0,li(4));class hs extends Cn{_sceneFunc(t){const e=this._getPoints(),i=this.radius(),n=this.sides(),s=this.cornerRadius();if(t.beginPath(),s)je.drawRoundedPolygonPath(t,e,n,i,s);else{t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y)}t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,i=[];for(let n=0;n<t;n++)i.push({x:e*Math.sin(2*n*Math.PI/t),y:-1*e*Math.cos(2*n*Math.PI/t)});return i}getSelfRect(){const t=this._getPoints();let e=t[0].x,i=t[0].y,n=t[0].x,s=t[0].y;return t.forEach(t=>{e=Math.min(e,t.x),i=Math.max(i,t.x),n=Math.min(n,t.y),s=Math.max(s,t.y)}),{x:e,y:n,width:i-e,height:s-n}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}hs.prototype.className="RegularPolygon",hs.prototype._centroid=!0,hs.prototype._attrsAffectingSize=["radius"],De(hs),gi.addGetterSetter(hs,"radius",0,ai()),gi.addGetterSetter(hs,"sides",0,ai()),gi.addGetterSetter(hs,"cornerRadius",0,li(4));const ds=2*Math.PI;class cs extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,ds,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),ds,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}cs.prototype.className="Ring",cs.protot