al).top)>0&&o<this.elementVertical.clientHeight-s.offsetHeight)return r(),!1;switch(void 0===e&&(e=this.table.options.scrollToRowPosition),"nearest"===e&&(e=this.scrollToRowNearestTop(t)?"top":"bottom"),this.scrollToRow(t),e){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(s.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-s.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-s.offsetTop)+s.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+s.offsetHeight;break;case"top":this.elementVertical.scrollTop=s.offsetTop}r()}else console.warn("Scroll Error - Row not visible"),a("Scroll Error - Row not visible")})}}class se extends ne{constructor(t){super(t)}renderRowCells(t,e){const i=document.createDocumentFragment();t.cells.forEach(t=>{i.appendChild(t.getElement())}),t.element.appendChild(i),e||t.cells.forEach(t=>{t.cellRendered()})}reinitializeColumnWidths(t){t.forEach(function(t){t.reinitializeWidth()})}}class oe extends ne{constructor(t){super(t),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){"fitDataTable"==this.options("layout")&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(t,e){this.dataChange()}scrollColumns(t,e){this.scrollLeft!=t&&(this.scrollLeft=t,this.scroll(t-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var t=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(e=>{if(e.visible){var i=e.getWidth();i>t&&(t=i)}}),this.windowBuffer=2*t}rerenderColumns(t,e){var i={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;t&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(t=>{var e,i={};t.visible&&(t.modules.frozen||(e=t.getWidth(),i.leftPos=n,i.rightPos=n+e,i.width=e,this.isFitData&&(i.fitDataCheck=!t.modules.vdomHoz||t.modules.vdomHoz.fitDataCheck),n+e>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(-1==this.leftCol&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):-1!==this.leftCol&&(this.vDomPadRight+=e),this.columns.push(t),t.modules.vdomHoz=i,n+=e))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,e||t&&!this.reinitChanged(i)||this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(t){if(this.initialized)this.initializeRow(t);else{const e=document.createDocumentFragment();t.cells.forEach(t=>{e.appendChild(t.getElement())}),t.element.appendChild(e),t.cells.forEach(t=>{t.cellRendered()})}}rerenderRowCells(t,e){this.reinitializeRow(t,e)}reinitializeColumnWidths(t){for(let t=this.leftCol;t<=this.rightCol;t++){let e=this.columns[t];e&&e.reinitializeWidth()}}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var t,e,i=!1;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(t=>{!t.definition.width&&t.visible&&(i=!0)}),i&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,t=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0])){e=t.getElement(),t.generateCells(),this.tableElement.appendChild(e);for(let i=0;i<t.cells.length;i++){let n=t.cells[i];e.appendChild(n.getElement()),n.column.reinitializeWidth()}e.parentNode.removeChild(e),this.rerenderColumns(!1,!0)}}else"fitColumns"===this.options("layout")&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(t){var e=!0;return t.cols.length!==this.columns.length||t.leftCol!==this.leftCol||t.rightCol!==this.rightCol||(t.cols.forEach((t,i)=>{t!==this.columns[i]&&(e=!1)}),!e)}reinitializeRows(){var t=this.getVisibleRows(),e=this.table.rowManager.getRows().filter(e=>!t.includes(e));t.forEach(t=>{this.reinitializeRow(t,!0)}),e.forEach(t=>{t.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(t){this.vDomScrollPosLeft+=t,this.vDomScrollPosRight+=t,Math.abs(t)>this.windowBuffer/2?this.rerenderColumns():t>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(t,e,i){for(let n=t;n<e;n++){let t=this.columns[n];t.modules.vdomHoz.leftPos+=i,t.modules.vdomHoz.rightPos+=i}}addColRight(){for(var t=!1,e=!0;e;){let i=this.columns[this.rightCol+1];i&&i.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);t.getElement().insertBefore(e.getElement(),t.getCell(this.columns[this.rightCol]).getElement().nextSibling),e.cellRendered()}}),this.fitDataColActualWidthCheck(i),this.rightCol++,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=i.getWidth()):e=!1}t&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var t=!1,e=!0;e;){let i=this.columns[this.leftCol-1];if(i)if(i.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);t.getElement().insertBefore(e.getElement(),t.getCell(this.columns[this.leftCol]).getElement()),e.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=i.getWidth();let e=this.fitDataColActualWidthCheck(i);e&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+e,this.vDomPadRight-=e)}else e=!1;else e=!1}t&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var t=!1,e=!0;e;){let i=this.columns[this.rightCol];i&&i.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);try{t.getElement().removeChild(e.getElement())}catch(t){console.warn("Could not removeColRight",t.message)}}}),this.vDomPadRight+=i.getWidth(),this.rightCol--,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.rightCol=this.rightCol)})):e=!1}t&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var t=!1,e=!0;e;){let i=this.columns[this.leftCol];i&&i.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(t=!0,this.getVisibleRows().forEach(t=>{if("group"!==t.type){var e=t.getCell(i);try{t.getElement().removeChild(e.getElement())}catch(t){console.warn("Could not removeColLeft",t.message)}}}),this.vDomPadLeft+=i.getWidth(),this.leftCol++,this.getVisibleRows().forEach(t=>{"group"!==t.type&&(t.modules.vdomHoz.leftCol=this.leftCol)})):e=!1}t&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(t){var e,i;return t.modules.vdomHoz.fitDataCheck&&(t.reinitializeWidth(),(i=(e=t.getWidth())-t.modules.vdomHoz.width)&&(t.modules.vdomHoz.rightPos+=i,t.modules.vdomHoz.width=e,this.colPositionAdjust(this.columns.indexOf(t)+1,this.columns.length,i)),t.modules.vdomHoz.fitDataCheck=!1),i}initializeRow(t){if("group"!==t.type){t.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(e=>{this.appendCell(t,e)});for(let e=this.leftCol;e<=this.rightCol;e++)this.appendCell(t,this.columns[e]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(e=>{this.appendCell(t,e)})}}appendCell(t,e){if(e&&e.visible){let i=t.getCell(e);t.getElement().appendChild(i.getElement()),i.cellRendered()}}reinitializeRow(t,e){if("group"!==t.type&&(e||!t.modules.vdomHoz||t.modules.vdomHoz.leftCol!==this.leftCol||t.modules.vdomHoz.rightCol!==this.rightCol)){for(var i=t.getElement();i.firstChild;)i.removeChild(i.firstChild);this.initializeRow(t)}}}class re extends jt{constructor(t){super(t),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new ie(this.table,"column definition",Zt),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(t){this.table.rtl?this.headersElement.style.marginLeft=t+"px":this.headersElement.style.marginRight=t+"px"}initializeRenderer(){var t,e={virtual:oe,basic:se};(t="string"==typeof this.table.options.renderHorizontal?e[this.table.options.renderHorizontal]:this.table.options.renderHorizontal)?(this.renderer=new t(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var t=document.createElement("div");return t.classList.add("tabulator-headers"),t.setAttribute("role","row"),t}createHeaderContentsElement(){var t=document.createElement("div");return t.classList.add("tabulator-header-contents"),t.setAttribute("role","rowgroup"),t}createHeaderElement(){var t=document.createElement("div");return t.classList.add("tabulator-header"),t.setAttribute("role","rowgroup"),this.table.options.headerVisible||t.classList.add("tabulator-header-hidden"),t}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(t){this.contentsElement.scrollLeft=t,this.scrollLeft=t,this.renderer.scrollColumns(t)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",t=>{var e;t.deltaX&&(e=this.contentsElement.scrollLeft+t.deltaX,this.table.rowManager.scrollHorizontal(e),this.table.columnManager.scrollHorizontal(e))})}generateColumnsFromRowData(t){var e=[],i={},n="full"===this.table.options.autoColumns?t:[t[0]],s=this.table.options.autoColumnsDefinitions;if(t&&t.length){if(n.forEach(t=>{Object.keys(t).forEach((n,s)=>{let o,r=t[n];i[n]?!0!==i[n]&&void 0!==r&&(i[n].sorter=this.calculateSorterFromValue(r),i[n]=!0):(o={field:n,title:n,sorter:this.calculateSorterFromValue(r)},e.splice(s,0,o),i[n]=void 0!==r||o)})}),s)switch(typeof s){case"function":this.table.options.columns=s.call(this.table,e);break;case"object":Array.isArray(s)?e.forEach(t=>{var e=s.find(e=>e.field===t.field);e&&Object.assign(t,e)}):e.forEach(t=>{s[t.field]&&Object.assign(t,s[t.field])}),this.table.options.columns=e}else this.table.options.columns=e;this.setColumns(this.table.options.columns)}}calculateSorterFromValue(t){var e;switch(typeof t){case"undefined":e="string";break;case"boolean":e="boolean";break;case"number":e="number";break;case"object":e=Array.isArray(t)?"array":"string";break;default:e=isNaN(t)||""===t?t.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?"alphanum":"string":"number"}return e}setColumns(t,e){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.dispatchExternal("columnsLoading"),this.table.options.rowHeader&&(this.rowHeader=new Jt(!0===this.table.options.rowHeader?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),t.forEach((t,e)=>{this._addColumn(t)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.subscribedExternal("columnsLoaded")&&this.dispatchExternal("columnsLoaded",this.getComponents()),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(t,e,i){var n=new Jt(t,this),s=n.getElement(),o=i?this.findColumnIndex(i):i;if(!e||!this.rowHeader||i&&i!==this.rowHeader||(e=!1,i=this.rowHeader,o=0),i&&o>-1){var r=i.getTopColumn(),a=this.columns.indexOf(r),l=r.getElement();e?(this.columns.splice(a,0,n),l.parentNode.insertBefore(s,l)):(this.columns.splice(a+1,0,n),l.parentNode.insertBefore(s,l.nextSibling))}else e?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(t){t.definition.field&&(this.columnsByField[t.definition.field]=t)}registerColumnPosition(t){this.columnsByIndex.push(t)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(t){t.reRegisterPosition()})}verticalAlignHeaders(){var t=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(t=>{t.clearVerticalAlign()}),this.columns.forEach(e=>{var i=e.getHeight();i>t&&(t=i)}),this.headersElement.style.height=t+"px",this.columns.forEach(e=>{e.verticalAlign(this.table.options.columnHeaderVertAlign,t)}),this.table.rowManager.adjustTableSize())}findColumn(t){var e;return"object"!=typeof t?this.columnsByField[t]||!1:t instanceof Jt?t:t instanceof Yt?t._getSelf()||!1:"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&(e=[],this.columns.forEach(t=>{e.push(t),e=e.concat(t.getColumns(!0))}),e.find(e=>e.element===t)||!1)}getColumnByField(t){return this.columnsByField[t]}getColumnsByFieldRoot(t){var e=[];return Object.keys(this.columnsByField).forEach(i=>{(this.table.options.nestedFieldSeparator?i.split(this.table.options.nestedFieldSeparator)[0]:i)===t&&e.push(this.columnsByField[i])}),e}getColumnByIndex(t){return this.columnsByIndex[t]}getFirstVisibleColumn(){var t=this.columnsByIndex.findIndex(t=>t.visible);return t>-1&&this.columnsByIndex[t]}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(t=>t.visible)}getColumns(){return this.columns}findColumnIndex(t){return this.columnsByIndex.findIndex(e=>t===e)}getRealColumns(){return this.columnsByIndex}traverse(t){this.columnsByIndex.forEach((e,i)=>{t(e,i)})}getDefinitions(t){var e=[];return this.columnsByIndex.forEach(i=>{(!t||t&&i.visible)&&e.push(i.getDefinition())}),e}getDefinitionTree(){var t=[];return this.columns.forEach(e=>{t.push(e.getDefinition(!0))}),t}getComponents(t){var e=[];return(t?this.columns:this.columnsByIndex).forEach(t=>{e.push(t.getComponent())}),e}getWidth(){var t=0;return this.columnsByIndex.forEach(e=>{e.visible&&(t+=e.getWidth())}),t}moveColumn(t,e,i){e.element.parentNode.insertBefore(t.element,e.element),i&&e.element.parentNode.insertBefore(e.element,t.element),this.moveColumnActual(t,e,i),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(t,e,i){t.parent.isGroup?this._moveColumnInArray(t.parent.columns,t,e,i):this._moveColumnInArray(this.columns,t,e,i),this._moveColumnInArray(this.columnsByIndex,t,e,i,!0),this.rerenderColumns(!0),this.dispatch("column-moved",t,e,i),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",t.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(t,e,i,n,s){var o,r=t.indexOf(e);r>-1&&(t.splice(r,1),(o=t.indexOf(i))>-1?n&&(o+=1):o=r,t.splice(o,0,e),s&&(this.chain("column-moving-rows",[e,i,n],null,[])||[]).concat(this.table.rowManager.rows).forEach(function(t){if(t.cells.length){var e=t.cells.splice(r,1)[0];t.cells.splice(o,0,e)}}))}scrollToColumn(t,e,i){var n=0,s=t.getLeftOffset(),o=0,r=t.getElement();return new Promise((a,l)=>{if(void 0===e&&(e=this.table.options.scrollToColumnPosition),void 0===i&&(i=this.table.options.scrollToColumnIfVisible),t.visible){switch(e){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=r.clientWidth-this.headersElement.clientWidth}if(!i&&s>0&&s+r.offsetWidth<this.element.clientWidth)return!1;n=s+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),a()}else console.warn("Scroll Error - Column not visible"),l("Scroll Error - Column not visible")})}generateCells(t){var e=[];return this.columnsByIndex.forEach(i=>{e.push(i.generateCell(t))}),e}getFlexBaseWidth(){var t=this.table.element.clientWidth,e=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(t-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(i){var n,s,o;i.visible&&(n=i.definition.width||0,s=parseInt(i.minWidth),o="string"==typeof n?n.indexOf("%")>-1?t/100*parseInt(n):parseInt(n):n,e+=o>s?o:s)}),e}addColumn(t,e,i){return new Promise((n,s)=>{var o=this._addColumn(t,e,i);this._reIndexColumns(),this.dispatch("column-add",t,e,i),"fitColumns"!=this.layoutMode()&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(t){var e,i=t.getField();i&&delete this.columnsByField[i],(e=this.columnsByIndex.indexOf(t))>-1&&this.columnsByIndex.splice(e,1),(e=this.columns.indexOf(t))>-1&&this.columns.splice(e,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(t,e){this.redrawBlock?(!1===t||!0===t&&null===this.redrawBlockUpdate)&&(this.redrawBlockUpdate=t):this.renderer.rerenderColumns(t,e)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(t){Ut.elVisible(this.element)&&this.verticalAlignHeaders(),t&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",t)||this.layoutRefresh(t),this.dispatch("table-redraw",t),this.table.footerManager.redraw()}}class ae extends ne{constructor(t){super(t),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var t=this.tableElement;t.firstChild;)t.removeChild(t.firstChild);t.scrollTop=0,t.scrollLeft=0,t.style.minWidth="",t.style.minHeight="",t.style.display="",t.style.visibility=""}renderRows(){var t=this.tableElement,e=!0,i=document.createDocumentFragment(),n=this.rows();n.forEach((t,n)=>{this.styleRow(t,n),t.initialize(!1,!0),"group"!==t.type&&(e=!1),i.appendChild(t.getElement())}),t.appendChild(i),n.forEach(t=>{t.rendered(),t.heightInitialized||t.calcHeight(!0)}),n.forEach(t=>{t.heightInitialized||t.setCellHeight()}),t.style.minWidth=e?this.table.columnManager.getWidth()+"px":""}rerenderRows(t){this.clearRows(),t&&t(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(t){var e=Ut.elOffset(t.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-e)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-e))}scrollToRow(t){var e=t.getElement();this.elementVertical.scrollTop=Ut.elOffset(e).top-Ut.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(t){return this.rows()}}class le extends ne{constructor(t){super(t),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var t=this.tableElement;t.firstChild;)t.removeChild(t.firstChild);t.style.paddingTop="",t.style.paddingBottom="",t.style.minHeight="",t.style.display="",t.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(t){for(var e=this.elementVertical.scrollTop,i=!1,n=!1,s=this.table.rowManager.scrollLeft,o=this.rows(),r=this.vDomTop;r<=this.vDomBottom;r++)if(o[r]){var a=e-o[r].getElement().offsetTop;if(!(!1===n||Math.abs(a)<n))break;n=a,i=r}o.forEach(t=>{t.deinitializeHeight()}),t&&t(),this.rows().length?this._virtualRenderFill(!1===i?this.rows.length-1:i,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(s)}scrollColumns(t){this.table.rowManager.scrollHorizontal(t)}scrollRows(t,e){var i=t-this.vDomScrollPosTop,n=t-this.vDomScrollPosBottom,s=2*this.vDomWindowBuffer,o=this.rows();if(this.scrollTop=t,-i>s||n>s){var r=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(r)}else e?(i<0&&this._addTopRow(o,-i),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),i>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,i):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(t){var e=this.rows().indexOf(t);return!(Math.abs(this.vDomTop-e)>Math.abs(this.vDomBottom-e))}scrollToRow(t){var e=this.rows().indexOf(t);e>-1&&this._virtualRenderFill(e,!0)}visibleRows(t){var e=this.elementVertical.scrollTop,i=this.elementVertical.clientHeight+e,n=!1,s=0,o=0,r=this.rows();if(t)s=this.vDomTop,o=this.vDomBottom;else for(var a=this.vDomTop;a<=this.vDomBottom;a++)if(r[a])if(n){if(!(i-r[a].getElement().offsetTop>=0))break;o=a}else if(e-r[a].getElement().offsetTop>=0)s=a;else{if(n=!0,!(i-r[a].getElement().offsetTop>=0))break;o=a}return r.slice(s,o+1)}_virtualRenderFill(t,e,i){var n,s,o=this.tableElement,r=this.elementVertical,a=0,l=0,h=0,d=0,c=0,u=0,p=this.rows(),m=p.length,g=0,f=[],v=0,b=0,_=this.table.rowManager.fixedHeight,w=this.elementVertical.clientHeight,y=this.table.options.rowHeight,C=!0;if(i=i||0,t=t||0){for(;o.firstChild;)o.removeChild(o.firstChild);(d=(m-t+1)*this.vDomRowHeight)<w&&(t-=Math.ceil((w-d)/this.vDomRowHeight))<0&&(t=0),t-=a=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),t)}else this.clear();if(m&&Ut.elVisible(this.elementVertical)){for(this.vDomTop=t,this.vDomBottom=t-1,_||this.table.options.maxHeight?(y&&(b=w/y+this.vDomWindowBuffer/y),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=m;(b==m||l<=w+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(f=[],s=document.createDocumentFragment(),u=0;u<b&&this.vDomBottom<m-1;)n=p[g=this.vDomBottom+1],this.styleRow(n,g),n.initialize(!1,!0),n.heightInitialized||this.table.options.rowHeight||n.clearCellHeight(),s.appendChild(n.getElement()),f.push(n),this.vDomBottom++,u++;if(!f.length)break;o.appendChild(s),f.forEach(t=>{t.rendered(),t.heightInitialized||t.calcHeight(!0)}),f.forEach(t=>{t.heightInitialized||t.setCellHeight()}),f.forEach(t=>{h=t.getHeight(),v<a?c+=h:l+=h,h>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*h),v++}),C=this.table.rowManager.adjustTableSize(),w=this.elementVertical.clientHeight,C&&(_||this.table.options.maxHeight)&&(y=l/v,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w/y+this.vDomWindowBuffer/y)))}t?(this.vDomTopPad=e?this.vDomRowHeight*this.vDomTop+i:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-l-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((l+c)/v),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=c+l+this.vDomBottomPad-w),o.style.paddingTop=this.vDomTopPad+"px",o.style.paddingBottom=this.vDomBottomPad+"px",e&&(this.scrollTop=this.vDomTopPad+c+i-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-w:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-w),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&e&&(this.scrollTop+=this.elementVertical.offsetHeight-w),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,r.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(t,e){for(var i=this.tableElement,n=[],s=0,o=this.vDomTop-1,r=0,a=!0;a;)if(this.vDomTop){let l,h,d=t[o];d&&r<this.vDomMaxRenderChain?(l=d.getHeight()||this.vDomRowHeight,h=d.initialized,e>=l?(this.styleRow(d,o),i.insertBefore(d.getElement(),i.firstChild),d.initialized&&d.heightInitialized||n.push(d),d.initialize(),h||(l=d.getElement().offsetHeight,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*l)),e-=l,s+=l,this.vDomTop--,o--,r++):a=!1):a=!1}else a=!1;for(let t of n)t.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomTopPad-=s,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),i.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=s)}_removeTopRow(t,e){for(var i=[],n=0,s=0,o=!0;o;){let r,a=t[this.vDomTop];a&&s<this.vDomMaxRenderChain?(r=a.getHeight()||this.vDomRowHeight,e>=r?(this.vDomTop++,e-=r,n+=r,i.push(a),s++):o=!1):o=!1}for(let t of i){let e=t.getElement();e.parentNode&&e.parentNode.removeChild(e)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(t,e){for(var i=this.tableElement,n=[],s=0,o=this.vDomBottom+1,r=0,a=!0;a;){let l,h,d=t[o];d&&r<this.vDomMaxRenderChain?(l=d.getHeight()||this.vDomRowHeight,h=d.initialized,e>=l?(this.styleRow(d,o),i.appendChild(d.getElement()),d.initialized&&d.heightInitialized||n.push(d),d.initialize(),h||(l=d.getElement().offsetHeight,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=2*l)),e-=l,s+=l,this.vDomBottom++,o++,r++):a=!1):a=!1}for(let t of n)t.clearCellHeight();this._quickNormalizeRowHeight(n),s&&(this.vDomBottomPad-=s,(this.vDomBottomPad<0||o==t.length-1)&&(this.vDomBottomPad=0),i.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=s)}_removeBottomRow(t,e){for(var i=[],n=0,s=0,o=!0;o;){let r,a=t[this.vDomBottom];a&&s<this.vDomMaxRenderChain?(r=a.getHeight()||this.vDomRowHeight,e>=r?(this.vDomBottom--,e-=r,n+=r,i.push(a),s++):o=!1):o=!1}for(let t of i){let e=t.getElement();e.parentNode&&e.parentNode.removeChild(e)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(t){for(let e of t)e.calcHeight();for(let e of t)e.setCellHeight()}}class he extends jt{constructor(t){super(t),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var t=document.createElement("div");return t.classList.add("tabulator-tableholder"),t.setAttribute("tabindex",0),t}createTableElement(){var t=document.createElement("div");return t.classList.add("tabulator-table"),t.setAttribute("role","rowgroup"),t}initializePlaceholder(){var t=this.table.options.placeholder;if("function"==typeof t&&(t=t.call(this.table)),t=this.chain("placeholder",[t],t,t)||t){let e=document.createElement("div");if(e.classList.add("tabulator-placeholder"),"string"==typeof t){let i=document.createElement("div");i.classList.add("tabulator-placeholder-contents"),i.innerHTML=t,e.appendChild(i),this.placeholderContents=i}else"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?(e.appendChild(t),this.placeholderContents=t):(console.warn("Invalid placeholder provided, must be string or HTML Element",t),this.el=null);this.placeholder=e}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var t=this.element.scrollLeft,e=this.scrollLeft>t,i=this.element.scrollTop,n=this.scrollTop>i;this.scrollLeft!=t&&(this.scrollLeft=t,this.dispatch("scroll-horizontal",t,e),this.dispatchExternal("scrollHorizontal",t,e),this._positionPlaceholder()),this.scrollTop!=i&&(this.scrollTop=i,this.renderer.scrollRows(i,n),this.dispatch("scroll-vertical",i,n),this.dispatchExternal("scrollVertical",i,n))})}findRow(t){return"object"!=typeof t?void 0!==t&&(this.rows.find(e=>e.data[this.table.options.index]==t)||!1):t instanceof te?t:t instanceof Qt?t._getSelf()||!1:"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&this.rows.find(e=>e.getElement()===t)||!1}getRowFromDataObject(t){return this.rows.find(e=>e.data===t)||!1}getRowFromPosition(t){return this.getDisplayRows().find(e=>"row"===e.type&&e.getPosition()===t&&e.isDisplayed())}scrollToRow(t,e,i){return this.renderer.scrollToRowPosition(t,e,i)}setData(t,e,i){return new Promise((n,s)=>{e&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(t,!0):this.reRenderInPosition(()=>{this._setDataActual(t)}):(this.table.options.autoColumns&&i&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(t),this.resetScroll(),this._setDataActual(t)),n()})}_setDataActual(t,e){this.dispatchExternal("dataProcessing",t),this._wipeElements(),Array.isArray(t)?(this.dispatch("data-processing",t),t.forEach((t,e)=>{if(t&&"object"==typeof t){var i=new te(t,this);this.rows.push(i)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",t)}),this.refreshActiveData(!1,!1,e),this.dispatch("data-processed",t),this.dispatchExternal("dataProcessed",t)):console.error("Data Loading Error - Unable to process data due to invalid data type \nExpecting: array \nReceived: ",typeof t,"\nData:     ",t)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(t=>{t.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(t,e){var i=this.rows.indexOf(t),n=this.activeRows.indexOf(t);n>-1&&this.activeRows.splice(n,1),i>-1&&this.rows.splice(i,1),this.setActiveRows(this.activeRows),this.displayRowIterator(e=>{var i=e.indexOf(t);i>-1&&e.splice(i,1)}),e||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",t.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(t,e,i,n){return this.addRowActual(t,e,i,n)}addRows(t,e,i,n){var s=[];return new Promise((o,r)=>{e=this.findAddRowPos(e),Array.isArray(t)||(t=[t]),(void 0===i&&e||void 0!==i&&!e)&&t.reverse(),t.forEach((t,n)=>{var o=this.addRow(t,e,i,!0);s.push(o),this.dispatch("row-added",o,t,e,i)}),this.refreshActiveData(!!n&&"displayPipeline",!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(s)})}findAddRowPos(t){return void 0===t&&(t=this.table.options.addRowPos),"pos"===t&&(t=!0),"bottom"===t&&(t=!1),t}addRowActual(t,e,i,n){var s,o,r=t instanceof te?t:new te(t||{},this),a=this.findAddRowPos(e),l=-1;return i||(o=this.chain("row-adding-position",[r,a],null,{index:i,top:a}),i=o.index,a=o.top),void 0!==i&&(i=this.findRow(i)),(i=this.chain("row-adding-index",[r,i,a],null,i))&&(l=this.rows.indexOf(i)),i&&l>-1?(s=this.activeRows.indexOf(i),this.displayRowIterator(function(t){var e=t.indexOf(i);e>-1&&t.splice(a?e:e+1,0,r)}),s>-1&&this.activeRows.splice(a?s:s+1,0,r),this.rows.splice(a?l:l+1,0,r)):a?(this.displayRowIterator(function(t){t.unshift(r)}),this.activeRows.unshift(r),this.rows.unshift(r)):(this.displayRowIterator(function(t){t.push(r)}),this.activeRows.push(r),this.rows.push(r)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",r.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),r}moveRow(t,e,i){this.dispatch("row-move",t,e,i),this.moveRowActual(t,e,i),this.regenerateRowPositions(),this.dispatch("row-moved",t,e,i),this.dispatchExternal("rowMoved",t.getComponent())}moveRowActual(t,e,i){this.moveRowInArray(this.rows,t,e,i),this.moveRowInArray(this.activeRows,t,e,i),this.displayRowIterator(n=>{this.moveRowInArray(n,t,e,i)}),this.dispatch("row-moving",t,e,i)}moveRowInArray(t,e,i,n){var s,o,r;if(e!==i&&((s=t.indexOf(e))>-1&&(t.splice(s,1),(o=t.indexOf(i))>-1?n?t.splice(o+1,0,e):t.splice(o,0,e):t.splice(s,0,e)),t===this.getDisplayRows())){r=o>s?o:s+1;for(let e=s<o?s:o;e<=r;e++)t[e]&&this.styleRow(t[e],e)}}clearData(){this.setData([])}getRowIndex(t){return this.findRowIndex(t,this.rows)}getDisplayRowIndex(t){var e=this.getDisplayRows().indexOf(t);return e>-1&&e}nextDisplayRow(t,e){var i=this.getDisplayRowIndex(t),n=!1;return!1!==i&&i<this.displayRowsCount-1&&(n=this.getDisplayRows()[i+1]),!n||n instanceof te&&"row"==n.type?n:this.nextDisplayRow(n,e)}prevDisplayRow(t,e){var i=this.getDisplayRowIndex(t),n=!1;return i&&(n=this.getDisplayRows()[i-1]),!e||!n||n instanceof te&&"row"==n.type?n:this.prevDisplayRow(n,e)}findRowIndex(t,e){var i;return!!((t=this.findRow(t))&&(i=e.indexOf(t))>-1)&&i}getData(t,e){var i=[];return this.getRows(t).forEach(function(t){"row"==t.type&&i.push(t.getData(e||"data"))}),i}getComponents(t){var e=[];return this.getRows(t).forEach(function(t){e.push(t.getComponent())}),e}getDataCount(t){return this.getRows(t).length}scrollHorizontal(t){this.scrollLeft=t,this.element.scrollLeft=t,this.dispatch("scroll-horizontal",t)}registerDataPipelineHandler(t,e){void 0!==e?(this.dataPipeline.push({handler:t,priority:e}),this.dataPipeline.sort((t,e)=>t.priority-e.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(t,e){void 0!==e?(this.displayPipeline.push({handler:t,priority:e}),this.displayPipeline.sort((t,e)=>t.priority-e.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(t,e,i){var n=this.table,s="",o=0,r=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if("function"==typeof t)if((o=this.dataPipeline.findIndex(e=>e.handler===t))>-1)s="dataPipeline",e&&(o==this.dataPipeline.length-1?s="display":o++);else{if(!((o=this.displayPipeline.findIndex(e=>e.handler===t))>-1))return void console.error("Unable to refresh data, invalid handler provided",t);s="displayPipeline",e&&(o==this.displayPipeline.length-1?s="end":o++)}else s=t||"all",o=0;if(this.redrawBlock)return void((!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===s&&o<this.redrawBlockRestoreConfig.index||r.indexOf(s)<r.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:t,skipStage:e,renderInPosition:i,stage:s,index:o}));Ut.elVisible(this.element)?i?this.reRenderInPosition(this.refreshPipelines.bind(this,t,s,o,i)):(this.refreshPipelines(t,s,o,i),t||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(t,s,o,i),this.dispatch("data-refreshed")}}refreshPipelines(t,e,i,n){switch(this.dispatch("data-refreshing"),t&&this.activeRowsPipeline[0]||(this.activeRowsPipeline[0]=this.rows.slice(0)),e){case"all":case"dataPipeline":for(let t=i;t<this.dataPipeline.length;t++){let e=this.dataPipeline[t].handler(this.activeRowsPipeline[t].slice(0));this.activeRowsPipeline[t+1]=e||this.activeRowsPipeline[t].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":i=0,this.resetDisplayRows();case"displayPipeline":for(let t=i;t<this.displayPipeline.length;t++){let e=this.displayPipeline[t].handler((t?this.getDisplayRows(t-1):this.activeRows).slice(0),n);this.setDisplayRows(e||this.getDisplayRows(t-1).slice(0),t)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var t=this.getDisplayRows(),e=1;t.forEach(t=>{"row"===t.type&&(t.setPosition(e),e++)})}setActiveRows(t){this.activeRows=this.activeRows=Object.assign([],t),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(t,e){this.displayRows[e]=t,e==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(t){return void 0===t?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[t]||[]}getVisibleRows(t,e){var i=Object.assign([],this.renderer.visibleRows(!e));return t&&(i=this.chain("rows-visible",[e],i,i)),i}displayRowIterator(t){this.activeRowsPipeline.forEach(t),this.displayRows.forEach(t),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(t){var e=[];switch(t){case"active":e=this.activeRows;break;case"display":e=this.table.rowManager.getDisplayRows();break;case"visible":e=this.getVisibleRows(!1,!0);break;default:e=this.chain("rows-retrieve",t,null,this.rows)||this.rows}return e}reRenderInPosition(t){this.redrawBlock?t?t():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(t),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var t=0;this.element.scrollHeight>this.element.clientHeight&&(t=this.element.offsetWidth-this.element.clientWidth),t!==this.scrollbarWidth&&(this.scrollbarWidth=t,this.dispatch("scrollbar-vertical",t))}initializeRenderer(){var t,e={virtual:le,basic:ae};(t="string"==typeof this.table.options.renderVertical?e[this.table.options.renderVertical]:this.table.options.renderVertical)?(this.renderMode=this.table.options.renderVertical,this.renderer=new t(this.table,this.element,this.tableElement),this.renderer.initialize(),!this.table.element.clientHeight&&!this.table.options.height||this.table.options.minHeight&&this.table.options.maxHeight?this.fixedHeight=!1:this.fixedHeight=!0):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(t,e){var i=t.getElement();e%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}normalizeHeight(t){this.activeRows.forEach(function(e){e.normalizeHeight(t)})}adjustTableSize(){let t,e=this.element.clientHeight,i=!1;if("fill"===this.renderer.verticalFillMode){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){t=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const e="calc(100% - "+n+"px)";this.element.style.minHeight=t||"calc(100% - "+n+"px)",this.element.style.height=e,this.element.style.maxHeight=e}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),this.fixedHeight||e==this.element.clientHeight||(i=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),i}reinitialize(){this.rows.forEach(function(t){t.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(t){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,t?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,"ie"===this.table.browser){var t=document.createEvent("Event");t.initEvent("scroll",!1,!0),this.element.dispatchEvent(t)}else this.element.dispatchEvent(new Event("scroll"))}}class de extends jt{constructor(t){super(t),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var t=document.createElement("div");return t.classList.add("tabulator-footer"),t}createContainerElement(){var t=document.createElement("div");return t.classList.add("tabulator-footer-contents"),this.element.appendChild(t),t}initializeElement(){this.table.options.footerElement&&("string"==typeof this.table.options.footerElement?"<"===this.table.options.footerElement[0]?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement)):this.element=this.table.options.footerElement)}getElement(){return this.element}append(t){this.activate(),this.containerElement.appendChild(t),this.table.rowManager.adjustTableSize()}prepend(t){this.activate(),this.element.insertBefore(t,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(t){t.parentNode.removeChild(t),this.deactivate()}deactivate(t){this.element.firstChild&&!t||(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class ce extends jt{constructor(t){super(t),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var t={};this.listeners.forEach(e=>{t[e]={handler:null,components:[]}}),this.listeners=t}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(t=>{this.pseudoTrackers[t].subscriber=this.pseudoMouseEnter.bind(this,t),this.subscribe(t+"-mouseover",this.pseudoTrackers[t].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(t,e,i){this.pseudoTrackers[t].target!==i&&(this.pseudoTrackers[t].target&&this.dispatch(t+"-mouseleave",e,this.pseudoTrackers[t].target),this.pseudoMouseLeave(t,e),this.pseudoTrackers[t].target=i,this.dispatch(t+"-mouseenter",e,i))}pseudoMouseLeave(t,e){var i=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};(i=i.filter(e=>{var i=n[t];return e!==t&&(!i||i&&!i.includes(e))})).forEach(t=>{var i=this.pseudoTrackers[t].target;this.pseudoTrackers[t].target&&(this.dispatch(t+"-mouseleave",e,i),this.pseudoTrackers[t].target=null)})}bindSubscriptionWatchers(){var t=Object.keys(this.listeners),e=Object.values(this.componentMap);for(let i of e)for(let e of t){let t=i+"-"+e;this.subscriptionChange(t,this.subscriptionChanged.bind(this,i,e))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(t,e,i){var n=this.listeners[e].components,s=n.indexOf(t),o=!1;i?-1===s&&(n.push(t),o=!0):this.subscribed(t+"-"+e)||s>-1&&(n.splice(s,1),o=!0),"mouseenter"!==e&&"mouseleave"!==e||this.pseudoTracking||this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let t in this.listeners){let e=this.listeners[t];e.components.length?e.handler||(e.handler=this.track.bind(this,t),this.el.addEventListener(t,e.handler)):e.handler&&(this.el.removeEventListener(t,e.handler),e.handler=null)}}track(t,e){var i=e.composedPath&&e.composedPath()||e.path,n=this.findTargets(i);n=this.bindComponents(t,n),this.triggerEvents(t,e,n),!this.pseudoTracking||"mouseover"!=t&&"mouseleave"!=t||Object.keys(n).length||this.pseudoMouseLeave("none",e)}findTargets(t){var e={};let i=Object.keys(this.componentMap);for(let n of t){let t=n.classList?[...n.classList]:[];if(t.filter(t=>this.abortClasses.includes(t)).length)break;let s=t.filter(t=>i.includes(t));for(let t of s)e[this.componentMap[t]]||(e[this.componentMap[t]]=n)}return e.group&&e.group===e.row&&delete e.row,e}bindComponents(t,e){var i=Object.keys(e).reverse(),n=this.listeners[t],s={},o={},r={};for(let t of i){let i,o=e[t],a=this.previousTargets[t];if(a&&a.target===o)i=a.component;else switch(t){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(i=this.table.rowManager.getVisibleRows(!0).find(t=>t.getElement()===o),e.row&&e.row.parentNode&&e.row.parentNode.closest(".tabulator-row")&&(e[t]=!1));break;case"column":n.components.includes("column")&&(i=this.table.columnManager.findColumn(o));break;case"cell":n.components.includes("cell")&&(s.row instanceof te?i=s.row.findCell(o):e.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"))}i&&(s[t]=i,r[t]={target:o,component:i})}return this.previousTargets=r,Object.keys(e).forEach(t=>{let e=s[t];o[t]=e}),o}triggerEvents(t,e,i){var n=this.listeners[t];for(let s in i)i[s]&&n.components.includes(s)&&this.dispatch(s+"-"+t,e,i[s])}clearWatchers(){for(let t in this.listeners){let e=this.listeners[t];e.handler&&(this.el.removeEventListener(t,e.handler),e.handler=null)}}}class ue{constructor(t){this.table=t,this.bindings={}}bind(t,e,i){this.bindings[t]||(this.bindings[t]={}),this.bindings[t][e]?console.warn("Unable to bind component handler, a matching function name is already bound",t,e,i):this.bindings[t][e]=i}handle(t,e,i){if(this.bindings[t]&&this.bindings[t][i]&&"function"==typeof this.bindings[t][i].bind)return this.bindings[t][i].bind(null,e);"then"===i||"string"!=typeof i||i.startsWith("_")||this.table.options.debugInvalidComponentFuncs&&console.error("The "+t+" component does not have a "+i+" function, have you checked that you have the correct Tabulator module installed?")}}class pe extends jt{constructor(t){super(t),this.requestOrder=0,this.loading=!1}initialize(){}load(t,e,i,n,s,o){var r=++this.requestOrder;return this.table.destroyed?Promise.resolve():(this.dispatchExternal("dataLoading",t),!t||0!=t.indexOf("{")&&0!=t.indexOf("[")||(t=JSON.parse(t)),this.confirm("data-loading",[t,e,i,s])?(this.loading=!0,s||this.alertLoader(),e=this.chain("data-params",[t,i,s],e||{},e||{}),e=this.mapParams(e,this.table.options.dataSendParams),this.chain("data-load",[t,e,i,s],!1,Promise.resolve([])).then(t=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{Array.isArray(t)||"object"!=typeof t||(t=this.mapParams(t,this.objectInvert(this.table.options.dataReceiveParams)));var e=this.chain("data-loaded",[t],null,t);r==this.requestOrder?(this.clearAlert(),!1!==e&&(this.dispatchExternal("dataLoaded",e),this.table.rowManager.setData(e,n,void 0===o?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(t=>{console.error("Data Load Error: ",t),this.dispatchExternal("dataLoadError",t),s||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})):(this.dispatchExternal("dataLoaded",t),t||(t=[]),this.table.rowManager.setData(t,n,void 0===o?!n:o),Promise.resolve()))}mapParams(t,e){var i={};for(let n in t)i[e.hasOwnProperty(n)?e[n]:n]=t[n];return i}objectInvert(t){var e={};for(let i in t)e[t[i]]=i;return e}blockActiveLoad(){this.requestOrder++}alertLoader(){("function"==typeof this.table.options.dataLoader?this.table.options.dataLoader():this.table.options.dataLoader)&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class me{constructor(t,e,i){this.table=t,this.events={},this.optionsList=e||{},this.subscriptionNotifiers={},this.dispatch=i?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=i}subscriptionChange(t,e){this.subscriptionNotifiers[t]||(this.subscriptionNotifiers[t]=[]),this.subscriptionNotifiers[t].push(e),this.subscribed(t)&&this._notifySubscriptionChange(t,!0)}subscribe(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e),this._notifySubscriptionChange(t,!0)}unsubscribe(t,e){var i;if(this.events[t]){if(e){if(!((i=this.events[t].findIndex(t=>t===e))>-1))return void console.warn("Cannot remove event, no matching event found:",t,e);this.events[t].splice(i,1)}else delete this.events[t];this._notifySubscriptionChange(t,!1)}else console.warn("Cannot remove event, no events set on:",t)}subscribed(t){return this.events[t]&&this.events[t].length}_notifySubscriptionChange(t,e){var i=this.subscriptionNotifiers[t];i&&i.forEach(t=>{t(e)})}_dispatch(){var t,e=Array.from(arguments),i=e.shift();return this.events[i]&&this.events[i].forEach((i,n)=>{let s=i.apply(this.table,e);n||(t=s)}),t}_debugDispatch(){var t=Array.from(arguments),e=t[0];return t[0]="ExternalEvent:"+t[0],(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._dispatch(...arguments)}}class ge{constructor(t){this.events={},this.subscriptionNotifiers={},this.dispatch=t?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=t?this._debugChain.bind(this):this._chain.bind(this),this.confirm=t?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=t}subscriptionChange(t,e){this.subscriptionNotifiers[t]||(this.subscriptionNotifiers[t]=[]),this.subscriptionNotifiers[t].push(e),this.subscribed(t)&&this._notifySubscriptionChange(t,!0)}subscribe(t,e,i=1e4){this.events[t]||(this.events[t]=[]),this.events[t].push({callback:e,priority:i}),this.events[t].sort((t,e)=>t.priority-e.priority),this._notifySubscriptionChange(t,!0)}unsubscribe(t,e){var i;if(this.events[t]){if(e){if(!((i=this.events[t].findIndex(t=>t.callback===e))>-1))return void console.warn("Cannot remove event, no matching event found:",t,e);this.events[t].splice(i,1)}this._notifySubscriptionChange(t,!1)}else console.warn("Cannot remove event, no events set on:",t)}subscribed(t){return this.events[t]&&this.events[t].length}_chain(t,e,i,n){var s=i;return Array.isArray(e)||(e=[e]),this.subscribed(t)?(this.events[t].forEach((t,i)=>{s=t.callback.apply(this,e.concat([s]))}),s):"function"==typeof n?n():n}_confirm(t,e){var i=!1;return Array.isArray(e)||(e=[e]),this.subscribed(t)&&this.events[t].forEach((t,n)=>{t.callback.apply(this,e)&&(i=!0)}),i}_notifySubscriptionChange(t,e){var i=this.subscriptionNotifiers[t];i&&i.forEach(t=>{t(e)})}_dispatch(){var t=Array.from(arguments),e=t.shift();this.events[e]&&this.events[e].forEach(e=>{e.callback.apply(this,t)})}_debugDispatch(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._dispatch(...arguments)}_debugChain(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._chain(...arguments)}_debugConfirm(){var t=Array.from(arguments),e=t[0];return t[0]="InternalEvent:"+e,(!0===this.debug||this.debug.includes(e))&&console.log(...t),this._confirm(...arguments)}}class fe extends jt{constructor(t){super(t)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(t,e,i){var n="";return void 0===this.options(t)||(n="Deprecated Setup Option - Use of the %c"+t+"%c option is now deprecated",e?(n=n+", Please use the %c"+e+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),i&&(this.table.options[e]=this.table.options[t])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1)}checkMsg(t,e){return void 0===this.options(t)||(this._warnUser("%cDeprecated Setup Option - Use of the %c"+t+" %c option is now deprecated, "+e,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1)}msg(t){this._warnUser(t)}}class ve extends jt{constructor(t){super(t),this.deps={},this.props={}}initialize(){this.deps=Object.assign({},this.options("dependencies"))}lookup(t,e,i){if(!Array.isArray(t))return e?this.lookupProp(t,e,i):this.lookupKey(t,i);for(const i of t){var n=this.lookup(i,e,!0);if(n)break}if(n)return n;this.error(t)}lookupProp(t,e,i){var n;return this.props[t]&&this.props[t][e]?this.props[t][e]:(n=this.lookupKey(t,i))?(this.props[t]||(this.props[t]={}),this.props[t][e]=n[e]||n,this.props[t][e]):void 0}lookupKey(t,e){var i;return this.deps[t]?i=this.deps[t]:window[t]?(this.deps[t]=window[t],i=this.deps[t]):e||this.error(t),i}error(t){console.error("Unable to find dependency",t,"Please check documentation and ensure you have imported the required library into your project")}}function be(t,e){t.forEach(function(t){t.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}var _e={fitData:function(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitDataFill:be,fitDataTable:be,fitDataStretch:function(t,e){var i=0,n=this.table.rowManager.element.clientWidth,s=0,o=!1;t.forEach((t,e)=>{t.widthFixed||t.reinitializeWidth(),(this.table.options.responsiveLayout?t.modules.responsive.visible:t.visible)&&(o=t),t.visible&&(i+=t.getWidth())}),o?(s=n-i+o.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(o.setWidth(0),this.table.modules.responsiveLayout.update()),s>0?o.setWidth(s):o.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()},fitColumns:function(t,e){var i,n,s=this.table.rowManager.element.getBoundingClientRect().width,o=0,r=0,a=0,l=[],h=[],d=0,c=0;function u(t){return"string"==typeof t?t.indexOf("%")>-1?s/100*parseInt(t):parseInt(t):t}function p(t,e,i,n){var s=[],o=0,r=0,l=0,h=a,d=0,c=0,m=[];function g(t){return i*(t.column.definition.widthGrow||1)}function f(t){return u(t.width)-i*(t.column.definition.widthShrink||0)}return t.forEach(function(t,o){var r=n?f(t):g(t);t.column.minWidth>=r?s.push(t):t.column.maxWidth&&t.column.maxWidth<r?(t.width=t.column.maxWidth,e-=t.column.maxWidth,(h-=n?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1)&&(i=Math.floor(e/h))):(m.push(t),c+=n?t.column.definition.widthShrink||1:t.column.definition.widthGrow||1)}),s.length?(s.forEach(function(t){o+=n?t.width-t.column.minWidth:t.column.minWidth,t.width=t.column.minWidth}),r=e-o,l=c?Math.floor(r/c):r,d=p(m,r,l,n)):(d=c?e-Math.floor(e/c)*c:e,m.forEach(function(t){t.width=n?f(t):g(t)})),d}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(s-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(t){var e,i,n;t.visible&&(e=t.definition.width,i=parseInt(t.minWidth),e?(n=u(e),o+=n>i?n:i,t.definition.widthShrink&&(h.push({column:t,width:n>i?n:i}),d+=t.definition.widthShrink)):(l.push({column:t,width:0}),a+=t.definition.widthGrow||1))}),r=s-o,i=Math.floor(r/a),c=p(l,r,i,!1),l.length&&c>0&&(l[l.length-1].width+=c),l.forEach(function(t){r-=t.width}),(n=Math.abs(c)+r)>0&&d&&(c=p(h,n,Math.floor(n/d),!0)),c&&h.length&&(h[h.length-1].width-=c),l.forEach(function(t){t.column.setWidth(t.width)}),h.forEach(function(t){t.column.setWidth(t.width)})}};class we extends $t{static moduleName="layout";static modes=_e;constructor(t){super(t,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var t=this.table.options.layout;we.modes[t]?this.mode=t:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+t),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(t){t.definition.widthGrow&&(t.definition.widthGrow=Number(t.definition.widthGrow)),t.definition.widthShrink&&(t.definition.widthShrink=Number(t.definition.widthShrink))}getMode(){return this.mode}layout(t){var e=this.table.columnManager.columnsByIndex.find(t=>t.definition.variableHeight||"textarea"===t.definition.formatter);this.dispatch("layout-refreshing"),we.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,t),e&&this.table.rowManager.normalizeHeight(!0),this.dispatch("layout-refreshed")}}var ye={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class Ce extends $t{static moduleName="localize";static langs=ye;constructor(t){super(t),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Ut.deepClone(Ce.langs),!1!==this.table.options.columnDefaults.headerFilterPlaceholder&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let t in this.table.options.langs)this.installLang(t,this.table.options.langs[t]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(t){this.langList.default.headerFilters.default=t}installLang(t,e){this.langList[t]?this._setLangProp(this.langList[t],e):this.langList[t]=e}_setLangProp(t,e){for(let i in e)t[i]&&"object"==typeof t[i]?this._setLangProp(t[i],e[i]):t[i]=e[i]}setLocale(t){if(!0===(t=t||"default")&&navigator.language&&(t=navigator.language.toLowerCase()),t&&!this.langList[t]){let e=t.split("-")[0];this.langList[e]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",t,e),t=e):(console.warn("Localization Error - Matching locale not found, using default: ",t),t="default")}this.locale=t,this.lang=Ut.deepClone(this.langList.default||{}),"default"!=t&&function t(e,i){for(var n in e)"object"==typeof e[n]?(i[n]||(i[n]={}),t(e[n],i[n])):i[n]=e[n]}(this.langList[t],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(t){return this.locale}getLang(t){return t?this.langList[t]:this.lang}getText(t,e){var i=(e?t+"|"+e:t).split("|");return this._getLangElement(i,this.locale)||""}_getLangElement(t,e){var i=this.lang;return t.forEach(function(t){var e;i&&(e=i[t],i=void 0!==e&&e)}),i}bind(t,e){this.bindings[t]||(this.bindings[t]=[]),this.bindings[t].push(e),e(this.getText(t),this.lang)}_executeBindings(){for(let t in this.bindings)this.bindings[t].forEach(e=>{e(this.getText(t),this.lang)})}}var xe=Object.freeze({__proto__:null,CommsModule:class extends $t{static moduleName="comms";constructor(t){super(t)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(t){var e=[];return this.table.constructor.registry.lookupTable(t).forEach(t=>{this.table!==t&&e.push(t)}),e}send(t,e,i,n){var s=this.getConnections(t);s.forEach(t=>{t.tableComms(this.table.element,e,i,n)}),!s.length&&t&&console.warn("Table Connection Error - No tables matching selector found",t)}receive(t,e,i,n){if(this.table.modExists(e))return this.table.modules[e].commsReceived(t,i,n);console.warn("Inter-table Comms Error - no such module:",e)}},LayoutModule:we,LocalizeModule:Ce});class Ee{static registry={tables:[],register(t){Ee.registry.tables.push(t)},deregister(t){var e=Ee.registry.tables.indexOf(t);e>-1&&Ee.registry.tables.splice(e,1)},lookupTable(t,e){var i,n,s=[];if("string"==typeof t){if((i=document.querySelectorAll(t)).length)for(var o=0;o<i.length;o++)(n=Ee.registry.matchElement(i[o]))&&s.push(n)}else"undefined"!=typeof HTMLElement&&t instanceof HTMLElement||t instanceof Ee?(n=Ee.registry.matchElement(t))&&s.push(n):Array.isArray(t)?t.forEach(function(t){s=s.concat(Ee.registry.lookupTable(t))}):e||console.warn("Table Connection Error - Invalid Selector",t);return s},matchElement:t=>Ee.registry.tables.find(function(e){return t instanceof Ee?e===t:e.element===t})};static findTable(t){var e=Ee.registry.lookupTable(t,!0);return!(Array.isArray(e)&&!e.length)&&e}}class Se extends Ee{static moduleBindings={};static moduleExtensions={};static modulesRegistered=!1;static defaultModules=!1;constructor(){super()}static initializeModuleBinder(t){Se.modulesRegistered||(Se.modulesRegistered=!0,Se._registerModules(xe,!0),t&&Se._registerModules(t))}static _extendModule(t,e,i){if(Se.moduleBindings[t]){var n=Se.moduleBindings[t][e];if(n)if("object"==typeof i)for(let t in i)n[t]=i[t];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",e)}else console.warn("Module Error - module does not exist:",t)}static _registerModules(t,e){var i=Object.values(t);e&&i.forEach(t=>{t.prototype.moduleCore=!0}),Se._registerModule(i)}static _registerModule(t){Array.isArray(t)||(t=[t]),t.forEach(t=>{Se._registerModuleBinding(t),Se._registerModuleExtensions(t)})}static _registerModuleBinding(t){t.moduleName?Se.moduleBindings[t.moduleName]=t:console.error("Unable to bind module, no moduleName defined",t.moduleName)}static _registerModuleExtensions(t){var e=t.moduleExtensions;if(t.moduleExtensions)for(let t in e){let i=e[t];if(Se.moduleBindings[t])for(let e in i)Se._extendModule(t,e,i[e]);else{Se.moduleExtensions[t]||(Se.moduleExtensions[t]={});for(let e in i)Se.moduleExtensions[t][e]||(Se.moduleExtensions[t][e]={}),Object.assign(Se.moduleExtensions[t][e],i[e])}}Se._extendModuleFromQueue(t)}static _extendModuleFromQueue(t){var e=Se.moduleExtensions[t.moduleName];if(e)for(let i in e)Se._extendModule(t.moduleName,i,e[i])}_bindModules(){var t=[],e=[],i=[];for(var n in this.modules={},Se.moduleBindings){let s=Se.moduleBindings[n],o=new s(this);this.modules[n]=o,s.prototype.moduleCore?this.modulesCore.push(o):s.moduleInitOrder?s.moduleInitOrder<0?t.push(o):e.push(o):i.push(o)}t.sort((t,e)=>t.moduleInitOrder>e.moduleInitOrder?1:-1),e.sort((t,e)=>t.moduleInitOrder>e.moduleInitOrder?1:-1),this.modulesRegular=t.concat(i.concat(e))}}class Pe extends jt{constructor(t){super(t),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var t=document.createElement("div");return t.classList.add("tabulator-alert"),t}_createMsgElement(){var t=document.createElement("div");return t.classList.add("tabulator-alert-msg"),t.setAttribute("role","alert"),t}_typeClass(){return"tabulator-alert-state-"+this.type}alert(t,e="msg"){if(t){for(this.clear(),this.dispatch("alert-show",e),this.type=e;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),"function"==typeof t&&(t=t()),t instanceof HTMLElement?this.msgElement.appendChild(t):this.msgElement.innerHTML=t,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class ke extends Se{static defaultOptions=ee;static extendModule(){ke.initializeModuleBinder(),ke._extendModule(...arguments)}static registerModule(){ke.initializeModuleBinder(),ke._registerModule(...arguments)}constructor(t,e,i){super(),ke.initializeModuleBinder(i),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new ue(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new fe(this),this.optionsList=new ie(this,"table constructor"),this.dependencyRegistry=new ve(this),this.initialized=!1,this.destroyed=!1,this.initializeElement(t)&&(this.initializeCoreSystems(e),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(t){return"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?(this.element=t,!0):"string"==typeof t?(this.element=document.querySelector(t),!!this.element||(console.error("Tabulator Creation Error - no element found matching selector: ",t),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",t),!1)}initializeCoreSystems(t){this.columnManager=new re(this),this.rowManager=new he(this),this.footerManager=new de(this),this.dataLoader=new pe(this),this.alertManager=new Pe(this),this._bindModules(),this.options=this.optionsList.generate(ke.defaultOptions,t),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new me(this,this.options,this.options.debugEventsExternal),this.eventBus=new ge(this.options.debugEventsInternal),this.interactionMonitor=new ce(this),this.dataLoader.initialize(),this.footerManager.initialize(),this.dependencyRegistry.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var t=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if("rtl"!==t.direction)break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var t,e=this.element,i=this.options;if("TABLE"===e.tagName){this.originalElement=this.element,t=document.createElement("div");var n=e.attributes;for(var s in n)"object"==typeof n[s]&&t.setAttribute(n[s].name,n[s].value);e.parentNode.replaceChild(t,e),this.element=e=t}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),!1!==i.minHeight&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),!1!==i.maxHeight&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var t=this.element,e=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(t=>{t.initialize()}),t.appendChild(this.columnManager.getElement()),t.appendChild(this.rowManager.getElement()),e.footerElement&&this.footerManager.activate(),e.autoColumns&&e.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(t=>{t.initialize()}),this.columnManager.setColumns(e.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var t=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();t.firstChild;)t.removeChild(t.firstChild);t.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var t=navigator.userAgent||navigator.vendor||window.opera;t.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):t.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):t.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):t.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.slice(0,4))}initGuard(t,e){var i,n;return this.options.debugInitialization&&!this.initialized&&(t||(t=" "==(n="Error"==(i=(new Error).stack.split("\n"))[0]?i[2]:i[1])[0]?n.trim().split(" ")[1].split(".")[1]:n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+t+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(e?" "+e:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(t,e,i){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(t,e,i,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(t){return this.rowManager.getData(t)}getDataCount(t){return this.rowManager.getDataCount(t)}replaceData(t,e,i){return this.initGuard(),this.dataLoader.load(t,e,i,!0,!0)}updateData(t){var e=0;return this.initGuard(),new Promise((i,n)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t&&t.length>0?t.forEach(t=>{var s=this.rowManager.findRow(t[this.options.index]);s?(e++,s.updateData(t).then(()=>{--e||i()}).catch(e=>{n("Update Error - Unable to update row",t,e)})):n("Update Error - Unable to find row",t)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(t,e,i){return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t?this.rowManager.addRows(t,e,i).then(t=>{var e=[];t.forEach(function(t){e.push(t.getComponent())}),n(e)}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}updateOrAddData(t){var e=[],i=0;return this.initGuard(),new Promise((n,s)=>{this.dataLoader.blockActiveLoad(),"string"==typeof t&&(t=JSON.parse(t)),t&&t.length>0?t.forEach(t=>{var s=this.rowManager.findRow(t[this.options.index]);i++,s?s.updateData(t).then(()=>{i--,e.push(s.getComponent()),i||n(e)}):this.rowManager.addRows(t).then(t=>{i--,e.push(t[0].getComponent()),i||n(e)})}):(console.warn("Update Error - No data provided"),s("Update Error - No data provided"))})}getRow(t){var e=this.rowManager.findRow(t);return e?e.getComponent():(console.warn("Find Error - No matching row found:",t),!1)}getRowFromPosition(t){var e=this.rowManager.getRowFromPosition(t);return e?e.getComponent():(console.warn("Find Error - No matching row found:",t),!1)}deleteRow(t){var e=[];this.initGuard(),Array.isArray(t)||(t=[t]);for(let i of t){let t=this.rowManager.findRow(i,!0);if(!t)return console.error("Delete Error - No matching row found:",i),Promise.reject("Delete Error - No matching row found");e.push(t)}return e.sort((t,e)=>this.rowManager.rows.indexOf(t)>this.rowManager.rows.indexOf(e)?1:-1),e.forEach(t=>{t.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(t,e,i){return this.initGuard(),"string"==typeof t&&(t=JSON.parse(t)),this.rowManager.addRows(t,e,i,!0).then(t=>t[0].getComponent())}updateOrAddRow(t,e){var i=this.rowManager.findRow(t);return this.initGuard(),"string"==typeof e&&(e=JSON.parse(e)),i?i.updateData(e).then(()=>i.getComponent()):this.rowManager.addRows(e).then(t=>t[0].getComponent())}updateRow(t,e){var i=this.rowManager.findRow(t);return this.initGuard(),"string"==typeof e&&(e=JSON.parse(e)),i?i.updateData(e).then(()=>Promise.resolve(i.getComponent())):(console.warn("Update Error - No matching row found:",t),Promise.reject("Update Error - No matching row found"))}scrollToRow(t,e,i){var n=this.rowManager.findRow(t);return n?this.rowManager.scrollToRow(n,e,i):(console.warn("Scroll Error - No matching row found:",t),Promise.reject("Scroll Error - No matching row found"))}moveRow(t,e,i){var n=this.rowManager.findRow(t);this.initGuard(),n?n.moveToRow(e,i):console.warn("Move Error - No matching row found:",t)}getRows(t){return this.rowManager.getComponents(t)}getRowPosition(t){var e=this.rowManager.findRow(t);return e?e.getPosition():(console.warn("Position Error - No matching row found:",t),!1)}setColumns(t){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(t)}getColumns(t){return this.columnManager.getComponents(t)}getColumn(t){var e=this.columnManager.findColumn(t);return e?e.getComponent():(console.warn("Find Error - No matching column found:",t),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Show Error - No matching column found:",t),!1;e.show()}hideColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Hide Error - No matching column found:",t),!1;e.hide()}toggleColumn(t){var e=this.columnManager.findColumn(t);if(this.initGuard(),!e)return console.warn("Column Visibility Toggle Error - No matching column found:",t),!1;e.visible?e.hide():e.show()}addColumn(t,e,i){var n=this.columnManager.findColumn(i);return this.initGuard(),this.columnManager.addColumn(t,e,n).then(t=>t.getComponent())}deleteColumn(t){var e=this.columnManager.findColumn(t);return this.initGuard(),e?e.delete():(console.warn("Column Delete Error - No matching column found:",t),Promise.reject())}updateColumnDefinition(t,e){var i=this.columnManager.findColumn(t);return this.initGuard(),i?i.updateDefinition(e):(console.warn("Column Update Error - No matching column found:",t),Promise.reject())}moveColumn(t,e,i){var n=this.columnManager.findColumn(t),s=this.columnManager.findColumn(e);this.initGuard(),n?s?this.columnManager.moveColumn(n,s,i):console.warn("Move Error - No matching column found:",s):console.warn("Move Error - No matching column found:",t)}scrollToColumn(t,e,i){return new Promise((n,s)=>{var o=this.columnManager.findColumn(t);return o?this.columnManager.scrollToColumn(o,e,i):(console.warn("Scroll Error - No matching column found:",t),Promise.reject("Scroll Error - No matching column found"))})}redraw(t){this.initGuard(),this.columnManager.redraw(t),this.rowManager.redraw(t)}setHeight(t){this.options.height=isNaN(t)?t:t+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(t,e){this.externalEvents.subscribe(t,e)}off(t,e){this.externalEvents.unsubscribe(t,e)}dispatchEvent(){Array.from(arguments).shift(),this.externalEvents.dispatch(...arguments)}alert(t,e){this.initGuard(),this.alertManager.alert(t,e)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(t,e){return!!this.modules[t]||(e&&console.error("Tabulator Module Not Installed: "+t),!1)}module(t){var e=this.modules[t];return e||console.error("Tabulator module not installed: "+t),e}}var Ie=ke;let Re=null;function Me(t){Ot("TRACE","[sidebar] colorSwatchCell entry",{color:t});const e=`<div style="background:${(t&&"function"==typeof t?t():t)||"transparent"};border:1px solid #bbb;width:20px;height:20px;display:inline-block;border-radius:4px;"></div>`;return Ot("TRACE","[sidebar] colorSwatchCell exit",{html:e}),e}const Le=Math.PI/180,Te="undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof WorkerGlobalScope?self:{},Ae={_global:Te,version:"10.0.2",isBrowser:"undefined"!=typeof window&&("[object Window]"==={}.toString.call(window)||"[object global]"==={}.toString.call(window)),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle:t=>Ae.angleDeg?t*Le:t,enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_renderBackend:"web",legacyTextRendering:!1,pixelRatio:"undefined"!=typeof window&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging:()=>Ae.DD.isDragging,isTransforming(){var t,e;return null!==(e=null===(t=Ae.Transformer)||void 0===t?void 0:t.isTransforming())&&void 0!==e&&e},isDragReady:()=>!!Ae.DD.node,releaseCanvasOnDestroy:!0,document:Te.document,_injectGlobal(t){void 0!==Te.Konva&&console.error("Severa Konva instances detected. It is not recommended to use multiple Konva instances in the same environment."),Te.Konva=t}},De=t=>{Ae[t.prototype.getClassName()]=t};Ae._injectGlobal(Ae);const ze=()=>{if("undefined"==typeof document)throw new Error('Konva.js unsupported environment.\n\nLooks like you are trying to use Konva.js in Node.js environment. because "document" object is undefined.\n\nTo use Konva.js in Node.js environment, you need to use the "canvas-backend" or "skia-backend" module.\n\nbash: npm install canvas\njs: import "konva/canvas-backend";\n\nor\n\nbash: npm install skia-canvas\njs: import "konva/skia-backend";\n')};class Oe{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new Oe(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){const e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,s=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,r=this.m[1]*-i+this.m[3]*e;return this.m[0]=n,this.m[1]=s,this.m[2]=o,this.m[3]=r,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){const i=this.m[0]+this.m[2]*e,n=this.m[1]+this.m[3]*e,s=this.m[2]+this.m[0]*t,o=this.m[3]+this.m[1]*t;return this.m[0]=i,this.m[1]=n,this.m[2]=s,this.m[3]=o,this}multiply(t){const e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],s=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],r=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r,this}invert(){const t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,s=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),r=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=s,this.m[4]=o,this.m[5]=r,this}getMatrix(){return this.m}decompose(){const t=this.m[0],e=this.m[1],i=this.m[2],n=this.m[3],s=t*n-e*i,o={x:this.m[4],y:this.m[5],rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(0!=t||0!=e){const r=Math.sqrt(t*t+e*e);o.rotation=e>0?Math.acos(t/r):-Math.acos(t/r),o.scaleX=r,o.scaleY=s/r,o.skewX=(t*i+e*n)/s,o.skewY=0}else if(0!=i||0!=n){const r=Math.sqrt(i*i+n*n);o.rotation=Math.PI/2-(n>0?Math.acos(-i/r):-Math.acos(i/r)),o.scaleX=s/r,o.scaleY=r,o.skewX=0,o.skewY=(t*i+e*n)/s}return o.rotation=je._getRotation(o.rotation),o}}const Be=Math.PI/180,He=180/Math.PI,Ne="Konva error: ",Ve={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},Fe=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;let Ge=[];const We="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||function(t){setTimeout(t,60)},je={_isElement:t=>!(!t||1!=t.nodeType),_isFunction:t=>!!(t&&t.constructor&&t.call&&t.apply),_isPlainObject:t=>!!t&&t.constructor===Object,_isArray:t=>"[object Array]"===Object.prototype.toString.call(t),_isNumber:t=>"[object Number]"===Object.prototype.toString.call(t)&&!isNaN(t)&&isFinite(t),_isString:t=>"[object String]"===Object.prototype.toString.call(t),_isBoolean:t=>"[object Boolean]"===Object.prototype.toString.call(t),isObject:t=>t instanceof Object,isValidSelector(t){if("string"!=typeof t)return!1;const e=t[0];return"#"===e||"."===e||e===e.toUpperCase()},_sign:t=>0===t||t>0?1:-1,requestAnimFrame(t){Ge.push(t),1===Ge.length&&We(function(){const t=Ge;Ge=[],t.forEach(function(t){t()})})},createCanvasElement(){ze();const t=document.createElement("canvas");try{t.style=t.style||{}}catch(t){}return t},createImageElement:()=>(ze(),document.createElement("img")),_isInDocument(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_urlToImage(t,e){const i=je.createImageElement();i.onload=function(){e(i)},i.src=t},_rgbToHex:(t,e,i)=>((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1),_hexToRgb(t){t=t.replace("#","");const e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},getRandomColor(){let t=(16777215*Math.random()|0).toString(16);for(;t.length<6;)t="0"+t;return"#"+t},getRGB(t){let e;return t in Ve?(e=Ve[t],{r:e[0],g:e[1],b:e[2]}):"#"===t[0]?this._hexToRgb(t.substring(1)):"rgb("===t.substr(0,4)?(e=Fe.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)}):{r:0,g:0,b:0}},colorToRGBA:t=>(t=t||"black",je._namedColorToRBA(t)||je._hex3ColorToRGBA(t)||je._hex4ColorToRGBA(t)||je._hex6ColorToRGBA(t)||je._hex8ColorToRGBA(t)||je._rgbColorToRGBA(t)||je._rgbaColorToRGBA(t)||je._hslColorToRGBA(t)),_namedColorToRBA(t){const e=Ve[t.toLowerCase()];return e?{r:e[0],g:e[1],b:e[2],a:1}:null},_rgbColorToRGBA(t){if(0===t.indexOf("rgb(")){const e=(t=t.match(/rgb\(([^)]+)\)/)[1]).split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(0===t.indexOf("rgba(")){const e=(t=t.match(/rgba\(([^)]+)\)/)[1]).split(/ *, */).map((t,e)=>"%"===t.slice(-1)?3===e?parseInt(t)/100:parseInt(t)/100*255:Number(t));return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if("#"===t[0]&&9===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if("#"===t[0]&&7===t.length)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if("#"===t[0]&&5===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if("#"===t[0]&&4===t.length)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){const[e,...i]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),n=Number(i[0])/360,s=Number(i[1])/100,o=Number(i[2])/100;let r,a,l;if(0===s)return l=255*o,{r:Math.round(l),g:Math.round(l),b:Math.round(l),a:1};r=o<.5?o*(1+s):o+s-o*s;const h=2*o-r,d=[0,0,0];for(let t=0;t<3;t++)a=n+1/3*-(t-1),a<0&&a++,a>1&&a--,l=6*a<1?h+6*(r-h)*a:2*a<1?r:3*a<2?h+(r-h)*(2/3-a)*6:h,d[t]=255*l;return{r:Math.round(d[0]),g:Math.round(d[1]),b:Math.round(d[2]),a:1}}},haveIntersection:(t,e)=>!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y),cloneObject(t){const e={};for(const i in t)this._isPlainObject(t[i])?e[i]=this.cloneObject(t[i]):this._isArray(t[i])?e[i]=this.cloneArray(t[i]):e[i]=t[i];return e},cloneArray:t=>t.slice(0),degToRad:t=>t*Be,radToDeg:t=>t*He,_degToRad:t=>(je.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),je.degToRad(t)),_radToDeg:t=>(je.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),je.radToDeg(t)),_getRotation:t=>Ae.angleDeg?je.radToDeg(t):t,_capitalize:t=>t.charAt(0).toUpperCase()+t.slice(1),throw(t){throw new Error(Ne+t)},error(t){console.error(Ne+t)},warn(t){Ae.showWarnings&&console.warn("Konva warning: "+t)},each(t,e){for(const i in t)e(i,t[i])},_inRange:(t,e,i)=>e<=t&&t<i,_getProjectionToSegment(t,e,i,n,s,o){let r,a,l;const h=(t-i)*(t-i)+(e-n)*(e-n);if(0==h)r=t,a=e,l=(s-i)*(s-i)+(o-n)*(o-n);else{const d=((s-t)*(i-t)+(o-e)*(n-e))/h;d<0?(r=t,a=e,l=(t-s)*(t-s)+(e-o)*(e-o)):d>1?(r=i,a=n,l=(i-s)*(i-s)+(n-o)*(n-o)):(r=t+d*(i-t),a=e+d*(n-e),l=(r-s)*(r-s)+(a-o)*(a-o))}return[r,a,l]},_getProjectionToLine(t,e,i){const n=je.cloneObject(t);let s=Number.MAX_VALUE;return e.forEach(function(o,r){if(!i&&r===e.length-1)return;const a=e[(r+1)%e.length],l=je._getProjectionToSegment(o.x,o.y,a.x,a.y,t.x,t.y),h=l[0],d=l[1],c=l[2];c<s&&(n.x=h,n.y=d,s=c)}),n},_prepareArrayForTween(t,e,i){const n=[],s=[];if(t.length>e.length){const i=e;e=t,t=i}for(let e=0;e<t.length;e+=2)n.push({x:t[e],y:t[e+1]});for(let t=0;t<e.length;t+=2)s.push({x:e[t],y:e[t+1]});const o=[];return s.forEach(function(t){const e=je._getProjectionToLine(t,n,i);o.push(e.x),o.push(e.y)}),o},_prepareToStringify(t){let e;t.visitedByCircularReferenceRemoval=!0;for(const i in t)if(t.hasOwnProperty(i)&&t[i]&&"object"==typeof t[i])if(e=Object.getOwnPropertyDescriptor(t,i),t[i].visitedByCircularReferenceRemoval||je._isElement(t[i])){if(!e.configurable)return null;delete t[i]}else if(null===je._prepareToStringify(t[i])){if(!e.configurable)return null;delete t[i]}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(const i in e)t[i]=e[i];return t},_getFirstPointerId:t=>t.touches?t.changedTouches[0].identifier:t.pointerId||999,releaseCanvas(...t){Ae.releaseCanvasOnDestroy&&t.forEach(t=>{t.width=0,t.height=0})},drawRoundedRectPath(t,e,i,n){let s=e<0?e:0,o=i<0?i:0;e=Math.abs(e),i=Math.abs(i);let r=0,a=0,l=0,h=0;"number"==typeof n?r=a=l=h=Math.min(n,e/2,i/2):(r=Math.min(n[0]||0,e/2,i/2),a=Math.min(n[1]||0,e/2,i/2),h=Math.min(n[2]||0,e/2,i/2),l=Math.min(n[3]||0,e/2,i/2)),t.moveTo(s+r,o),t.lineTo(s+e-a,o),t.arc(s+e-a,o+a,a,3*Math.PI/2,0,!1),t.lineTo(s+e,o+i-h),t.arc(s+e-h,o+i-h,h,0,Math.PI/2,!1),t.lineTo(s+l,o+i),t.arc(s+l,o+i-l,l,Math.PI/2,Math.PI,!1),t.lineTo(s,o+r),t.arc(s+r,o+r,r,Math.PI,3*Math.PI/2,!1)},drawRoundedPolygonPath(t,e,i,n,s){n=Math.abs(n);for(let o=0;o<i;o++){const r=e[(o-1+i)%i],a=e[o],l=e[(o+1)%i],h={x:a.x-r.x,y:a.y-r.y},d={x:l.x-a.x,y:l.y-a.y},c=Math.hypot(h.x,h.y),u=Math.hypot(d.x,d.y);let p;p="number"==typeof s?s:o<s.length?s[o]:0,p=n*Math.cos(Math.PI/i)*Math.min(1,p/n*2);const m={x:h.x/c,y:h.y/c},g={x:d.x/u,y:d.y/u},f={x:a.x-m.x*p,y:a.y-m.y*p},v={x:a.x+g.x*p,y:a.y+g.y*p};0===o?t.moveTo(f.x,f.y):t.lineTo(f.x,f.y),t.arcTo(a.x,a.y,v.x,v.y,p)}}},Ue=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];let qe,$e=null;function Ke(){if(null!==$e)return $e;try{const t=je.createCanvasElement().getContext("2d");return t?!!t&&"filter"in t:($e=!1,!1)}catch(t){return $e=!1,!1}}class Xe{constructor(t){this.canvas=t,Ae.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(t){t.fillEnabled()&&this._fill(t)}_fill(t){}strokeShape(t){t.hasStroke()&&this._stroke(t)}_stroke(t){}fillStrokeShape(t){t.attrs.fillAfterStrokeEnabled?(this.strokeShape(t),this.fillShape(t)):(this.fillShape(t),this.strokeShape(t))}getTrace(t,e){let i,n,s,o,r=this.traceArr,a=r.length,l="";for(i=0;i<a;i++)n=r[i],s=n.method,s?(o=n.args,l+=s,t?l+="()":je._isArray(o[0])?l+="(["+o.join(",")+"])":(e&&(o=o.map(t=>"number"==typeof t?Math.floor(t):t)),l+="("+o.join(",")+")")):(l+=n.property,t||(l+="="+n.val)),l+=";";return l}clearTrace(){this.traceArr=[]}_trace(t){let e,i=this.traceArr;i.push(t),e=i.length,e>=100&&i.shift()}reset(){const t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){const e=this.getCanvas();t?this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0):this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){const e=t.attrs.lineCap;e&&this.setAttr("lineCap",e)}_applyOpacity(t){const e=t.getAbsoluteOpacity();1!==e&&this.setAttr("globalAlpha",e)}_applyLineJoin(t){const e=t.attrs.lineJoin;e&&this.setAttr("lineJoin",e)}_applyMiterLimit(t){const e=t.attrs.miterLimit;null!=e&&this.setAttr("miterLimit",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,n,s,o){this._context.arc(t,e,i,n,s,o)}arcTo(t,e,i,n,s){this._context.arcTo(t,e,i,n,s)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,n,s,o){this._context.bezierCurveTo(t,e,i,n,s,o)}clearRect(t,e,i,n){this._context.clearRect(t,e,i,n)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){const i=arguments;return 2===i.length?this._context.createImageData(t,e):1===i.length?this._context.createImageData(t):void 0}createLinearGradient(t,e,i,n){return this._context.createLinearGradient(t,e,i,n)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,n,s,o){return this._context.createRadialGradient(t,e,i,n,s,o)}drawImage(t,e,i,n,s,o,r,a,l){const h=arguments,d=this._context;3===h.length?d.drawImage(t,e,i):5===h.length?d.drawImage(t,e,i,n,s):9===h.length&&d.drawImage(t,e,i,n,s,o,r,a,l)}ellipse(t,e,i,n,s,o,r,a){this._context.ellipse(t,e,i,n,s,o,r,a)}isPointInPath(t,e,i,n){return i?this._context.isPointInPath(i,t,e,n):this._context.isPointInPath(t,e,n)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,i,n){this._context.fillRect(t,e,i,n)}strokeRect(t,e,i,n){this._context.strokeRect(t,e,i,n)}fillText(t,e,i,n){n?this._context.fillText(t,e,i,n):this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,n){return this._context.getImageData(t,e,i,n)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,n){this._context.rect(t,e,i,n)}roundRect(t,e,i,n,s){this._context.roundRect(t,e,i,n,s)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,n){this._context.quadraticCurveTo(t,e,i,n)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){this._context.setLineDash?this._context.setLineDash(t):"mozDash"in this._context?this._context.mozDash=t:"webkitLineDash"in this._context&&(this._context.webkitLineDash=t)}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,n,s,o){this._context.setTransform(t,e,i,n,s,o)}stroke(t){t?this._context.stroke(t):this._context.stroke()}strokeText(t,e,i,n){this._context.strokeText(t,e,i,n)}transform(t,e,i,n,s,o){this._context.transform(t,e,i,n,s,o)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let t,e,i=this,n=Ue.length,s=this.setAttr;const o=function(t){let n,s=i[t];i[t]=function(){return e=function(t){const e=[],i=t.length,n=je;for(let s=0;s<i;s++){let i=t[s];n._isNumber(i)?i=Math.round(1e3*i)/1e3:n._isString(i)||(i+=""),e.push(i)}return e}(Array.prototype.slice.call(arguments,0)),n=s.apply(i,arguments),i._trace({method:t,args:e}),n}};for(t=0;t<n;t++)o(Ue[t]);i.setAttr=function(){s.apply(i,arguments);const t=arguments[0];let e=arguments[1];"shadowOffsetX"!==t&&"shadowOffsetY"!==t&&"shadowBlur"!==t||(e/=this.canvas.getPixelRatio()),i._trace({property:t,val:e})}}_applyGlobalCompositeOperation(t){const e=t.attrs.globalCompositeOperation;!e||"source-over"===e||this.setAttr("globalCompositeOperation",e)}}["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled","filter"].forEach(function(t){Object.defineProperty(Xe.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class Ye extends Xe{constructor(t,{willReadFrequently:e=!1}={}){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){const e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){const e=t._getLinearGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fillRadialGradient(t){const e=t._getRadialGradient();e&&(this.setAttr("fillStyle",e),t._fillFunc(this))}_fill(t){const e=t.fill(),i=t.getFillPriority();if(e&&"color"===i)return void this._fillColor(t);const n=t.getFillPatternImage();if(n&&"pattern"===i)return void this._fillPattern(t);const s=t.getFillLinearGradientColorStops();if(s&&"linear-gradient"===i)return void this._fillLinearGradient(t);const o=t.getFillRadialGradientColorStops();o&&"radial-gradient"===i?this._fillRadialGradient(t):e?this._fillColor(t):n?this._fillPattern(t):s?this._fillLinearGradient(t):o&&this._fillRadialGradient(t)}_strokeLinearGradient(t){const e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),n=t.getStrokeLinearGradientColorStops(),s=this.createLinearGradient(e.x,e.y,i.x,i.y);if(n){for(let t=0;t<n.length;t+=2)s.addColorStop(n[t],n[t+1]);this.setAttr("strokeStyle",s)}}_stroke(t){const e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t),e&&t.dashEnabled()&&(this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset())),this.setAttr("lineWidth",t.strokeWidth()),t.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)"),t.getStrokeLinearGradientColorStops()?this._strokeLinearGradient(t):this.setAttr("strokeStyle",t.stroke()),t._strokeFunc(this),i||this.restore()}}_applyShadow(t){var e,i,n;const s=null!==(e=t.getShadowRGBA())&&void 0!==e?e:"black",o=null!==(i=t.getShadowBlur())&&void 0!==i?i:5,r=null!==(n=t.getShadowOffset())&&void 0!==n?n:{x:0,y:0},a=t.getAbsoluteScale(),l=this.canvas.getPixelRatio(),h=a.x*l,d=a.y*l;this.setAttr("shadowColor",s),this.setAttr("shadowBlur",o*Math.min(Math.abs(h),Math.abs(d))),this.setAttr("shadowOffsetX",r.x*h),this.setAttr("shadowOffsetY",r.y*d)}}class Ze extends Xe{constructor(t){super(t),this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){t.hasHitStroke()&&this._stroke(t)}_stroke(t){if(t.hasHitStroke()){const e=t.getStrokeScaleEnabled();if(!e){this.save();const t=this.getCanvas().getPixelRatio();this.setTransform(t,0,0,t,0,0)}this._applyLineCap(t);const i=t.hitStrokeWidth(),n="auto"===i?t.strokeWidth():i;this.setAttr("lineWidth",n),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),e||this.restore()}}}class Je{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;const e=(t||{}).pixelRatio||Ae.pixelRatio||function(){if(qe)return qe;const t=je.createCanvasElement(),e=t.getContext("2d");return qe=(Ae._global.devicePixelRatio||1)/(e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1),je.releaseCanvas(t),qe}();this.pixelRatio=e,this._canvas=je.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){const e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";const e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(t){try{return this._canvas.toDataURL()}catch(t){return je.error("Unable to get data URL. "+t.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}class Qe extends Je{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t),this.context=new Ye(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}function ti(){const t=je.createCanvasElement();t.width=1,t.height=1;const e=t.getContext("2d",{willReadFrequently:!0});e.clearRect(0,0,1,1),e.fillStyle="rgba(255,0,255,1)",e.fillRect(0,0,1,1);const i=e.getImageData(0,0,1,1).data;return!(255===i[0]&&0===i[1]&&255===i[2]&&255===i[3])}function ei(){var t,e;return"undefined"!=typeof navigator&&null!==(e=null===(t=navigator.brave)||void 0===t?void 0:t.isBrave())&&void 0!==e&&e}let ii=!1;class ni extends Je{constructor(t={width:0,height:0}){super(t),this.hitCanvas=!0,this.context=new Ze(this),this.setSize(t.width,t.height),ei()&&ti()&&!ii&&(ii=!0,je.error('Looks like you have "Brave shield" enabled in your browser. It breaks KonvaJS internals. Please disable it. You may need to ask your users to do the same.')),ei()&&ti()}}const si={get isDragging(){let t=!1;return si._dragElements.forEach(e=>{"dragging"===e.dragStatus&&(t=!0)}),t},justDragged:!1,get node(){let t;return si._dragElements.forEach(e=>{t=e.node}),t},_dragElements:new Map,_drag(t){const e=[];si._dragElements.forEach((i,n)=>{const{node:s}=i,o=s.getStage();o.setPointersPositions(t),void 0===i.pointerId&&(i.pointerId=je._getFirstPointerId(t));const r=o._changedPointerPositions.find(t=>t.id===i.pointerId);if(r){if("dragging"!==i.dragStatus){const e=s.dragDistance();if(Math.max(Math.abs(r.x-i.startPointerPos.x),Math.abs(r.y-i.startPointerPos.y))<e)return;if(s.startDrag({evt:t}),!s.isDragging())return}s._setDragPosition(t,i),e.push(s)}}),e.forEach(e=>{e.fire("dragmove",{type:"dragmove",target:e,evt:t},!0)})},_endDragBefore(t){const e=[];si._dragElements.forEach(i=>{const{node:n}=i,s=n.getStage();if(t&&s.setPointersPositions(t),!s._changedPointerPositions.find(t=>t.id===i.pointerId))return;"dragging"!==i.dragStatus&&"stopped"!==i.dragStatus||(si.justDragged=!0,Ae._mouseListenClick=!1,Ae._touchListenClick=!1,Ae._pointerListenClick=!1,i.dragStatus="stopped");const o=i.node.getLayer()||i.node instanceof Ae.Stage&&i.node;o&&-1===e.indexOf(o)&&e.push(o)}),e.forEach(t=>{t.draw()})},_endDragAfter(t){si._dragElements.forEach((e,i)=>{"stopped"===e.dragStatus&&e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0),"dragging"!==e.dragStatus&&si._dragElements.delete(i)})}};function oi(t){return je._isString(t)?'"'+t+'"':"[object Number]"===Object.prototype.toString.call(t)||je._isBoolean(t)?t:Object.prototype.toString.call(t)}function ri(t){return t>255?255:t<0?0:Math.round(t)}function ai(){if(Ae.isUnminified)return function(t,e){return je._isNumber(t)||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.'),t}}function li(t){if(Ae.isUnminified)return function(e,i){let n=je._isNumber(e),s=je._isArray(e)&&e.length==t;return n||s||je.warn(oi(e)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+t+")"),e}}function hi(){if(Ae.isUnminified)return function(t,e){return je._isNumber(t)||"auto"===t||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".'),t}}function di(){if(Ae.isUnminified)return function(t,e){return je._isString(t)||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.'),t}}function ci(){if(Ae.isUnminified)return function(t,e){const i=je._isString(t),n="[object CanvasGradient]"===Object.prototype.toString.call(t)||t&&t.addColorStop;return i||n||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.'),t}}function ui(){if(Ae.isUnminified)return function(t,e){return!0===t||!1===t||je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.'),t}}Ae.isBrowser&&(window.addEventListener("mouseup",si._endDragBefore,!0),window.addEventListener("touchend",si._endDragBefore,!0),window.addEventListener("touchcancel",si._endDragBefore,!0),window.addEventListener("mousemove",si._drag),window.addEventListener("touchmove",si._drag),window.addEventListener("mouseup",si._endDragAfter,!1),window.addEventListener("touchend",si._endDragAfter,!1),window.addEventListener("touchcancel",si._endDragAfter,!1));const pi="get",mi="set",gi={addGetterSetter(t,e,i,n,s){gi.addGetter(t,e,i),gi.addSetter(t,e,n,s),gi.addOverloadedGetterSetter(t,e)},addGetter(t,e,i){const n=pi+je._capitalize(e);t.prototype[n]=t.prototype[n]||function(){const t=this.attrs[e];return void 0===t?i:t}},addSetter(t,e,i,n){const s=mi+je._capitalize(e);t.prototype[s]||gi.overWriteSetter(t,e,i,n)},overWriteSetter(t,e,i,n){const s=mi+je._capitalize(e);t.prototype[s]=function(t){return i&&null!=t&&(t=i.call(this,t,e)),this._setAttr(e,t),n&&n.call(this),this}},addComponentsGetterSetter(t,e,i,n,s){const o=i.length,r=je._capitalize,a=pi+r(e),l=mi+r(e);t.prototype[a]=function(){const t={};for(let n=0;n<o;n++){const s=i[n];t[s]=this.getAttr(e+r(s))}return t};const h=function(t){if(Ae.isUnminified)return function(e,i){return null==e||je.isObject(e)||je.warn(oi(e)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+t),e}}(i);t.prototype[l]=function(t){const o=this.attrs[e];n&&(t=n.call(this,t,e)),h&&h.call(this,t,e);for(const i in t)t.hasOwnProperty(i)&&this._setAttr(e+r(i),t[i]);return t||i.forEach(t=>{this._setAttr(e+r(t),void 0)}),this._fireChangeEvent(e,o,t),s&&s.call(this),this},gi.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){const i=je._capitalize(e),n=mi+i,s=pi+i;t.prototype[e]=function(){return arguments.length?(this[n](arguments[0]),this):this[s]()}},addDeprecatedGetterSetter(t,e,i,n){je.error("Adding deprecated "+e);const s=pi+je._capitalize(e),o=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[s]=function(){je.error(o);const t=this.attrs[e];return void 0===t?i:t},gi.addSetter(t,e,n,function(){je.error(o)}),gi.addOverloadedGetterSetter(t,e)},backCompat(t,e){je.each(e,function(e,i){const n=t.prototype[i],s=pi+je._capitalize(e),o=mi+je._capitalize(e);function r(){n.apply(this,arguments),je.error('"'+e+'" method is deprecated and will be removed soon. Use ""'+i+'" instead.')}t.prototype[e]=r,t.prototype[s]=r,t.prototype[o]=r})},afterSetFilter(){this._filterUpToDate=!1}};function fi(t){const e=/(\w+)\(([^)]+)\)/g;let i;for(;null!==(i=e.exec(t));){const[,t,e]=i;switch(t){case"blur":{const t=parseFloat(e.replace("px",""));return function(e){this.blurRadius(.5*t);const i=Ae.Filters;i&&i.Blur&&i.Blur.call(this,e)}}case"brightness":{const t=e.includes("%")?parseFloat(e)/100:parseFloat(e);return function(e){this.brightness(t);const i=Ae.Filters;i&&i.Brightness&&i.Brightness.call(this,e)}}case"contrast":{const t=parseFloat(e);return function(e){const i=100*(Math.sqrt(t)-1);this.contrast(i);const n=Ae.Filters;n&&n.Contrast&&n.Contrast.call(this,e)}}case"grayscale":return function(t){const e=Ae.Filters;e&&e.Grayscale&&e.Grayscale.call(this,t)};case"sepia":return function(t){const e=Ae.Filters;e&&e.Sepia&&e.Sepia.call(this,t)};case"invert":return function(t){const e=Ae.Filters;e&&e.Invert&&e.Invert.call(this,t)};default:je.warn(`CSS filter "${t}" is not supported in fallback mode. Consider using function filters for better compatibility.`)}}return()=>{}}const vi="absoluteOpacity",bi="allEventListeners",_i="absoluteTransform",wi="absoluteScale",yi="canvas",Ci="listening",xi="Shape",Ei=" ",Si="stage",Pi="transform",ki="visible",Ii=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Ei);let Ri=1;class Mi{constructor(t){this._id=Ri++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){t!==Pi&&t!==_i||!this._cache.get(t)?t?this._cache.delete(t):this._cache.clear():this._cache.get(t).dirty=!0}_getCache(t,e){let i=this._cache.get(t);return(void 0===i||(t===Pi||t===_i)&&!0===i.dirty)&&(i=e.call(this),this._cache.set(t,i)),i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){const i=e.map(t=>t+"Change.konva").join(Ei);this.on(i,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get(yi)}_clearSelfAndDescendantCache(t){this._clearCache(t),t===_i&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(yi)){const{scene:t,filter:e,hit:i,buffer:n}=this._cache.get(yi);je.releaseCanvas(t,e,i,n),this._cache.delete(yi)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){const e=t||{};let i={};void 0!==e.x&&void 0!==e.y&&void 0!==e.width&&void 0!==e.height||(i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));let n=Math.ceil(e.width||i.width),s=Math.ceil(e.height||i.height),o=e.pixelRatio,r=void 0===e.x?Math.floor(i.x):e.x,a=void 0===e.y?Math.floor(i.y):e.y,l=e.offset||0,h=e.drawBorder||!1,d=e.hitCanvasPixelRatio||1;if(!n||!s)return void je.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");n+=2*l+(Math.abs(Math.round(i.x)-r)>.5?1:0),s+=2*l+(Math.abs(Math.round(i.y)-a)>.5?1:0),r-=l,a-=l;const c=new Qe({pixelRatio:o,width:n,height:s}),u=new Qe({pixelRatio:o,width:0,height:0,willReadFrequently:!0}),p=new ni({pixelRatio:d,width:n,height:s}),m=c.getContext(),g=p.getContext(),f=new Qe({width:c.width/c.pixelRatio+Math.abs(r),height:c.height/c.pixelRatio+Math.abs(a),pixelRatio:c.pixelRatio}),v=f.getContext();return p.isCache=!0,c.isCache=!0,this._cache.delete(yi),this._filterUpToDate=!1,!1===e.imageSmoothingEnabled&&(c.getContext()._context.imageSmoothingEnabled=!1,u.getContext()._context.imageSmoothingEnabled=!1),m.save(),g.save(),v.save(),m.translate(-r,-a),g.translate(-r,-a),v.translate(-r,-a),f.x=r,f.y=a,this._isUnderCache=!0,this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(wi),this.drawScene(c,this,f),this.drawHit(p,this),this._isUnderCache=!1,m.restore(),g.restore(),h&&(m.save(),m.beginPath(),m.rect(0,0,n,s),m.closePath(),m.setAttr("strokeStyle","red"),m.setAttr("lineWidth",5),m.stroke(),m.restore()),this._cache.set(yi,{scene:c,filter:u,hit:p,buffer:f,x:r,y:a}),this._requestDraw(),this}isCached(){return this._cache.has(yi)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){const i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}];let n=1/0,s=1/0,o=-1/0,r=-1/0;const a=this.getAbsoluteTransform(e);return i.forEach(function(t){const e=a.point(t);void 0===n&&(n=o=e.x,s=r=e.y),n=Math.min(n,e.x),s=Math.min(s,e.y),o=Math.max(o,e.x),r=Math.max(r,e.y)}),{x:n,y:s,width:o-n,height:r-s}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);const e=this._getCanvasCache();t.translate(e.x,e.y);const i=this._getCachedSceneCanvas(),n=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/n,i.height/n),t.restore()}_drawCachedHitCanvas(t){const e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t,e,i,n,s=this.filters(),o=this._getCanvasCache(),r=o.scene,a=o.filter,l=a.getContext();if(!s||0===s.length)return r;if(this._filterUpToDate)return a;let h=!0;for(let t=0;t<s.length;t++)if("string"==typeof s[t]&&Ke(),"string"!=typeof s[t]||!Ke()){h=!1;break}const d=r.pixelRatio;if(a.setSize(r.width/r.pixelRatio,r.height/r.pixelRatio),h){const t=s.join(" ");return l.save(),l.setAttr("filter",t),l.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),l.restore(),this._filterUpToDate=!0,a}try{for(t=s.length,l.clear(),l.drawImage(r._canvas,0,0,r.getWidth()/d,r.getHeight()/d),e=l.getImageData(0,0,a.getWidth(),a.getHeight()),i=0;i<t;i++)n=s[i],"string"==typeof n&&(n=fi(n)),n.call(this,e),l.putImageData(e,0,0)}catch(t){je.error("Unable to apply filter. "+t.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}return this._filterUpToDate=!0,a}on(t,e){if(this._cache&&this._cache.delete(bi),3===arguments.length)return this._delegate.apply(this,arguments);const i=t.split(Ei);for(let t=0;t<i.length;t++){const n=i[t].split("."),s=n[0],o=n[1]||"";this.eventListeners[s]||(this.eventListeners[s]=[]),this.eventListeners[s].push({name:o,handler:e})}return this}off(t,e){let i,n,s,o,r,a,l=(t||"").split(Ei),h=l.length;if(this._cache&&this._cache.delete(bi),!t)for(n in this.eventListeners)this._off(n);for(i=0;i<h;i++)if(s=l[i],o=s.split("."),r=o[0],a=o[1],r)this.eventListeners[r]&&this._off(r,a,e);else for(n in this.eventListeners)this._off(n,a,e);return this}dispatchEvent(t){const e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(t){e.call(this,t.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){const n=this;this.on(t,function(t){const s=t.target.findAncestors(e,!0,n);for(let e=0;e<s.length;e++)(t=je.cloneObject(t)).currentTarget=s[e],i.call(s[e],t)})}remove(){return this.isDragging()&&this.stopDrag(),si._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(_i),this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(wi),this._clearSelfAndDescendantCache(Si),this._clearSelfAndDescendantCache(ki),this._clearSelfAndDescendantCache(Ci)}_remove(){this._clearCaches();const t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){const e="get"+je._capitalize(t);return je._isFunction(this[e])?this[e]():this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];for(;t;)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,i;if(!t)return this;for(e in t)"children"!==e&&(i="set"+je._capitalize(e),je._isFunction(this[i])?this[i](t[e]):this._setAttr(e,t[e]))}),this}isListening(){return this._getCache(Ci,this._isListening)}_isListening(t){if(!this.listening())return!1;const e=this.getParent();return!e||e===t||this===t||e._isListening(t)}isVisible(){return this._getCache(ki,this._isVisible)}_isVisible(t){if(!this.visible())return!1;const e=this.getParent();return!e||e===t||this===t||e._isVisible(t)}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);const i=this.getLayer();let n=!1;si._dragElements.forEach(t=>{"dragging"===t.dragStatus&&("Stage"===t.node.nodeType||t.node.getLayer()===i)&&(n=!0)});const s=!e&&!Ae.hitOnDragEnabled&&(n||Ae.isTransforming());return this.isListening()&&this.isVisible()&&!s}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t,e,i,n,s=this.getDepth(),o=this,r=0;const a=this.getStage();return"Stage"!==o.nodeType&&a&&function a(l){for(t=[],e=l.length,i=0;i<e;i++)n=l[i],r++,n.nodeType!==xi&&(t=t.concat(n.getChildren().slice())),n._id===o._id&&(i=e);t.length>0&&t[0].getDepth()<=s&&a(t)}(a.getChildren()),r}getDepth(){let t=0,e=this.parent;for(;e;)t++,e=e.parent;return t}_batchTransformChanges(t){this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(Pi),this._clearSelfAndDescendantCache(_i)),this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const t=this.getStage();if(!t)return null;const e=t.getPointerPosition();if(!e)return null;const i=this.getAbsoluteTransform().copy();return i.invert(),i.point(e)}getAbsolutePosition(t){let e=!1,i=this.parent;for(;i;){if(i.isCached()){e=!0;break}i=i.parent}e&&!t&&(t=!0);const n=this.getAbsoluteTransform(t).getMatrix(),s=new Oe,o=this.offset();return s.m=n.slice(),s.translate(o.x,o.y),s.getTranslation()}setAbsolutePosition(t){const{x:e,y:i,...n}=this._clearTransform();this.attrs.x=e,this.attrs.y=i,this._clearCache(Pi);const s=this._getAbsoluteTransform().copy();return s.invert(),s.translate(t.x,t.y),t={x:this.attrs.x+s.getTranslation().x,y:this.attrs.y+s.getTranslation().y},this._setTransform(n),this.setPosition({x:t.x,y:t.y}),this._clearCache(Pi),this._clearSelfAndDescendantCache(_i),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){const t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let e=t.x,i=t.y,n=this.x(),s=this.y();return void 0!==e&&(n+=e),void 0!==i&&(s+=i),this.setPosition({x:n,y:s}),this}_eachAncestorReverse(t,e){let i,n,s=[],o=this.getParent();if(!e||e._id!==this._id){for(s.unshift(this);o&&(!e||o._id!==e._id);)s.unshift(o),o=o.parent;for(i=s.length,n=0;n<i;n++)t(s[n])}}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return je.warn("Node has no parent. moveToTop function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0)}moveUp(){if(!this.parent)return je.warn("Node has no parent. moveUp function is ignored."),!1;const t=this.index;return t<this.parent.getChildren().length-1&&(this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0)}moveDown(){if(!this.parent)return je.warn("Node has no parent. moveDown function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0)}moveToBottom(){if(!this.parent)return je.warn("Node has no parent. moveToBottom function is ignored."),!1;const t=this.index;return t>0&&(this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)}setZIndex(t){if(!this.parent)return je.warn("Node has no parent. zIndex parameter is ignored."),this;(t<0||t>=this.parent.children.length)&&je.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");const e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(vi,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity();const e=this.getParent();return e&&!e._isUnderCache&&(t*=e.getAbsoluteOpacity()),t}moveTo(t){return this.getParent()!==t&&(this._remove(),t.add(this)),this}toObject(){let t,e,i,n,s,o=this.getAttrs();const r={attrs:{},className:this.getClassName()};for(t in o)e=o[t],s=je.isObject(e)&&!je._isPlainObject(e)&&!je._isArray(e),s||(i="function"==typeof this[t]&&this[t],delete o[t],n=i?i.call(this):null,o[t]=e,n!==e&&(r.attrs[t]=e));return je._prepareToStringify(r)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){const n=[];e&&this._isMatch(t)&&n.push(this);let s=this.parent;for(;s;){if(s===i)return n;s._isMatch(t)&&n.push(s),s=s.parent}return n}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if("function"==typeof t)return t(this);let e,i,n=t.replace(/ /g,"").split(","),s=n.length;for(e=0;e<s;e++)if(i=n[e],je.isValidSelector(i)||(je.warn('Selector "'+i+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),je.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),je.warn("Konva is awesome, right?")),"#"===i.charAt(0)){if(this.id()===i.slice(1))return!0}else if("."===i.charAt(0)){if(this.hasName(i.slice(1)))return!0}else if(this.className===i||this.nodeType===i)return!0;return!1}getLayer(){const t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(Si,this._getStage)}_getStage(){const t=this.getParent();return t?t.getStage():null}fire(t,e={},i){return e.target=e.target||this,i?this._fireAndBubble(t,e):this._fire(t,e),this}getAbsoluteTransform(t){return t?this._getAbsoluteTransform(t):this._getCache(_i,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new Oe,this._eachAncestorReverse(function(t){const i=t.transformsEnabled();"all"===i?e.multiply(t.getTransform()):"position"===i&&e.translate(t.x()-t.offsetX(),t.y()-t.offsetY())},t),e;{e=this._cache.get(_i)||new Oe,this.parent?this.parent.getAbsoluteTransform().copyInto(e):e.reset();const t=this.transformsEnabled();if("all"===t)e.multiply(this.getTransform());else if("position"===t){const t=this.attrs.x||0,i=this.attrs.y||0,n=this.attrs.offsetX||0,s=this.attrs.offsetY||0;e.translate(t-n,i-s)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;for(;e;)e._isUnderCache&&(t=e),e=e.getParent();const i=this.getAbsoluteTransform(t).decompose();return{x:i.scaleX,y:i.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(Pi,this._getTransform)}_getTransform(){var t,e;const i=this._cache.get(Pi)||new Oe;i.reset();const n=this.x(),s=this.y(),o=Ae.getAngle(this.rotation()),r=null!==(t=this.attrs.scaleX)&&void 0!==t?t:1,a=null!==(e=this.attrs.scaleY)&&void 0!==e?e:1,l=this.attrs.skewX||0,h=this.attrs.skewY||0,d=this.attrs.offsetX||0,c=this.attrs.offsetY||0;return 0===n&&0===s||i.translate(n,s),0!==o&&i.rotate(o),0===l&&0===h||i.skew(l,h),1===r&&1===a||i.scale(r,a),0===d&&0===c||i.translate(-1*d,-1*c),i.dirty=!1,i}clone(t){let e,i,n,s,o,r=je.cloneObject(this.attrs);for(e in t)r[e]=t[e];const a=new this.constructor(r);for(e in this.eventListeners)for(i=this.eventListeners[e],n=i.length,s=0;s<n;s++)o=i[s],o.name.indexOf("konva")<0&&(a.eventListeners[e]||(a.eventListeners[e]=[]),a.eventListeners[e].push(o));return a}_toKonvaCanvas(t){t=t||{};const e=this.getClientRect(),i=this.getStage(),n=void 0!==t.x?t.x:Math.floor(e.x),s=void 0!==t.y?t.y:Math.floor(e.y),o=t.pixelRatio||1,r=new Qe({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:o}),a=r.getContext(),l=new Qe({width:r.width/r.pixelRatio+Math.abs(n),height:r.height/r.pixelRatio+Math.abs(s),pixelRatio:r.pixelRatio});return!1===t.imageSmoothingEnabled&&(a._context.imageSmoothingEnabled=!1),a.save(),(n||s)&&a.translate(-1*n,-1*s),this.drawScene(r,void 0,l),a.restore(),r}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){const e=(t=t||{}).mimeType||null,i=t.quality||null,n=this._toKonvaCanvas(t).toDataURL(e,i);return t.callback&&t.callback(n),n}toImage(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,je._urlToImage(this.toDataURL(t),function(t){e(t),null==i||i(t)})}catch(t){i(t)}})}toBlob(t){return new Promise((e,i)=>{try{const i=null==t?void 0:t.callback;i&&delete t.callback,this.toCanvas(t).toBlob(t=>{e(t),null==i||i(t)},null==t?void 0:t.mimeType,null==t?void 0:t.quality)}catch(t){i(t)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Ae.dragDistance}_off(t,e,i){let n,s,o,r=this.eventListeners[t];for(n=0;n<r.length;n++)if(s=r[n].name,o=r[n].handler,!("konva"===s&&"konva"!==e||e&&s!==e||i&&i!==o)){if(r.splice(n,1),0===r.length){delete this.eventListeners[t];break}n--}}_fireChangeEvent(t,e,i){this._fire(t+"Change",{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){const e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;const e=this.name();return!!e&&-1!==(e||"").split(/\s/g).indexOf(t)}removeName(t){const e=(this.name()||"").split(/\s/g),i=e.indexOf(t);return-1!==i&&(e.splice(i,1),this.name(e.join(" "))),this}setAttr(t,e){const i=this["set"+je._capitalize(t)];return je._isFunction(i)?i.call(this,e):this._setAttr(t,e),this}_requestDraw(){if(Ae.autoDrawEnabled){const t=this.getLayer()||this.getStage();null==t||t.batchDraw()}}_setAttr(t,e){const i=this.attrs[t];(i!==e||je.isObject(e))&&(null==e?delete this.attrs[t]:this.attrs[t]=e,this._shouldFireChangeEvents&&this._fireChangeEvent(t,i,e),this._requestDraw())}_setComponentAttr(t,e,i){let n;void 0!==i&&(n=this.attrs[t],n||(this.attrs[t]=this.getAttr(t)),this.attrs[t][e]=i,this._fireChangeEvent(t,n,i))}_fireAndBubble(t,e,i){e&&this.nodeType===xi&&(e.target=this);const n=["mouseenter","mouseleave","pointerenter","pointerleave","touchenter","touchleave"];if(-1===n.indexOf(t)||!(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||"Stage"===this.nodeType&&!i)){this._fire(t,e);const s=-1!==n.indexOf(t)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);(e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!s&&(i&&i.parent?this._fireAndBubble.call(this.parent,t,e,i):this._fireAndBubble.call(this.parent,t,e))}}_getProtoListeners(t){var e,i,n;const s=null!==(e=this._cache.get(bi))&&void 0!==e?e:{};let o=null==s?void 0:s[t];if(void 0===o){o=[];let e=Object.getPrototypeOf(this);for(;e;){const s=null!==(n=null===(i=e.eventListeners)||void 0===i?void 0:i[t])&&void 0!==n?n:[];o.push(...s),e=Object.getPrototypeOf(e)}s[t]=o,this._cache.set(bi,s)}return o}_fire(t,e){(e=e||{}).currentTarget=this,e.type=t;const i=this._getProtoListeners(t);if(i)for(let t=0;t<i.length;t++)i[t].handler.call(this,e);const n=this.eventListeners[t];if(n)for(let t=0;t<n.length;t++)n[t].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){const e=t?t.pointerId:void 0,i=this.getStage(),n=this.getAbsolutePosition();if(!i)return;const s=i._getPointerById(e)||i._changedPointerPositions[0]||n;si._dragElements.set(this._id,{node:this,startPointerPos:s,offset:{x:s.x-n.x,y:s.y-n.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){si._dragElements.has(this._id)||this._createDragElement(t),si._dragElements.get(this._id).dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){const i=this.getStage()._getPointerById(e.pointerId);if(!i)return;let n={x:i.x-e.offset.x,y:i.y-e.offset.y};const s=this.dragBoundFunc();if(void 0!==s){const e=s.call(this,n,t);e?n=e:je.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}this._lastPos&&this._lastPos.x===n.x&&this._lastPos.y===n.y||(this.setAbsolutePosition(n),this._requestDraw()),this._lastPos=n}stopDrag(t){const e=si._dragElements.get(this._id);e&&(e.dragStatus="stopped"),si._endDragBefore(t),si._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){const t=si._dragElements.get(this._id);return!!t&&"dragging"===t.dragStatus}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(void 0===t.evt.button||Ae.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let e=!1;si._dragElements.forEach(t=>{this.isAncestorOf(t.node)&&(e=!0)}),e||this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;const t=si._dragElements.get(this._id),e=t&&"dragging"===t.dragStatus,i=t&&"ready"===t.dragStatus;e?this.stopDrag():i&&si._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){const e=this.getStage();if(!e)return!1;const i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return je.haveIntersection(i,this.getClientRect())}static create(t,e){return je._isString(t)&&(t=JSON.parse(t)),this._createNode(t,e)}static _createNode(t,e){let i,n,s,o=Mi.prototype.getClassName.call(t),r=t.children;if(e&&(t.attrs.container=e),Ae[o]||(je.warn('Can not find a node with class name "'+o+'". Fallback to "Shape".'),o="Shape"),i=new(0,Ae[o])(t.attrs),r)for(n=r.length,s=0;s<n;s++)i.add(Mi._createNode(r[s]));return i}}Mi.prototype.nodeType="Node",Mi.prototype._attrsAffectingSize=[],Mi.prototype.eventListeners={},Mi.prototype.on.call(Mi.prototype,Ii,function(){this._batchingTransformChange?this._needClearTransformCache=!0:(this._clearCache(Pi),this._clearSelfAndDescendantCache(_i))}),Mi.prototype.on.call(Mi.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(ki)}),Mi.prototype.on.call(Mi.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(Ci)}),Mi.prototype.on.call(Mi.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(vi)});const Li=gi.addGetterSetter;Li(Mi,"zIndex"),Li(Mi,"absolutePosition"),Li(Mi,"position"),Li(Mi,"x",0,ai()),Li(Mi,"y",0,ai()),Li(Mi,"globalCompositeOperation","source-over",di()),Li(Mi,"opacity",1,ai()),Li(Mi,"name","",di()),Li(Mi,"id","",di()),Li(Mi,"rotation",0,ai()),gi.addComponentsGetterSetter(Mi,"scale",["x","y"]),Li(Mi,"scaleX",1,ai()),Li(Mi,"scaleY",1,ai()),gi.addComponentsGetterSetter(Mi,"skew",["x","y"]),Li(Mi,"skewX",0,ai()),Li(Mi,"skewY",0,ai()),gi.addComponentsGetterSetter(Mi,"offset",["x","y"]),Li(Mi,"offsetX",0,ai()),Li(Mi,"offsetY",0,ai()),Li(Mi,"dragDistance",void 0,ai()),Li(Mi,"width",0,ai()),Li(Mi,"height",0,ai()),Li(Mi,"listening",!0,ui()),Li(Mi,"preventDefault",!0,ui()),Li(Mi,"filters",void 0,function(t){return this._filterUpToDate=!1,t}),Li(Mi,"visible",!0,ui()),Li(Mi,"transformsEnabled","all",di()),Li(Mi,"size"),Li(Mi,"dragBoundFunc"),Li(Mi,"draggable",!1,ui()),gi.backCompat(Mi,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});class Ti extends Mi{constructor(){super(...arguments),this.children=[]}getChildren(t){const e=this.children||[];return t?e.filter(t):e}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(t=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(0===t.length)return this;if(t.length>1){for(let e=0;e<t.length;e++)this.add(t[e]);return this}const e=t[0];return e.getParent()?(e.moveTo(this),this):(this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){const e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){const i=[];return this._descendants(n=>{const s=n._isMatch(t);return s&&i.push(n),!(!s||!e)}),i}_descendants(t){let e=!1;const i=this.getChildren();for(const n of i){if(e=t(n),e)return!0;if(n.hasChildren()&&(e=n._descendants(t),e))return!0}return!1}toObject(){const t=Mi.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach(e=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();for(;e;){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){const e=Mi.prototype.clone.call(this,t);return this.getChildren().forEach(function(t){e.add(t.clone())}),e}getAllIntersections(t){const e=[];return this.find("Shape").forEach(i=>{i.isVisible()&&i.intersects(t)&&e.push(i)}),e}_clearSelfAndDescendantCache(t){var e;super._clearSelfAndDescendantCache(t),this.isCached()||null===(e=this.children)||void 0===e||e.forEach(function(e){e._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;null===(t=this.children)||void 0===t||t.forEach(function(t,e){t.index=e}),this._requestDraw()}drawScene(t,e,i){const n=this.getLayer(),s=t||n&&n.getCanvas(),o=s&&s.getContext(),r=this._getCanvasCache(),a=r&&r.scene,l=s&&s.isCache;if(!this.isVisible()&&!l)return this;if(a){o.save();const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(o),o.restore()}else this._drawChildren("drawScene",s,e,i);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;const i=this.getLayer(),n=t||i&&i.hitCanvas,s=n&&n.getContext(),o=this._getCanvasCache();if(o&&o.hit){s.save();const t=this.getAbsoluteTransform(e).getMatrix();s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(s),s.restore()}else this._drawChildren("drawHit",n,e);return this}_drawChildren(t,e,i,n){var s;const o=e&&e.getContext(),r=this.clipWidth(),a=this.clipHeight(),l=this.clipFunc(),h="number"==typeof r&&"number"==typeof a||l,d=i===this;if(h){o.save();const t=this.getAbsoluteTransform(i);let e,n=t.getMatrix();if(o.transform(n[0],n[1],n[2],n[3],n[4],n[5]),o.beginPath(),l)e=l.call(this,o,this);else{const t=this.clipX(),e=this.clipY();o.rect(t||0,e||0,r,a)}o.clip.apply(o,e),n=t.copy().invert().getMatrix(),o.transform(n[0],n[1],n[2],n[3],n[4],n[5])}const c=!d&&"source-over"!==this.globalCompositeOperation()&&"drawScene"===t;c&&(o.save(),o._applyGlobalCompositeOperation(this)),null===(s=this.children)||void 0===s||s.forEach(function(s){s[t](e,i,n)}),c&&o.restore(),h&&o.restore()}getClientRect(t={}){var e;const i=t.skipTransform,n=t.relativeTo;let s,o,r,a,l={x:1/0,y:1/0,width:0,height:0};const h=this;null===(e=this.children)||void 0===e||e.forEach(function(e){if(!e.visible())return;const i=e.getClientRect({relativeTo:h,skipShadow:t.skipShadow,skipStroke:t.skipStroke});0===i.width&&0===i.height||(void 0===s?(s=i.x,o=i.y,r=i.x+i.width,a=i.y+i.height):(s=Math.min(s,i.x),o=Math.min(o,i.y),r=Math.max(r,i.x+i.width),a=Math.max(a,i.y+i.height)))});const d=this.find("Shape");let c=!1;for(let t=0;t<d.length;t++)if(d[t]._isVisible(this)){c=!0;break}return l=c&&void 0!==s?{x:s,y:o,width:r-s,height:a-o}:{x:0,y:0,width:0,height:0},i?l:this._transformedRect(l,n)}}gi.addComponentsGetterSetter(Ti,"clip",["x","y","width","height"]),gi.addGetterSetter(Ti,"clipX",void 0,ai()),gi.addGetterSetter(Ti,"clipY",void 0,ai()),gi.addGetterSetter(Ti,"clipWidth",void 0,ai()),gi.addGetterSetter(Ti,"clipHeight",void 0,ai()),gi.addGetterSetter(Ti,"clipFunc");const Ai=new Map,Di=void 0!==Ae._global.PointerEvent;function zi(t){return Ai.get(t)}function Oi(t){return{evt:t,pointerId:t.pointerId}}function Bi(t,e){return Ai.get(t)===e}function Hi(t,e){Ni(t),e.getStage()&&(Ai.set(t,e),Di&&e._fire("gotpointercapture",Oi(new PointerEvent("gotpointercapture"))))}function Ni(t,e){const i=Ai.get(t);if(!i)return;const n=i.getStage();n&&n.content,Ai.delete(t),Di&&i._fire("lostpointercapture",Oi(new PointerEvent("lostpointercapture")))}const Vi="mouseleave",Fi="mouseover",Gi="mouseenter",Wi="mousemove",ji="mousedown",Ui="mouseup",qi="pointermove",$i="pointerdown",Ki="pointerup",Xi="pointercancel",Yi="pointerout",Zi="pointerleave",Ji="pointerover",Qi="pointerenter",tn="contextmenu",en="touchstart",nn="touchend",sn="touchmove",on="touchcancel",rn="wheel",an=[[Gi,"_pointerenter"],[ji,"_pointerdown"],[Wi,"_pointermove"],[Ui,"_pointerup"],[Vi,"_pointerleave"],[en,"_pointerdown"],[sn,"_pointermove"],[nn,"_pointerup"],[on,"_pointercancel"],[Fi,"_pointerover"],[rn,"_wheel"],[tn,"_contextmenu"],[$i,"_pointerdown"],[qi,"_pointermove"],[Ki,"_pointerup"],[Xi,"_pointercancel"],[Zi,"_pointerleave"],["lostpointercapture","_lostpointercapture"]],ln={mouse:{[Yi]:"mouseout",[Zi]:Vi,[Ji]:Fi,[Qi]:Gi,[qi]:Wi,[$i]:ji,[Ki]:Ui,[Xi]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[Yi]:"touchout",[Zi]:"touchleave",[Ji]:"touchover",[Qi]:"touchenter",[qi]:sn,[$i]:en,[Ki]:nn,[Xi]:on,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[Yi]:Yi,[Zi]:Zi,[Ji]:Ji,[Qi]:Qi,[qi]:qi,[$i]:$i,[Ki]:Ki,[Xi]:Xi,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},hn=t=>t.indexOf("pointer")>=0?"pointer":t.indexOf("touch")>=0?"touch":"mouse",dn=t=>{const e=hn(t);return"pointer"===e?Ae.pointerEventsEnabled&&ln.pointer:"touch"===e?ln.touch:"mouse"===e?ln.mouse:void 0};function cn(t={}){return(t.clipFunc||t.clipWidth||t.clipHeight)&&je.warn("Stage does not support clipping. Please use clip for Layers or Groups."),t}const un=[];class pn extends Ti{constructor(t){super(cn(t)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),un.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{cn(this.attrs)}),this._checkVisibility()}_validateAdd(t){const e="Layer"===t.getType(),i="FastLayer"===t.getType();e||i||je.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if("string"==typeof t){let e;if("."===t.charAt(0)){const e=t.slice(1);t=document.getElementsByClassName(e)[0]}else e="#"!==t.charAt(0)?t:t.slice(1),t=document.getElementById(e);if(!t)throw"Can not find container in document with id "+e}return this._setAttr("container",t),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),t.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){const t=this.children,e=t.length;for(let i=0;i<e;i++)t[i].clear();return this}clone(t){return t||(t={}),t.container="undefined"!=typeof document&&document.createElement("div"),Ti.prototype.clone.call(this,t)}destroy(){super.destroy();const t=this.content;t&&je._isInDocument(t)&&this.container().removeChild(t);const e=un.indexOf(this);return e>-1&&un.splice(e,1),je.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const t=this._pointerPositions[0]||this._changedPointerPositions[0];return t?{x:t.x,y:t.y}:(je.warn("Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);"),null)}_getPointerById(t){return this._pointerPositions.find(e=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){(t={...t}).x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();const e=new Qe({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),i=e.getContext()._context,n=this.children;return(t.x||t.y)&&i.translate(-1*t.x,-1*t.y),n.forEach(function(e){if(!e.isVisible())return;const n=e._toKonvaCanvas(t);i.drawImage(n._canvas,t.x,t.y,n.getWidth()/n.getPixelRatio(),n.getHeight()/n.getPixelRatio())}),e}getIntersection(t){if(!t)return null;const e=this.children;for(let i=e.length-1;i>=0;i--){const n=e[i].getIntersection(t);if(n)return n}return null}_resizeDOM(){const t=this.width(),e=this.height();this.content&&(this.content.style.width=t+"px",this.content.style.height=e+"px"),this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach(i=>{i.setSize({width:t,height:e}),i.draw()})}add(t,...e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}super.add(t);const i=this.children.length;return i>5&&je.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),t.setSize({width:this.width(),height:this.height()}),t.draw(),Ae.isBrowser&&this.content.appendChild(t.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return Bi(t,this)}setPointerCapture(t){Hi(t,this)}releaseCapture(t){Ni(t)}getLayers(){return this.children}_bindContentEvents(){Ae.isBrowser&&an.forEach(([t,e])=>{this.content.addEventListener(t,t=>{this[e](t)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);const e=dn(t.type);e&&this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);const e=dn(t.type);e&&this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];return e&&!e.getStage()&&(e=null),e}_pointerleave(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);const n=this._getTargetShape(i),s=!(Ae.isDragging()||Ae.isTransforming())||Ae.hitOnDragEnabled;n&&s?(n._fireAndBubble(e.pointerout,{evt:t}),n._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null):s&&(this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);let n=!1;this._changedPointerPositions.forEach(s=>{const o=this.getIntersection(s);if(si.justDragged=!1,Ae["_"+i+"ListenClick"]=!0,!o||!o.isListening())return void(this[i+"ClickStartShape"]=void 0);Ae.capturePointerEventsEnabled&&o.setPointerCapture(s.id),this[i+"ClickStartShape"]=o,o._fireAndBubble(e.pointerdown,{evt:t,pointerId:s.id}),n=!0;const r=t.type.indexOf("touch")>=0;o.preventDefault()&&t.cancelable&&r&&t.preventDefault()}),n||this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){const e=dn(t.type),i=hn(t.type);if(!e)return;const n=t.type.indexOf("touch")>=0||"touch"===t.pointerType;if(Ae.isDragging()&&si.node.preventDefault()&&t.cancelable&&n&&t.preventDefault(),this.setPointersPositions(t),(Ae.isDragging()||Ae.isTransforming())&&!Ae.hitOnDragEnabled)return;const s={};let o=!1;const r=this._getTargetShape(i);this._changedPointerPositions.forEach(n=>{const a=zi(n.id)||this.getIntersection(n),l=n.id,h={evt:t,pointerId:l},d=r!==a;if(d&&r&&(r._fireAndBubble(e.pointerout,{...h},a),r._fireAndBubble(e.pointerleave,{...h},a)),a){if(s[a._id])return;s[a._id]=!0}a&&a.isListening()?(o=!0,d&&(a._fireAndBubble(e.pointerover,{...h},r),a._fireAndBubble(e.pointerenter,{...h},r),this[i+"targetShape"]=a),a._fireAndBubble(e.pointermove,{...h})):r&&(this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[i+"targetShape"]=null)}),o||this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){const e=dn(t.type),i=hn(t.type);if(!e)return;this.setPointersPositions(t);const n=this[i+"ClickStartShape"],s=this[i+"ClickEndShape"],o={};let r=!1;this._changedPointerPositions.forEach(a=>{const l=zi(a.id)||this.getIntersection(a);if(l){if(l.releaseCapture(a.id),o[l._id])return;o[l._id]=!0}const h=a.id,d={evt:t,pointerId:h};let c=!1;Ae["_"+i+"InDblClickWindow"]?(c=!0,clearTimeout(this[i+"DblTimeout"])):si.justDragged||(Ae["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"])),this[i+"DblTimeout"]=setTimeout(function(){Ae["_"+i+"InDblClickWindow"]=!1},Ae.dblClickWindow),l&&l.isListening()?(r=!0,this[i+"ClickEndShape"]=l,l._fireAndBubble(e.pointerup,{...d}),Ae["_"+i+"ListenClick"]&&n&&n===l&&(l._fireAndBubble(e.pointerclick,{...d}),c&&s&&s===l&&l._fireAndBubble(e.pointerdblclick,{...d}))):(this[i+"ClickEndShape"]=null,r||(this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),r=!0),Ae["_"+i+"ListenClick"]&&this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:h}),c&&this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:h}))}),r||this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),Ae["_"+i+"ListenClick"]=!1,t.cancelable&&"touch"!==i&&"pointer"!==i&&t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(tn,{evt:t}):this._fire(tn,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);const e=this.getIntersection(this.getPointerPosition());e&&e.isListening()?e._fireAndBubble(rn,{evt:t}):this._fire(rn,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);const e=zi(t.pointerId)||this.getIntersection(this.getPointerPosition());e&&e._fireAndBubble(Ki,Oi(t)),Ni(t.pointerId)}_lostpointercapture(t){Ni(t.pointerId)}setPointersPositions(t){const e=this._getContentPosition();let i=null,n=null;void 0!==(t=t||window.event).touches?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,t=>{this._pointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,t=>{this._changedPointerPositions.push({id:t.identifier,x:(t.clientX-e.left)/e.scaleX,y:(t.clientY-e.top)/e.scaleY})})):(i=(t.clientX-e.left)/e.scaleX,n=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:i,y:n},this._pointerPositions=[{x:i,y:n,id:je._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:n,id:je._getFirstPointerId(t)}])}_setPointerPosition(t){je.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};const t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new Qe({width:this.width(),height:this.height()}),this.bufferHitCanvas=new ni({pixelRatio:1,width:this.width(),height:this.height()}),!Ae.isBrowser)return;const t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return je.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}pn.prototype.nodeType="Stage",De(pn),gi.addGetterSetter(pn,"container"),Ae.isBrowser&&document.addEventListener("visibilitychange",()=>{un.forEach(t=>{t.batchDraw()})});const mn="hasShadow",gn="shadowRGBA",fn="patternImage",vn="linearGradient",bn="radialGradient";let _n;function wn(){return _n||(_n=je.createCanvasElement().getContext("2d"),_n)}const yn={};class Cn extends Mi{constructor(t){let e;for(super(t);e=je.getRandomColor(),!e||e in yn;);this.colorKey=e,yn[e]=this}getContext(){return je.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return je.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(mn,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(fn,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){const t=wn().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(t&&t.setTransform){const e=new Oe;e.translate(this.fillPatternX(),this.fillPatternY()),e.rotate(Ae.getAngle(this.fillPatternRotation())),e.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),e.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const i=e.getMatrix(),n="undefined"==typeof DOMMatrix?{a:i[0],b:i[1],c:i[2],d:i[3],e:i[4],f:i[5]}:new DOMMatrix(i);t.setTransform(n)}return t}}_getLinearGradient(){return this._getCache(vn,this.__getLinearGradient)}__getLinearGradient(){const t=this.fillLinearGradientColorStops();if(t){const e=wn(),i=this.fillLinearGradientStartPoint(),n=this.fillLinearGradientEndPoint(),s=e.createLinearGradient(i.x,i.y,n.x,n.y);for(let e=0;e<t.length;e+=2)s.addColorStop(t[e],t[e+1]);return s}}_getRadialGradient(){return this._getCache(bn,this.__getRadialGradient)}__getRadialGradient(){const t=this.fillRadialGradientColorStops();if(t){const e=wn(),i=this.fillRadialGradientStartPoint(),n=this.fillRadialGradientEndPoint(),s=e.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),n.x,n.y,this.fillRadialGradientEndRadius());for(let e=0;e<t.length;e+=2)s.addColorStop(t[e],t[e+1]);return s}}getShadowRGBA(){return this._getCache(gn,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;const t=je.colorToRGBA(this.shadowColor());return t?"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")":void 0}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops()))}hasHitStroke(){const t=this.hitStrokeWidth();return"auto"===t?this.hasStroke():this.strokeEnabled()&&!!t}intersects(t){const e=this.getStage();if(!e)return!1;const i=e.bufferHitCanvas;return i.getContext().clear(),this.drawHit(i,void 0,!0),i.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return Mi.prototype.destroy.call(this),delete yn[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(null!==(e=this.attrs.perfectDrawEnabled)&&void 0!==e&&!e)return!1;const i=t||this.hasFill(),n=this.hasStroke(),s=1!==this.getAbsoluteOpacity();if(i&&n&&s)return!0;const o=this.hasShadow(),r=this.shadowForStrokeEnabled();return!!(i&&n&&o&&r)}setStrokeHitEnabled(t){je.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return 0!==this.hitStrokeWidth()}getSelfRect(){const t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,i=this.getParent();for(;i;){if(i.isCached()){e=!0;break}i=i.getParent()}const n=t.skipTransform,s=t.relativeTo||e&&this.getStage()||void 0,o=this.getSelfRect(),r=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,a=o.width+r,l=o.height+r,h=!t.skipShadow&&this.hasShadow(),d=h?this.shadowOffsetX():0,c=h?this.shadowOffsetY():0,u=a+Math.abs(d),p=l+Math.abs(c),m=h&&this.shadowBlur()||0,g={width:u+2*m,height:p+2*m,x:-(r/2+m)+Math.min(d,0)+o.x,y:-(r/2+m)+Math.min(c,0)+o.y};return n?g:this._transformedRect(g,s)}drawScene(t,e,i){const n=this.getLayer(),s=(t||n.getCanvas()).getContext(),o=this._getCanvasCache(),r=this.getSceneFunc(),a=this.hasShadow();let l;const h=e===this;if(!this.isVisible()&&!h)return this;if(o){s.save();const t=this.getAbsoluteTransform(e).getMatrix();return s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!r)return this;if(s.save(),this._useBufferCanvas()){l=this.getStage();const t=i||l.bufferCanvas,n=t.getContext();n.clear(),n.save(),n._applyLineJoin(this),n._applyMiterLimit(this);const o=this.getAbsoluteTransform(e).getMatrix();n.transform(o[0],o[1],o[2],o[3],o[4],o[5]),r.call(this,n,this),n.restore();const h=t.pixelRatio;a&&s._applyShadow(this),s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(t._canvas,t.x||0,t.y||0,t.width/h,t.height/h)}else{if(s._applyLineJoin(this),s._applyMiterLimit(this),!h){const t=this.getAbsoluteTransform(e).getMatrix();s.transform(t[0],t[1],t[2],t[3],t[4],t[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}a&&s._applyShadow(this),r.call(this,s,this)}return s.restore(),this}drawHit(t,e,i=!1){if(!this.shouldDrawHit(e,i))return this;const n=this.getLayer(),s=t||n.hitCanvas,o=s&&s.getContext(),r=this.hitFunc()||this.sceneFunc(),a=this._getCanvasCache(),l=a&&a.hit;if(this.colorKey||je.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),l){o.save();const t=this.getAbsoluteTransform(e).getMatrix();return o.transform(t[0],t[1],t[2],t[3],t[4],t[5]),this._drawCachedHitCanvas(o),o.restore(),this}if(!r)return this;if(o.save(),o._applyLineJoin(this),o._applyMiterLimit(this),this!==e){const t=this.getAbsoluteTransform(e).getMatrix();o.transform(t[0],t[1],t[2],t[3],t[4],t[5])}return r.call(this,o,this),o.restore(),this}drawHitFromCache(t=0){const e=this._getCanvasCache(),i=this._getCachedSceneCanvas(),n=e.hit,s=n.getContext(),o=n.getWidth(),r=n.getHeight();s.clear(),s.drawImage(i._canvas,0,0,o,r);try{const e=s.getImageData(0,0,o,r),i=e.data,n=i.length,a=je._hexToRgb(this.colorKey);for(let e=0;e<n;e+=4)i[e+3]>t?(i[e]=a.r,i[e+1]=a.g,i[e+2]=a.b,i[e+3]=255):i[e+3]=0;s.putImageData(e,0,0)}catch(t){je.error("Unable to draw hit graph from cached scene canvas. "+t.message)}return this}hasPointerCapture(t){return Bi(t,this)}setPointerCapture(t){Hi(t,this)}releaseCapture(t){Ni(t)}}Cn.prototype._fillFunc=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Cn.prototype._strokeFunc=function(t){t.stroke()},Cn.prototype._fillFuncHit=function(t){const e=this.attrs.fillRule;e?t.fill(e):t.fill()},Cn.prototype._strokeFuncHit=function(t){t.stroke()},Cn.prototype._centroid=!1,Cn.prototype.nodeType="Shape",De(Cn),Cn.prototype.eventListeners={},Cn.prototype.on.call(Cn.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(mn)}),Cn.prototype.on.call(Cn.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",function(){this._clearCache(gn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",function(){this._clearCache(fn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",function(){this._clearCache(vn)}),Cn.prototype.on.call(Cn.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",function(){this._clearCache(bn)}),gi.addGetterSetter(Cn,"stroke",void 0,ci()),gi.addGetterSetter(Cn,"strokeWidth",2,ai()),gi.addGetterSetter(Cn,"fillAfterStrokeEnabled",!1),gi.addGetterSetter(Cn,"hitStrokeWidth","auto",hi()),gi.addGetterSetter(Cn,"strokeHitEnabled",!0,ui()),gi.addGetterSetter(Cn,"perfectDrawEnabled",!0,ui()),gi.addGetterSetter(Cn,"shadowForStrokeEnabled",!0,ui()),gi.addGetterSetter(Cn,"lineJoin"),gi.addGetterSetter(Cn,"lineCap"),gi.addGetterSetter(Cn,"miterLimit"),gi.addGetterSetter(Cn,"sceneFunc"),gi.addGetterSetter(Cn,"hitFunc"),gi.addGetterSetter(Cn,"dash"),gi.addGetterSetter(Cn,"dashOffset",0,ai()),gi.addGetterSetter(Cn,"shadowColor",void 0,di()),gi.addGetterSetter(Cn,"shadowBlur",0,ai()),gi.addGetterSetter(Cn,"shadowOpacity",1,ai()),gi.addComponentsGetterSetter(Cn,"shadowOffset",["x","y"]),gi.addGetterSetter(Cn,"shadowOffsetX",0,ai()),gi.addGetterSetter(Cn,"shadowOffsetY",0,ai()),gi.addGetterSetter(Cn,"fillPatternImage"),gi.addGetterSetter(Cn,"fill",void 0,ci()),gi.addGetterSetter(Cn,"fillPatternX",0,ai()),gi.addGetterSetter(Cn,"fillPatternY",0,ai()),gi.addGetterSetter(Cn,"fillLinearGradientColorStops"),gi.addGetterSetter(Cn,"strokeLinearGradientColorStops"),gi.addGetterSetter(Cn,"fillRadialGradientStartRadius",0),gi.addGetterSetter(Cn,"fillRadialGradientEndRadius",0),gi.addGetterSetter(Cn,"fillRadialGradientColorStops"),gi.addGetterSetter(Cn,"fillPatternRepeat","repeat"),gi.addGetterSetter(Cn,"fillEnabled",!0),gi.addGetterSetter(Cn,"strokeEnabled",!0),gi.addGetterSetter(Cn,"shadowEnabled",!0),gi.addGetterSetter(Cn,"dashEnabled",!0),gi.addGetterSetter(Cn,"strokeScaleEnabled",!0),gi.addGetterSetter(Cn,"fillPriority","color"),gi.addComponentsGetterSetter(Cn,"fillPatternOffset",["x","y"]),gi.addGetterSetter(Cn,"fillPatternOffsetX",0,ai()),gi.addGetterSetter(Cn,"fillPatternOffsetY",0,ai()),gi.addComponentsGetterSetter(Cn,"fillPatternScale",["x","y"]),gi.addGetterSetter(Cn,"fillPatternScaleX",1,ai()),gi.addGetterSetter(Cn,"fillPatternScaleY",1,ai()),gi.addComponentsGetterSetter(Cn,"fillLinearGradientStartPoint",["x","y"]),gi.addComponentsGetterSetter(Cn,"strokeLinearGradientStartPoint",["x","y"]),gi.addGetterSetter(Cn,"fillLinearGradientStartPointX",0),gi.addGetterSetter(Cn,"strokeLinearGradientStartPointX",0),gi.addGetterSetter(Cn,"fillLinearGradientStartPointY",0),gi.addGetterSetter(Cn,"strokeLinearGradientStartPointY",0),gi.addComponentsGetterSetter(Cn,"fillLinearGradientEndPoint",["x","y"]),gi.addComponentsGetterSetter(Cn,"strokeLinearGradientEndPoint",["x","y"]),gi.addGetterSetter(Cn,"fillLinearGradientEndPointX",0),gi.addGetterSetter(Cn,"strokeLinearGradientEndPointX",0),gi.addGetterSetter(Cn,"fillLinearGradientEndPointY",0),gi.addGetterSetter(Cn,"strokeLinearGradientEndPointY",0),gi.addComponentsGetterSetter(Cn,"fillRadialGradientStartPoint",["x","y"]),gi.addGetterSetter(Cn,"fillRadialGradientStartPointX",0),gi.addGetterSetter(Cn,"fillRadialGradientStartPointY",0),gi.addComponentsGetterSetter(Cn,"fillRadialGradientEndPoint",["x","y"]),gi.addGetterSetter(Cn,"fillRadialGradientEndPointX",0),gi.addGetterSetter(Cn,"fillRadialGradientEndPointY",0),gi.addGetterSetter(Cn,"fillPatternRotation",0),gi.addGetterSetter(Cn,"fillRule",void 0,di()),gi.backCompat(Cn,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});const xn=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],En=xn.length;class Sn extends Ti{constructor(t){super(t),this.canvas=new Qe,this.hitCanvas=new ni({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);const e=this.getStage();return e&&e.content&&(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1?e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas):e.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){Mi.prototype.moveToTop.call(this);const t=this.getStage();return t&&t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){if(!Mi.prototype.moveUp.call(this))return!1;const t=this.getStage();return!(!t||!t.content||(t.content.removeChild(this.getNativeCanvasElement()),this.index<t.children.length-1?t.content.insertBefore(this.getNativeCanvasElement(),t.children[this.index+1].getCanvas()._canvas):t.content.appendChild(this.getNativeCanvasElement()),0))}moveDown(){if(Mi.prototype.moveDown.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(Mi.prototype.moveToBottom.call(this)){const t=this.getStage();if(t){const e=t.children;t.content&&(t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){const t=this.getNativeCanvasElement();return Mi.prototype.remove.call(this),t&&t.parentNode&&je._isInDocument(t)&&t.parentNode.removeChild(t),this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&je.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return(t={...t}).width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=void 0!==t.x?t.x:this.x(),t.y=void 0!==t.y?t.y:this.y(),Mi.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){const t=this.visible();this.canvas._canvas.style.display=t?"block":"none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){je.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){je.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,je.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,i=!1;for(;;){for(let n=0;n<En;n++){const s=xn[n],o=this._getIntersection({x:t.x+s.x*e,y:t.y+s.y*e}),r=o.shape;if(r)return r;if(i=!!o.antialiased,!o.antialiased)break}if(!i)return null;e+=1}}_getIntersection(t){const e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,n=i[3];if(255===n){const t=je._rgbToHex(i[0],i[1],i[2]),e=yn["#"+t];return e?{shape:e}:{antialiased:!0}}return n>0?{antialiased:!0}:{}}drawScene(t,e,i){const n=this.getLayer(),s=t||n&&n.getCanvas();return this._fire("beforeDraw",{node:this}),this.clearBeforeDraw()&&s.getContext().clear(),Ti.prototype.drawScene.call(this,s,e,i),this._fire("draw",{node:this}),this}drawHit(t,e){const i=this.getLayer(),n=t||i&&i.hitCanvas;return i&&i.clearBeforeDraw()&&i.getHitCanvas().getContext().clear(),Ti.prototype.drawHit.call(this,n,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){je.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return je.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;const t=this.parent;this.hitCanvas._canvas.parentNode?t.content.removeChild(this.hitCanvas._canvas):t.content.appendChild(this.hitCanvas._canvas)}destroy(){return je.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}Sn.prototype.nodeType="Layer",De(Sn),gi.addGetterSetter(Sn,"imageSmoothingEnabled",!0),gi.addGetterSetter(Sn,"clearBeforeDraw",!0),gi.addGetterSetter(Sn,"hitGraphEnabled",!0,ui());class Pn extends Sn{constructor(t){super(t),this.listening(!1),je.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}Pn.prototype.nodeType="FastLayer",De(Pn);class kn extends Ti{_validateAdd(t){const e=t.getType();"Group"!==e&&"Shape"!==e&&je.throw("You may only add groups and shapes to groups.")}}kn.prototype.nodeType="Group",De(kn);const In=Te.performance&&Te.performance.now?function(){return Te.performance.now()}:function(){return(new Date).getTime()};class Rn{constructor(t,e){this.id=Rn.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:In(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];return t&&(e=Array.isArray(t)?t:[t]),this.layers=e,this}getLayers(){return this.layers}addLayer(t){const e=this.layers,i=e.length;for(let n=0;n<i;n++)if(e[n]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){const t=Rn.animations,e=t.length;for(let i=0;i<e;i++)if(t[i].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=In(),Rn._addAnimation(this),this}stop(){return Rn._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){const e=t.id,i=this.animations,n=i.length;for(let t=0;t<n;t++)if(i[t].id===e){this.animations.splice(t,1);break}}static _runFrames(){const t={},e=this.animations;for(let i=0;i<e.length;i++){const n=e[i],s=n.layers,o=n.func;n._updateFrameObject(In());const r=s.length;let a;if(a=!o||!1!==o.call(n,n.frame),a)for(let e=0;e<r;e++){const i=s[e];void 0!==i._id&&(t[i._id]=i)}}for(const e in t)t.hasOwnProperty(e)&&t[e].batchDraw()}static _animationLoop(){const t=Rn;t.animations.length?(t._runFrames(),je.requestAnimFrame(t._animationLoop)):t.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,je.requestAnimFrame(this._animationLoop))}}Rn.animations=[],Rn.animIdCounter=0,Rn.animRunning=!1;const Mn={node:1,duration:1,easing:1,onFinish:1,yoyo:1},Ln=["fill","stroke","shadowColor"];let Tn=0;class An{constructor(t,e,i,n,s,o,r){this.prop=t,this.propFunc=e,this.begin=n,this._pos=n,this.duration=o,this._change=0,this.prevPos=0,this.yoyo=r,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=s-this.begin,this.pause()}fire(t){const e=this[t];e&&e()}setTime(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():t<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){return void 0===t&&(t=this._time),this.func(t,this.begin,this._change,this.duration)}play(){this.state=2,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=3,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){const t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)}pause(){this.state=1,this.fire("onPause")}getTimer(){return(new Date).getTime()}}class Dn{constructor(t){const e=this,i=t.node,n=i._id,s=t.easing||zn.Linear,o=!!t.yoyo;let r,a;r=void 0===t.duration?.3:0===t.duration?.001:t.duration,this.node=i,this._id=Tn++;const l=i.getLayer()||(i instanceof Ae.Stage?i.getLayers():null);for(a in l||je.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new Rn(function(){e.tween.onEnterFrame()},l),this.tween=new An(a,function(t){e._tweenFunc(t)},s,0,1,1e3*r,o),this._addListeners(),Dn.attrs[n]||(Dn.attrs[n]={}),Dn.attrs[n][this._id]||(Dn.attrs[n][this._id]={}),Dn.tweens[n]||(Dn.tweens[n]={}),t)void 0===Mn[a]&&this._addAttr(a,t[a]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){const i=this.node,n=i._id;let s,o,r,a,l;const h=Dn.tweens[n][t];h&&delete Dn.attrs[n][h][t];let d=i.getAttr(t);if(je._isArray(e))if(s=[],o=Math.max(e.length,d.length),"points"===t&&e.length!==d.length&&(e.length>d.length?(a=d,d=je._prepareArrayForTween(d,e,i.closed())):(r=e,e=je._prepareArrayForTween(e,d,i.closed()))),0===t.indexOf("fill"))for(let t=0;t<o;t++)if(t%2==0)s.push(e[t]-d[t]);else{const i=je.colorToRGBA(d[t]);l=je.colorToRGBA(e[t]),d[t]=i,s.push({r:l.r-i.r,g:l.g-i.g,b:l.b-i.b,a:l.a-i.a})}else for(let t=0;t<o;t++)s.push(e[t]-d[t]);else-1!==Ln.indexOf(t)?(d=je.colorToRGBA(d),l=je.colorToRGBA(e),s={r:l.r-d.r,g:l.g-d.g,b:l.b-d.b,a:l.a-d.a}):s=e-d;Dn.attrs[n][this._id][t]={start:d,diff:s,end:e,trueEnd:r,trueStart:a},Dn.tweens[n][t]=this._id}_tweenFunc(t){const e=this.node,i=Dn.attrs[e._id][this._id];let n,s,o,r,a,l,h,d;for(n in i){if(s=i[n],o=s.start,r=s.diff,d=s.end,je._isArray(o))if(a=[],h=Math.max(o.length,d.length),0===n.indexOf("fill"))for(l=0;l<h;l++)l%2==0?a.push((o[l]||0)+r[l]*t):a.push("rgba("+Math.round(o[l].r+r[l].r*t)+","+Math.round(o[l].g+r[l].g*t)+","+Math.round(o[l].b+r[l].b*t)+","+(o[l].a+r[l].a*t)+")");else for(l=0;l<h;l++)a.push((o[l]||0)+r[l]*t);else a=-1!==Ln.indexOf(n)?"rgba("+Math.round(o.r+r.r*t)+","+Math.round(o.g+r.g*t)+","+Math.round(o.b+r.b*t)+","+(o.a+r.a*t)+")":o+r*t;e.setAttr(n,a)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{const t=this.node,e=Dn.attrs[t._id][this._id];e.points&&e.points.trueEnd&&t.setAttr("points",e.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{const t=this.node,e=Dn.attrs[t._id][this._id];e.points&&e.points.trueStart&&t.points(e.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(1e3*t),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){const t=this.node._id,e=this._id,i=Dn.tweens[t];this.pause(),this.anim&&this.anim.stop();for(const e in i)delete Dn.tweens[t][e];delete Dn.attrs[t][e],Dn.tweens[t]&&(0===Object.keys(Dn.tweens[t]).length&&delete Dn.tweens[t],0===Object.keys(Dn.attrs[t]).length&&delete Dn.attrs[t])}}Dn.attrs={},Dn.tweens={},Mi.prototype.to=function(t){const e=t.onFinish;t.node=this,t.onFinish=function(){this.destroy(),e&&e()},new Dn(t).play()};const zn={BackEaseIn(t,e,i,n){const s=1.70158;return i*(t/=n)*t*((s+1)*t-s)+e},BackEaseOut(t,e,i,n){const s=1.70158;return i*((t=t/n-1)*t*((s+1)*t+s)+1)+e},BackEaseInOut(t,e,i,n){let s=1.70158;return(t/=n/2)<1?i/2*(t*t*((1+(s*=1.525))*t-s))+e:i/2*((t-=2)*t*((1+(s*=1.525))*t+s)+2)+e},ElasticEaseIn(t,e,i,n,s,o){let r=0;return 0===t?e:1===(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)+e)},ElasticEaseOut(t,e,i,n,s,o){let r=0;return 0===t?e:1===(t/=n)?e+i:(o||(o=.3*n),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),s*Math.pow(2,-10*t)*Math.sin((t*n-r)*(2*Math.PI)/o)+i+e)},ElasticEaseInOut(t,e,i,n,s,o){let r=0;return 0===t?e:2==(t/=n/2)?e+i:(o||(o=n*(.3*1.5)),!s||s<Math.abs(i)?(s=i,r=o/4):r=o/(2*Math.PI)*Math.asin(i/s),t<1?s*Math.pow(2,10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*-.5+e:s*Math.pow(2,-10*(t-=1))*Math.sin((t*n-r)*(2*Math.PI)/o)*.5+i+e)},BounceEaseOut:(t,e,i,n)=>(t/=n)<1/2.75?i*(7.5625*t*t)+e:t<2/2.75?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e,BounceEaseIn:(t,e,i,n)=>i-zn.BounceEaseOut(n-t,0,i,n)+e,BounceEaseInOut:(t,e,i,n)=>t<n/2?.5*zn.BounceEaseIn(2*t,0,i,n)+e:.5*zn.BounceEaseOut(2*t-n,0,i,n)+.5*i+e,EaseIn:(t,e,i,n)=>i*(t/=n)*t+e,EaseOut:(t,e,i,n)=>-i*(t/=n)*(t-2)+e,EaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e,StrongEaseIn:(t,e,i,n)=>i*(t/=n)*t*t*t*t+e,StrongEaseOut:(t,e,i,n)=>i*((t=t/n-1)*t*t*t*t+1)+e,StrongEaseInOut:(t,e,i,n)=>(t/=n/2)<1?i/2*t*t*t*t*t+e:i/2*((t-=2)*t*t*t*t+2)+e,Linear:(t,e,i,n)=>i*t/n+e},On=je._assign(Ae,{Util:je,Transform:Oe,Node:Mi,Container:Ti,Stage:pn,stages:un,Layer:Sn,FastLayer:Pn,Group:kn,DD:si,Shape:Cn,shapes:yn,Animation:Rn,Tween:Dn,Easings:zn,Context:Xe,Canvas:Je});class Bn extends Cn{_sceneFunc(t){const e=Ae.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){const t=this.innerRadius(),e=this.outerRadius(),i=this.clockwise(),n=Ae.getAngle(i?360-this.angle():this.angle()),s=Math.cos(Math.min(n,Math.PI)),o=Math.sin(Math.min(Math.max(Math.PI,n),3*Math.PI/2)),r=Math.sin(Math.min(n,Math.PI/2)),a=s*(s>0?t:e),l=o*(o>0?t:e),h=r*(r>0?e:t);return{x:a,y:i?-1*h:l,width:1*e-a,height:h-l}}}function Hn(t,e,i,n,s,o,r){const a=Math.sqrt(Math.pow(i-t,2)+Math.pow(n-e,2)),l=Math.sqrt(Math.pow(s-i,2)+Math.pow(o-n,2)),h=r*a/(a+l),d=r*l/(a+l);return[i-h*(s-t),n-h*(o-e),i+d*(s-t),n+d*(o-e)]}function Nn(t,e){const i=t.length,n=[];for(let s=2;s<i-2;s+=2){const i=Hn(t[s-2],t[s-1],t[s],t[s+1],t[s+2],t[s+3],e);isNaN(i[0])||(n.push(i[0]),n.push(i[1]),n.push(t[s]),n.push(t[s+1]),n.push(i[2]),n.push(i[3]))}return n}Bn.prototype._centroid=!0,Bn.prototype.className="Arc",Bn.prototype._attrsAffectingSize=["innerRadius","outerRadius","angle","clockwise"],De(Bn),gi.addGetterSetter(Bn,"innerRadius",0,ai()),gi.addGetterSetter(Bn,"outerRadius",0,ai()),gi.addGetterSetter(Bn,"angle",0,ai()),gi.addGetterSetter(Bn,"clockwise",!1,ui());class Vn extends Cn{constructor(t){super(t),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){const e=this.points(),i=e.length,n=this.tension(),s=this.closed(),o=this.bezier();if(!i)return;let r=0;if(t.beginPath(),t.moveTo(e[0],e[1]),0!==n&&i>4){const n=this.getTensionPoints(),o=n.length;for(r=s?0:4,s||t.quadraticCurveTo(n[0],n[1],n[2],n[3]);r<o-2;)t.bezierCurveTo(n[r++],n[r++],n[r++],n[r++],n[r++],n[r++]);s||t.quadraticCurveTo(n[o-2],n[o-1],e[i-2],e[i-1])}else if(o)for(r=2;r<i;)t.bezierCurveTo(e[r++],e[r++],e[r++],e[r++],e[r++],e[r++]);else for(r=2;r<i;r+=2)t.lineTo(e[r],e[r+1]);s?(t.closePath(),t.fillStrokeShape(this)):t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():Nn(this.points(),this.tension())}_getTensionPointsClosed(){const t=this.points(),e=t.length,i=this.tension(),n=Hn(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),s=Hn(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),o=Nn(t,i);return[n[2],n[3]].concat(o).concat([s[0],s[1],t[e-2],t[e-1],s[2],s[3],n[0],n[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};t=0!==this.tension()?[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]]:this.points();let e,i,n=t[0],s=t[0],o=t[1],r=t[1];for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),s=Math.max(s,e),o=Math.min(o,i),r=Math.max(r,i);return{x:n,y:o,width:s-n,height:r-o}}}Vn.prototype.className="Line",Vn.prototype._attrsAffectingSize=["points","bezier","tension"],De(Vn),gi.addGetterSetter(Vn,"closed",!1),gi.addGetterSetter(Vn,"bezier",!1),gi.addGetterSetter(Vn,"tension",0,ai()),gi.addGetterSetter(Vn,"points",[],function(){if(Ae.isUnminified)return function(t,e){const i=Int8Array?Object.getPrototypeOf(Int8Array):null;return i&&t instanceof i||(je._isArray(t)?t.forEach(function(t){je._isNumber(t)||je.warn('"'+e+'" attribute has non numeric element '+t+". Make sure that all elements are numbers.")}):je.warn(oi(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.')),t}}());const Fn=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],Gn=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],Wn=[[1],[1,1],[1,2,1],[1,3,3,1]],jn=(t,e,i)=>{let n,s;const o=i/2;n=0;for(let i=0;i<20;i++)s=o*Fn[20][i]+o,n+=Gn[20][i]*qn(t,e,s);return o*n},Un=(t,e,i)=>{void 0===i&&(i=1);const n=t[0]-2*t[1]+t[2],s=e[0]-2*e[1]+e[2],o=2*t[1]-2*t[0],r=2*e[1]-2*e[0],a=4*(n*n+s*s),l=4*(n*o+s*r),h=o*o+r*r;if(0===a)return i*Math.sqrt(Math.pow(t[2]-t[0],2)+Math.pow(e[2]-e[0],2));const d=l/(2*a),c=i+d,u=h/a-d*d,p=c*c+u>0?Math.sqrt(c*c+u):0,m=d*d+u>0?Math.sqrt(d*d+u):0,g=d+Math.sqrt(d*d+u)!==0?u*Math.log(Math.abs((c+p)/(d+m))):0;return Math.sqrt(a)/2*(c*p-d*m+g)};function qn(t,e,i){const n=$n(1,i,t),s=$n(1,i,e),o=n*n+s*s;return Math.sqrt(o)}const $n=(t,e,i)=>{const n=i.length-1;let s,o;if(0===n)return 0;if(0===t){o=0;for(let t=0;t<=n;t++)o+=Wn[n][t]*Math.pow(1-e,n-t)*Math.pow(e,t)*i[t];return o}s=new Array(n);for(let t=0;t<n;t++)s[t]=n*(i[t+1]-i[t]);return $n(t-1,e,s)},Kn=(t,e,i)=>{let n=1,s=t/e,o=(t-i(s))/e,r=0;for(;n>.001;){const a=i(s+o),l=Math.abs(t-a)/e;if(l<n)n=l,s+=o;else{const r=i(s-o),a=Math.abs(t-r)/e;a<n?(n=a,s-=o):o/=2}if(r++,r>500)break}return s};class Xn extends Cn{constructor(t){super(t),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Xn.parsePathData(this.data()),this.pathLength=Xn.getPathLength(this.dataArray)}_sceneFunc(t){const e=this.dataArray;t.beginPath();let i=!1;for(let n=0;n<e.length;n++){const s=e[n].command,o=e[n].points;switch(s){case"L":t.lineTo(o[0],o[1]);break;case"M":t.moveTo(o[0],o[1]);break;case"C":t.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5]);break;case"Q":t.quadraticCurveTo(o[0],o[1],o[2],o[3]);break;case"A":const e=o[0],n=o[1],s=o[2],r=o[3],a=o[4],l=o[5],h=o[6],d=o[7],c=s>r?s:r,u=s>r?1:s/r,p=s>r?r/s:1;t.translate(e,n),t.rotate(h),t.scale(u,p),t.arc(0,0,c,a,a+l,1-d),t.scale(1/u,1/p),t.rotate(-h),t.translate(-e,-n);break;case"z":i=!0,t.closePath()}}i||this.hasFill()?t.fillStrokeShape(this):t.strokeShape(this)}getSelfRect(){let t=[];this.dataArray.forEach(function(e){if("A"===e.command){const i=e.points[4],n=e.points[5],s=e.points[4]+n;let o=Math.PI/180;if(Math.abs(i-s)<o&&(o=Math.abs(i-s)),n<0)for(let n=i-o;n>s;n-=o){const i=Xn.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}else for(let n=i+o;n<s;n+=o){const i=Xn.getPointOnEllipticalArc(e.points[0],e.points[1],e.points[2],e.points[3],n,0);t.push(i.x,i.y)}}else if("C"===e.command)for(let i=0;i<=1;i+=.01){const n=Xn.getPointOnCubicBezier(i,e.start.x,e.start.y,e.points[0],e.points[1],e.points[2],e.points[3],e.points[4],e.points[5]);t.push(n.x,n.y)}else t=t.concat(e.points)});let e,i,n=t[0],s=t[0],o=t[1],r=t[1];for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],isNaN(e)||(n=Math.min(n,e),s=Math.max(s,e)),isNaN(i)||(o=Math.min(o,i),r=Math.max(r,i));return{x:n,y:o,width:s-n,height:r-o}}getLength(){return this.pathLength}getPointAtLength(t){return Xn.getPointAtLengthOfDataArray(t,this.dataArray)}static getLineLength(t,e,i,n){return Math.sqrt((i-t)*(i-t)+(n-e)*(n-e))}static getPathLength(t){let e=0;for(let i=0;i<t.length;++i)e+=t[i].pathLength;return e}static getPointAtLengthOfDataArray(t,e){let i,n=0,s=e.length;if(!s)return null;for(;n<s&&t>e[n].pathLength;)t-=e[n].pathLength,++n;if(n===s)return i=e[n-1].points.slice(-2),{x:i[0],y:i[1]};if(t<.01)return"M"===e[n].command?(i=e[n].points.slice(0,2),{x:i[0],y:i[1]}):{x:e[n].start.x,y:e[n].start.y};const o=e[n],r=o.points;switch(o.command){case"L":return Xn.getPointOnLine(t,o.start.x,o.start.y,r[0],r[1]);case"C":return Xn.getPointOnCubicBezier(Kn(t,Xn.getPathLength(e),t=>jn([o.start.x,r[0],r[2],r[4]],[o.start.y,r[1],r[3],r[5]],t)),o.start.x,o.start.y,r[0],r[1],r[2],r[3],r[4],r[5]);case"Q":return Xn.getPointOnQuadraticBezier(Kn(t,Xn.getPathLength(e),t=>Un([o.start.x,r[0],r[2]],[o.start.y,r[1],r[3]],t)),o.start.x,o.start.y,r[0],r[1],r[2],r[3]);case"A":const i=r[0],n=r[1],s=r[2],a=r[3],l=r[5],h=r[6];let d=r[4];return d+=l*t/o.pathLength,Xn.getPointOnEllipticalArc(i,n,s,a,d,h)}return null}static getPointOnLine(t,e,i,n,s,o,r){o=null!=o?o:e,r=null!=r?r:i;const a=this.getLineLength(e,i,n,s);if(a<1e-10)return{x:e,y:i};if(n===e)return{x:o,y:r+(s>i?t:-t)};const l=(s-i)/(n-e),h=Math.sqrt(t*t/(1+l*l))*(n<e?-1:1),d=l*h;if(Math.abs(r-i-l*(o-e))<1e-10)return{x:o+h,y:r+d};const c=((o-e)*(n-e)+(r-i)*(s-i))/(a*a),u=e+c*(n-e),p=i+c*(s-i),m=this.getLineLength(o,r,u,p),g=Math.sqrt(t*t-m*m),f=Math.sqrt(g*g/(1+l*l))*(n<e?-1:1);return{x:u+f,y:p+l*f}}static getPointOnCubicBezier(t,e,i,n,s,o,r,a,l){function h(t){return t*t*t}function d(t){return 3*t*t*(1-t)}function c(t){return 3*t*(1-t)*(1-t)}function u(t){return(1-t)*(1-t)*(1-t)}return{x:a*h(t)+o*d(t)+n*c(t)+e*u(t),y:l*h(t)+r*d(t)+s*c(t)+i*u(t)}}static getPointOnQuadraticBezier(t,e,i,n,s,o,r){function a(t){return t*t}function l(t){return 2*t*(1-t)}function h(t){return(1-t)*(1-t)}return{x:o*a(t)+n*l(t)+e*h(t),y:r*a(t)+s*l(t)+i*h(t)}}static getPointOnEllipticalArc(t,e,i,n,s,o){const r=Math.cos(o),a=Math.sin(o),l=i*Math.cos(s),h=n*Math.sin(s);return{x:t+(l*r-h*a),y:e+(l*a+h*r)}}static parsePathData(t){if(!t)return[];let e=t;const i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(let t=0;t<i.length;t++)e=e.replace(new RegExp(i[t],"g"),"|"+i[t]);const n=e.split("|"),s=[],o=[];let r=0,a=0;const l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi;let h;for(let t=1;t<n.length;t++){let e=n[t],i=e.charAt(0);for(e=e.slice(1),o.length=0;h=l.exec(e);)o.push(h[0]);let d=[],c="A"===i||"a"===i?0:-1;for(let t=0,e=o.length;t<e;t++){const e=o[t];if("00"!==e)if(c>=0){if(3===c){if(/^[01]{2}\d+(?:\.\d+)?$/.test(e)){d.push(parseInt(e[0],10)),d.push(parseInt(e[1],10)),d.push(parseFloat(e.slice(2))),c+=3,c>=7&&(c-=7);continue}if("11"===e||"10"===e||"01"===e){d.push(parseInt(e[0],10)),d.push(parseInt(e[1],10)),c+=2,c>=7&&(c-=7);continue}if("0"===e||"1"===e){d.push(parseInt(e,10)),c+=1,c>=7&&(c-=7);continue}}else if(4===c){if(/^[01]\d+(?:\.\d+)?$/.test(e)){d.push(parseInt(e[0],10)),d.push(parseFloat(e.slice(1))),c+=2,c>=7&&(c-=7);continue}if("0"===e||"1"===e){d.push(parseInt(e,10)),c+=1,c>=7&&(c-=7);continue}}const t=parseFloat(e);isNaN(t)?d.push(0):d.push(t),c+=1,c>=7&&(c-=7)}else{const t=parseFloat(e);isNaN(t)?d.push(0):d.push(t)}else d.push(0,0),c>=0&&(c+=2,c>=7&&(c-=7))}for(;d.length>0&&!isNaN(d[0]);){let t="",e=[];const n=r,o=a;let l,h,c,u,p,m,g,f,v,b;switch(i){case"l":r+=d.shift(),a+=d.shift(),t="L",e.push(r,a);break;case"L":r=d.shift(),a=d.shift(),e.push(r,a);break;case"m":const n=d.shift(),o=d.shift();if(r+=n,a+=o,t="M",s.length>2&&"z"===s[s.length-1].command)for(let t=s.length-2;t>=0;t--)if("M"===s[t].command){r=s[t].points[0]+n,a=s[t].points[1]+o;break}e.push(r,a),i="l";break;case"M":r=d.shift(),a=d.shift(),t="M",e.push(r,a),i="L";break;case"h":r+=d.shift(),t="L",e.push(r,a);break;case"H":r=d.shift(),t="L",e.push(r,a);break;case"v":a+=d.shift(),t="L",e.push(r,a);break;case"V":a=d.shift(),t="L",e.push(r,a);break;case"C":e.push(d.shift(),d.shift(),d.shift(),d.shift()),r=d.shift(),a=d.shift(),e.push(r,a);break;case"c":e.push(r+d.shift(),a+d.shift(),r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="C",e.push(r,a);break;case"S":h=r,c=a,l=s[s.length-1],"C"===l.command&&(h=r+(r-l.points[2]),c=a+(a-l.points[3])),e.push(h,c,d.shift(),d.shift()),r=d.shift(),a=d.shift(),t="C",e.push(r,a);break;case"s":h=r,c=a,l=s[s.length-1],"C"===l.command&&(h=r+(r-l.points[2]),c=a+(a-l.points[3])),e.push(h,c,r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="C",e.push(r,a);break;case"Q":e.push(d.shift(),d.shift()),r=d.shift(),a=d.shift(),e.push(r,a);break;case"q":e.push(r+d.shift(),a+d.shift()),r+=d.shift(),a+=d.shift(),t="Q",e.push(r,a);break;case"T":h=r,c=a,l=s[s.length-1],"Q"===l.command&&(h=r+(r-l.points[0]),c=a+(a-l.points[1])),r=d.shift(),a=d.shift(),t="Q",e.push(h,c,r,a);break;case"t":h=r,c=a,l=s[s.length-1],"Q"===l.command&&(h=r+(r-l.points[0]),c=a+(a-l.points[1])),r+=d.shift(),a+=d.shift(),t="Q",e.push(h,c,r,a);break;case"A":u=d.shift(),p=d.shift(),m=d.shift(),g=d.shift(),f=d.shift(),v=r,b=a,r=d.shift(),a=d.shift(),t="A",e=this.convertEndpointToCenterParameterization(v,b,r,a,g,f,u,p,m);break;case"a":u=d.shift(),p=d.shift(),m=d.shift(),g=d.shift(),f=d.shift(),v=r,b=a,r+=d.shift(),a+=d.shift(),t="A",e=this.convertEndpointToCenterParameterization(v,b,r,a,g,f,u,p,m)}s.push({command:t||i,points:e,start:{x:n,y:o},pathLength:this.calcLength(n,o,t||i,e)})}"z"!==i&&"Z"!==i||s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(t,e,i,n){let s,o,r,a;const l=Xn;switch(i){case"L":return l.getLineLength(t,e,n[0],n[1]);case"C":return jn([t,n[0],n[2],n[4]],[e,n[1],n[3],n[5]],1);case"Q":return Un([t,n[0],n[2]],[e,n[1],n[3]],1);case"A":s=0;const i=n[4],h=n[5],d=n[4]+h;let c=Math.PI/180;if(Math.abs(i-d)<c&&(c=Math.abs(i-d)),o=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],i,0),h<0)for(a=i-c;a>d;a-=c)r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),o=r;else for(a=i+c;a<d;a+=c)r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],a,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),o=r;return r=l.getPointOnEllipticalArc(n[0],n[1],n[2],n[3],d,0),s+=l.getLineLength(o.x,o.y,r.x,r.y),s}return 0}static convertEndpointToCenterParameterization(t,e,i,n,s,o,r,a,l){const h=l*(Math.PI/180),d=Math.cos(h)*(t-i)/2+Math.sin(h)*(e-n)/2,c=-1*Math.sin(h)*(t-i)/2+Math.cos(h)*(e-n)/2,u=d*d/(r*r)+c*c/(a*a);u>1&&(r*=Math.sqrt(u),a*=Math.sqrt(u));let p=Math.sqrt((r*r*(a*a)-r*r*(c*c)-a*a*(d*d))/(r*r*(c*c)+a*a*(d*d)));s===o&&(p*=-1),isNaN(p)&&(p=0);const m=p*r*c/a,g=p*-a*d/r,f=(t+i)/2+Math.cos(h)*m-Math.sin(h)*g,v=(e+n)/2+Math.sin(h)*m+Math.cos(h)*g,b=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},_=function(t,e){return(t[0]*e[0]+t[1]*e[1])/(b(t)*b(e))},w=function(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(_(t,e))},y=w([1,0],[(d-m)/r,(c-g)/a]),C=[(d-m)/r,(c-g)/a],x=[(-1*d-m)/r,(-1*c-g)/a];let E=w(C,x);return _(C,x)<=-1&&(E=Math.PI),_(C,x)>=1&&(E=0),0===o&&E>0&&(E-=2*Math.PI),1===o&&E<0&&(E+=2*Math.PI),[f,v,r,a,y,E,h,o]}}Xn.prototype.className="Path",Xn.prototype._attrsAffectingSize=["data"],De(Xn),gi.addGetterSetter(Xn,"data");class Yn extends Vn{_sceneFunc(t){super._sceneFunc(t);const e=2*Math.PI,i=this.points();let n=i;const s=0!==this.tension()&&i.length>4;s&&(n=this.getTensionPoints());const o=this.pointerLength(),r=i.length;let a,l;if(s){const t=[n[n.length-4],n[n.length-3],n[n.length-2],n[n.length-1],i[r-2],i[r-1]],e=Xn.calcLength(n[n.length-4],n[n.length-3],"C",t),s=Xn.getPointOnQuadraticBezier(Math.min(1,1-o/e),t[0],t[1],t[2],t[3],t[4],t[5]);a=i[r-2]-s.x,l=i[r-1]-s.y}else a=i[r-2]-i[r-4],l=i[r-1]-i[r-3];const h=(Math.atan2(l,a)+e)%e,d=this.pointerWidth();this.pointerAtEnding()&&(t.save(),t.beginPath(),t.translate(i[r-2],i[r-1]),t.rotate(h),t.moveTo(0,0),t.lineTo(-o,d/2),t.lineTo(-o,-d/2),t.closePath(),t.restore(),this.__fillStroke(t)),this.pointerAtBeginning()&&(t.save(),t.beginPath(),t.translate(i[0],i[1]),s?(a=(n[0]+n[2])/2-i[0],l=(n[1]+n[3])/2-i[1]):(a=i[2]-i[0],l=i[3]-i[1]),t.rotate((Math.atan2(-l,-a)+e)%e),t.moveTo(0,0),t.lineTo(-o,d/2),t.lineTo(-o,-d/2),t.closePath(),t.restore(),this.__fillStroke(t))}__fillStroke(t){const e=this.dashEnabled();e&&(this.attrs.dashEnabled=!1,t.setLineDash([])),t.fillStrokeShape(this),e&&(this.attrs.dashEnabled=!0)}getSelfRect(){const t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x,y:t.y-e,width:t.width,height:t.height+2*e}}}Yn.prototype.className="Arrow",De(Yn),gi.addGetterSetter(Yn,"pointerLength",10,ai()),gi.addGetterSetter(Yn,"pointerWidth",10,ai()),gi.addGetterSetter(Yn,"pointerAtBeginning",!1),gi.addGetterSetter(Yn,"pointerAtEnding",!0);class Zn extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,2*Math.PI,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius()!==t/2&&this.radius(t/2)}setHeight(t){this.radius()!==t/2&&this.radius(t/2)}}Zn.prototype._centroid=!0,Zn.prototype.className="Circle",Zn.prototype._attrsAffectingSize=["radius"],De(Zn),gi.addGetterSetter(Zn,"radius",0,ai());class Jn extends Cn{_sceneFunc(t){const e=this.radiusX(),i=this.radiusY();t.beginPath(),t.save(),e!==i&&t.scale(1,i/e),t.arc(0,0,e,0,2*Math.PI,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radiusX()}getHeight(){return 2*this.radiusY()}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}Jn.prototype.className="Ellipse",Jn.prototype._centroid=!0,Jn.prototype._attrsAffectingSize=["radiusX","radiusY"],De(Jn),gi.addComponentsGetterSetter(Jn,"radius",["x","y"]),gi.addGetterSetter(Jn,"radiusX",0,ai()),gi.addGetterSetter(Jn,"radiusY",0,ai());class Qn extends Cn{constructor(t){super(t),this._loadListener=()=>{this._requestDraw()},this.on("imageChange.konva",t=>{this._removeImageLoad(t.oldVal),this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const t=this.image();t&&t.complete||t&&4===t.readyState||t&&t.addEventListener&&t.addEventListener("load",this._loadListener)}_removeImageLoad(t){t&&t.removeEventListener&&t.removeEventListener("load",this._loadListener)}destroy(){return this._removeImageLoad(this.image()),super.destroy(),this}_useBufferCanvas(){const t=!!this.cornerRadius(),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas(!0)}_sceneFunc(t){const e=this.getWidth(),i=this.getHeight(),n=this.cornerRadius(),s=this.attrs.image;let o;if(s){const t=this.attrs.cropWidth,n=this.attrs.cropHeight;o=t&&n?[s,this.cropX(),this.cropY(),t,n,0,0,e,i]:[s,0,0,e,i]}(this.hasFill()||this.hasStroke()||n)&&(t.beginPath(),n?je.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)),s&&(n&&t.clip(),t.drawImage.apply(t,o))}_hitFunc(t){const e=this.width(),i=this.height(),n=this.cornerRadius();t.beginPath(),n?je.drawRoundedRectPath(t,e,i,n):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return null!==(t=this.attrs.width)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.width}getHeight(){var t,e;return null!==(t=this.attrs.height)&&void 0!==t?t:null===(e=this.image())||void 0===e?void 0:e.height}static fromURL(t,e,i=null){const n=je.createImageElement();n.onload=function(){const t=new Qn({image:n});e(t)},n.onerror=i,n.crossOrigin="Anonymous",n.src=t}}Qn.prototype.className="Image",De(Qn),gi.addGetterSetter(Qn,"cornerRadius",0,li(4)),gi.addGetterSetter(Qn,"image"),gi.addComponentsGetterSetter(Qn,"crop",["x","y","width","height"]),gi.addGetterSetter(Qn,"cropX",0,ai()),gi.addGetterSetter(Qn,"cropY",0,ai()),gi.addGetterSetter(Qn,"cropWidth",0,ai()),gi.addGetterSetter(Qn,"cropHeight",0,ai());const ts=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],es="up",is="right",ns="down",ss="left",os=ts.length;class rs extends kn{constructor(t){super(t),this.on("add.konva",function(t){this._addListeners(t.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){let e,i=this;const n=function(){i._sync()};for(e=0;e<os;e++)t.on(ts[e]+"Change.konva",n)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let t,e,i,n,s,o,r,a=this.getText(),l=this.getTag();if(a&&l){switch(t=a.width(),e=a.height(),i=l.pointerDirection(),n=l.pointerWidth(),r=l.pointerHeight(),s=0,o=0,i){case es:s=t/2,o=-1*r;break;case is:s=t+n,o=e/2;break;case ns:s=t/2,o=e+r;break;case ss:s=-1*n,o=e/2}l.setAttrs({x:-1*s,y:-1*o,width:t,height:e}),a.setAttrs({x:-1*s,y:-1*o})}}}rs.prototype.className="Label",De(rs);class as extends Cn{_sceneFunc(t){const e=this.width(),i=this.height(),n=this.pointerDirection(),s=this.pointerWidth(),o=this.pointerHeight(),r=this.cornerRadius();let a=0,l=0,h=0,d=0;"number"==typeof r?a=l=h=d=Math.min(r,e/2,i/2):(a=Math.min(r[0]||0,e/2,i/2),l=Math.min(r[1]||0,e/2,i/2),d=Math.min(r[2]||0,e/2,i/2),h=Math.min(r[3]||0,e/2,i/2)),t.beginPath(),t.moveTo(a,0),n===es&&(t.lineTo((e-s)/2,0),t.lineTo(e/2,-1*o),t.lineTo((e+s)/2,0)),t.lineTo(e-l,0),t.arc(e-l,l,l,3*Math.PI/2,0,!1),n===is&&(t.lineTo(e,(i-o)/2),t.lineTo(e+s,i/2),t.lineTo(e,(i+o)/2)),t.lineTo(e,i-d),t.arc(e-d,i-d,d,0,Math.PI/2,!1),n===ns&&(t.lineTo((e+s)/2,i),t.lineTo(e/2,i+o),t.lineTo((e-s)/2,i)),t.lineTo(h,i),t.arc(h,i-h,h,Math.PI/2,Math.PI,!1),n===ss&&(t.lineTo(0,(i+o)/2),t.lineTo(-1*s,i/2),t.lineTo(0,(i-o)/2)),t.lineTo(0,a),t.arc(a,a,a,Math.PI,3*Math.PI/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){let t=0,e=0,i=this.pointerWidth(),n=this.pointerHeight(),s=this.pointerDirection(),o=this.width(),r=this.height();return s===es?(e-=n,r+=n):s===ns?r+=n:s===ss?(t-=1.5*i,o+=i):s===is&&(o+=1.5*i),{x:t,y:e,width:o,height:r}}}as.prototype.className="Tag",De(as),gi.addGetterSetter(as,"pointerDirection","none"),gi.addGetterSetter(as,"pointerWidth",0,ai()),gi.addGetterSetter(as,"pointerHeight",0,ai()),gi.addGetterSetter(as,"cornerRadius",0,li(4));class ls extends Cn{_sceneFunc(t){const e=this.cornerRadius(),i=this.width(),n=this.height();t.beginPath(),e?je.drawRoundedRectPath(t,i,n,e):t.rect(0,0,i,n),t.closePath(),t.fillStrokeShape(this)}}ls.prototype.className="Rect",De(ls),gi.addGetterSetter(ls,"cornerRadius",0,li(4));class hs extends Cn{_sceneFunc(t){const e=this._getPoints(),i=this.radius(),n=this.sides(),s=this.cornerRadius();if(t.beginPath(),s)je.drawRoundedPolygonPath(t,e,n,i,s);else{t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y)}t.closePath(),t.fillStrokeShape(this)}_getPoints(){const t=this.attrs.sides,e=this.attrs.radius||0,i=[];for(let n=0;n<t;n++)i.push({x:e*Math.sin(2*n*Math.PI/t),y:-1*e*Math.cos(2*n*Math.PI/t)});return i}getSelfRect(){const t=this._getPoints();let e=t[0].x,i=t[0].y,n=t[0].x,s=t[0].y;return t.forEach(t=>{e=Math.min(e,t.x),i=Math.max(i,t.x),n=Math.min(n,t.y),s=Math.max(s,t.y)}),{x:e,y:n,width:i-e,height:s-n}}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}hs.prototype.className="RegularPolygon",hs.prototype._centroid=!0,hs.prototype._attrsAffectingSize=["radius"],De(hs),gi.addGetterSetter(hs,"radius",0,ai()),gi.addGetterSetter(hs,"sides",0,ai()),gi.addGetterSetter(hs,"cornerRadius",0,li(4));const ds=2*Math.PI;class cs extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,ds,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),ds,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}cs.prototype.className="Ring",cs.prototype._centroid=!0,cs.prototype._attrsAffectingSize=["innerRadius","outerRadius"],De(cs),gi.addGetterSetter(cs,"innerRadius",0,ai()),gi.addGetterSetter(cs,"outerRadius",0,ai());class us extends Cn{constructor(t){super(t),this._updated=!0,this.anim=new Rn(()=>{const t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(t){const e=this.animation(),i=this.frameIndex(),n=4*i,s=this.animations()[e],o=this.frameOffsets(),r=s[n+0],a=s[n+1],l=s[n+2],h=s[n+3],d=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,l,h),t.closePath(),t.fillStrokeShape(this)),d)if(o){const n=o[e],s=2*i;t.drawImage(d,r,a,l,h,n[s+0],n[s+1],l,h)}else t.drawImage(d,r,a,l,h,0,0,l,h)}_hitFunc(t){const e=this.animation(),i=this.frameIndex(),n=4*i,s=this.animations()[e],o=this.frameOffsets(),r=s[n+2],a=s[n+3];if(t.beginPath(),o){const n=o[e],s=2*i;t.rect(n[s+0],n[s+1],r,a)}else t.rect(0,0,r,a);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}us.prototype.className="Sprite",De(us),gi.addGetterSetter(us,"animation"),gi.addGetterSetter(us,"animations"),gi.addGetterSetter(us,"frameOffsets"),gi.addGetterSetter(us,"image"),gi.addGetterSetter(us,"frameIndex",0,ai()),gi.addGetterSetter(us,"frameRate",17,ai()),gi.backCompat(us,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class ps extends Cn{_sceneFunc(t){const e=this.innerRadius(),i=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(let s=1;s<2*n;s++){const o=s%2==0?i:e,r=o*Math.sin(s*Math.PI/n),a=-1*o*Math.cos(s*Math.PI/n);t.lineTo(r,a)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function ms(t){return[...t].reduce((t,e,i,n)=>{if(/\p{Emoji}/u.test(e)){const s=n[i+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(t.push(e+s),n[i+1]=""):t.push(e)}else/\p{Regional_Indicator}{2}/u.test(e+(n[i+1]||""))?t.push(e+n[i+1]):i>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(e)?t[t.length-1]+=e:e&&t.push(e);return t},[])}ps.prototype.className="Star",ps.prototype._centroid=!0,ps.prototype._attrsAffectingSize=["innerRadius","outerRadius"],De(ps),gi.addGetterSetter(ps,"numPoints",5,ai()),gi.addGetterSetter(ps,"innerRadius",0,ai()),gi.addGetterSetter(ps,"outerRadius",0,ai());const gs="auto",fs="inherit",vs="justify",bs="left",_s="middle",ws="normal",ys=" ",Cs="none",xs=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Es=xs.length;let Ss;function Ps(){return Ss||(Ss=je.createCanvasElement().getContext("2d"),Ss)}class ks extends Cn{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<Es;t++)this.on(xs[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e,i;const n=this.textArr,s=n.length;if(!this.text())return;let o,r=this.padding(),a=this.fontSize(),l=this.lineHeight()*a,h=this.verticalAlign(),d=this.direction(),c=0,u=this.align(),p=this.getWidth(),m=this.letterSpacing(),g=this.charRenderFunc(),f=this.fill(),v=this.textDecoration(),b=-1!==v.indexOf("underline"),_=-1!==v.indexOf("line-through");d=d===fs?t.direction:d;let w=l/2,y=_s;if(!Ae.legacyTextRendering){const t=this.measureSize("M");y="alphabetic",w=((null!==(e=t.fontBoundingBoxAscent)&&void 0!==e?e:t.actualBoundingBoxAscent)-(null!==(i=t.fontBoundingBoxDescent)&&void 0!==i?i:t.actualBoundingBoxDescent))/2+l/2}for("rtl"===d&&t.setAttr("direction",d),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",y),t.setAttr("textAlign",bs),h===_s?c=(this.getHeight()-s*l-2*r)/2:"bottom"===h&&(c=this.getHeight()-s*l-2*r),t.translate(r,c+r),o=0;o<s;o++){let e=0,i=0;const h=n[o],c=h.text,v=h.width,y=h.lastInParagraph;if(t.save(),"right"===u?e+=p-v-2*r:"center"===u&&(e+=(p-v-2*r)/2),b){t.save(),t.beginPath();const n=e,s=w+i+(Ae.legacyTextRendering?Math.round(a/2):Math.round(a/4));t.moveTo(n,s);const o=u!==vs||y?v:p-2*r;t.lineTo(n+Math.round(o),s),t.lineWidth=a/15;const l=this._getLinearGradient();t.strokeStyle=l||f,t.stroke(),t.restore()}if("rtl"===d||0===m&&u!==vs&&!g)0!==m&&t.setAttr("letterSpacing",`${m}px`),this._partialTextX=e,this._partialTextY=w+i,this._partialText=c,t.fillStrokeShape(this);else{const s=c.split(" ").length-1,a=ms(c);for(let l=0;l<a.length;l++){const h=a[l];" "!==h||y||u!==vs||(e+=(p-2*r-v)/s),this._partialTextX=e,this._partialTextY=w+i,this._partialText=h,g&&(t.save(),g({char:h,index:l+n.slice(0,o).reduce((t,e)=>t+ms(e.text).length,0),x:e,y:w+i,lineIndex:o,column:l,isLastInLine:y,width:this.measureSize(h).width,context:t})),t.fillStrokeShape(this),g&&t.restore(),e+=this.measureSize(h).width+m}}if(_){t.save(),t.beginPath();const n=Ae.legacyTextRendering?0:-Math.round(a/4),s=u===vs?0:e;t.moveTo(s,w+i+n);const o=u!==vs||y?v:p-2*r;t.lineTo(s+Math.round(o),w+i+n),t.lineWidth=a/15;const l=this._getLinearGradient();t.strokeStyle=l||f,t.stroke(),t.restore()}t.restore(),s>1&&(w+=l)}}_hitFunc(t){const e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){const e=je._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===gs||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===gs||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return je.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,i,n,s,o,r,a,l,h,d,c;let u,p=Ps(),m=this.fontSize();p.save(),p.font=this._getContextFont(),u=p.measureText(t),p.restore();const g=m/100;return{actualBoundingBoxAscent:null!==(e=u.actualBoundingBoxAscent)&&void 0!==e?e:71.58203125*g,actualBoundingBoxDescent:null!==(i=u.actualBoundingBoxDescent)&&void 0!==i?i:0,actualBoundingBoxLeft:null!==(n=u.actualBoundingBoxLeft)&&void 0!==n?n:-7.421875*g,actualBoundingBoxRight:null!==(s=u.actualBoundingBoxRight)&&void 0!==s?s:75.732421875*g,alphabeticBaseline:null!==(o=u.alphabeticBaseline)&&void 0!==o?o:0,emHeightAscent:null!==(r=u.emHeightAscent)&&void 0!==r?r:100*g,emHeightDescent:null!==(a=u.emHeightDescent)&&void 0!==a?a:-20*g,fontBoundingBoxAscent:null!==(l=u.fontBoundingBoxAscent)&&void 0!==l?l:91*g,fontBoundingBoxDescent:null!==(h=u.fontBoundingBoxDescent)&&void 0!==h?h:21*g,hangingBaseline:null!==(d=u.hangingBaseline)&&void 0!==d?d:72.80000305175781*g,ideographicBaseline:null!==(c=u.ideographicBaseline)&&void 0!==c?c:-21*g,width:u.width,height:m}}_getContextFont(){return this.fontStyle()+ys+this.fontVariant()+ys+(this.fontSize()+"px ")+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,i=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!i&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){this.align()===vs&&(t=t.trim());const e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){const e=this.letterSpacing(),i=t.length;return Ps().measureText(t).width+e*i}_setTextData(){let t=this.text().split("\n"),e=+this.fontSize(),i=0,n=this.lineHeight()*e,s=this.attrs.width,o=this.attrs.height,r=s!==gs&&void 0!==s,a=o!==gs&&void 0!==o,l=this.padding(),h=s-2*l,d=o-2*l,c=0,u=this.wrap(),p="char"!==u&&u!==Cs,m=this.ellipsis();this.textArr=[],Ps().font=this._getContextFont();const g=m?this._getTextWidth("…"):0;for(let e=0,s=t.length;e<s;++e){let o=t[e],l=this._getTextWidth(o);if(r&&l>h)for(;o.length>0;){let t=0,e=ms(o).length,s="",r=0;for(;t<e;){const i=t+e>>>1,l=ms(o).slice(0,i+1).join(""),u=this._getTextWidth(l);(m&&a&&c+n>d?u+g:u)<=h?(t=i+1,s=l,r=u):e=i}if(!s)break;if(p){const e=ms(o),i=ms(s),n=e[i.length];let a;if((n===ys||"-"===n)&&r<=h)a=i.length;else{const t=i.lastIndexOf(ys),e=i.lastIndexOf("-");a=Math.max(t,e)+1}a>0&&(t=a,s=e.slice(0,t).join(""),r=this._getTextWidth(s))}if(s=s.trimRight(),this._addTextLine(s),i=Math.max(i,r),c+=n,this._shouldHandleEllipsis(c)){this._tryToAddEllipsisToLastLine();break}if(o=ms(o).slice(t).join("").trimLeft(),o.length>0&&(l=this._getTextWidth(o),l<=h)){this._addTextLine(o),c+=n,i=Math.max(i,l);break}}else this._addTextLine(o),c+=n,i=Math.max(i,l),this._shouldHandleEllipsis(c)&&e<s-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),a&&c+n>d)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){const e=+this.fontSize(),i=this.lineHeight()*e,n=this.attrs.height,s=n!==gs&&void 0!==n,o=n-2*this.padding();return!(this.wrap()!==Cs)||s&&t+i>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,e=t!==gs&&void 0!==t,i=t-2*this.padding(),n=this.ellipsis(),s=this.textArr[this.textArr.length-1];s&&n&&(e&&(this._getTextWidth(s.text+"…")<i||(s.text=s.text.slice(0,s.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+"…"))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas()}}ks.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},ks.prototype._strokeFunc=function(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},ks.prototype.className="Text",ks.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],De(ks),gi.overWriteSetter(ks,"width",hi()),gi.overWriteSetter(ks,"height",hi()),gi.addGetterSetter(ks,"direction",fs),gi.addGetterSetter(ks,"fontFamily","Arial"),gi.addGetterSetter(ks,"fontSize",12,ai()),gi.addGetterSetter(ks,"fontStyle",ws),gi.addGetterSetter(ks,"fontVariant",ws),gi.addGetterSetter(ks,"padding",0,ai()),gi.addGetterSetter(ks,"align",bs),gi.addGetterSetter(ks,"verticalAlign","top"),gi.addGetterSetter(ks,"lineHeight",1,ai()),gi.addGetterSetter(ks,"wrap","word"),gi.addGetterSetter(ks,"ellipsis",!1,ui()),gi.addGetterSetter(ks,"letterSpacing",0,ai()),gi.addGetterSetter(ks,"text","",di()),gi.addGetterSetter(ks,"textDecoration",""),gi.addGetterSetter(ks,"charRenderFunc",void 0);const Is="normal";function Rs(t){t.fillText(this.partialText,0,0)}function Ms(t){t.strokeText(this.partialText,0,0)}class Ls extends Cn{constructor(t){super(t),this.dummyCanvas=je.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Xn.getPathLength(this.dataArray)}_getPointAtLength(t){return this.attrs.data?t>this.pathLength?null:Xn.getPointAtLengthOfDataArray(t,this.dataArray):null}_readDataAttribute(){this.dataArray=Xn.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();const e=this.textDecoration(),i=this.fill(),n=this.fontSize(),s=this.glyphInfo;"underline"===e&&t.beginPath();for(let i=0;i<s.length;i++){t.save();const o=s[i].p0;t.translate(o.x,o.y),t.rotate(s[i].rotation),this.partialText=s[i].text,t.fillStrokeShape(this),"underline"===e&&(0===i&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=i,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();const e=this.glyphInfo;if(e.length>=1){const i=e[0].p0;t.moveTo(i.x,i.y)}for(let i=0;i<e.length;i++){const n=e[i].p1;t.lineTo(n.x,n.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return je.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return ks.prototype.setText.call(this,t)}_getContextFont(){return ks.prototype._getContextFont.call(this)}_getTextSize(t){const e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();const i=e.measureText(t);return e.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const t=ms(this.text()),e=[];let i=0;for(let n=0;n<t.length;n++)e.push({char:t[n],width:this._getTextSize(t[n]).width}),i+=e[n].width;const{height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=i,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const s=this.letterSpacing(),o=this.align(),r=this.kerningFunc(),a=Math.max(this.textWidth+((this.attrs.text||"").length-1)*s,0);let l=0;"center"===o&&(l=Math.max(0,this.pathLength/2-a/2)),"right"===o&&(l=Math.max(0,this.pathLength-a));let h=l;for(let i=0;i<e.length;i++){const n=this._getPointAtLength(h);if(!n)return;const l=e[i].char;let d=e[i].width+s;if(" "===l&&"justify"===o){const t=this.text().split(" ").length-1;d+=(this.pathLength-a)/t}const c=this._getPointAtLength(h+d);if(!c)return;const u=Xn.getLineLength(n.x,n.y,c.x,c.y);let p=0;if(r)try{p=r(e[i-1].char,l)*this.fontSize()}catch(t){p=0}n.x+=p,c.x+=p,this.textWidth+=p;const m=Xn.getPointOnLine(p+u/2,n.x,n.y,c.x,c.y),g=Math.atan2(c.y-n.y,c.x-n.x);this.glyphInfo.push({transposeX:m.x,transposeY:m.y,text:t[i],rotation:g,p0:n,p1:c}),h+=d}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const t=[];this.glyphInfo.forEach(function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)});let e,i,n=t[0]||0,s=t[0]||0,o=t[1]||0,r=t[1]||0;for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),s=Math.max(s,e),o=Math.min(o,i),r=Math.max(r,i);const a=this.fontSize();return{x:n-a/2,y:o-a/2,width:s-n+a,height:r-o+a}}destroy(){return je.releaseCanvas(this.dummyCanvas),super.destroy()}}Ls.prototype._fillFunc=Rs,Ls.prototype._strokeFunc=Ms,Ls.prototype._fillFuncHit=Rs,Ls.prototype._strokeFuncHit=Ms,Ls.prototype.className="TextPath",Ls.prototype._attrsAffectingSize=["text","fontSize","data"],De(Ls),gi.addGetterSetter(Ls,"data"),gi.addGetterSetter(Ls,"fontFamily","Arial"),gi.addGetterSetter(Ls,"fontSize",12,ai()),gi.addGetterSetter(Ls,"fontStyle",Is),gi.addGetterSetter(Ls,"align","left"),gi.addGetterSetter(Ls,"letterSpacing",0,ai()),gi.addGetterSetter(Ls,"textBaseline","middle"),gi.addGetterSetter(Ls,"fontVariant",Is),gi.addGetterSetter(Ls,"text",""),gi.addGetterSetter(Ls,"textDecoration",""),gi.addGetterSetter(Ls,"kerningFunc",void 0);const Ts="tr-konva",As=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(t=>t+`.${Ts}`).join(" "),Ds="nodesRect",zs=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange","draggableChange"],Os={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Bs="ontouchstart"in Ae._global,Hs=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Ns(t,e,i){const n=i.x+(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e),s=i.y+(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:n,y:s}}let Vs=0;class Fs extends kn{constructor(t){super(t),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(As,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return je.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Ts+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter(t=>!t.isAncestorOf(this)||(je.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1));return this._nodes=t=e,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()};if(t._attrsAffectingSize.length){const i=t._attrsAffectingSize.map(t=>t+"Change."+this._getEventNamespace()).join(" ");t.on(i,e)}t.on(zs.map(t=>t+`.${this._getEventNamespace()}`).join(" "),e),t.on(`absoluteTransformChange.${this._getEventNamespace()}`,e),this._proxyDrag(t)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,i=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(i,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,i=>{if(!e)return;const n=t.getAbsolutePosition(),s=n.x-e.x,o=n.y-e.y;this.nodes().forEach(e=>{if(e===t)return;if(e.isDragging())return;const n=e.getAbsolutePosition();e.setAbsolutePosition({x:n.x+s,y:n.y+o}),e.startDrag(i)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Ds),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Ds,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),i){const n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=t.getAbsoluteScale(i),o=t.getAbsolutePosition(i),r=n.x*s.x-t.offsetX()*s.x,a=n.y*s.y-t.offsetY()*s.y,l=(Ae.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Ns({x:o.x+r*Math.cos(l)+a*Math.sin(-l),y:o.y+a*Math.cos(l)+r*Math.sin(l),width:n.width*s.x,height:n.height*s.y,rotation:l},-Ae.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(e=>{const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}],s=e.getAbsoluteTransform();n.forEach(function(e){const i=s.point(e);t.push(i)})});const e=new Oe;e.rotate(-Ae.getAngle(this.rotation()));let i=1/0,n=1/0,s=-1/0,o=-1/0;t.forEach(function(t){const r=e.point(t);void 0===i&&(i=s=r.x,n=o=r.y),i=Math.min(i,r.x),n=Math.min(n,r.y),s=Math.max(s,r.x),o=Math.max(o,r.y)}),e.invert();const r=e.point({x:i,y:n});return{x:r.x,y:r.y,width:s-i,height:o-n,rotation:Ae.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Hs.forEach(t=>{this._createAnchor(t)}),this._createAnchor("rotater")}_createAnchor(t){const e=new ls({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Bs?10:"auto"}),i=this;e.on("mousedown touchstart",function(t){i._handleMouseDown(t)}),e.on("dragstart",t=>{e.stopDrag(),t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),e.on("mouseenter",()=>{const i=Ae.getAngle(this.rotation()),n=this.rotateAnchorCursor(),s=function(t,e,i){if("rotater"===t)return i;e+=je.degToRad(Os[t]||0);const n=(je.radToDeg(e)%360+360)%360;return je._inRange(n,337.5,360)||je._inRange(n,0,22.5)?"ns-resize":je._inRange(n,22.5,67.5)?"nesw-resize":je._inRange(n,67.5,112.5)?"ew-resize":je._inRange(n,112.5,157.5)?"nwse-resize":je._inRange(n,157.5,202.5)?"ns-resize":je._inRange(n,202.5,247.5)?"nesw-resize":je._inRange(n,247.5,292.5)?"ew-resize":je._inRange(n,292.5,337.5)?"nwse-resize":(je.error("Transformer has unknown angle for cursor detection: "+n),"pointer")}(t,i,n);e.getStage().content&&(e.getStage().content.style.cursor=s),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){const t=new Cn({name:"back",width:0,height:0,sceneFunc(t,e){const i=e.getParent(),n=i.padding();t.beginPath(),t.rect(-n,-n,e.width()+2*n,e.height()+2*n),t.moveTo(e.width()/2,-n),i.rotateEnabled()&&i.rotateLineVisible()&&t.lineTo(e.width()/2,-i.rotateAnchorOffset()*je._sign(e.height())-n),t.fillStrokeShape(e)},hitFunc:(t,e)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();t.beginPath(),t.rect(-i,-i,e.width()+2*i,e.height()+2*i),t.fillStrokeShape(e)}});this.add(t),this._proxyDrag(t),t.on("dragstart",t=>{t.cancelBubble=!0}),t.on("dragmove",t=>{t.cancelBubble=!0}),t.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(t){if(this._transforming)return;this._movingAnchorName=t.target.name().split(" ")[0];const e=this._getNodeRect(),i=e.width,n=e.height,s=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/s),this.cos=Math.abs(i/s),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const o=t.target.getAbsolutePosition(),r=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:r.x-o.x,y:r.y-o.y},Vs++,this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(e=>{e._fire("transformstart",{evt:t.evt,target:e})})}_handleMouseMove(t){let e,i,n;const s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(t);const r=o.getPointerPosition();let a={x:r.x-this._anchorDragOffset.x,y:r.y-this._anchorDragOffset.y};const l=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(a=this.anchorDragBoundFunc()(l,a,t)),s.setAbsolutePosition(a);const h=s.getAbsolutePosition();if(l.x===h.x&&l.y===h.y)return;if("rotater"===this._movingAnchorName){const n=this._getNodeRect();e=s.x()-n.width/2,i=-s.y()+n.height/2;let o=Math.atan2(-i,e)+Math.PI/2;n.height<0&&(o-=Math.PI);const r=Ae.getAngle(this.rotation())+o,a=Ae.getAngle(this.rotationSnapTolerance()),l=function(t,e,i){let n=e;for(let s=0;s<t.length;s++){const o=Ae.getAngle(t[s]),r=Math.abs(o-e)%(2*Math.PI);Math.min(r,2*Math.PI-r)<i&&(n=o)}return n}(this.rotationSnaps(),r,a),h=function(t,e){const i=function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t);return Ns(t,e,i)}(n,l-n.rotation);return void this._fitNodesInto(h,t)}const d=this.shiftBehavior();let c;c="inverted"===d?this.keepRatio()&&!t.shiftKey:"none"===d?this.keepRatio():this.keepRatio()||t.shiftKey;let u=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(t.x-s.x(),2)+Math.pow(t.y-s.y(),2));const o=this.findOne(".top-left").x()>t.x?-1:1,r=this.findOne(".top-left").y()>t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".top-left").x(t.x-e),this.findOne(".top-left").y(t.y-i)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(s.y());else if("top-right"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(s.x()-t.x,2)+Math.pow(t.y-s.y(),2));const o=this.findOne(".top-right").x()<t.x?-1:1,r=this.findOne(".top-right").y()>t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".top-right").x(t.x+e),this.findOne(".top-right").y(t.y-i)}var p=s.position();this.findOne(".top-left").y(p.y),this.findOne(".bottom-right").x(p.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(s.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(s.x());else if("bottom-left"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(t.x-s.x(),2)+Math.pow(s.y()-t.y,2));const o=t.x<s.x()?-1:1,r=s.y()<t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,s.x(t.x-e),s.y(t.y+i)}p=s.position(),this.findOne(".top-left").x(p.x),this.findOne(".bottom-right").y(p.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(s.y());else if("bottom-right"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(s.x()-t.x,2)+Math.pow(s.y()-t.y,2));const o=this.findOne(".bottom-right").x()<t.x?-1:1,r=this.findOne(".bottom-right").y()<t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".bottom-right").x(t.x+e),this.findOne(".bottom-right").y(t.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(u=this.centeredScaling()||t.altKey,u){const t=this.findOne(".top-left"),e=this.findOne(".bottom-right"),i=t.x(),n=t.y(),s=this.getWidth()-e.x(),o=this.getHeight()-e.y();e.move({x:-i,y:-n}),t.move({x:s,y:o})}const m=this.findOne(".top-left").getAbsolutePosition();e=m.x,i=m.y;const g=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),f=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:g,height:f,rotation:Ae.getAngle(this.rotation())},t)}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){var e;if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const i=this.getNode();Vs--,this._fire("transformend",{evt:t,target:i}),null===(e=this.getLayer())||void 0===e||e.batchDraw(),i&&this._nodes.forEach(e=>{var i;e._fire("transformend",{evt:t,target:e}),null===(i=e.getLayer())||void 0===i||i.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(t,e){const i=this._getNodeRect();if(je._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(je._inRange(t.height,2*-this.padding()-1,1))return void this.update();const n=new Oe;if(n.rotate(Ae.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=n.point({x:2*-this.padding(),y:0});t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=n.point({x:2*this.padding(),y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=n.point({x:0,y:2*-this.padding()});t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=n.point({x:0,y:2*this.padding()});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(i,t);e?t=e:je.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const s=1e7,o=new Oe;o.translate(i.x,i.y),o.rotate(i.rotation),o.scale(i.width/s,i.height/s);const r=new Oe,a=t.width/s,l=t.height/s;!1===this.flipEnabled()?(r.translate(t.x,t.y),r.rotate(t.rotation),r.translate(t.width<0?t.width:0,t.height<0?t.height:0),r.scale(Math.abs(a),Math.abs(l))):(r.translate(t.x,t.y),r.rotate(t.rotation),r.scale(a,l));const h=r.multiply(o.invert());this._nodes.forEach(t=>{var e;if(!t.getStage())return;const i=t.getParent().getAbsoluteTransform(),n=t.getTransform().copy();n.translate(t.offsetX(),t.offsetY());const s=new Oe;s.multiply(i.copy().invert()).multiply(h).multiply(i).multiply(n);const o=s.decompose();t.setAttrs(o),null===(e=t.getLayer())||void 0===e||e.batchDraw()}),this.rotation(je._getRotation(t.rotation)),this._nodes.forEach(t=>{this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t;const e=this._getNodeRect();this.rotation(je._getRotation(e.rotation));const i=e.width,n=e.height,s=this.enabledAnchors(),o=this.resizeEnabled(),r=this.padding(),a=this.anchorSize(),l=this.find("._anchor");l.forEach(t=>{t.setAttrs({width:a,height:a,offsetX:a/2,offsetY:a/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:a/2+r,offsetY:a/2+r,visible:o&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:a/2+r,visible:o&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:a/2-r,offsetY:a/2+r,visible:o&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:a/2+r,visible:o&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:n/2,offsetX:a/2-r,visible:o&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:a/2+r,offsetY:a/2-r,visible:o&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:n,offsetY:a/2-r,visible:o&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:n,offsetX:a/2-r,offsetY:a/2-r,visible:o&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*je._sign(n)-r,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),draggable:this.nodes().some(t=>t.draggable()),x:0,y:0});const h=this.anchorStyleFunc();h&&l.forEach(t=>{h(t)}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),kn.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Mi.prototype.toObject.call(this)}clone(t){return Mi.prototype.clone.call(this,t)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Fs.isTransforming=()=>Vs>0,Fs.prototype.className="Transformer",De(Fs),gi.addGetterSetter(Fs,"enabledAnchors",Hs,function(t){return t instanceof Array||je.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach(function(t){-1===Hs.indexOf(t)&&je.warn("Unknown anchor name: "+t+". Available names are: "+Hs.join(", "))}),t||[]}),gi.addGetterSetter(Fs,"flipEnabled",!0,ui()),gi.addGetterSetter(Fs,"resizeEnabled",!0),gi.addGetterSetter(Fs,"anchorSize",10,ai()),gi.addGetterSetter(Fs,"rotateEnabled",!0),gi.addGetterSetter(Fs,"rotateLineVisible",!0),gi.addGetterSetter(Fs,"rotationSnaps",[]),gi.addGetterSetter(Fs,"rotateAnchorOffset",50,ai()),gi.addGetterSetter(Fs,"rotateAnchorCursor","crosshair"),gi.addGetterSetter(Fs,"rotationSnapTolerance",5,ai()),gi.addGetterSetter(Fs,"borderEnabled",!0),gi.addGetterSetter(Fs,"anchorStroke","rgb(0, 161, 255)"),gi.addGetterSetter(Fs,"anchorStrokeWidth",1,ai()),gi.addGetterSetter(Fs,"anchorFill","white"),gi.addGetterSetter(Fs,"anchorCornerRadius",0,ai()),gi.addGetterSetter(Fs,"borderStroke","rgb(0, 161, 255)"),gi.addGetterSetter(Fs,"borderStrokeWidth",1,ai()),gi.addGetterSetter(Fs,"borderDash"),gi.addGetterSetter(Fs,"keepRatio",!0),gi.addGetterSetter(Fs,"shiftBehavior","default"),gi.addGetterSetter(Fs,"centeredScaling",!1),gi.addGetterSetter(Fs,"ignoreStroke",!1),gi.addGetterSetter(Fs,"padding",0,ai()),gi.addGetterSetter(Fs,"nodes"),gi.addGetterSetter(Fs,"node"),gi.addGetterSetter(Fs,"boundBoxFunc"),gi.addGetterSetter(Fs,"anchorDragBoundFunc"),gi.addGetterSetter(Fs,"anchorStyleFunc"),gi.addGetterSetter(Fs,"shouldOverdrawWholeArea",!1),gi.addGetterSetter(Fs,"useSingleNodeRotation",!0),gi.backCompat(Fs,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Gs extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,Ae.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function Ws(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Gs.prototype.className="Wedge",Gs.prototype._centroid=!0,Gs.prototype._attrsAffectingSize=["radius"],De(Gs),gi.addGetterSetter(Gs,"radius",0,ai()),gi.addGetterSetter(Gs,"angle",0,ai()),gi.addGetterSetter(Gs,"clockwise",!1),gi.backCompat(Gs,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});const js=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Us=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function qs(t,e,i,n,s){const o=i-e,r=s-n;if(0===o)return n+r/2;if(0===r)return n;let a=(t-e)/o;return a=r*a+n,a}function $s(t,e,i){let n=4*(i*t.width+e);const s=[];return s.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),s}function Ks(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}gi.addGetterSetter(Mi,"blurRadius",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"brightness",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"contrast",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossStrength",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossWhiteLevel",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossDirection","top-left",void 0,gi.afterSetFilter),gi.addGetterSetter(Mi,"embossBlend",!1,void 0,gi.afterSetFilter),gi.addGetterSetter(Mi,"enhance",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"hue",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"saturation",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"luminance",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"hue",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"saturation",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"value",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"kaleidoscopePower",2,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"kaleidoscopeAngle",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"threshold",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"noise",.2,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"pixelSize",8,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"levels",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"blue",0,ri,gi.afterSetFilter),gi.addGetterSetter(Mi,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"blue",0,ri,gi.afterSetFilter),gi.addGetterSetter(Mi,"alpha",1,function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}),gi.addGetterSetter(Mi,"threshold",.5,ai(),gi.afterSetFilter),On.Util._assign(On,{Arc:Bn,Arrow:Yn,Circle:Zn,Ellipse:Jn,Image:Qn,Label:rs,Tag:as,Line:Vn,Path:Xn,Rect:ls,RegularPolygon:hs,Ring:cs,Sprite:us,Star:ps,Text:ks,TextPath:Ls,Transformer:Fs,Wedge:Gs,Filters:{Blur:function(t){const e=Math.round(this.blurRadius());e>0&&function(t,e){const i=t.data,n=t.width,s=t.height;let o,r,a,l,h,d,c,u,p,m,g,f,v,b,_,w,y,C,x,E;const S=e+e+1,P=n-1,k=s-1,I=e+1,R=I*(I+1)/2,M=new Ws,L=js[e],T=Us[e];let A=null,D=M,z=null,O=null;for(let t=1;t<S;t++)D=D.next=new Ws,t===I&&(A=D);D.next=M,a=r=0;for(let t=0;t<s;t++){f=v=b=_=l=h=d=c=0,u=I*(w=i[r]),p=I*(y=i[r+1]),m=I*(C=i[r+2]),g=I*(x=i[r+3]),l+=R*w,h+=R*y,d+=R*C,c+=R*x,D=M;for(let t=0;t<I;t++)D.r=w,D.g=y,D.b=C,D.a=x,D=D.next;for(let t=1;t<I;t++)o=r+((P<t?P:t)<<2),l+=(D.r=w=i[o])*(E=I-t),h+=(D.g=y=i[o+1])*E,d+=(D.b=C=i[o+2])*E,c+=(D.a=x=i[o+3])*E,f+=w,v+=y,b+=C,_+=x,D=D.next;z=M,O=A;for(let t=0;t<n;t++)i[r+3]=x=c*L>>T,0!==x?(x=255/x,i[r]=(l*L>>T)*x,i[r+1]=(h*L>>T)*x,i[r+2]=(d*L>>T)*x):i[r]=i[r+1]=i[r+2]=0,l-=u,h-=p,d-=m,c-=g,u-=z.r,p-=z.g,m-=z.b,g-=z.a,o=a+((o=t+e+1)<P?o:P)<<2,f+=z.r=i[o],v+=z.g=i[o+1],b+=z.b=i[o+2],_+=z.a=i[o+3],l+=f,h+=v,d+=b,c+=_,z=z.next,u+=w=O.r,p+=y=O.g,m+=C=O.b,g+=x=O.a,f-=w,v-=y,b-=C,_-=x,O=O.next,r+=4;a+=n}for(let t=0;t<n;t++){v=b=_=f=h=d=c=l=0,r=t<<2,u=I*(w=i[r]),p=I*(y=i[r+1]),m=I*(C=i[r+2]),g=I*(x=i[r+3]),l+=R*w,h+=R*y,d+=R*C,c+=R*x,D=M;for(let t=0;t<I;t++)D.r=w,D.g=y,D.b=C,D.a=x,D=D.next;let a=n;for(let s=1;s<=e;s++)r=a+t<<2,l+=(D.r=w=i[r])*(E=I-s),h+=(D.g=y=i[r+1])*E,d+=(D.b=C=i[r+2])*E,c+=(D.a=x=i[r+3])*E,f+=w,v+=y,b+=C,_+=x,D=D.next,s<k&&(a+=n);r=t,z=M,O=A;for(let e=0;e<s;e++)o=r<<2,i[o+3]=x=c*L>>T,x>0?(x=255/x,i[o]=(l*L>>T)*x,i[o+1]=(h*L>>T)*x,i[o+2]=(d*L>>T)*x):i[o]=i[o+1]=i[o+2]=0,l-=u,h-=p,d-=m,c-=g,u-=z.r,p-=z.g,m-=z.b,g-=z.a,o=t+((o=e+I)<k?o:k)*n<<2,l+=f+=z.r=i[o],h+=v+=z.g=i[o+1],d+=b+=z.b=i[o+2],c+=_+=z.a=i[o+3],z=z.next,u+=w=O.r,p+=y=O.g,m+=C=O.b,g+=x=O.a,f-=w,v-=y,b-=C,_-=x,O=O.next,r+=n}}(t,e)},Brightness:function(t){const e=this.brightness(),i=t.data,n=i.length;for(let t=0;t<n;t+=4)i[t]=Math.min(255,i[t]*e),i[t+1]=Math.min(255,i[t+1]*e),i[t+2]=Math.min(255,i[t+2]*e)},Brighten:function(t){const e=255*this.brightness(),i=t.data,n=i.length;for(let t=0;t<n;t+=4)i[t]+=e,i[t+1]+=e,i[t+2]+=e},Contrast:function(t){const e=Math.pow((this.contrast()+100)/100,2),i=t.data,n=i.length;let s=150,o=150,r=150;for(let t=0;t<n;t+=4)s=i[t],o=i[t+1],r=i[t+2],s/=255,s-=.5,s*=e,s+=.5,s*=255,o/=255,o-=.5,o*=e,o+=.5,o*=255,r/=255,r-=.5,r*=e,r+=.5,r*=255,s=s<0?0:s>255?255:s,o=o<0?0:o>255?255:o,r=r<0?0:r>255?255:r,i[t]=s,i[t+1]=o,i[t+2]=r},Emboss:function(t){var e,i,n,s,o,r,a,l,h;const d=t.data,c=t.width,u=t.height,p=Math.min(1,Math.max(0,null!==(i=null===(e=this.embossStrength)||void 0===e?void 0:e.call(this))&&void 0!==i?i:.5)),m=Math.min(1,Math.max(0,null!==(s=null===(n=this.embossWhiteLevel)||void 0===n?void 0:n.call(this))&&void 0!==s?s:.5)),g=null!==(a={"top-left":315,top:270,"top-right":225,right:180,"bottom-right":135,bottom:90,"bottom-left":45,left:0}[null!==(r=null===(o=this.embossDirection)||void 0===o?void 0:o.call(this))&&void 0!==r?r:"top-left"])&&void 0!==a?a:315,f=!(null===(h=null===(l=this.embossBlend)||void 0===l?void 0:l.call(this))||void 0===h||!h),v=10*p,b=255*m,_=g*Math.PI/180,w=Math.cos(_),y=Math.sin(_),C=128/1020*v,x=new Uint8ClampedArray(d),E=new Float32Array(c*u);for(let t=0,e=0;e<d.length;e+=4,t++)E[t]=.2126*x[e]+.7152*x[e+1]+.0722*x[e+2];const S=[-1,0,1,-2,0,2,-1,0,1],P=[-1,-2,-1,0,0,0,1,2,1],k=[-c-1,-c,1-c,-1,0,1,c-1,c,c+1],I=t=>t<0?0:t>255?255:t;for(let t=1;t<u-1;t++)for(let e=1;e<c-1;e++){const i=t*c+e;let n=0,s=0;n+=E[i+k[0]]*S[0],s+=E[i+k[0]]*P[0],n+=E[i+k[1]]*S[1],s+=E[i+k[1]]*P[1],n+=E[i+k[2]]*S[2],s+=E[i+k[2]]*P[2],n+=E[i+k[3]]*S[3],s+=E[i+k[3]]*P[3],n+=E[i+k[5]]*S[5],s+=E[i+k[5]]*P[5],n+=E[i+k[6]]*S[6],s+=E[i+k[6]]*P[6],n+=E[i+k[7]]*S[7],s+=E[i+k[7]]*P[7],n+=E[i+k[8]]*S[8],s+=E[i+k[8]]*P[8];const o=I(b+(w*n+y*s)*C),r=4*i;if(f){const t=o-b;d[r]=I(x[r]+t),d[r+1]=I(x[r+1]+t),d[r+2]=I(x[r+2]+t),d[r+3]=x[r+3]}else d[r]=d[r+1]=d[r+2]=o,d[r+3]=x[r+3]}for(let t=0;t<c;t++){let e=4*t,i=4*((u-1)*c+t);d[e]=x[e],d[e+1]=x[e+1],d[e+2]=x[e+2],d[e+3]=x[e+3],d[i]=x[i],d[i+1]=x[i+1],d[i+2]=x[i+2],d[i+3]=x[i+3]}for(let t=1;t<u-1;t++){let e=t*c*4,i=4*(t*c+(c-1));d[e]=x[e],d[e+1]=x[e+1],d[e+2]=x[e+2],d[e+3]=x[e+3],d[i]=x[i],d[i+1]=x[i+1],d[i+2]=x[i+2],d[i+3]=x[i+3]}return t},Enhance:function(t){const e=t.data,i=e.length;let n,s,o,r=e[0],a=r,l=e[1],h=l,d=e[2],c=d;const u=this.enhance();if(0===u)return;for(let t=0;t<i;t+=4)n=e[t+0],n<r?r=n:n>a&&(a=n),s=e[t+1],s<l?l=s:s>h&&(h=s),o=e[t+2],o<d?d=o:o>c&&(c=o);let p,m,g,f,v,b;if(a===r&&(a=255,r=0),h===l&&(h=255,l=0),c===d&&(c=255,d=0),u>0)p=a+u*(255-a),m=r-u*(r-0),g=h+u*(255-h),f=l-u*(l-0),v=c+u*(255-c),b=d-u*(d-0);else{const t=.5*(a+r);p=a+u*(a-t),m=r+u*(r-t);const e=.5*(h+l);g=h+u*(h-e),f=l+u*(l-e);const i=.5*(c+d);v=c+u*(c-i),b=d+u*(d-i)}for(let t=0;t<i;t+=4)e[t+0]=qs(e[t+0],r,a,m,p),e[t+1]=qs(e[t+1],l,h,f,g),e[t+2]=qs(e[t+2],d,c,b,v)},Grayscale:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4){const i=.34*e[t]+.5*e[t+1]+.16*e[t+2];e[t]=i,e[t+1]=i,e[t+2]=i}},HSL:function(t){const e=t.data,i=e.length,n=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=127*this.luminance(),r=1*n*Math.cos(s*Math.PI/180),a=1*n*Math.sin(s*Math.PI/180),l=.299+.701*r+.167*a,h=.587-.587*r+.33*a,d=.114-.114*r-.497*a,c=.299-.299*r-.328*a,u=.587+.413*r+.035*a,p=.114-.114*r+.293*a,m=.299-.3*r+1.25*a,g=.587-.586*r-1.05*a,f=.114+.886*r-.2*a;let v,b,_,w;for(let t=0;t<i;t+=4)v=e[t+0],b=e[t+1],_=e[t+2],w=e[t+3],e[t+0]=l*v+h*b+d*_+o,e[t+1]=c*v+u*b+p*_+o,e[t+2]=m*v+g*b+f*_+o,e[t+3]=w},HSV:function(t){const e=t.data,i=e.length,n=Math.pow(2,this.value()),s=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,r=n*s*Math.cos(o*Math.PI/180),a=n*s*Math.sin(o*Math.PI/180),l=.299*n+.701*r+.167*a,h=.587*n-.587*r+.33*a,d=.114*n-.114*r-.497*a,c=.299*n-.299*r-.328*a,u=.587*n+.413*r+.035*a,p=.114*n-.114*r+.293*a,m=.299*n-.3*r+1.25*a,g=.587*n-.586*r-1.05*a,f=.114*n+.886*r-.2*a;for(let t=0;t<i;t+=4){const i=e[t+0],n=e[t+1],s=e[t+2],o=e[t+3];e[t+0]=l*i+h*n+d*s,e[t+1]=c*i+u*n+p*s,e[t+2]=m*i+g*n+f*s,e[t+3]=o}},Invert:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]},Kaleidoscope:function(t){const e=t.width,i=t.height;let n,s,o,r,a,l,h,d,c,u,p=Math.round(this.kaleidoscopePower());const m=Math.round(this.kaleidoscopeAngle()),g=Math.floor(e*(m%360)/360);if(p<1)return;const f=je.createCanvasElement();f.width=e,f.height=i;const v=f.getContext("2d").getImageData(0,0,e,i);je.releaseCanvas(f),function(t,e,i){const n=t.data,s=e.data,o=t.width,r=t.height,a=i.polarCenterX||o/2,l=i.polarCenterY||r/2;let h=Math.sqrt(a*a+l*l),d=o-a,c=r-l;const u=Math.sqrt(d*d+c*c);h=u>h?u:h;const p=r,m=o,g=360/m*Math.PI/180;for(let t=0;t<m;t+=1){const e=Math.sin(t*g),i=Math.cos(t*g);for(let r=0;r<p;r+=1){d=Math.floor(a+h*r/p*i),c=Math.floor(l+h*r/p*e);let u=4*(c*o+d);const m=n[u+0],g=n[u+1],f=n[u+2],v=n[u+3];u=4*(t+r*o),s[u+0]=m,s[u+1]=g,s[u+2]=f,s[u+3]=v}}}(t,v,{polarCenterX:e/2,polarCenterY:i/2});let b=e/Math.pow(2,p);for(;b<=8;)b*=2,p-=1;b=Math.ceil(b);let _=b,w=0,y=_,C=1;for(g+b>e&&(w=_,y=0,C=-1),s=0;s<i;s+=1)for(n=w;n!==y;n+=C)o=Math.round(n+g)%e,c=4*(e*s+o),a=v.data[c+0],l=v.data[c+1],h=v.data[c+2],d=v.data[c+3],u=4*(e*s+n),v.data[u+0]=a,v.data[u+1]=l,v.data[u+2]=h,v.data[u+3]=d;for(s=0;s<i;s+=1)for(_=Math.floor(b),r=0;r<p;r+=1){for(n=0;n<_+1;n+=1)c=4*(e*s+n),a=v.data[c+0],l=v.data[c+1],h=v.data[c+2],d=v.data[c+3],u=4*(e*s+2*_-n-1),v.data[u+0]=a,v.data[u+1]=l,v.data[u+2]=h,v.data[u+3]=d;_*=2}!function(t,e,i){const n=t.data,s=e.data,o=t.width,r=t.height,a=i.polarCenterX||o/2,l=i.polarCenterY||r/2;let h=Math.sqrt(a*a+l*l),d=o-a,c=r-l;const u=Math.sqrt(d*d+c*c);h=u>h?u:h;const p=r,m=o,g=i.polarRotation||0;let f,v;for(d=0;d<o;d+=1)for(c=0;c<r;c+=1){const t=d-a,e=c-l,i=Math.sqrt(t*t+e*e)*p/h;let r=(180*Math.atan2(e,t)/Math.PI+360+g)%360;r=r*m/360,f=Math.floor(r),v=Math.floor(i);let u=4*(v*o+f);const b=n[u+0],_=n[u+1],w=n[u+2],y=n[u+3];u=4*(c*o+d),s[u+0]=b,s[u+1]=_,s[u+2]=w,s[u+3]=y}}(v,t,{polarRotation:0})},Mask:function(t){let e=function(t,e){const i=$s(t,0,0),n=$s(t,t.width-1,0),s=$s(t,0,t.height-1),o=$s(t,t.width-1,t.height-1),r=e||10;if(Ks(i,n)<r&&Ks(n,o)<r&&Ks(o,s)<r&&Ks(s,i)<r){const e=function(t){const e=[0,0,0];for(let i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([n,i,o,s]),a=[];for(let i=0;i<t.width*t.height;i++){const n=Ks(e,[t.data[4*i],t.data[4*i+1],t.data[4*i+2]]);a[i]=n<r?0:255}return a}}(t,this.threshold());return e&&(e=function(t,e,i){const n=[1,1,1,1,0,1,1,1,1],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=2040===d?255:0}return r}(e,t.width,t.height),e=function(t,e,i){const n=[1,1,1,1,1,1,1,1,1],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=d>=1020?255:0}return r}(e,t.width,t.height),e=function(t,e,i){const n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=d}return r}(e,t.width,t.height),function(t,e){for(let i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}(t,e)),t},Noise:function(t){const e=255*this.noise(),i=t.data,n=i.length,s=e/2;for(let t=0;t<n;t+=4)i[t+0]+=s-2*s*Math.random(),i[t+1]+=s-2*s*Math.random(),i[t+2]+=s-2*s*Math.random()},Pixelate:function(t){let e=Math.ceil(this.pixelSize()),i=t.width,n=t.height,s=Math.ceil(i/e),o=Math.ceil(n/e),r=t.data;if(e<=0)je.error("pixelSize value can not be <= 0");else for(let t=0;t<s;t+=1)for(let s=0;s<o;s+=1){let o=0,a=0,l=0,h=0;const d=t*e,c=d+e,u=s*e,p=u+e;let m=0;for(let t=d;t<c;t+=1)if(!(t>=i))for(let e=u;e<p;e+=1){if(e>=n)continue;const s=4*(i*e+t);o+=r[s+0],a+=r[s+1],l+=r[s+2],h+=r[s+3],m+=1}o/=m,a/=m,l/=m,h/=m;for(let t=d;t<c;t+=1)if(!(t>=i))for(let e=u;e<p;e+=1){if(e>=n)continue;const s=4*(i*e+t);r[s+0]=o,r[s+1]=a,r[s+2]=l,r[s+3]=h}}},Posterize:function(t){const e=Math.round(254*this.levels())+1,i=t.data,n=i.length,s=255/e;for(let t=0;t<n;t+=1)i[t]=Math.floor(i[t]/s)*s},RGB:function(t){const e=t.data,i=e.length,n=this.red(),s=this.green(),o=this.blue();for(let t=0;t<i;t+=4){const i=(.34*e[t]+.5*e[t+1]+.16*e[t+2])/255;e[t]=i*n,e[t+1]=i*s,e[t+2]=i*o,e[t+3]=e[t+3]}},RGBA:function(t){const e=t.data,i=e.length,n=this.red(),s=this.green(),o=this.blue(),r=this.alpha();for(let t=0;t<i;t+=4){const i=1-r;e[t]=n*r+e[t]*i,e[t+1]=s*r+e[t+1]*i,e[t+2]=o*r+e[t+2]*i}},Sepia:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4){const i=e[t+0],n=e[t+1],s=e[t+2];e[t+0]=Math.min(255,.393*i+.769*n+.189*s),e[t+1]=Math.min(255,.349*i+.686*n+.168*s),e[t+2]=Math.min(255,.272*i+.534*n+.131*s)}},Solarize:function(t){const e=t.data;for(let t=0;t<e.length;t+=4){const i=e[t],n=e[t+1],s=e[t+2];.2126*i+.7152*n+.0722*s>=128&&(e[t]=255-i,e[t+1]=255-n,e[t+2]=255-s)}return t},Threshold:function(t){const e=255*this.threshold(),i=t.data,n=i.length;for(let t=0;t<n;t+=1)i[t]=i[t]<e?0:255}}});let Xs=!1,Ys=null;function Zs(){return Xs}var Js=i(931);function Qs(t){return null==t}function to(t){return null!==t&&"object"==typeof t}function eo(t){return null!==t&&"object"==typeof t}function io(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function no(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce((i,n)=>{const s=t[n],o=e[n];return eo(s)&&eo(o)?Object.assign(Object.assign({},i),{[n]:no(s,o)}):Object.assign(Object.assign({},i),{[n]:n in e?o:s})},{})}function so(t){return!!to(t)&&"target"in t}const oo={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ro{static alreadyDisposed(){return new ro({type:"alreadydisposed"})}static notBindable(){return new ro({type:"notbindable"})}static notCompatible(t,e){return new ro({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new ro({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new ro({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=oo[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class ao{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){const i=this.read();if(!ao.isBindable(i))throw ro.notBindable();if(!(t in i))throw ro.propertyNotFound(t);i[t]=e}}class lo{constructor(){this.observers_={}}on(t,e,i){var n;let s=this.observers_[t];return s||(s=this.observers_[t]=[]),s.push({handler:e,key:null!==(n=null==i?void 0:i.key)&&void 0!==n?n:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter(t=>t.key!==e)),this}emit(t,e){const i=this.observers_[t];i&&i.forEach(t=>{t.handler(e)})}}class ho{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new lo,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(t):t,s=this.rawValue_;(!this.equals_(s,n)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:n,sender:this}))}}class co{constructor(t){this.emitter=new lo,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},n=this.value_;(n!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:this.value_,sender:this}))}}class uo{constructor(t){this.emitter=new lo,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function po(t,e){const i=null==e?void 0:e.constraint,n=null==e?void 0:e.equals;return i||n?new ho(t,e):new co(t)}class mo{constructor(t){this.emitter=new lo,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,i)=>Object.assign(e,{[i]:po(t[i])}),{})}static fromObject(t){const e=this.createCore(t);return new mo(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class go{constructor(t){this.values=mo.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class fo{constructor(t){this.values=mo.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");let n=t;return Qs(i)||(n=Math.max(n,i)),Qs(e)||(n=Math.min(n,e)),n}}class vo{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class bo{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const _o={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class wo{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=_o[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const yo={"+":t=>t,"-":t=>-t,"~":t=>~t};class Co{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=yo[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function xo(t){return(e,i)=>{for(let n=0;n<t.length;n++){const s=t[n](e,i);if(""!==s)return s}return""}}function Eo(t,e){var i;const n=t.substr(e).match(/^\s+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function So(t,e){var i;const n=t.substr(e).match(/^[0-9]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function Po(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const n=function(t,e){const i=So(t,e);if(""!==i)return i;const n=t.substr(e,1);if("-"!==n&&"+"!==n)return"";const s=So(t,e+=1);return""===s?"":n+s}(t,e);return""===n?"":i+n}function ko(t,e){const i=t.substr(e,1);if("0"===i)return i;const n=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=n.length,""===n?"":n+So(t,e)}const Io=xo([function(t,e){const i=ko(t,e);if(e+=i.length,""===i)return"";const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const s=So(t,e);return i+n+s+Po(t,e+=s.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const n=So(t,e);return e+=n.length,""===n?"":i+n+Po(t,e)},function(t,e){const i=ko(t,e);return e+=i.length,""===i?"":i+Po(t,e)}]),Ro=xo([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[01]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-7]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n}]),Mo=xo([Ro,Io]);function Lo(t,e,i){i+=Eo(e,i).length;const n=t.filter(t=>e.startsWith(t,i))[0];return n?(i+=n.length,{cursor:i+=Eo(e,i).length,operator:n}):null}const To=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>function(t,e){return(i,n)=>{const s=t(i,n);if(!s)return null;n=s.cursor;let o=s.evaluable;for(;;){const s=Lo(e,i,n);if(!s)break;n=s.cursor;const r=t(i,n);if(!r)return null;n=r.cursor,o=new wo(s.operator,o,r.evaluable)}return o?{cursor:n,evaluable:o}:null}}(t,e),function t(e,i){const n=function(t,e){var i;return null!==(i=function(t,e){const i=Mo(t,e);return e+=i.length,""===i?null:{evaluable:new bo(i),cursor:e}}(t,e))&&void 0!==i?i:function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const n=Ao(t,e);if(!n)return null;e=n.cursor,e+=Eo(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:n.evaluable,cursor:e}}(t,e)}(e,i);if(n)return n;const s=e.substr(i,1);if(i+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const o=t(e,i);return o?{cursor:i=o.cursor,evaluable:new Co(s,o.evaluable)}:null});function Ao(t,e){return e+=Eo(t,e).length,To(t,e)}function Do(t){var e;const i=function(t){const e=Ao(t,0);return e?e.cursor+Eo(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function zo(t){if("number"==typeof t)return t;if("string"==typeof t){const e=Do(t);if(!Qs(e))return e}return 0}function Oo(t){return String(t)}function Bo(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function Ho(t,e,i,n,s){return n+(t-e)/(i-e)*(s-n)}function No(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Vo(t,e,i){return Math.min(Math.max(t,e),i)}function Fo(t,e){return(t%e+e)%e}function Go(t,e){return Qs(t.step)?Math.max(No(e),2):No(t.step)}function Wo(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function jo(t,e){var i;const n=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===n?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function Uo(t,e){return Qs(t.step)?null:new vo(t.step,e)}function qo(t){return Qs(t.max)||Qs(t.min)?Qs(t.max)&&Qs(t.min)?null:new fo({max:t.max,min:t.min}):new go({max:t.max,min:t.min})}function $o(t,e){var i,n,s;return{formatter:null!==(i=t.format)&&void 0!==i?i:Bo(Go(t,e)),keyScale:null!==(n=t.keyScale)&&void 0!==n?n:Wo(t),pointerScale:null!==(s=t.pointerScale)&&void 0!==s?s:jo(t,e)}}function Ko(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function Xo(t){return{constraint:t.constraint,textProps:mo.fromObject($o(t.params,t.initialValue))}}class Yo{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class Zo{constructor(t){this.target=t}}class Jo extends Zo{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class Qo extends Zo{constructor(t,e){super(t),this.expanded=e}}class tr extends Zo{constructor(t,e){super(t),this.index=e}}class er extends Zo{constructor(t,e){super(t),this.native=e}}class ir extends Yo{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new lo,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const e=this.controller.value;this.emitter_.emit("change",new Jo(this,e.binding.target.read(),t.options.last))}}class nr{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new lo}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function sr(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const n=t(i);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function or(t){return{custom:e=>sr(e)(t),boolean:sr(t=>"boolean"==typeof t?t:void 0)(t),number:sr(t=>"number"==typeof t?t:void 0)(t),string:sr(t=>"string"==typeof t?t:void 0)(t),function:sr(t=>"function"==typeof t?t:void 0)(t),constant:e=>sr(t=>t===e?e:void 0)(t),raw:sr(t=>t)(t),object:e=>sr(t=>{var i;if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce((i,n)=>{if(void 0===i)return;const s=(0,e[n])(t[n]);return s.succeeded?Object.assign(Object.assign({},i),{[n]:s.value}):void 0},{})}(t,e)})(t),array:e=>sr(t=>{var i;if(Array.isArray(t))return i=e,t.reduce((t,e)=>{if(void 0===t)return;const n=i(e);return n.succeeded&&void 0!==n.value?[...t,n.value]:void 0},[])})(t)}}const rr={optional:or(!0),required:or(!1)};function ar(t,e){const i=e(rr),n=rr.required.object(i)(t);return n.succeeded?n.value:void 0}function lr(t,e,i,n){if(e&&!e(t))return!1;const s=ar(t,i);return!!s&&n(s)}function hr(t,e){var i;return no(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function dr(t){return"value"in t}function cr(t){return!(!to(t)||!("binding"in t))&&so(t.binding)}const ur="http://www.w3.org/2000/svg";function pr(t){t.offsetHeight}function mr(t){return void 0!==t.ontouchstart}const gr={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function fr(t,e){const i=t.createElementNS(ur,"svg");return i.innerHTML=gr[e],i}function vr(t,e,i){t.insertBefore(e,t.children[i])}function br(t){t.parentElement&&t.parentElement.removeChild(t)}function _r(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function wr(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function yr(t,e){t.emitter.on("change",t=>{e(t.rawValue)}),e(t.rawValue)}function Cr(t,e,i){yr(t.value(e),i)}const xr="tp";function Er(t){return(e,i)=>[xr,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const Sr=Er("lbl");class Pr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sr()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Sr("l")),Cr(e.props,"label",e=>{Qs(e)?this.element.classList.add(Sr(void 0,"nol")):(this.element.classList.remove(Sr(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){const i=t.createDocumentFragment();return e.split("\n").map(e=>t.createTextNode(e)).forEach((e,n)=>{n>0&&i.appendChild(t.createElement("br")),i.appendChild(e)}),i}(t,e)))}),this.element.appendChild(i),this.labelElement=i;const n=t.createElement("div");n.classList.add(Sr("v")),this.element.appendChild(n),this.valueElement=n}}class kr{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new Pr(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return lr(t,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return hr(null,{label:this.props.get("label")})}}const Ir=Er(""),Rr={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Mr{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(t=>{e.classList.remove(Ir(void 0,Rr[t]))}),this.blade.get("positions").forEach(t=>{e.classList.add(Ir(void 0,Rr[t]))})}),this.viewProps.handleDispose(()=>{br(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return lr(t,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return hr(null,Object.assign({},this.viewProps.exportState()))}}class Lr extends Mr{constructor(t,e){if(e.value!==e.valueController.value)throw ro.shouldNeverHappen();const i=e.valueController.viewProps,n=new kr(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new Pr(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=n,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return lr(t,e=>{var i,n,s;return super.importState(e)&&this.labelController.importProps(e)&&(null===(s=null===(n=(i=this.valueController).importProps)||void 0===n?void 0:n.call(i,t))||void 0===s||s)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var t,e,i;return hr(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function Tr(t){const e=Object.assign({},t);return delete e.value,e}class Ar extends Lr{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return lr(t,e=>super.importState(Tr(t)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return hr(()=>Tr(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class Dr extends Ar{importState(t){return lr(t,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function zr(t,e){for(;t.length<e;)t.push(void 0)}function Or(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}class Br{constructor(t){this.emitter=new lo,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=po(function(t){const e=[];return zr(e,t),e}(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=function(t,e){const i=[...Or(t),e];return i.length>t.length?i.splice(0,i.length-t.length):zr(i,t.length),i}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class Hr extends Ar{exportState(){return hr(()=>super.exportState(),{binding:{readonly:!0}})}}class Nr extends Yo{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller.buttonController.emitter.on(t,t=>{i(new er(this,t.nativeEvent))}),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}}function Vr(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}function Fr(t,e){yr(t,t=>{e.textContent=null!=t?t:""})}const Gr=Er("btn");class Wr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Gr()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(Gr("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=t.createElement("div");n.classList.add(Gr("t")),Fr(e.props.value("title"),n),this.buttonElement.appendChild(n)}}class jr{constructor(t,e){this.emitter=new lo,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Wr(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return lr(t,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return hr(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class Ur extends Mr{constructor(t,e){const i=new jr(t,{props:e.buttonProps,viewProps:e.viewProps}),n=new kr(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:n.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=n}importState(t){return lr(t,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return hr(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class qr{constructor(t){const[e,i]=t.split("-"),n=e.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=null!=i?i:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}const $r=new qr("2.0.5");function Kr(t){return Object.assign({core:$r},t)}const Xr=Kr({id:"button",type:"blade",accept(t){const e=ar(t,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new Ur(t.document,{blade:t.blade,buttonProps:mo.fromObject({title:t.params.title}),labelProps:mo.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof Ur?new Nr(t.controller):null});class Yr{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new lo,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,i){const n=null!=i?i:{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,function(t,e){if(!ao.isBindable(t))throw ro.notBindable();return new ao(t,e)}(t,e),n),r=this.pool_.createBindingApi(o);return this.add(r,n.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){const i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),n=this.pool_.createApi(i);return this.add(n,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach(t=>{var e;to(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()})}onRackValueChange_(t){const e=t.bladeController,i=this.pool_.createApi(e),n=cr(e.value)?e.value.binding:null;this.emitter_.emit("change",new Jo(i,n?n.target.read():e.value.rawValue,t.options.last))}}class Zr extends Yo{constructor(t,e){super(t),this.rackApi_=new Yr(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class Jr extends Mr{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return lr(t,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((e,i)=>e.importState(t.children[i])))}exportState(){return hr(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function Qr(t){return"rackController"in t}class ta{constructor(t){this.emitter=new lo,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw ro.shouldNeverHappen();const i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const n=this.extract_(t);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach(t=>{this.cache_.add(t)})),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.allItems().forEach(t=>{this.cache_.delete(t)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function ea(t){return Qr(t)?t.rackController.rack.bcSet_:null}class ia{constructor(t){var e,i;this.emitter=new lo,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new ta(ea),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),dr(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Qr(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;const i=t.item;if(dr(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Qr(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden")),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach(t=>{const n=[];t===e&&(n.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||n.push("veryfirst")),t===i&&(n.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||n.push("verylast")),t.blade.set("positions",n)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const n=t[i];if(dr(n)&&n.value===e)return n}return null}(this.find(dr),t.sender);if(!e)throw ro.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class na{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const e=new ia({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&vr(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&br(t.bladeController.view.element)}}function sa(){return new mo({positions:po([],{equals:io})})}class oa extends mo{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=mo.createCore(e);return new oa(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Qs(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};Cr(this,"expanded",i),Cr(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ra(t,e){e.style.height=t.styleHeight}function aa(t,e){t.value("expanded").emitter.on("beforechange",()=>{if(t.set("completed",!1),Qs(t.get("expandedHeight"))){const i=function(t,e){let i=0;return function(n){const s=n.style.transition;n.style.transition="none",t.set("expandedHeight",null),t.set("temporaryExpanded",!0),pr(e),i=e.clientHeight,t.set("temporaryExpanded",null),pr(e),n.style.transition=s}(e),i}(t,e);i>0&&t.set("expandedHeight",i)}t.set("shouldFixHeight",!0),pr(e)}),t.emitter.on("change",()=>{ra(t,e)}),ra(t,e),e.addEventListener("transitionend",e=>{"height"===e.propertyName&&t.cleanUpTransition()})}class la extends Zr{constructor(t,e){super(t,e),this.emitter_=new lo,this.controller.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",new Qo(this,t.sender.rawValue))}),this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const ha=Er("cnt");class da{constructor(t,e){var i;this.className_=Er(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),ha()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Cr(this.foldable_,"completed",Vr(this.element,this.className_(void 0,"cpl")));const n=t.createElement("button");n.classList.add(this.className_("b")),Cr(e.props,"title",t=>{Qs(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=t.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=t.createElement("div");o.classList.add(this.className_("t")),Fr(e.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const r=t.createElement("div");r.classList.add(this.className_("m")),this.buttonElement.appendChild(r);const a=t.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class ca extends Jr{constructor(t,e){var i;const n=oa.create(null===(i=e.expanded)||void 0===i||i),s=new da(t,{foldable:n,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new na({blade:e.blade,element:s.containerElement,root:e.root,viewProps:e.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=n,aa(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return lr(t,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return hr(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ua=Kr({id:"folder",type:"blade",accept(t){const e=ar(t,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller:t=>new ca(t.document,{blade:t.blade,expanded:t.params.expanded,props:mo.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof ca?new la(t.controller,t.pool):null}),pa=Er("");function ma(t,e){return Vr(t,pa(void 0,e))}class ga extends mo{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(i=po(this.getGlobalDisabled_()),[new uo(i),(t,e)=>{i.setRawValue(t,e)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,n;const s=null!=t?t:{};return new ga(mo.createCore({disabled:null!==(e=s.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=s.hidden)&&void 0!==i&&i,parent:null!==(n=s.parent)&&void 0!==n?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){yr(this.globalDisabled_,ma(t,"disabled")),Cr(this,"hidden",ma(t,"hidden"))}bindDisabled(t){yr(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){yr(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const fa=Er("tbp");class va{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(fa()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(fa("c")),this.element.appendChild(i),this.containerElement=i}}const ba=Er("tbi");class _a{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ba()),e.viewProps.bindClassModifiers(this.element),Cr(e.props,"selected",t=>{t?this.element.classList.add(ba(void 0,"sel")):this.element.classList.remove(ba(void 0,"sel"))});const i=t.createElement("button");i.classList.add(ba("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=t.createElement("div");n.classList.add(ba("t")),Fr(e.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}}class wa{constructor(t,e){this.emitter=new lo,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new _a(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ya extends Jr{constructor(t,e){const i=new va(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new na({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new wa(t,{props:e.itemProps,viewProps:ga.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,Cr(this.props,"selected",t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}importState(t){return lr(t,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return hr(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Ca extends Zr{constructor(t,e){super(t,e),this.emitter_=new lo,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const e=this.controller.view.element.ownerDocument,i=new ya(e,{blade:sa(),itemProps:mo.fromObject({selected:!1,title:t.title}),props:mo.fromObject({selected:!1}),viewProps:ga.create()}),n=this.pool_.createApi(i);return this.rackApi_.add(n,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new tr(this,t.rawValue))}}class xa extends Zr{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class Ea{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=po(!0),this.selectedIndex=po(-1),this.items_=[]}add(t,e){const i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const t=this.items_.findIndex(t=>t.rawValue);t<0?(this.items_.forEach((t,e)=>{t.rawValue=0===e}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,i)=>{e.rawValue=i===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex(e=>e===t.sender);this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const Sa=Er("tab");class Pa{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sa(),ha()),e.viewProps.bindClassModifiers(this.element),yr(e.empty,Vr(this.element,Sa(void 0,"nop")));const i=t.createElement("div");i.classList.add(Sa("t")),this.element.appendChild(i),this.itemsElement=i;const n=t.createElement("div");n.classList.add(Sa("i")),this.element.appendChild(n);const s=t.createElement("div");s.classList.add(Sa("c")),this.element.appendChild(s),this.contentsElement=s}}class ka extends Jr{constructor(t,e){const i=new Ea,n=new Pa(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new na({blade:e.blade,element:n.contentsElement,viewProps:e.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const e=t.bladeController;vr(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const e=t.bladeController;br(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}const Ia=Kr({id:"tab",type:"blade",accept(t){const e=ar(t,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return e&&0!==e.pages.length?{params:e}:null},controller(t){const e=new ka(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach(i=>{const n=new ya(t.document,{blade:sa(),itemProps:mo.fromObject({selected:!1,title:i.title}),props:mo.fromObject({selected:!1}),viewProps:ga.create()});e.add(n)}),e},api:t=>t.controller instanceof ka?new Ca(t.controller,t.pool):t.controller instanceof ya?new xa(t.controller,t.pool):null});class Ra extends ir{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class Ma{constructor(){this.disabled=!1,this.emitter=new lo}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class La{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new lo,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ta{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>e.constrain(t),t)}}function Aa(t,e){if(t instanceof e)return t;if(t instanceof Ta){const i=t.constraints.reduce((t,i)=>t||(i instanceof e?i:null),null);if(i)return i}return null}class Da{constructor(t){this.values=mo.fromObject({options:t})}constrain(t){const e=this.values.get("options");return 0===e.length||e.filter(e=>e.value===t).length>0?t:e[0].value}}function za(t){var e;const i=rr;return Array.isArray(t)?null===(e=ar({items:t},t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))})))||void 0===e?void 0:e.items:"object"==typeof t?i.required.raw(t).value:void 0}function Oa(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach(i=>{e.push({text:i,value:t[i]})}),e}function Ba(t){return Qs(t)?null:new Da(Oa(t))}const Ha=Er("lst");class Na{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Ha()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(Ha("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const n=t.createElement("div");n.classList.add(Ha("m")),n.appendChild(fr(t,"dropdown")),this.element.appendChild(n),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,Cr(this.props_,"options",e=>{_r(this.selectElement),e.forEach(e=>{const i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)}),this.update_()})}update_(){const t=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Va{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Na(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return lr(t,null,t=>({options:t.required.custom(za)}),t=>(this.props.set("options",Oa(t.options)),!0))}exportProps(){return hr(null,{options:this.props.get("options")})}}const Fa=Er("pop");class Ga{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Fa()),e.viewProps.bindClassModifiers(this.element),yr(e.shows,Vr(this.element,Fa(void 0,"v")))}}class Wa{constructor(t,e){this.shows=po(!1),this.viewProps=e.viewProps,this.view=new Ga(t,{shows:this.shows,viewProps:this.viewProps})}}const ja=Er("txt");class Ua{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ja()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(ja("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class qa{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ua(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Qs(i)||(this.value.rawValue=i),this.view.refresh()}}function $a(t){return"false"!==t&&!!t}function Ka(t){return function(t){return String(t)}(t)}const Xa=Bo(0);function Ya(t){return Xa(t)+"%"}function Za(t){return String(t)}function Ja(t){return t}function Qa({primary:t,secondary:e,forward:i,backward:n}){let s=!1;function o(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",n=>{o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)})}),e.emitter.on("change",s=>{o(()=>{t.setRawValue(n(t.rawValue,e.rawValue),s.options)}),o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)})}),o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function tl(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function el(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function il(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function nl(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function sl(t,e){var i,n;const s=e.ownerDocument.defaultView,o=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=s&&s.scrollX)&&void 0!==i?i:0)+o.left),y:t.pageY-((null!==(n=s&&s.scrollY)&&void 0!==n?n:0)+o.top)}}class ol{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new lo,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-n.left,y:i.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const rl=Er("txt");class al{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(rl(),rl(void 0,"num")),e.arrayPosition&&this.element.classList.add(rl(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(rl("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(rl()),this.inputElement.classList.add(rl("i"));const n=t.createElement("div");n.classList.add(rl("k")),this.element.appendChild(n),this.knobElement=n;const s=t.createElementNS(ur,"svg");s.classList.add(rl("g")),this.knobElement.appendChild(s);const o=t.createElementNS(ur,"path");o.classList.add(rl("gb")),s.appendChild(o),this.guideBodyElem_=o;const r=t.createElementNS(ur,"path");r.classList.add(rl("gh")),s.appendChild(r),this.guideHeadElem_=r;const a=t.createElement("div");a.classList.add(Er("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(rl(void 0,"drg"));this.element.classList.add(rl(void 0,"drg"));const e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),n=Vo(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+n},0 L${i},4 L${i+n},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class ll{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=po(null),this.view=new al(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new ol(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;const n=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),s=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max");let o=t;return void 0!==n&&(o=Math.max(o,n)),void 0!==s&&(o=Math.min(o,s)),o}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Qs(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=tl(this.props.get("keyScale"),el(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==tl(this.props.get("keyScale"),el(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const hl=Er("sld");class dl{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(hl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(hl("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const n=t.createElement("div");n.classList.add(hl("k")),this.trackElement.appendChild(n),this.knobElement=n,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=Vo(Ho(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class cl{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new dl(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Ho(Vo(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(this.props.get("keyScale"),il(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(this.props.get("keyScale"),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ul=Er("sldtxt");class pl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ul());const i=t.createElement("div");i.classList.add(ul("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(ul("t")),this.textView_=e.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}}class ml{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new cl(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new ll(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new pl(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return lr(t,null,t=>({max:t.required.number,min:t.required.number}),t=>{const e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0})}exportProps(){const t=this.sliderC_.props;return hr(null,{max:t.get("max"),min:t.get("min")})}}function gl(t){return{sliderProps:new mo({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new mo({formatter:po(t.formatter),keyScale:t.keyScale,pointerScale:po(t.pointerScale)})}}const fl={containerUnitSize:"cnt-usz"};function vl(t){return`--${fl[t]}`}function bl(t){return Ko(t)}function _l(t){if(eo(t))return ar(t,bl)}function wl(t,e){if(!t)return;const i=[],n=Uo(t,e);n&&i.push(n);const s=qo(t);return s&&i.push(s),new Ta(i)}function yl(t){if("inline"===t||"popup"===t)return t}function Cl(t,e){t.write(e)}const xl=Er("ckb");class El{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(xl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(xl("l")),this.element.appendChild(i),this.labelElement=i;const n=t.createElement("input");n.classList.add(xl("i")),n.type="checkbox",this.labelElement.appendChild(n),this.inputElement=n,e.viewProps.bindDisabled(this.inputElement);const s=t.createElement("div");s.classList.add(xl("w")),this.labelElement.appendChild(s);const o=fr(t,"check");s.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Sl{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new El(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}const Pl=Kr({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=ar(e,t=>({options:t.optional.custom(za),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>$a,constraint:t=>function(t){const e=[],i=Ba(t.options);return i&&e.push(i),new Ta(e)}(t.params),writer:t=>Cl},controller:t=>{const e=t.document,i=t.value,n=t.constraint,s=n&&Aa(n,Da);return s?new Va(e,{props:new mo({options:s.values.value("options")}),value:i,viewProps:t.viewProps}):new Sl(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Va?new Ra(t.controller):null}),kl=Er("col");class Il{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(kl()),e.foldable.bindExpandedClass(this.element,kl(void 0,"expanded")),Cr(e.foldable,"completed",Vr(this.element,kl(void 0,"cpl")));const i=t.createElement("div");i.classList.add(kl("h")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(kl("s")),i.appendChild(n),this.swatchElement=n;const s=t.createElement("div");if(s.classList.add(kl("t")),i.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(kl("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function Rl(t,e,i){const n=Fo(t,360),s=Vo(e/100,0,1),o=Vo(i/100,0,1),r=o*s,a=r*(1-Math.abs(n/60%2-1)),l=o-r;let h,d,c;return[h,d,c]=n>=0&&n<60?[r,a,0]:n>=60&&n<120?[a,r,0]:n>=120&&n<180?[0,r,a]:n>=180&&n<240?[0,a,r]:n>=240&&n<300?[a,0,r]:[r,0,a],[255*(h+l),255*(d+l),255*(c+l)]}function Ml(t){return[t[0],t[1],t[2]]}function Ll(t,e){return[t[0],t[1],t[2],e]}const Tl={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){const n=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==n?e*(100-Math.abs(2*i-100))/n:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){const n=(t%360+360)%360,s=Vo(e/100,0,1),o=Vo(i/100,0,1),r=(1-Math.abs(2*o-1))*s,a=r*(1-Math.abs(n/60%2-1)),l=o-r/2;let h,d,c;return[h,d,c]=n>=0&&n<60?[r,a,0]:n>=60&&n<120?[a,r,0]:n>=120&&n<180?[0,r,a]:n>=180&&n<240?[0,a,r]:n>=240&&n<300?[a,0,r]:[r,0,a],[255*(h+l),255*(d+l),255*(c+l)]}},hsv:{hsl:function(t,e,i){const n=100-Math.abs(i*(200-e)/100-100);return[t,0!==n?e*i/n:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:Rl},rgb:{hsl:function(t,e,i){const n=Vo(t/255,0,1),s=Vo(e/255,0,1),o=Vo(i/255,0,1),r=Math.max(n,s,o),a=Math.min(n,s,o),l=r-a;let h=0,d=0;const c=(a+r)/2;return 0!==l&&(d=l/(1-Math.abs(r+a-1)),h=n===r?(s-o)/l:s===r?2+(o-n)/l:4+(n-s)/l,h=h/6+(h<0?1:0)),[360*h,100*d,100*c]},hsv:function(t,e,i){const n=Vo(t/255,0,1),s=Vo(e/255,0,1),o=Vo(i/255,0,1),r=Math.max(n,s,o),a=r-Math.min(n,s,o);let l;return l=0===a?0:r===n?((s-o)/a%6+6)%6*60:r===s?60*((o-n)/a+2):60*((n-s)/a+4),[l,100*(0===r?0:a/r),100*r]},rgb:(t,e,i)=>[t,e,i]}};function Al(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function Dl(t,e,i){var n;const s=Al(e,i);return["rgb"===e?Vo(t[0],0,s[0]):(o=t[0],r=s[0],o===r?r:Fo(o,r)),Vo(t[1],0,s[1]),Vo(t[2],0,s[2]),Vo(null!==(n=t[3])&&void 0!==n?n:1,0,1)];var o,r}function zl(t,e,i,n){const s=Al(e,i),o=Al(e,n);return t.map((t,e)=>t/s[e]*o[e])}function Ol(t,e,i){const n=zl(t,e.mode,e.type,"int");return zl(Tl[e.mode][i.mode](...n),i.mode,"int",i.type)}class Bl{static black(){return new Bl([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Dl(t,e,this.type)}getComponents(t){return Ll(Ol(Ml(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Hl=Er("colp");class Nl{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Hl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Hl("hsv"));const n=t.createElement("div");n.classList.add(Hl("sv")),this.svPaletteView_=e.svPaletteView,n.appendChild(this.svPaletteView_.element),i.appendChild(n);const s=t.createElement("div");s.classList.add(Hl("h")),this.hPaletteView_=e.hPaletteView,s.appendChild(this.hPaletteView_.element),i.appendChild(s),this.element.appendChild(i);const o=t.createElement("div");if(o.classList.add(Hl("rgb")),this.textsView_=e.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const i=t.createElement("div");i.classList.add(Hl("a"));const n=t.createElement("div");n.classList.add(Hl("ap")),n.appendChild(this.alphaViews_.palette.element),i.appendChild(n);const s=t.createElement("div");s.classList.add(Hl("at")),s.appendChild(this.alphaViews_.text.element),i.appendChild(s),this.element.appendChild(i)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Vl(t){return"int"===t?"int":"float"===t?"float":void 0}function Fl(t){return ar(t,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Vl)}),expanded:t.optional.boolean,picker:t.optional.custom(yl),readonly:t.optional.constant(!1)}))}function Gl(t){return t?.1:1}function Wl(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class jl{constructor(t,e){this.type="float",this.mode=e,this.comps_=Dl(t,e,this.type)}getComponents(t){return Ll(Ol(Ml(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Ul={int:(t,e)=>new Bl(t,e),float:(t,e)=>new jl(t,e)};function ql(t,e,i){return Ul[i](t,e)}function $l(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return function(t){const e=t.getComponents(),i=Al(t.mode,"int");return new jl([Ho(e[0],0,i[0],0,1),Ho(e[1],0,i[1],0,1),Ho(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){const e=t.getComponents(),i=Al(t.mode,"int");return new Bl([Math.round(Ho(e[0],0,1,0,i[0])),Math.round(Ho(e[1],0,1,0,i[1])),Math.round(Ho(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw ro.shouldNeverHappen()}function Kl(t,e){const i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const Xl={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Yl(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const i=parseFloat(e[1]),n=e[2];return Xl[n](i)}function Zl(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Kl(e[1],255),Kl(e[2],255),Kl(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Jl(t){const e=Zl(t);return e?new Bl(e,"rgb"):null}function Ql(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Kl(e[1],255),Kl(e[2],255),Kl(e[3],255),Kl(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function th(t){const e=Ql(t);return e?new Bl(e,"rgb"):null}function eh(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Yl(e[1]),Kl(e[2],100),Kl(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function ih(t){const e=eh(t);return e?new Bl(e,"hsl"):null}function nh(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Yl(e[1]),Kl(e[2],100),Kl(e[3],100),Kl(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function sh(t){const e=nh(t);return e?new Bl(e,"hsl"):null}function oh(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function rh(t){const e=oh(t);return e?new Bl(e,"rgb"):null}function ah(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Ho(parseInt(e[4]+e[4],16),0,255,0,1)];const i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),Ho(parseInt(i[4],16),0,255,0,1)]:null}function lh(t){const e=ah(t);return e?new Bl(e,"rgb"):null}function hh(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function dh(t){return e=>{const i=hh(e);return i?ql(i,"rgb",t):null}}function ch(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function uh(t){return e=>{const i=ch(e);return i?ql(i,"rgb",t):null}}const ph=[{parser:oh,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ah,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Zl,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ql,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:eh,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:nh,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:hh,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ch,result:{alpha:!0,mode:"rgb",notation:"object"}}];function mh(t){const e=[rh,lh,Jl,th,ih,sh];"int"===t&&e.push(dh("int"),uh("int")),"float"===t&&e.push(dh("float"),uh("float"));const i=function(t){return e=>t.reduce((t,i)=>null!==t?t:i(e),null)}(e);return e=>{const n=i(e);return n?$l(n,t):null}}function gh(t){const e=mh("int");if("string"!=typeof t)return Bl.black();const i=e(t);return null!=i?i:Bl.black()}function fh(t){const e=Vo(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function vh(t,e="#"){return`${e}${Ml(t.getComponents("rgb")).map(fh).join("")}`}function bh(t,e="#"){const i=t.getComponents("rgb");return`${e}${[i[0],i[1],i[2],255*i[3]].map(fh).join("")}`}function _h(t){const e=Bo(0);return`rgb(${Ml($l(t,"int").getComponents("rgb")).map(t=>e(t)).join(", ")})`}function wh(t){const e=Bo(2),i=Bo(0);return`rgba(${$l(t,"int").getComponents("rgb").map((t,n)=>(3===n?e:i)(t)).join(", ")})`}function yh(t,e){const i=Bo("float"===e?2:0),n=["r","g","b"];return`{${Ml($l(t,e).getComponents("rgb")).map((t,e)=>`${n[e]}: ${i(t)}`).join(", ")}}`}function Ch(t){return e=>yh(e,t)}function xh(t,e){const i=Bo(2),n=Bo("float"===e?2:0),s=["r","g","b","a"];return`{${$l(t,e).getComponents("rgb").map((t,e)=>`${s[e]}: ${(3===e?i:n)(t)}`).join(", ")}}`}function Eh(t){return e=>xh(e,t)}const Sh=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:vh},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:bh},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:_h},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:wh},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Bo(0),Ya,Ya];return`hsl(${Ml($l(t,"int").getComponents("hsl")).map((t,i)=>e[i](t)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Bo(0),Ya,Ya,Bo(2)];return`hsla(${$l(t,"int").getComponents("hsl").map((t,i)=>e[i](t)).join(", ")})`}},...["int","float"].reduce((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Ch(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Eh(e)}],[])];function Ph(t){return Sh.reduce((e,i)=>{return e||(n=i.format,s=t,n.alpha===s.alpha&&n.mode===s.mode&&n.notation===s.notation&&n.type===s.type?i.stringifier:null);var n,s},null)}const kh=Er("apl");class Ih{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(kh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(kh("b")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(kh("c")),i.appendChild(n),this.colorElem_=n;const s=t.createElement("div");s.classList.add(kh("m")),this.element.appendChild(s),this.markerElem_=s;const o=t.createElement("div");o.classList.add(kh("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new Bl([e[0],e[1],e[2],0],"rgb"),n=new Bl([e[0],e[1],e[2],255],"rgb"),s=["to right",wh(i),wh(n)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=wh(t);const o=Ho(e[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class Rh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ih(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,n=this.value.rawValue,[s,o,r]=n.getComponents("hsv");this.value.setRawValue(new Bl([s,o,r,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(Gl(!0),il(t));if(0===e)return;const i=this.value.rawValue,[n,s,o,r]=i.getComponents("hsv");this.value.setRawValue(new Bl([n,s,o,r+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(Gl(!0),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Mh=Er("coltxt");class Lh{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Mh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Mh("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((e,i)=>{const n=t.createElement("option");return n.textContent=i.text,n.value=i.value,e.appendChild(n),e},t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(Mh("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const n=t.createElement("div");n.classList.add(Mh("mm")),n.appendChild(fr(t,"dropdown")),i.appendChild(n),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Mh("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=e.inputViews,this.applyInputViews_(),yr(e.mode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){_r(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach(e=>{const i=t.createElement("div");i.classList.add(Mh("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)})}}function Th(t,e,i){const n=Al(t,e)[i];return new go({min:0,max:n})}class Ah{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=po(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Lh(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?function(t,e){const i={colorMode:e.colorMode,colorType:e.colorType,parser:Do,viewProps:e.viewProps};return[0,1,2].map(n=>{const s=function(t,e,i){return new ll(t,{arrayPosition:0===i?"fst":2===i?"lst":"mid",parser:e.parser,props:mo.fromObject({formatter:(n=e.colorType,Bo("float"===n?2:0)),keyScale:Gl(!1),pointerScale:"float"===e.colorType?.01:1}),value:po(0,{constraint:Th(e.colorMode,e.colorType,i)}),viewProps:e.viewProps});var n}(t,i,n);return Qa({primary:e.value,secondary:s.value,forward:t=>$l(t,e.colorType).getComponents(e.colorMode)[n],backward(t,i){const s=e.colorMode,o=$l(t,e.colorType).getComponents(s);return o[n]=i,$l(ql(Ll(Ml(o),o[3]),s,e.colorType),"int")}}),s})}(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){const i=new qa(t,{parser:mh("int"),props:mo.fromObject({formatter:vh}),value:po(Bl.black()),viewProps:e.viewProps});return Qa({primary:e.value,secondary:i.value,forward:t=>new Bl(Ml(t.getComponents()),t.mode),backward:(t,e)=>new Bl(Ll(Ml(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(t=>t.view)}}const Dh=Er("hpl");class zh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Dh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Dh("c")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(Dh("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=_h(new Bl([e,100,100],"hsv"));const i=Ho(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Oh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new zh(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Ho(Vo(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),n=this.value.rawValue,[,s,o,r]=n.getComponents("hsv");this.value.setRawValue(new Bl([i,s,o,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(Gl(!1),il(t));if(0===e)return;const i=this.value.rawValue,[n,s,o,r]=i.getComponents("hsv");this.value.setRawValue(new Bl([n+e,s,o,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(Gl(!1),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Bh=Er("svp");class Hh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Bh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(Bh("c")),this.element.appendChild(i),this.canvasElement=i;const n=t.createElement("div");n.classList.add(Bh("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,n=this.canvasElement.height,s=t.getImageData(0,0,i,n),o=s.data;for(let t=0;t<n;t++)for(let s=0;s<i;s++){const r=Ho(s,0,i,0,100),a=Ho(t,0,n,100,0),l=Rl(e[0],r,a),h=4*(t*i+s);o[h]=l[0],o[h+1]=l[1],o[h+2]=l[2],o[h+3]=255}t.putImageData(s,0,0);const r=Ho(e[1],0,100,0,100);this.markerElem_.style.left=`${r}%`;const a=Ho(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Nh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Hh(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Ho(t.point.x,0,t.bounds.width,0,100),n=Ho(t.point.y,0,t.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Bl([s,i,n,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){nl(t.key)&&t.preventDefault();const[e,i,n,s]=this.value.rawValue.getComponents("hsv"),o=Gl(!1),r=tl(o,il(t)),a=tl(o,el(t));0===r&&0===a||this.value.setRawValue(new Bl([e,i+r,n+a,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Gl(!1),i=tl(e,il(t)),n=tl(e,el(t));0===i&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Vh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Oh(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Nh(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Rh(t,{value:this.value,viewProps:this.viewProps}),text:new ll(t,{parser:Do,props:mo.fromObject({pointerScale:.01,keyScale:.1,formatter:Bo(2)}),value:po(0,{constraint:new go({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Qa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{const i=t.getComponents();return i[3]=e,new Bl(i,t.mode)}}),this.textsC_=new Ah(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Nl(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Fh=Er("colsw");class Gh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Fh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Fh("sw")),this.element.appendChild(i),this.swatchElem_=i;const n=t.createElement("button");n.classList.add(Fh("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=bh(t)}onValueChange_(){this.update_()}}class Wh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Gh(t,{value:this.value,viewProps:this.viewProps})}}class jh{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=oa.create(e.expanded),this.swatchC_=new Wh(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new qa(t,{parser:e.parser,props:mo.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Il(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Wa(t,{viewProps:this.viewProps}):null;const n=new Vh(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),Qa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aa(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=wr(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!mr(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function Uh(t){return Ml(t.getComponents("rgb")).reduce((t,e)=>t<<8|255&Math.floor(e),0)}function qh(t){return t.getComponents("rgb").reduce((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e),0)>>>0}function $h(t){return"number"!=typeof t?Bl.black():new Bl([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function Kh(t){return"number"!=typeof t?Bl.black():new Bl([(e=t)>>24&255,e>>16&255,e>>8&255,Ho(255&e,0,255,0,1)],"rgb");var e}function Xh(t,e){return"object"==typeof t&&!Qs(t)&&e in t&&"number"==typeof t[e]}function Yh(t){return Xh(t,"r")&&Xh(t,"g")&&Xh(t,"b")}function Zh(t){return Yh(t)&&Xh(t,"a")}function Jh(t){return Yh(t)}function Qh(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;const i=t.getComponents(),n=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==n[t])return!1;return!0}function td(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}const ed=Kr({id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;const i=Fl(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{supportsAlpha:(n=e,!!(null===(s=null==n?void 0:n.color)||void 0===s?void 0:s.alpha))})}:null;var n,s},binding:{reader:t=>t.params.supportsAlpha?Kh:$h,equals:Qh,writer:t=>function(t){const e=t?qh:Uh;return(t,i)=>{Cl(t,e(i))}}(t.params.supportsAlpha)},controller:t=>{var e,i,n;return new jh(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(n=t.params.supportsAlpha,n?t=>bh(t,"0x"):t=>vh(t,"0x")),parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}});function id(t,e){return i=>t?xh(i,e):yh(i,e)}const nd=Kr({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!Jh(t))return null;const n=Fl(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{colorType:null!==(i=Wl(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>{return e=t.params.colorType,t=>{const i=function(t,e){if(!Jh(t))return $l(Bl.black(),e);if("int"===e){const e=td(t);return new Bl(e,"rgb")}if("float"===e){const e=td(t);return new jl(e,"rgb")}return $l(Bl.black(),"int")}(t,e);return $l(i,"int")};var e},equals:Qh,writer:t=>{return e=Zh(t.initialValue),i=t.params.colorType,(t,n)=>{e?function(t,e,i){const n=$l(e,i).toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}(t,n,i):function(t,e,i){const n=$l(e,i).toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}(t,n,i)};var e,i}},controller:t=>{var e,i;const n=Zh(t.initialValue);return new jh(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:id(n,t.params.colorType),parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:n,value:t.value,viewProps:t.viewProps})}}),sd=Kr({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("text"===e.view)return null;const i=function(t,e="int"){const i=function(t){return ph.reduce((e,{parser:i,result:n})=>e||(i(t)?n:null),null)}(t);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}(t,Wl(e));if(!i)return null;const n=Ph(i);if(!n)return null;const s=Fl(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{format:i,stringifier:n})}:null},binding:{reader:()=>gh,equals:Qh,writer:t=>{const e=function(t){const e=Ph(t);return e?(t,i)=>{Cl(t,e(i))}:null}(t.params.format);if(!e)throw ro.notBindable();return e}},controller:t=>{var e,i;return new jh(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class od{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((t,e)=>{var i,n;return null!==(n=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==n?n:t});return this.asm_.fromComponents(e)}}const rd=Er("pndtxt");class ad{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(rd()),this.textViews.forEach(e=>{const i=t.createElement("div");i.classList.add(rd("a")),i.appendChild(e.element),this.element.appendChild(i)})}}class ld{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((i,n)=>function(t,e,i){return new ll(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[i].textProps,value:po(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,n)),this.acs_.forEach((t,i)=>{Qa({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,n)=>{const s=e.assembly.toComponents(t);return s[i]=n,e.assembly.fromComponents(s)}})}),this.view=new ad(t,{textViews:this.acs_.map(t=>t.view)})}get textControllers(){return this.acs_}}class hd extends ir{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}const dd=Kr({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const i=ar(e,t=>Object.assign(Object.assign({},Ko(t)),{options:t.optional.custom(za),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>zo,constraint:t=>function(t,e){const i=[],n=Uo(t,e);n&&i.push(n);const s=qo(t);s&&i.push(s);const o=Ba(t.options);return o&&i.push(o),new Ta(i)}(t.params,t.initialValue),writer:t=>Cl},controller:t=>{const e=t.value,i=t.constraint,n=i&&Aa(i,Da);if(n)return new Va(t.document,{props:new mo({options:n.values.value("options")}),value:e,viewProps:t.viewProps});const s=$o(t.params,e.rawValue),o=i&&Aa(i,go);return o?new ml(t.document,Object.assign(Object.assign({},gl(Object.assign(Object.assign({},s),{keyScale:po(s.keyScale),max:o.values.value("max"),min:o.values.value("min")}))),{parser:Do,value:e,viewProps:t.viewProps})):new ll(t.document,{parser:Do,props:mo.fromObject(s),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof ml?new hd(t.controller):t.controller.valueController instanceof Va?new Ra(t.controller):null});class cd{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const ud={toComponents:t=>t.getComponents(),fromComponents:t=>new cd(...t)},pd=Er("p2d");class md{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pd()),e.viewProps.bindClassModifiers(this.element),yr(e.expanded,Vr(this.element,pd(void 0,"expanded")));const i=t.createElement("div");i.classList.add(pd("h")),this.element.appendChild(i);const n=t.createElement("button");n.classList.add(pd("b")),n.appendChild(fr(t,"p2dpad")),e.viewProps.bindDisabled(n),i.appendChild(n),this.buttonElement=n;const s=t.createElement("div");if(s.classList.add(pd("t")),i.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(pd("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const gd=Er("p2dp");class fd{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(gd()),"popup"===e.layout&&this.element.classList.add(gd(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(gd("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const n=t.createElementNS(ur,"svg");n.classList.add(gd("g")),this.padElement.appendChild(n),this.svgElem_=n;const s=t.createElementNS(ur,"line");s.classList.add(gd("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=t.createElementNS(ur,"line");o.classList.add(gd("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const r=t.createElementNS(ur,"line");r.classList.add(gd("l")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(r),this.lineElem_=r;const a=t.createElement("div");a.classList.add(gd("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),n=Ho(t,-i,+i,0,100),s=Ho(e,-i,+i,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function vd(t,e,i){return[tl(e[0],il(t)),tl(e[1],el(t))*(i?1:-1)]}class bd{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new fd(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.props.get("max"),n=Ho(t.point.x,0,t.bounds.width,-i,+i),s=Ho(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new cd(n,s),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){nl(t.key)&&t.preventDefault();const[e,i]=vd(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(new cd(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=vd(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class _d{constructor(t,e){var i,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=oa.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Wa(t,{viewProps:this.viewProps}):null;const s=new bd(t,{layout:e.pickerLayout,props:new mo({invertsY:po(e.invertsY),max:po(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new ld(t,{assembly:ud,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new md(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Qa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aa(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=wr(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!mr(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function wd(t){return cd.isObject(t)?new cd(t.x,t.y):new cd}function yd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Cd(t,e){var i,n;if(!Qs(t.min)||!Qs(t.max))return Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(n=t.max)&&void 0!==n?n:0));const s=Wo(t);return Math.max(10*Math.abs(s),10*Math.abs(e))}function xd(t,e){var i,n;const s=Cd(no(t,null!==(i=t.x)&&void 0!==i?i:{}),e.x),o=Cd(no(t,null!==(n=t.y)&&void 0!==n?n:{}),e.y);return Math.max(s,o)}function Ed(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const Sd=Kr({id:"input-point2d",type:"input",accept:(t,e)=>{if(!cd.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{expanded:t.optional.boolean,picker:t.optional.custom(yl),readonly:t.optional.constant(!1),x:t.optional.custom(_l),y:t.optional.object(Object.assign(Object.assign({},bl(t)),{inverted:t.optional.boolean}))}));return i?{initialValue:t,params:i}:null},binding:{reader:()=>wd,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:ud,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y)]});var e,i},equals:cd.equals,writer:()=>yd},controller:t=>{var e,i;const n=t.document,s=t.value,o=t.constraint,r=[t.params.x,t.params.y];return new _d(n,{axes:s.rawValue.getComponents().map((e,i)=>{var n;return Xo({constraint:o.components[i],initialValue:e,params:no(t.params,null!==(n=r[i])&&void 0!==n?n:{})})}),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:Ed(t.params),max:xd(t.params,s.rawValue),parser:Do,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:s,viewProps:t.viewProps})}});class Pd{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y,n=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const kd={toComponents:t=>t.getComponents(),fromComponents:t=>new Pd(...t)};function Id(t){return Pd.isObject(t)?new Pd(t.x,t.y,t.z):new Pd}function Rd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}const Md=Kr({id:"input-point3d",type:"input",accept:(t,e)=>{if(!Pd.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(_l),y:t.optional.custom(_l),z:t.optional.custom(_l)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Id,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:kd,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y),wl(Object.assign(Object.assign({},e),e.z),i.z)]});var e,i},equals:Pd.equals,writer:t=>Rd},controller:t=>{const e=t.value,i=t.constraint,n=[t.params.x,t.params.y,t.params.z];return new ld(t.document,{assembly:kd,axes:e.rawValue.getComponents().map((e,s)=>{var o;return Xo({constraint:i.components[s],initialValue:e,params:no(t.params,null!==(o=n[s])&&void 0!==o?o:{})})}),parser:Do,value:e,viewProps:t.viewProps})}});class Ld{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.z=i,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y,n=t.z,s=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof n&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Td={toComponents:t=>t.getComponents(),fromComponents:t=>new Ld(...t)};function Ad(t){return Ld.isObject(t)?new Ld(t.x,t.y,t.z,t.w):new Ld}function Dd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}const zd=Kr({id:"input-point4d",type:"input",accept:(t,e)=>{if(!Ld.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(_l),x:t.optional.custom(_l),y:t.optional.custom(_l),z:t.optional.custom(_l)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ad,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:Td,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y),wl(Object.assign(Object.assign({},e),e.z),i.z),wl(Object.assign(Object.assign({},e),e.w),i.w)]});var e,i},equals:Ld.equals,writer:t=>Dd},controller:t=>{const e=t.value,i=t.constraint,n=[t.params.x,t.params.y,t.params.z,t.params.w];return new ld(t.document,{assembly:Td,axes:e.rawValue.getComponents().map((e,s)=>{var o;return Xo({constraint:i.components[s],initialValue:e,params:no(t.params,null!==(o=n[s])&&void 0!==o?o:{})})}),parser:Do,value:e,viewProps:t.viewProps})}}),Od=Kr({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const i=ar(e,t=>({readonly:t.optional.constant(!1),options:t.optional.custom(za)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Za,constraint:t=>function(t){const e=[],i=Ba(t.options);return i&&e.push(i),new Ta(e)}(t.params),writer:t=>Cl},controller:t=>{const e=t.document,i=t.value,n=t.constraint,s=n&&Aa(n,Da);return s?new Va(e,{props:new mo({options:s.values.value("options")}),value:i,viewProps:t.viewProps}):new qa(e,{parser:t=>t,props:mo.fromObject({formatter:Ja}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Va?new Ra(t.controller):null}),Bd=200,Hd=3,Nd=Er("mll");class Vd{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Nd()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(Nd("i")),i.style.height=`calc(var(${vl("containerUnitSize")}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(t=>{void 0!==t&&i.push(this.formatter_(t))}),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Fd{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Vd(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const Gd=Er("sgl");class Wd{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Gd()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(Gd("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class jd{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Wd(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Ud=Kr({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=ar(e,t=>({readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>$a},controller:t=>{var e;return 1===t.value.rawValue.length?new jd(t.document,{formatter:Ka,value:t.value,viewProps:t.viewProps}):new Fd(t.document,{formatter:Ka,rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:t.value,viewProps:t.viewProps})}});class qd extends ir{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const $d=Er("grl");class Kd{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add($d()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(ur,"svg");i.classList.add($d("g")),i.style.height=`calc(var(${vl("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;const n=t.createElementNS(ur,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;const s=t.createElement("div");s.classList.add($d("t"),Er("tt")()),this.element.appendChild(s),this.tooltipElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:t,clientHeight:e}=this.element,i=this.value.rawValue.length-1,n=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((r,a)=>{if(void 0===r)return;const l=Ho(a,0,i,0,t),h=Ho(r,n,s,e,0);o.push([l,h].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void r.classList.remove($d("t","a"));const l=Ho(this.cursor_.rawValue,0,i,0,t),h=Ho(a,n,s,e,0);r.style.left=`${l}px`,r.style.top=`${h}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains($d("t","a"))||(r.classList.add($d("t","a"),$d("t","in")),pr(r),r.classList.remove($d("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Xd{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=po(-1),this.view=new Kd(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),mr(t)){const t=new ol(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return lr(t,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return hr(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(Ho(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(Ho(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Yd(t){return Qs(t.format)?Bo(2):t.format}function Zd(t){return"graph"===t.view}const Jd=Kr({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const i=ar(e,t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>Zd(t)?64:1,reader:t=>zo},controller:t=>Zd(t.params)?function(t){var e,i,n;return new Xd(t.document,{formatter:Yd(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,props:mo.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(n=t.params.min)&&void 0!==n?n:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new jd(t.document,{formatter:Yd(t.params),value:t.value,viewProps:t.viewProps}):new Fd(t.document,{formatter:Yd(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:t.value,viewProps:t.viewProps})}(t),api:t=>t.controller.valueController instanceof Xd?new qd(t.controller):null}),Qd=Kr({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const i=ar(e,t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Za},controller:t=>{var e;const i=t.value;return i.rawValue.length>1||t.params.multiline?new Fd(t.document,{formatter:Ja,rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:i,viewProps:t.viewProps}):new jd(t.document,{formatter:Ja,value:i,viewProps:t.viewProps})}});class tc{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class ec{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}function ic(t,e){return 0===e?new Ma:new La(t,null!=e?e:Bd)}class nc{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!(i=e.core)||i.major!==$r.major)throw ro.notCompatible(t,e.id);var i;"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,i){return this.pluginsMap_.inputs.reduce((n,s)=>null!=n?n:function(t,e){var i;const n=t.accept(e.target.read(),e.params);if(Qs(n))return null;const s={target:e.target,initialValue:n.initialValue,params:n.params},o=ar(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string})),r=t.binding.reader(s),a=t.binding.constraint?t.binding.constraint(s):void 0,l=new tc({reader:r,target:e.target,writer:t.binding.writer(s)}),h=new nr(po(r(n.initialValue),{constraint:a,equals:t.binding.equals}),l),d=t.controller({constraint:a,document:e.document,initialValue:n.initialValue,params:n.params,value:h,viewProps:ga.create({disabled:null==o?void 0:o.disabled,hidden:null==o?void 0:o.hidden})});return new Dr(e.document,{blade:sa(),props:mo.fromObject({label:"label"in e.params?null!==(i=null==o?void 0:o.label)&&void 0!==i?i:null:e.target.key}),tag:null==o?void 0:o.tag,value:h,valueController:d})}(s,{document:t,target:e,params:i}),null)}createMonitor_(t,e,i){return this.pluginsMap_.monitors.reduce((n,s)=>null!=n?n:function(t,e){var i,n,s;const o=t.accept(e.target.read(),e.params);if(Qs(o))return null;const r={target:e.target,initialValue:o.initialValue,params:o.params},a=ar(e.params,t=>({bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string})),l=t.binding.reader(r),h=null!==(n=null!==(i=null==a?void 0:a.bufferSize)&&void 0!==i?i:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==n?n:1,d=new Br({binding:new ec({reader:l,target:e.target}),bufferSize:h,ticker:ic(e.document,null==a?void 0:a.interval)}),c=t.controller({document:e.document,params:o.params,value:d,viewProps:ga.create({disabled:null==a?void 0:a.disabled,hidden:null==a?void 0:a.hidden})});return c.viewProps.bindDisabled(d.ticker),c.viewProps.handleDispose(()=>{d.ticker.dispose()}),new Hr(e.document,{blade:sa(),props:mo.fromObject({label:"label"in e.params?null!==(s=null==a?void 0:a.label)&&void 0!==s?s:null:e.target.key}),value:d,valueController:c})}(s,{document:t,params:i,target:e}),null)}createBinding(t,e,i){if(Qs(e.read()))throw new ro({context:{key:e.key},type:"nomatchingcontroller"});const n=this.createInput_(t,e,i);if(n)return n;const s=this.createMonitor_(t,e,i);if(s)return s;throw new ro({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const i=this.pluginsMap_.blades.reduce((i,n)=>null!=i?i:function(t,e){const i=t.accept(e.params);if(!i)return null;const n=ar(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean}));return t.controller({blade:sa(),document:e.document,params:Object.assign(Object.assign({},i.params),{disabled:null==n?void 0:n.disabled,hidden:null==n?void 0:n.hidden}),viewProps:ga.create({disabled:null==n?void 0:n.disabled,hidden:null==n?void 0:n.hidden})})}(n,{document:t,params:e}),null);if(!i)throw new ro({type:"nomatchingview",context:{params:e}});return i}createInputBindingApi_(t){const e=this.pluginsMap_.inputs.reduce((e,i)=>{var n,s;return e||(null!==(s=null===(n=i.api)||void 0===n?void 0:n.call(i,{controller:t}))&&void 0!==s?s:null)},null);return this.apiCache_.add(t,null!=e?e:new ir(t))}createMonitorBindingApi_(t){const e=this.pluginsMap_.monitors.reduce((e,i)=>{var n,s;return e||(null!==(s=null===(n=i.api)||void 0===n?void 0:n.call(i,{controller:t}))&&void 0!==s?s:null)},null);return this.apiCache_.add(t,null!=e?e:new ir(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return dr(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return so(e)&&"read"in e&&"write"in e}(t.value)}(t))return this.createInputBindingApi_(t);if(function(t){return dr(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return so(e)&&"read"in e&&!("write"in e)}(t.value)}(t))return this.createMonitorBindingApi_(t);throw ro.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return dr(t)&&cr(t.value)}(t))return this.createBindingApi(t);const e=this.pluginsMap_.blades.reduce((e,i)=>null!=e?e:i.api({controller:t,pool:this}),null);if(!e)throw ro.shouldNeverHappen();return this.apiCache_.add(t,e)}}const sc=new class{constructor(){this.map_=new Map}get(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),e}};class oc extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class rc extends Yo{}class ac extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class lc extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const hc={id:"list",type:"blade",core:$r,accept(t){const e=ar(t,t=>({options:t.required.custom(za),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(t){const e=new Da(Oa(t.params.options)),i=po(t.params.value,{constraint:e}),n=new Va(t.document,{props:new mo({options:e.values.value("options")}),value:i,viewProps:t.viewProps});return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:i,valueController:n})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof Va?new oc(t.controller):null};class dc extends la{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class cc extends ca{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const uc=Er("spr");class pc{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(uc()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("hr");i.classList.add(uc("r")),this.element.appendChild(i)}}class mc extends Mr{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new pc(t,{viewProps:e.viewProps})}))}}const gc={id:"separator",type:"blade",core:$r,accept(t){const e=ar(t,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller:t=>new mc(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof mc?new rc(t.controller):null},fc={id:"slider",type:"blade",core:$r,accept(t){const e=ar(t,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(t){var e,i;const n=null!==(e=t.params.value)&&void 0!==e?e:0,s=new go({max:t.params.max,min:t.params.min}),o=po(n,{constraint:s}),r=new ml(t.document,Object.assign(Object.assign({},gl({formatter:null!==(i=t.params.format)&&void 0!==i?i:Oo,keyScale:po(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:jo(t.params,n)})),{parser:Do,value:o,viewProps:t.viewProps}));return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:o,valueController:r})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof ml?new ac(t.controller):null},vc={id:"text",type:"blade",core:$r,accept(t){const e=ar(t,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(t){var e;const i=po(t.params.value),n=new qa(t.document,{parser:t.params.parse,props:mo.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:i,viewProps:t.viewProps});return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:i,valueController:n})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof qa?new lc(t.controller):null};class bc extends dc{constructor(t){var e,i;const n=null!=t?t:{},s=null!==(e=n.document)&&void 0!==e?e:globalThis.document,o=function(){const t=new nc(sc);return[Sd,Md,zd,Od,dd,sd,nd,ed,Pl,Ud,Qd,Jd,Xr,ua,Ia].forEach(e=>{t.register("core",e)}),t}();super(new cc(s,{expanded:n.expanded,blade:sa(),props:mo.fromObject({title:n.title}),viewProps:ga.create()}),o),this.pool_=o,this.containerElem_=null!==(i=n.container)&&void 0!==i?i:function(t){const e=t.createElement("div");return e.classList.add(Er("dfw")()),t.body&&t.body.appendChild(e),e}(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw ro.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw ro.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&function(t,e,i){if(t.querySelector(`style[data-tp-style=${e}]`))return;const n=t.createElement("style");n.dataset.tpStyle=e,n.textContent=i,t.head.appendChild(n)}(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(t.id,e)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[hc,gc,fc,Ia,vc]})}}new qr("4.0.5");var _c=i(790);const wc=[{key:"multiDragBox",label:"Show Multi-Drag Box",type:"boolean",default:!0},{key:"defaultRectWidth",label:"Default Rectangle Width",type:"number",default:50,min:10,max:300,step:1},{key:"defaultRectHeight",label:"Default Rectangle Height",type:"number",default:30,min:10,max:200,step:1},{key:"defaultCircleRadius",label:"Default Circle Radius",type:"number",default:15,min:4,max:100,step:1},{key:"defaultStrokeColor",label:"Default Stroke Color",type:"pickr",default:"#000000"},{key:"defaultFillColor",label:"Default Fill Color",type:"pickr",default:"#00000000"},{key:"canvasMaxWidth",label:"Canvas Max Width (px)",type:"number",default:430,min:100,max:4e3,step:10},{key:"canvasMaxHeight",label:"Canvas Max Height (px)",type:"number",default:9999,min:100,max:4e3,step:10},{key:"canvasScaleMode",label:"Image Scale Mode",type:"select",options:[{value:"fit",label:"Fit (aspect ratio, max width)"},{value:"fill",label:"Fill (aspect ratio, max w/h, may crop)"},{value:"stretch",label:"Stretch (fill max w/h, ignore ratio)"},{value:"actual",label:"Actual Size (image pixels, scroll if too large)"}],default:"fit"},{key:"canvasResponsive",label:"Responsive: Resize on Window Change",type:"boolean",default:!0},{key:"DEBUG_LOG_LEVEL",label:"Debug: Log Level",type:"select",options:[{value:"OFF",label:"Off"},{value:"ERROR",label:"Error"},{value:"WARN",label:"Warning"},{value:"INFO",label:"Info"},{value:"DEBUG",label:"Debug"},{value:"TRACE",label:"Trace (very verbose)"}],default:"OFF"},{key:"LOG_OUTPUT_DEST",label:"Log Output Destination",type:"select",options:[{value:"console",label:"Console Only"},{value:"server",label:"Remote Server Only"},{value:"both",label:"Both Console and Server"}],default:"console"},{key:"LOG_SERVER_URL",label:"Log Server URL",type:"text",default:""},{key:"LOG_SERVER_TOKEN",label:"Log Server Token",type:"text",default:""},{key:"INTERCEPT_CONSOLE",label:"Intercept All Console Logs (for Mobile/Dev)",type:"boolean",default:!1},{key:"showErrorLogPanel",label:"Show Error Log Panel",type:"boolean",default:!0}];async function yc(){Ot("TRACE","[settings] loadSettings entry");try{let t=await _c.getItem("sceneDesignerSettings")||{};t=function(t){let e={};return"undefined"!=typeof window&&window._settings&&"object"==typeof window._settings&&(e={...window._settings}),"undefined"!=typeof window&&window._externalLogServerURL&&(e.LOG_SERVER_URL=window._externalLogServerURL),"undefined"!=typeof window&&window._externalLogServerToken&&(e.LOG_SERVER_TOKEN=window._externalLogServerToken),{...t,...e}}(t);let e={};for(const i of wc)e[i.key]=i.key in t?t[i.key]:i.default;return Ft(e),Sc(e),Pc(e),Ot("DEBUG","[settings] Settings loaded",e),Ot("TRACE","[settings] loadSettings exit"),e}catch(t){throw Ot("ERROR","[settings] loadSettings error",t),Ot("TRACE","[settings] loadSettings exit (error)"),t}}async function Cc(){Ot("TRACE","[settings] saveSettings entry");try{await _c.setItem("sceneDesignerSettings",Bt.settings),Sc(Bt.settings),Pc(Bt.settings),Ot("DEBUG","[settings] Settings saved",Bt.settings),Ot("TRACE","[settings] saveSettings exit")}catch(t){throw Ot("ERROR","[settings] saveSettings error",t),Ot("TRACE","[settings] saveSettings exit (error)"),t}}_c.config({name:"scene-designer",storeName:"settings"});const xc=Gt;async function Ec(t,e){Ot("TRACE","[settings] setSettingAndSave entry",{key:t,value:e}),xc(t,e),await Cc(),Ot("DEBUG","[settings] setSettingAndSave",{key:t,value:e}),Ot("TRACE","[settings] setSettingAndSave exit")}function Sc(t){if(Ot("TRACE","[settings] updateLogConfigFromSettings entry",t),t){if("DEBUG_LOG_LEVEL"in t){let e=t.DEBUG_LOG_LEVEL;"OFF"!==e&&"off"!==e||(e="silent"),It(e)}"LOG_OUTPUT_DEST"in t&&Rt(t.LOG_OUTPUT_DEST),"LOG_SERVER_URL"in t&&Mt(t.LOG_SERVER_URL),"LOG_SERVER_TOKEN"in t&&Lt(t.LOG_SERVER_TOKEN),Ot("TRACE","[settings] updateLogConfigFromSettings exit")}else Ot("TRACE","[settings] updateLogConfigFromSettings exit (no settings)")}function Pc(t){Ot("TRACE","[settings] updateConsoleInterceptionFromSettings entry",t),t&&(t.INTERCEPT_CONSOLE?Zs()||(function({preserveOriginal:t=!0}={}){if(Xs)return;Xs=!0,Ys=Ys||{...console};const e={log:"INFO",info:"INFO",warn:"WARN",error:"ERROR",debug:"DEBUG",trace:"TRACE"};["log","info","warn","error","debug","trace"].forEach(i=>{console[i]=function(...n){try{Ot(e[i],...n)}catch(e){t&&Ys&&Ys[i]&&Ys[i].apply(console,n)}t&&Ys&&Ys[i]&&Ys[i].apply(console,n)}})}(),Ot("INFO","[settings] Console interception ENABLED")):Zs()&&(Xs&&Ys&&(["log","info","warn","error","debug","trace"].forEach(t=>{Ys[t]&&(console[t]=Ys[t])}),Xs=!1),Ot("INFO","[settings] Console interception DISABLED")),Ot("TRACE","[settings] updateConsoleInterceptionFromSettings exit"))}const kc=[];let Ic=null;function Rc(){if(!Ic)return;let t='<div id="error-log-scroll" style="overflow-y:auto;width:100%;height:100%;font-family:monospace;font-size:1em;background:#1a1a1a;color:#e6e6e6;padding:8px 6px;">';for(const e of kc)t+=`<div>${e}</div>`;t+="</div>",Ic.innerHTML=t,setTimeout(()=>{const t=Ic.querySelector("#error-log-scroll");t&&(t.scrollTop=t.scrollHeight)},1)}function Mc(t,...e){let i="#e6e6e6";"ERROR"===t?i="#ff5b6c":"WARN"===t?i="#ffe26b":"INFO"===t?i="#8be9fd":"DEBUG"===t?i="#b8e994":"TRACE"===t&&(i="#aaa");const n=`<span style="color:#666;">[${(new Date).toLocaleTimeString()}]</span> <span style="color:${i};">${t}</span> <span style="color:#e6e6e6;">${e.map(t=>"object"==typeof t?JSON.stringify(t):String(t)).join(" ")}</span>`;kc.push(n),kc.length>250&&kc.shift(),Rc()}Ot("INFO","[errorlog] errorlog.js module loaded and ready."),Ot("INFO","[layout] layout.js module loaded and ready!"),document.addEventListener("DOMContentLoaded",()=>{Ot("TRACE","[layout] DOMContentLoaded handler entry"),Ot("INFO","[layout] DOMContentLoaded fired");const t=document.getElementById("gl-root");if(Ot("INFO","[layout] glRoot found?",!!t,t),!t)return Ot("ERROR","[layout] #gl-root not found!"),void Ot("TRACE","[layout] DOMContentLoaded handler exit (no glRoot)");let e=!0;try{yc(),e=!1!==Wt("showErrorLogPanel"),Ot("DEBUG","[layout] Loaded settings, showErrorLogPanel:",e)}catch(t){Ot("ERROR","[layout] Error loading settings, defaulting showErrorLogPanel to true",t),e=!0}const i={root:{type:"row",content:[{type:"component",componentName:"SidebarPanel",title:"Sidebar",width:20},{type:"component",componentName:"CanvasPanel",title:"Canvas",width:60},{type:"component",componentName:"SettingsPanel",title:"Settings",width:20}]}};let n;e&&(i.root={type:"column",content:[i.root,{type:"component",componentName:"ErrorLogPanel",title:"Error Log",height:18}]},Ot("DEBUG","[layout] ErrorLogPanel added to layout"));try{Ot("INFO","[layout] About to create GoldenLayout instance..."),n=new yt(i,t),Ot("INFO","[layout] GoldenLayout instance created.")}catch(t){throw Ot("ERROR","[layout] ERROR while creating GoldenLayout instance:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (GoldenLayout error)"),t}try{n.registerComponent("SidebarPanel",t=>{Ot("TRACE","[layout] SidebarPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] SidebarPanel factory called",{title:t?.title,componentName:t?.componentName}),function(t,e){Ot("TRACE","[sidebar] buildSidebarPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{function i(){Ot("TRACE","[sidebar] makeTableData entry");const t=(Bt.shapes||[]).map((t,e)=>{const i=function(t){Ot("TRACE","[sidebar] getShapeAttrs entry",{s:t});try{if(!t||"function"!=typeof t.getAttrs)return Ot("TRACE","[sidebar] getShapeAttrs exit (no getAttrs)"),{};const e=t.getAttrs();return Ot("TRACE","[sidebar] getShapeAttrs exit",{attrs:e}),e}catch(t){return Ot("ERROR","[sidebar] getShapeAttrs error",t),Ot("TRACE","[sidebar] getShapeAttrs exit (error)"),{}}}(t);let n=0,s=0,o=0,r=0;return"rect"===t._type?(n=i.x,s=i.y,o=i.width,r=i.height):"circle"===t._type?(n=i.x,s=i.y,o=i.radius,r=i.radius):"point"===t._type&&(n=i.x,s=i.y,o="--",r="--"),{idx:e+1,label:t._label||"",type:t._type||"",locked:t.locked?"🔒":"",fillColor:t.fill?t.fill():"",strokeColor:t.stroke?t.stroke():"",x:Math.round(n),y:Math.round(s),w:o,h:r,_shape:t,selected:Bt.selectedShapes.includes(t)}});return Ot("TRACE","[sidebar] makeTableData exit",{rowCount:t.length}),t}Ot("INFO","[sidebar] buildSidebarPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),t.innerHTML='\n      <div id="sidebar-panel-container" style="width:100%;height:100%;background:#f4f8ff;display:flex;flex-direction:column;overflow:auto;">\n        <div style="padding:10px 8px 4px 8px;font-weight:bold;font-size:1.2em;color:#0057d8;">\n          Shape List\n          <button id="sidebar-select-all" style="float:right;font-size:0.9em;">Select All</button>\n        </div>\n        <div id="sidebar-table-div" style="flex:1 1 0;overflow:auto;"></div>\n      </div>\n    ',t.querySelector("#sidebar-select-all").onclick=()=>{Ot("TRACE","[sidebar] sidebar-select-all onclick entry"),Nt(Bt.shapes.slice()),Ot("INFO","[sidebar] Select All clicked"),Re&&Re.replaceData(i()),Ot("TRACE","[sidebar] sidebar-select-all onclick exit")};const n=[{title:"#",field:"idx",width:45,hozAlign:"center"},{title:"Label",field:"label",editor:"input",widthGrow:2},{title:"Type",field:"type",width:70},{title:"L",field:"locked",width:36,hozAlign:"center"},{title:"F",field:"fillColor",width:36,hozAlign:"center",formatter:t=>Me(t.getValue())},{title:"S",field:"strokeColor",width:36,hozAlign:"center",formatter:t=>Me(t.getValue())},{title:"X",field:"x",width:50},{title:"Y",field:"y",width:50},{title:"W/R",field:"w",width:50},{title:"H",field:"h",width:50}],s=t.querySelector("#sidebar-table-div");if(s.innerHTML="",Re&&"function"==typeof Re.destroy&&(Ot("TRACE","[sidebar] destroying old tabulatorInstance"),Re.destroy(),Re=null),Ot("TRACE","[sidebar] instantiating Tabulator"),Re=new Ie(s,{data:i(),layout:"fitColumns",columns:n,height:"100%",selectable:!0,rowFormatter:function(t){Ot("TRACE","[sidebar] Tabulator rowFormatter entry",{rowData:t.getData()}),t.getData().selected?t.getElement().style.background="#d0e7ff":t.getElement().style.background="",Ot("TRACE","[sidebar] Tabulator rowFormatter exit")},rowClick:function(t,e){Ot("TRACE","[sidebar] Tabulator rowClick entry",{idx:e.getData().idx-1}),Nt([e.getData()._shape]),Ot("INFO","[sidebar] Shape row clicked",{idx:e.getData().idx-1}),Re.replaceData(i()),Ot("TRACE","[sidebar] Tabulator rowClick exit")},cellEdited:function(t){Ot("TRACE","[sidebar] Tabulator cellEdited entry",{cell:t});const e=t.getField(),i=t.getData()._shape;"label"===e&&i&&(i._label=t.getValue(),Ot("DEBUG","[sidebar] Label edited",{newLabel:t.getValue(),shapeType:i._type,shapeId:i._id})),Ot("TRACE","[sidebar] Tabulator cellEdited exit")}}),!t._appStateUnsub){Ot("TRACE","[sidebar] registering AppState update subscriber");const o=()=>{Ot("TRACE","[sidebar] AppState update triggered"),Re&&Re.replaceData(i())};Bt._subscribers=Bt._subscribers||[],Bt._subscribers.push(o),t._appStateUnsub=o,e&&"function"==typeof e.on&&e.on("destroy",()=>{Ot("TRACE","[sidebar] panel destroy event");const t=Bt._subscribers.indexOf(o);-1!==t&&Bt._subscribers.splice(t,1)})}Ot("INFO","[sidebar] Sidebar panel fully initialized (Tabulator)")}catch(r){throw Ot("ERROR","[sidebar] buildSidebarPanel ERROR",r),alert("SidebarPanel ERROR: "+r.message),Ot("TRACE","[sidebar] buildSidebarPanel exit (error)"),r}Ot("TRACE","[sidebar] buildSidebarPanel exit",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName})}(t.element,t),Ot("TRACE","[layout] SidebarPanel factory exit")}),n.registerComponent("CanvasPanel",t=>{Ot("TRACE","[layout] CanvasPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] CanvasPanel factory called",{title:t?.title,componentName:t?.componentName}),function(t,e){Ot("TRACE","[canvas] buildCanvasPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{Ot("INFO","[canvas] buildCanvasPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),t.innerHTML='\n      <div id="canvas-panel-container" style="width:100%;height:100%;position:relative;">\n        <div id="canvas-toolbar-main" style="display:flex;flex-wrap:wrap;align-items:center;padding:6px 8px 4px 8px;background:#f7f7fa;border-bottom:1px solid #bbb;">\n          <input type="file" id="canvas-image-upload" accept="image/*" style="display:inline-block;">\n          <select id="canvas-server-image-select" style="margin-left:6px;">\n            <option value="">[Server image]</option>\n            <option value="sample1.png">sample1.png</option>\n            <option value="sample2.png">sample2.png</option>\n          </select>\n          <span style="margin-left:12px;">Shape:</span>\n          <select id="shape-type-select" style="margin-left:4px;">\n            <option value="point">Point</option>\n            <option value="rect">Rectangle</option>\n            <option value="circle">Circle</option>\n          </select>\n          <button id="add-shape-btn" style="margin-left:4px;">Add</button>\n          <button id="delete-shape-btn" style="margin-left:12px;">Delete</button>\n          <button id="duplicate-shape-btn" style="margin-left:4px;">Duplicate</button>\n          <button id="align-left-btn" style="margin-left:12px;">Align Left</button>\n          <button id="align-center-btn">Align Center</button>\n          <button id="align-right-btn">Align Right</button>\n          <button id="align-top-btn" style="margin-left:4px;">Align Top</button>\n          <button id="align-middle-btn">Align Middle</button>\n          <button id="align-bottom-btn">Align Bottom</button>\n          <button id="select-all-btn" style="margin-left:12px;">Select All</button>\n          <button id="lock-btn" style="margin-left:14px;">Lock</button>\n          <button id="unlock-btn" style="margin-left:4px;">Unlock</button>\n        </div>\n        <div id="konva-stage-div" style="width:100%;height:calc(100% - 44px);background:#eee;"></div>\n      </div>\n    ';const i=t.querySelector("#canvas-image-upload"),n=t.querySelector("#canvas-server-image-select");Ot("TRACE","[canvas] image upload DOM nodes",{imageUploadType:typeof i,serverImageSelectType:typeof n}),i?i.addEventListener("change",function(t){Ot("TRACE","[canvas] imageUpload changed",t);const e=t.target.files&&t.target.files[0];if(!e)return;const i=new FileReader;i.onload=function(t){Ot("TRACE","[canvas] FileReader onload",{resultLen:t.target.result.length}),Vt(t.target.result,null),n&&(n.value="")},i.readAsDataURL(e)}):Ot("ERROR","[canvas] imageUpload element not found in DOM"),n?n.addEventListener("change",function(t){Ot("TRACE","[canvas] serverImageSelect changed",t);const e=t.target.value;e?(Vt("./images/"+e,null),i&&(i.value="")):Vt(null,null)}):Ot("ERROR","[canvas] serverImageSelect element not found in DOM"),Ot("INFO","[canvas] Canvas panel fully initialized")}catch(t){throw Ot("ERROR","[canvas] buildCanvasPanel ERROR",t),alert("CanvasPanel ERROR: "+t.message),Ot("TRACE","[canvas] buildCanvasPanel exit (error)"),t}Ot("TRACE","[canvas] buildCanvasPanel exit",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName})}(t.element,t),Ot("TRACE","[layout] CanvasPanel factory exit")}),n.registerComponent("SettingsPanel",t=>{Ot("TRACE","[layout] SettingsPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] SettingsPanel factory called",{title:t?.title,componentName:t?.componentName}),t.on("open",()=>{Ot("TRACE","[layout] SettingsPanel container 'open' event"),function(t,e){Ot("TRACE","[settings] buildSettingsPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{if(Ot("INFO","[settings] buildSettingsPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),!t)return Ot("ERROR","[settings] buildSettingsPanel: rootElement is null or undefined"),void alert("Settings panel root element not found! (No content will be shown)");if(null===t.offsetParent&&Ot("ERROR","[settings] buildSettingsPanel: rootElement is not visible (may be hidden)"),Ot("DEBUG","[settings] Tweakpane import check",{PaneType:typeof bc,Pane:bc}),Ot("DEBUG","[settings] Pickr import check",{PickrType:typeof Js,Pickr:Js}),Ot("DEBUG","[settings] settingsRegistry length",{len:wc.length}),"function"!=typeof bc)return t.innerHTML="<div style=\"color:red;padding:2em;\">Settings panel failed: Tweakpane (Pane) not loaded as ES module.<br>\n      Check your webpack and npm dependencies: tweakpane@4.x must be imported as <code>import { Pane } from 'tweakpane'</code>.</div>",void Ot("ERROR","[settings] Pane (Tweakpane) is not a constructor/function! Check import.");yc().then(()=>{Ot("TRACE","[settings] buildSettingsPanel after loadSettings (resolved)",{AppStateSettings:Bt.settings});const e={};for(const t of wc)t.key in Bt.settings||(Bt.settings[t.key]=t.default),e[t.key]=Bt.settings[t.key];Ot("DEBUG","[settings] settingsPOJO plain object check",{proto:Object.getPrototypeOf(e),isPlain:Object.getPrototypeOf(e)===Object.prototype}),t.innerHTML='\n          <div id="settings-panel-container" style="width:100%;height:100%;background:#e7f8eb;display:flex;flex-direction:column;overflow:auto;">\n            <div style="padding:10px 8px 4px 8px;font-weight:bold;font-size:1.2em;color:#0a6e2c;">\n              Settings\n              <button id="settings-save-btn" style="float:right;font-size:0.9em;">Save</button>\n            </div>\n            <div id="tweakpane-fields-div" style="flex:1 1 0;overflow:auto;padding:0 8px 8px 8px;"></div>\n          </div>\n        ';const i=t.querySelector("#tweakpane-fields-div"),n=t.querySelector("#settings-save-btn");if(!i)return Ot("ERROR","[settings] tweakpane-fields-div not found in DOM"),t.innerHTML='<div style="color:red;padding:2em;">Settings panel failed to render (missing tweakpane-fields-div)</div>',void Ot("TRACE","[settings] buildSettingsPanel exit (missing fieldsDiv)");let s;try{s=new bc({container:i,title:"Settings",expanded:!0})}catch(t){return Ot("ERROR","[settings] Tweakpane instantiation failed",t),i.innerHTML=`<div style="color:red;padding:2em;">Settings panel failed: Tweakpane error (${t.message})</div>`,void Ot("TRACE","[settings] buildSettingsPanel exit (Tweakpane failed)")}const o={};wc.forEach(t=>{const n=t.key;try{if(Ot("DEBUG","[settings] addInput plainness",{key:n,value:e[n],hasKey:Object.prototype.hasOwnProperty.call(e,n),isPlain:Object.getPrototypeOf(e)===Object.prototype}),"boolean"===t.type)s.addInput(e,n,{label:t.label}).on("change",t=>{e[n]=t.value,Ec(n,t.value)});else if("number"===t.type)s.addInput(e,n,{label:t.label,min:t.min,max:t.max,step:t.step}).on("change",t=>{e[n]=t.value,Ec(n,t.value)});else if("pickr"===t.type){const s=document.createElement("div");s.id="pickr-"+n,s.style.display="inline-block",s.style.verticalAlign="middle",s.style.marginLeft="1em";const r=document.createElement("label");r.textContent=t.label,r.style.marginRight="0.7em";const a=document.createElement("div");a.style.margin="0.4em 0",a.appendChild(r),a.appendChild(s),i.appendChild(a),setTimeout(()=>{o[n]&&(o[n].destroyAndRemove(),delete o[n]),o[n]=Js.create({el:"#"+s.id,theme:"monolith",default:e[n],components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,input:!0}}}),o[n].on("change",t=>{const i=t.toHEXA().toString();e[n]=i,Ec(n,i)}),o[n].setColor(e[n])},1)}else"select"===t.type?s.addInput(e,n,{label:t.label,options:t.options.reduce((t,e)=>(t[e.value]=e.label,t),{})}).on("change",t=>{e[n]=t.value,Ec(n,t.value)}):"text"===t.type&&s.addInput(e,n,{label:t.label}).on("change",t=>{e[n]=t.value,Ec(n,t.value)})}catch(e){Ot("ERROR","[settings] Error rendering registry field",{key:n,reg:t,error:e})}}),n?n.onclick=async()=>{await Cc(),Ot("INFO","[settings] Settings saved by user"),alert("Settings saved!")}:Ot("WARN","[settings] Save button not found"),Ot("INFO","[settings] Settings panel rendered (Tweakpane)"),Ot("TRACE","[settings] buildSettingsPanel exit (rendered)")}).catch(e=>{Ot("ERROR","[settings] Error in loadSettings().then for buildSettingsPanel",e),t.innerHTML=`<div style="color:red;padding:2em;">Settings failed to load: ${e.message}</div>`,Ot("TRACE","[settings] buildSettingsPanel exit (loadSettings error)")})}catch(t){throw Ot("ERROR","[settings] buildSettingsPanel ERROR",t),alert("SettingsPanel ERROR: "+t.message),Ot("TRACE","[settings] buildSettingsPanel exit (error)"),t}}(t.element,t)}),Ot("TRACE","[layout] SettingsPanel factory exit")}),n.registerComponent("ErrorLogPanel",t=>{var e;Ot("TRACE","[layout] ErrorLogPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] ErrorLogPanel factory called",{title:t?.title,componentName:t?.componentName}),e=t.element,Ic=e,e.innerHTML='<div style="color:#888;font-family:monospace;">Error Log initializing...</div>',Rc(),Ot("TRACE","[layout] ErrorLogPanel factory exit")}),("function"==typeof(s=Mc)||s&&"function"==typeof s.sinkLog)&&kt.push(s),Ot("DEBUG","[layout] All panel factories registered, log sink registered")}catch(t){throw Ot("ERROR","[layout] ERROR in registerComponent:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (registerComponent error)"),t}var s;try{Ot("INFO","[layout] Calling layout.init..."),n.init(),Ot("INFO","[layout] layout.init called, done.")}catch(t){throw Ot("ERROR","[layout] ERROR during layout.init:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (layout.init error)"),t}Ot("TRACE","[layout] DOMContentLoaded handler exit")})})()})();
====== node and npm versions ======
v22.19.0
10.9.3
