ype._centroid=!0,cs.prototype._attrsAffectingSize=["innerRadius","outerRadius"],De(cs),gi.addGetterSetter(cs,"innerRadius",0,ai()),gi.addGetterSetter(cs,"outerRadius",0,ai());class us extends Cn{constructor(t){super(t),this._updated=!0,this.anim=new Rn(()=>{const t=this._updated;return this._updated=!1,t}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(t){const e=this.animation(),i=this.frameIndex(),n=4*i,s=this.animations()[e],o=this.frameOffsets(),r=s[n+0],a=s[n+1],l=s[n+2],h=s[n+3],d=this.image();if((this.hasFill()||this.hasStroke())&&(t.beginPath(),t.rect(0,0,l,h),t.closePath(),t.fillStrokeShape(this)),d)if(o){const n=o[e],s=2*i;t.drawImage(d,r,a,l,h,n[s+0],n[s+1],l,h)}else t.drawImage(d,r,a,l,h,0,0,l,h)}_hitFunc(t){const e=this.animation(),i=this.frameIndex(),n=4*i,s=this.animations()[e],o=this.frameOffsets(),r=s[n+2],a=s[n+3];if(t.beginPath(),o){const n=o[e],s=2*i;t.rect(n[s+0],n[s+1],r,a)}else t.rect(0,0,r,a);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){const t=this;this.interval=setInterval(function(){t._updateIndex()},1e3/this.frameRate())}start(){if(this.isRunning())return;const t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){const t=this.frameIndex(),e=this.animation();t<this.animations()[e].length/4-1?this.frameIndex(t+1):this.frameIndex(0)}}us.prototype.className="Sprite",De(us),gi.addGetterSetter(us,"animation"),gi.addGetterSetter(us,"animations"),gi.addGetterSetter(us,"frameOffsets"),gi.addGetterSetter(us,"image"),gi.addGetterSetter(us,"frameIndex",0,ai()),gi.addGetterSetter(us,"frameRate",17,ai()),gi.backCompat(us,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"});class ps extends Cn{_sceneFunc(t){const e=this.innerRadius(),i=this.outerRadius(),n=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(let s=1;s<2*n;s++){const o=s%2==0?i:e,r=o*Math.sin(s*Math.PI/n),a=-1*o*Math.cos(s*Math.PI/n);t.lineTo(r,a)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.outerRadius()}getHeight(){return 2*this.outerRadius()}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}function ms(t){return[...t].reduce((t,e,i,n)=>{if(/\p{Emoji}/u.test(e)){const s=n[i+1];s&&/\p{Emoji_Modifier}|\u200D/u.test(s)?(t.push(e+s),n[i+1]=""):t.push(e)}else/\p{Regional_Indicator}{2}/u.test(e+(n[i+1]||""))?t.push(e+n[i+1]):i>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(e)?t[t.length-1]+=e:e&&t.push(e);return t},[])}ps.prototype.className="Star",ps.prototype._centroid=!0,ps.prototype._attrsAffectingSize=["innerRadius","outerRadius"],De(ps),gi.addGetterSetter(ps,"numPoints",5,ai()),gi.addGetterSetter(ps,"innerRadius",0,ai()),gi.addGetterSetter(ps,"outerRadius",0,ai());const gs="auto",fs="inherit",vs="justify",bs="left",_s="middle",ws="normal",ys=" ",Cs="none",xs=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],Es=xs.length;let Ss;function Ps(){return Ss||(Ss=je.createCanvasElement().getContext("2d"),Ss)}class ks extends Cn{constructor(t){super(function(t){return(t=t||{}).fillLinearGradientColorStops||t.fillRadialGradientColorStops||t.fillPatternImage||(t.fill=t.fill||"black"),t}(t)),this._partialTextX=0,this._partialTextY=0;for(let t=0;t<Es;t++)this.on(xs[t]+"Change.konva",this._setTextData);this._setTextData()}_sceneFunc(t){var e,i;const n=this.textArr,s=n.length;if(!this.text())return;let o,r=this.padding(),a=this.fontSize(),l=this.lineHeight()*a,h=this.verticalAlign(),d=this.direction(),c=0,u=this.align(),p=this.getWidth(),m=this.letterSpacing(),g=this.charRenderFunc(),f=this.fill(),v=this.textDecoration(),b=-1!==v.indexOf("underline"),_=-1!==v.indexOf("line-through");d=d===fs?t.direction:d;let w=l/2,y=_s;if(!Ae.legacyTextRendering){const t=this.measureSize("M");y="alphabetic",w=((null!==(e=t.fontBoundingBoxAscent)&&void 0!==e?e:t.actualBoundingBoxAscent)-(null!==(i=t.fontBoundingBoxDescent)&&void 0!==i?i:t.actualBoundingBoxDescent))/2+l/2}for("rtl"===d&&t.setAttr("direction",d),t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",y),t.setAttr("textAlign",bs),h===_s?c=(this.getHeight()-s*l-2*r)/2:"bottom"===h&&(c=this.getHeight()-s*l-2*r),t.translate(r,c+r),o=0;o<s;o++){let e=0,i=0;const h=n[o],c=h.text,v=h.width,y=h.lastInParagraph;if(t.save(),"right"===u?e+=p-v-2*r:"center"===u&&(e+=(p-v-2*r)/2),b){t.save(),t.beginPath();const n=e,s=w+i+(Ae.legacyTextRendering?Math.round(a/2):Math.round(a/4));t.moveTo(n,s);const o=u!==vs||y?v:p-2*r;t.lineTo(n+Math.round(o),s),t.lineWidth=a/15;const l=this._getLinearGradient();t.strokeStyle=l||f,t.stroke(),t.restore()}if("rtl"===d||0===m&&u!==vs&&!g)0!==m&&t.setAttr("letterSpacing",`${m}px`),this._partialTextX=e,this._partialTextY=w+i,this._partialText=c,t.fillStrokeShape(this);else{const s=c.split(" ").length-1,a=ms(c);for(let l=0;l<a.length;l++){const h=a[l];" "!==h||y||u!==vs||(e+=(p-2*r-v)/s),this._partialTextX=e,this._partialTextY=w+i,this._partialText=h,g&&(t.save(),g({char:h,index:l+n.slice(0,o).reduce((t,e)=>t+ms(e.text).length,0),x:e,y:w+i,lineIndex:o,column:l,isLastInLine:y,width:this.measureSize(h).width,context:t})),t.fillStrokeShape(this),g&&t.restore(),e+=this.measureSize(h).width+m}}if(_){t.save(),t.beginPath();const n=Ae.legacyTextRendering?0:-Math.round(a/4),s=u===vs?0:e;t.moveTo(s,w+i+n);const o=u!==vs||y?v:p-2*r;t.lineTo(s+Math.round(o),w+i+n),t.lineWidth=a/15;const l=this._getLinearGradient();t.strokeStyle=l||f,t.stroke(),t.restore()}t.restore(),s>1&&(w+=l)}}_hitFunc(t){const e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){const e=je._isString(t)?t:null==t?"":t+"";return this._setAttr("text",e),this}getWidth(){return this.attrs.width===gs||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width}getHeight(){return this.attrs.height===gs||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return je.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,i,n,s,o,r,a,l,h,d,c;let u,p=Ps(),m=this.fontSize();p.save(),p.font=this._getContextFont(),u=p.measureText(t),p.restore();const g=m/100;return{actualBoundingBoxAscent:null!==(e=u.actualBoundingBoxAscent)&&void 0!==e?e:71.58203125*g,actualBoundingBoxDescent:null!==(i=u.actualBoundingBoxDescent)&&void 0!==i?i:0,actualBoundingBoxLeft:null!==(n=u.actualBoundingBoxLeft)&&void 0!==n?n:-7.421875*g,actualBoundingBoxRight:null!==(s=u.actualBoundingBoxRight)&&void 0!==s?s:75.732421875*g,alphabeticBaseline:null!==(o=u.alphabeticBaseline)&&void 0!==o?o:0,emHeightAscent:null!==(r=u.emHeightAscent)&&void 0!==r?r:100*g,emHeightDescent:null!==(a=u.emHeightDescent)&&void 0!==a?a:-20*g,fontBoundingBoxAscent:null!==(l=u.fontBoundingBoxAscent)&&void 0!==l?l:91*g,fontBoundingBoxDescent:null!==(h=u.fontBoundingBoxDescent)&&void 0!==h?h:21*g,hangingBaseline:null!==(d=u.hangingBaseline)&&void 0!==d?d:72.80000305175781*g,ideographicBaseline:null!==(c=u.ideographicBaseline)&&void 0!==c?c:-21*g,width:u.width,height:m}}_getContextFont(){return this.fontStyle()+ys+this.fontVariant()+ys+(this.fontSize()+"px ")+this.fontFamily().split(",").map(t=>{const e=(t=t.trim()).indexOf(" ")>=0,i=t.indexOf('"')>=0||t.indexOf("'")>=0;return e&&!i&&(t=`"${t}"`),t}).join(", ")}_addTextLine(t){this.align()===vs&&(t=t.trim());const e=this._getTextWidth(t);return this.textArr.push({text:t,width:e,lastInParagraph:!1})}_getTextWidth(t){const e=this.letterSpacing(),i=t.length;return Ps().measureText(t).width+e*i}_setTextData(){let t=this.text().split("\n"),e=+this.fontSize(),i=0,n=this.lineHeight()*e,s=this.attrs.width,o=this.attrs.height,r=s!==gs&&void 0!==s,a=o!==gs&&void 0!==o,l=this.padding(),h=s-2*l,d=o-2*l,c=0,u=this.wrap(),p="char"!==u&&u!==Cs,m=this.ellipsis();this.textArr=[],Ps().font=this._getContextFont();const g=m?this._getTextWidth("…"):0;for(let e=0,s=t.length;e<s;++e){let o=t[e],l=this._getTextWidth(o);if(r&&l>h)for(;o.length>0;){let t=0,e=ms(o).length,s="",r=0;for(;t<e;){const i=t+e>>>1,l=ms(o).slice(0,i+1).join(""),u=this._getTextWidth(l);(m&&a&&c+n>d?u+g:u)<=h?(t=i+1,s=l,r=u):e=i}if(!s)break;if(p){const e=ms(o),i=ms(s),n=e[i.length];let a;if((n===ys||"-"===n)&&r<=h)a=i.length;else{const t=i.lastIndexOf(ys),e=i.lastIndexOf("-");a=Math.max(t,e)+1}a>0&&(t=a,s=e.slice(0,t).join(""),r=this._getTextWidth(s))}if(s=s.trimRight(),this._addTextLine(s),i=Math.max(i,r),c+=n,this._shouldHandleEllipsis(c)){this._tryToAddEllipsisToLastLine();break}if(o=ms(o).slice(t).join("").trimLeft(),o.length>0&&(l=this._getTextWidth(o),l<=h)){this._addTextLine(o),c+=n,i=Math.max(i,l);break}}else this._addTextLine(o),c+=n,i=Math.max(i,l),this._shouldHandleEllipsis(c)&&e<s-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),a&&c+n>d)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){const e=+this.fontSize(),i=this.lineHeight()*e,n=this.attrs.height,s=n!==gs&&void 0!==n,o=n-2*this.padding();return!(this.wrap()!==Cs)||s&&t+i>o}_tryToAddEllipsisToLastLine(){const t=this.attrs.width,e=t!==gs&&void 0!==t,i=t-2*this.padding(),n=this.ellipsis(),s=this.textArr[this.textArr.length-1];s&&n&&(e&&(this._getTextWidth(s.text+"…")<i||(s.text=s.text.slice(0,s.text.length-3))),this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+"…"))}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const t=-1!==this.textDecoration().indexOf("underline")||-1!==this.textDecoration().indexOf("line-through"),e=this.hasShadow();return!(!t||!e)||super._useBufferCanvas()}}ks.prototype._fillFunc=function(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)},ks.prototype._strokeFunc=function(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)},ks.prototype.className="Text",ks.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],De(ks),gi.overWriteSetter(ks,"width",hi()),gi.overWriteSetter(ks,"height",hi()),gi.addGetterSetter(ks,"direction",fs),gi.addGetterSetter(ks,"fontFamily","Arial"),gi.addGetterSetter(ks,"fontSize",12,ai()),gi.addGetterSetter(ks,"fontStyle",ws),gi.addGetterSetter(ks,"fontVariant",ws),gi.addGetterSetter(ks,"padding",0,ai()),gi.addGetterSetter(ks,"align",bs),gi.addGetterSetter(ks,"verticalAlign","top"),gi.addGetterSetter(ks,"lineHeight",1,ai()),gi.addGetterSetter(ks,"wrap","word"),gi.addGetterSetter(ks,"ellipsis",!1,ui()),gi.addGetterSetter(ks,"letterSpacing",0,ai()),gi.addGetterSetter(ks,"text","",di()),gi.addGetterSetter(ks,"textDecoration",""),gi.addGetterSetter(ks,"charRenderFunc",void 0);const Is="normal";function Rs(t){t.fillText(this.partialText,0,0)}function Ms(t){t.strokeText(this.partialText,0,0)}class Ls extends Cn{constructor(t){super(t),this.dummyCanvas=je.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return Xn.getPathLength(this.dataArray)}_getPointAtLength(t){return this.attrs.data?t>this.pathLength?null:Xn.getPointAtLengthOfDataArray(t,this.dataArray):null}_readDataAttribute(){this.dataArray=Xn.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();const e=this.textDecoration(),i=this.fill(),n=this.fontSize(),s=this.glyphInfo;"underline"===e&&t.beginPath();for(let i=0;i<s.length;i++){t.save();const o=s[i].p0;t.translate(o.x,o.y),t.rotate(s[i].rotation),this.partialText=s[i].text,t.fillStrokeShape(this),"underline"===e&&(0===i&&t.moveTo(0,n/2+1),t.lineTo(n,n/2+1)),t.restore()}"underline"===e&&(t.strokeStyle=i,t.lineWidth=n/20,t.stroke()),t.restore()}_hitFunc(t){t.beginPath();const e=this.glyphInfo;if(e.length>=1){const i=e[0].p0;t.moveTo(i.x,i.y)}for(let i=0;i<e.length;i++){const n=e[i].p1;t.lineTo(n.x,n.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return je.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return ks.prototype.setText.call(this,t)}_getContextFont(){return ks.prototype._getContextFont.call(this)}_getTextSize(t){const e=this.dummyCanvas.getContext("2d");e.save(),e.font=this._getContextFont();const i=e.measureText(t);return e.restore(),{width:i.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const t=ms(this.text()),e=[];let i=0;for(let n=0;n<t.length;n++)e.push({char:t[n],width:this._getTextSize(t[n]).width}),i+=e[n].width;const{height:n}=this._getTextSize(this.attrs.text);if(this.textWidth=i,this.textHeight=n,this.glyphInfo=[],!this.attrs.data)return null;const s=this.letterSpacing(),o=this.align(),r=this.kerningFunc(),a=Math.max(this.textWidth+((this.attrs.text||"").length-1)*s,0);let l=0;"center"===o&&(l=Math.max(0,this.pathLength/2-a/2)),"right"===o&&(l=Math.max(0,this.pathLength-a));let h=l;for(let i=0;i<e.length;i++){const n=this._getPointAtLength(h);if(!n)return;const l=e[i].char;let d=e[i].width+s;if(" "===l&&"justify"===o){const t=this.text().split(" ").length-1;d+=(this.pathLength-a)/t}const c=this._getPointAtLength(h+d);if(!c)return;const u=Xn.getLineLength(n.x,n.y,c.x,c.y);let p=0;if(r)try{p=r(e[i-1].char,l)*this.fontSize()}catch(t){p=0}n.x+=p,c.x+=p,this.textWidth+=p;const m=Xn.getPointOnLine(p+u/2,n.x,n.y,c.x,c.y),g=Math.atan2(c.y-n.y,c.x-n.x);this.glyphInfo.push({transposeX:m.x,transposeY:m.y,text:t[i],rotation:g,p0:n,p1:c}),h+=d}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};const t=[];this.glyphInfo.forEach(function(e){t.push(e.p0.x),t.push(e.p0.y),t.push(e.p1.x),t.push(e.p1.y)});let e,i,n=t[0]||0,s=t[0]||0,o=t[1]||0,r=t[1]||0;for(let a=0;a<t.length/2;a++)e=t[2*a],i=t[2*a+1],n=Math.min(n,e),s=Math.max(s,e),o=Math.min(o,i),r=Math.max(r,i);const a=this.fontSize();return{x:n-a/2,y:o-a/2,width:s-n+a,height:r-o+a}}destroy(){return je.releaseCanvas(this.dummyCanvas),super.destroy()}}Ls.prototype._fillFunc=Rs,Ls.prototype._strokeFunc=Ms,Ls.prototype._fillFuncHit=Rs,Ls.prototype._strokeFuncHit=Ms,Ls.prototype.className="TextPath",Ls.prototype._attrsAffectingSize=["text","fontSize","data"],De(Ls),gi.addGetterSetter(Ls,"data"),gi.addGetterSetter(Ls,"fontFamily","Arial"),gi.addGetterSetter(Ls,"fontSize",12,ai()),gi.addGetterSetter(Ls,"fontStyle",Is),gi.addGetterSetter(Ls,"align","left"),gi.addGetterSetter(Ls,"letterSpacing",0,ai()),gi.addGetterSetter(Ls,"textBaseline","middle"),gi.addGetterSetter(Ls,"fontVariant",Is),gi.addGetterSetter(Ls,"text",""),gi.addGetterSetter(Ls,"textDecoration",""),gi.addGetterSetter(Ls,"kerningFunc",void 0);const Ts="tr-konva",As=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(t=>t+`.${Ts}`).join(" "),Ds="nodesRect",zs=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange","draggableChange"],Os={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},Bs="ontouchstart"in Ae._global,Hs=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function Ns(t,e,i){const n=i.x+(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e),s=i.y+(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:n,y:s}}let Vs=0;class Fs extends kn{constructor(t){super(t),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(As,this.update),this.getNode()&&this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return je.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Ts+this._id}setNodes(t=[]){this._nodes&&this._nodes.length&&this.detach();const e=t.filter(t=>!t.isAncestorOf(this)||(je.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1));return this._nodes=t=e,1===t.length&&this.useSingleNodeRotation()?this.rotation(t[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(t=>{const e=()=>{1===this.nodes().length&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),this._transforming||this.isDragging()||this.update()};if(t._attrsAffectingSize.length){const i=t._attrsAffectingSize.map(t=>t+"Change."+this._getEventNamespace()).join(" ");t.on(i,e)}t.on(zs.map(t=>t+`.${this._getEventNamespace()}`).join(" "),e),t.on(`absoluteTransformChange.${this._getEventNamespace()}`,e),this._proxyDrag(t)}),this._resetTransformCache(),!!this.findOne(".top-left")&&this.update(),this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,i=>{e=t.getAbsolutePosition(),this.isDragging()||t===this.findOne(".back")||this.startDrag(i,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,i=>{if(!e)return;const n=t.getAbsolutePosition(),s=n.x-e.x,o=n.y-e.y;this.nodes().forEach(e=>{if(e===t)return;if(e.isDragging())return;const n=e.getAbsolutePosition();e.setAbsolutePosition({x:n.x+s,y:n.y+o}),e.startDrag(i)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(t=>{t.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Ds),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Ds,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),i){const n=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),s=t.getAbsoluteScale(i),o=t.getAbsolutePosition(i),r=n.x*s.x-t.offsetX()*s.x,a=n.y*s.y-t.offsetY()*s.y,l=(Ae.getAngle(t.getAbsoluteRotation())+2*Math.PI)%(2*Math.PI);return Ns({x:o.x+r*Math.cos(l)+a*Math.sin(-l),y:o.y+a*Math.cos(l)+r*Math.sin(l),width:n.width*s.x,height:n.height*s.y,rotation:l},-Ae.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const t=[];this.nodes().map(e=>{const i=e.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}],s=e.getAbsoluteTransform();n.forEach(function(e){const i=s.point(e);t.push(i)})});const e=new Oe;e.rotate(-Ae.getAngle(this.rotation()));let i=1/0,n=1/0,s=-1/0,o=-1/0;t.forEach(function(t){const r=e.point(t);void 0===i&&(i=s=r.x,n=o=r.y),i=Math.min(i,r.x),n=Math.min(n,r.y),s=Math.max(s,r.x),o=Math.max(o,r.y)}),e.invert();const r=e.point({x:i,y:n});return{x:r.x,y:r.y,width:s-i,height:o-n,rotation:Ae.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Hs.forEach(t=>{this._createAnchor(t)}),this._createAnchor("rotater")}_createAnchor(t){const e=new ls({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:Bs?10:"auto"}),i=this;e.on("mousedown touchstart",function(t){i._handleMouseDown(t)}),e.on("dragstart",t=>{e.stopDrag(),t.cancelBubble=!0}),e.on("dragend",t=>{t.cancelBubble=!0}),e.on("mouseenter",()=>{const i=Ae.getAngle(this.rotation()),n=this.rotateAnchorCursor(),s=function(t,e,i){if("rotater"===t)return i;e+=je.degToRad(Os[t]||0);const n=(je.radToDeg(e)%360+360)%360;return je._inRange(n,337.5,360)||je._inRange(n,0,22.5)?"ns-resize":je._inRange(n,22.5,67.5)?"nesw-resize":je._inRange(n,67.5,112.5)?"ew-resize":je._inRange(n,112.5,157.5)?"nwse-resize":je._inRange(n,157.5,202.5)?"ns-resize":je._inRange(n,202.5,247.5)?"nesw-resize":je._inRange(n,247.5,292.5)?"ew-resize":je._inRange(n,292.5,337.5)?"nwse-resize":(je.error("Transformer has unknown angle for cursor detection: "+n),"pointer")}(t,i,n);e.getStage().content&&(e.getStage().content.style.cursor=s),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){const t=new Cn({name:"back",width:0,height:0,sceneFunc(t,e){const i=e.getParent(),n=i.padding();t.beginPath(),t.rect(-n,-n,e.width()+2*n,e.height()+2*n),t.moveTo(e.width()/2,-n),i.rotateEnabled()&&i.rotateLineVisible()&&t.lineTo(e.width()/2,-i.rotateAnchorOffset()*je._sign(e.height())-n),t.fillStrokeShape(e)},hitFunc:(t,e)=>{if(!this.shouldOverdrawWholeArea())return;const i=this.padding();t.beginPath(),t.rect(-i,-i,e.width()+2*i,e.height()+2*i),t.fillStrokeShape(e)}});this.add(t),this._proxyDrag(t),t.on("dragstart",t=>{t.cancelBubble=!0}),t.on("dragmove",t=>{t.cancelBubble=!0}),t.on("dragend",t=>{t.cancelBubble=!0}),this.on("dragmove",t=>{this.update()})}_handleMouseDown(t){if(this._transforming)return;this._movingAnchorName=t.target.name().split(" ")[0];const e=this._getNodeRect(),i=e.width,n=e.height,s=Math.sqrt(Math.pow(i,2)+Math.pow(n,2));this.sin=Math.abs(n/s),this.cos=Math.abs(i/s),"undefined"!=typeof window&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;const o=t.target.getAbsolutePosition(),r=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:r.x-o.x,y:r.y-o.y},Vs++,this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach(e=>{e._fire("transformstart",{evt:t.evt,target:e})})}_handleMouseMove(t){let e,i,n;const s=this.findOne("."+this._movingAnchorName),o=s.getStage();o.setPointersPositions(t);const r=o.getPointerPosition();let a={x:r.x-this._anchorDragOffset.x,y:r.y-this._anchorDragOffset.y};const l=s.getAbsolutePosition();this.anchorDragBoundFunc()&&(a=this.anchorDragBoundFunc()(l,a,t)),s.setAbsolutePosition(a);const h=s.getAbsolutePosition();if(l.x===h.x&&l.y===h.y)return;if("rotater"===this._movingAnchorName){const n=this._getNodeRect();e=s.x()-n.width/2,i=-s.y()+n.height/2;let o=Math.atan2(-i,e)+Math.PI/2;n.height<0&&(o-=Math.PI);const r=Ae.getAngle(this.rotation())+o,a=Ae.getAngle(this.rotationSnapTolerance()),l=function(t,e,i){let n=e;for(let s=0;s<t.length;s++){const o=Ae.getAngle(t[s]),r=Math.abs(o-e)%(2*Math.PI);Math.min(r,2*Math.PI-r)<i&&(n=o)}return n}(this.rotationSnaps(),r,a),h=function(t,e){const i=function(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}(t);return Ns(t,e,i)}(n,l-n.rotation);return void this._fitNodesInto(h,t)}const d=this.shiftBehavior();let c;c="inverted"===d?this.keepRatio()&&!t.shiftKey:"none"===d?this.keepRatio():this.keepRatio()||t.shiftKey;let u=this.centeredScaling()||t.altKey;if("top-left"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};n=Math.sqrt(Math.pow(t.x-s.x(),2)+Math.pow(t.y-s.y(),2));const o=this.findOne(".top-left").x()>t.x?-1:1,r=this.findOne(".top-left").y()>t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".top-left").x(t.x-e),this.findOne(".top-left").y(t.y-i)}}else if("top-center"===this._movingAnchorName)this.findOne(".top-left").y(s.y());else if("top-right"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};n=Math.sqrt(Math.pow(s.x()-t.x,2)+Math.pow(t.y-s.y(),2));const o=this.findOne(".top-right").x()<t.x?-1:1,r=this.findOne(".top-right").y()>t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".top-right").x(t.x+e),this.findOne(".top-right").y(t.y-i)}var p=s.position();this.findOne(".top-left").y(p.y),this.findOne(".bottom-right").x(p.x)}else if("middle-left"===this._movingAnchorName)this.findOne(".top-left").x(s.x());else if("middle-right"===this._movingAnchorName)this.findOne(".bottom-right").x(s.x());else if("bottom-left"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};n=Math.sqrt(Math.pow(t.x-s.x(),2)+Math.pow(s.y()-t.y,2));const o=t.x<s.x()?-1:1,r=s.y()<t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,s.x(t.x-e),s.y(t.y+i)}p=s.position(),this.findOne(".top-left").x(p.x),this.findOne(".bottom-right").y(p.y)}else if("bottom-center"===this._movingAnchorName)this.findOne(".bottom-right").y(s.y());else if("bottom-right"===this._movingAnchorName){if(c){const t=u?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};n=Math.sqrt(Math.pow(s.x()-t.x,2)+Math.pow(s.y()-t.y,2));const o=this.findOne(".bottom-right").x()<t.x?-1:1,r=this.findOne(".bottom-right").y()<t.y?-1:1;e=n*this.cos*o,i=n*this.sin*r,this.findOne(".bottom-right").x(t.x+e),this.findOne(".bottom-right").y(t.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));if(u=this.centeredScaling()||t.altKey,u){const t=this.findOne(".top-left"),e=this.findOne(".bottom-right"),i=t.x(),n=t.y(),s=this.getWidth()-e.x(),o=this.getHeight()-e.y();e.move({x:-i,y:-n}),t.move({x:s,y:o})}const m=this.findOne(".top-left").getAbsolutePosition();e=m.x,i=m.y;const g=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),f=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:g,height:f,rotation:Ae.getAngle(this.rotation())},t)}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){var e;if(this._transforming){this._transforming=!1,"undefined"!=typeof window&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));const i=this.getNode();Vs--,this._fire("transformend",{evt:t,target:i}),null===(e=this.getLayer())||void 0===e||e.batchDraw(),i&&this._nodes.forEach(e=>{var i;e._fire("transformend",{evt:t,target:e}),null===(i=e.getLayer())||void 0===i||i.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(t,e){const i=this._getNodeRect();if(je._inRange(t.width,2*-this.padding()-1,1))return void this.update();if(je._inRange(t.height,2*-this.padding()-1,1))return void this.update();const n=new Oe;if(n.rotate(Ae.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){const e=n.point({x:2*-this.padding(),y:0});t.x+=e.x,t.y+=e.y,t.width+=2*this.padding(),this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){const e=n.point({x:2*this.padding(),y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.width+=2*this.padding()}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){const e=n.point({x:0,y:2*-this.padding()});t.x+=e.x,t.y+=e.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding()}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const e=n.point({x:0,y:2*this.padding()});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=e.x,this._anchorDragOffset.y-=e.y,t.height+=2*this.padding()}if(this.boundBoxFunc()){const e=this.boundBoxFunc()(i,t);e?t=e:je.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const s=1e7,o=new Oe;o.translate(i.x,i.y),o.rotate(i.rotation),o.scale(i.width/s,i.height/s);const r=new Oe,a=t.width/s,l=t.height/s;!1===this.flipEnabled()?(r.translate(t.x,t.y),r.rotate(t.rotation),r.translate(t.width<0?t.width:0,t.height<0?t.height:0),r.scale(Math.abs(a),Math.abs(l))):(r.translate(t.x,t.y),r.rotate(t.rotation),r.scale(a,l));const h=r.multiply(o.invert());this._nodes.forEach(t=>{var e;if(!t.getStage())return;const i=t.getParent().getAbsoluteTransform(),n=t.getTransform().copy();n.translate(t.offsetX(),t.offsetY());const s=new Oe;s.multiply(i.copy().invert()).multiply(h).multiply(i).multiply(n);const o=s.decompose();t.setAttrs(o),null===(e=t.getLayer())||void 0===e||e.batchDraw()}),this.rotation(je._getRotation(t.rotation)),this._nodes.forEach(t=>{this._fire("transform",{evt:e,target:t}),t._fire("transform",{evt:e,target:t})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t;const e=this._getNodeRect();this.rotation(je._getRotation(e.rotation));const i=e.width,n=e.height,s=this.enabledAnchors(),o=this.resizeEnabled(),r=this.padding(),a=this.anchorSize(),l=this.find("._anchor");l.forEach(t=>{t.setAttrs({width:a,height:a,offsetX:a/2,offsetY:a/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:a/2+r,offsetY:a/2+r,visible:o&&s.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:a/2+r,visible:o&&s.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:a/2-r,offsetY:a/2+r,visible:o&&s.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:n/2,offsetX:a/2+r,visible:o&&s.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:n/2,offsetX:a/2-r,visible:o&&s.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:n,offsetX:a/2+r,offsetY:a/2-r,visible:o&&s.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:n,offsetY:a/2-r,visible:o&&s.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:n,offsetX:a/2-r,offsetY:a/2-r,visible:o&&s.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*je._sign(n)-r,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:n,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),draggable:this.nodes().some(t=>t.draggable()),x:0,y:0});const h=this.anchorStyleFunc();h&&l.forEach(t=>{h(t)}),null===(t=this.getLayer())||void 0===t||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();const t=this.findOne("."+this._movingAnchorName);t&&t.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),kn.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return Mi.prototype.toObject.call(this)}clone(t){return Mi.prototype.clone.call(this,t)}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}}Fs.isTransforming=()=>Vs>0,Fs.prototype.className="Transformer",De(Fs),gi.addGetterSetter(Fs,"enabledAnchors",Hs,function(t){return t instanceof Array||je.warn("enabledAnchors value should be an array"),t instanceof Array&&t.forEach(function(t){-1===Hs.indexOf(t)&&je.warn("Unknown anchor name: "+t+". Available names are: "+Hs.join(", "))}),t||[]}),gi.addGetterSetter(Fs,"flipEnabled",!0,ui()),gi.addGetterSetter(Fs,"resizeEnabled",!0),gi.addGetterSetter(Fs,"anchorSize",10,ai()),gi.addGetterSetter(Fs,"rotateEnabled",!0),gi.addGetterSetter(Fs,"rotateLineVisible",!0),gi.addGetterSetter(Fs,"rotationSnaps",[]),gi.addGetterSetter(Fs,"rotateAnchorOffset",50,ai()),gi.addGetterSetter(Fs,"rotateAnchorCursor","crosshair"),gi.addGetterSetter(Fs,"rotationSnapTolerance",5,ai()),gi.addGetterSetter(Fs,"borderEnabled",!0),gi.addGetterSetter(Fs,"anchorStroke","rgb(0, 161, 255)"),gi.addGetterSetter(Fs,"anchorStrokeWidth",1,ai()),gi.addGetterSetter(Fs,"anchorFill","white"),gi.addGetterSetter(Fs,"anchorCornerRadius",0,ai()),gi.addGetterSetter(Fs,"borderStroke","rgb(0, 161, 255)"),gi.addGetterSetter(Fs,"borderStrokeWidth",1,ai()),gi.addGetterSetter(Fs,"borderDash"),gi.addGetterSetter(Fs,"keepRatio",!0),gi.addGetterSetter(Fs,"shiftBehavior","default"),gi.addGetterSetter(Fs,"centeredScaling",!1),gi.addGetterSetter(Fs,"ignoreStroke",!1),gi.addGetterSetter(Fs,"padding",0,ai()),gi.addGetterSetter(Fs,"nodes"),gi.addGetterSetter(Fs,"node"),gi.addGetterSetter(Fs,"boundBoxFunc"),gi.addGetterSetter(Fs,"anchorDragBoundFunc"),gi.addGetterSetter(Fs,"anchorStyleFunc"),gi.addGetterSetter(Fs,"shouldOverdrawWholeArea",!1),gi.addGetterSetter(Fs,"useSingleNodeRotation",!0),gi.backCompat(Fs,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"});class Gs extends Cn{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,Ae.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return 2*this.radius()}getHeight(){return 2*this.radius()}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}function Ws(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}Gs.prototype.className="Wedge",Gs.prototype._centroid=!0,Gs.prototype._attrsAffectingSize=["radius"],De(Gs),gi.addGetterSetter(Gs,"radius",0,ai()),gi.addGetterSetter(Gs,"angle",0,ai()),gi.addGetterSetter(Gs,"clockwise",!1),gi.backCompat(Gs,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"});const js=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Us=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function qs(t,e,i,n,s){const o=i-e,r=s-n;if(0===o)return n+r/2;if(0===r)return n;let a=(t-e)/o;return a=r*a+n,a}function $s(t,e,i){let n=4*(i*t.width+e);const s=[];return s.push(t.data[n++],t.data[n++],t.data[n++],t.data[n++]),s}function Ks(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}gi.addGetterSetter(Mi,"blurRadius",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"brightness",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"contrast",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossStrength",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossWhiteLevel",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"embossDirection","top-left",void 0,gi.afterSetFilter),gi.addGetterSetter(Mi,"embossBlend",!1,void 0,gi.afterSetFilter),gi.addGetterSetter(Mi,"enhance",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"hue",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"saturation",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"luminance",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"hue",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"saturation",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"value",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"kaleidoscopePower",2,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"kaleidoscopeAngle",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"threshold",0,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"noise",.2,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"pixelSize",8,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"levels",.5,ai(),gi.afterSetFilter),gi.addGetterSetter(Mi,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"blue",0,ri,gi.afterSetFilter),gi.addGetterSetter(Mi,"red",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"green",0,function(t){return this._filterUpToDate=!1,t>255?255:t<0?0:Math.round(t)}),gi.addGetterSetter(Mi,"blue",0,ri,gi.afterSetFilter),gi.addGetterSetter(Mi,"alpha",1,function(t){return this._filterUpToDate=!1,t>1?1:t<0?0:t}),gi.addGetterSetter(Mi,"threshold",.5,ai(),gi.afterSetFilter),On.Util._assign(On,{Arc:Bn,Arrow:Yn,Circle:Zn,Ellipse:Jn,Image:Qn,Label:rs,Tag:as,Line:Vn,Path:Xn,Rect:ls,RegularPolygon:hs,Ring:cs,Sprite:us,Star:ps,Text:ks,TextPath:Ls,Transformer:Fs,Wedge:Gs,Filters:{Blur:function(t){const e=Math.round(this.blurRadius());e>0&&function(t,e){const i=t.data,n=t.width,s=t.height;let o,r,a,l,h,d,c,u,p,m,g,f,v,b,_,w,y,C,x,E;const S=e+e+1,P=n-1,k=s-1,I=e+1,R=I*(I+1)/2,M=new Ws,L=js[e],T=Us[e];let A=null,D=M,z=null,O=null;for(let t=1;t<S;t++)D=D.next=new Ws,t===I&&(A=D);D.next=M,a=r=0;for(let t=0;t<s;t++){f=v=b=_=l=h=d=c=0,u=I*(w=i[r]),p=I*(y=i[r+1]),m=I*(C=i[r+2]),g=I*(x=i[r+3]),l+=R*w,h+=R*y,d+=R*C,c+=R*x,D=M;for(let t=0;t<I;t++)D.r=w,D.g=y,D.b=C,D.a=x,D=D.next;for(let t=1;t<I;t++)o=r+((P<t?P:t)<<2),l+=(D.r=w=i[o])*(E=I-t),h+=(D.g=y=i[o+1])*E,d+=(D.b=C=i[o+2])*E,c+=(D.a=x=i[o+3])*E,f+=w,v+=y,b+=C,_+=x,D=D.next;z=M,O=A;for(let t=0;t<n;t++)i[r+3]=x=c*L>>T,0!==x?(x=255/x,i[r]=(l*L>>T)*x,i[r+1]=(h*L>>T)*x,i[r+2]=(d*L>>T)*x):i[r]=i[r+1]=i[r+2]=0,l-=u,h-=p,d-=m,c-=g,u-=z.r,p-=z.g,m-=z.b,g-=z.a,o=a+((o=t+e+1)<P?o:P)<<2,f+=z.r=i[o],v+=z.g=i[o+1],b+=z.b=i[o+2],_+=z.a=i[o+3],l+=f,h+=v,d+=b,c+=_,z=z.next,u+=w=O.r,p+=y=O.g,m+=C=O.b,g+=x=O.a,f-=w,v-=y,b-=C,_-=x,O=O.next,r+=4;a+=n}for(let t=0;t<n;t++){v=b=_=f=h=d=c=l=0,r=t<<2,u=I*(w=i[r]),p=I*(y=i[r+1]),m=I*(C=i[r+2]),g=I*(x=i[r+3]),l+=R*w,h+=R*y,d+=R*C,c+=R*x,D=M;for(let t=0;t<I;t++)D.r=w,D.g=y,D.b=C,D.a=x,D=D.next;let a=n;for(let s=1;s<=e;s++)r=a+t<<2,l+=(D.r=w=i[r])*(E=I-s),h+=(D.g=y=i[r+1])*E,d+=(D.b=C=i[r+2])*E,c+=(D.a=x=i[r+3])*E,f+=w,v+=y,b+=C,_+=x,D=D.next,s<k&&(a+=n);r=t,z=M,O=A;for(let e=0;e<s;e++)o=r<<2,i[o+3]=x=c*L>>T,x>0?(x=255/x,i[o]=(l*L>>T)*x,i[o+1]=(h*L>>T)*x,i[o+2]=(d*L>>T)*x):i[o]=i[o+1]=i[o+2]=0,l-=u,h-=p,d-=m,c-=g,u-=z.r,p-=z.g,m-=z.b,g-=z.a,o=t+((o=e+I)<k?o:k)*n<<2,l+=f+=z.r=i[o],h+=v+=z.g=i[o+1],d+=b+=z.b=i[o+2],c+=_+=z.a=i[o+3],z=z.next,u+=w=O.r,p+=y=O.g,m+=C=O.b,g+=x=O.a,f-=w,v-=y,b-=C,_-=x,O=O.next,r+=n}}(t,e)},Brightness:function(t){const e=this.brightness(),i=t.data,n=i.length;for(let t=0;t<n;t+=4)i[t]=Math.min(255,i[t]*e),i[t+1]=Math.min(255,i[t+1]*e),i[t+2]=Math.min(255,i[t+2]*e)},Brighten:function(t){const e=255*this.brightness(),i=t.data,n=i.length;for(let t=0;t<n;t+=4)i[t]+=e,i[t+1]+=e,i[t+2]+=e},Contrast:function(t){const e=Math.pow((this.contrast()+100)/100,2),i=t.data,n=i.length;let s=150,o=150,r=150;for(let t=0;t<n;t+=4)s=i[t],o=i[t+1],r=i[t+2],s/=255,s-=.5,s*=e,s+=.5,s*=255,o/=255,o-=.5,o*=e,o+=.5,o*=255,r/=255,r-=.5,r*=e,r+=.5,r*=255,s=s<0?0:s>255?255:s,o=o<0?0:o>255?255:o,r=r<0?0:r>255?255:r,i[t]=s,i[t+1]=o,i[t+2]=r},Emboss:function(t){var e,i,n,s,o,r,a,l,h;const d=t.data,c=t.width,u=t.height,p=Math.min(1,Math.max(0,null!==(i=null===(e=this.embossStrength)||void 0===e?void 0:e.call(this))&&void 0!==i?i:.5)),m=Math.min(1,Math.max(0,null!==(s=null===(n=this.embossWhiteLevel)||void 0===n?void 0:n.call(this))&&void 0!==s?s:.5)),g=null!==(a={"top-left":315,top:270,"top-right":225,right:180,"bottom-right":135,bottom:90,"bottom-left":45,left:0}[null!==(r=null===(o=this.embossDirection)||void 0===o?void 0:o.call(this))&&void 0!==r?r:"top-left"])&&void 0!==a?a:315,f=!(null===(h=null===(l=this.embossBlend)||void 0===l?void 0:l.call(this))||void 0===h||!h),v=10*p,b=255*m,_=g*Math.PI/180,w=Math.cos(_),y=Math.sin(_),C=128/1020*v,x=new Uint8ClampedArray(d),E=new Float32Array(c*u);for(let t=0,e=0;e<d.length;e+=4,t++)E[t]=.2126*x[e]+.7152*x[e+1]+.0722*x[e+2];const S=[-1,0,1,-2,0,2,-1,0,1],P=[-1,-2,-1,0,0,0,1,2,1],k=[-c-1,-c,1-c,-1,0,1,c-1,c,c+1],I=t=>t<0?0:t>255?255:t;for(let t=1;t<u-1;t++)for(let e=1;e<c-1;e++){const i=t*c+e;let n=0,s=0;n+=E[i+k[0]]*S[0],s+=E[i+k[0]]*P[0],n+=E[i+k[1]]*S[1],s+=E[i+k[1]]*P[1],n+=E[i+k[2]]*S[2],s+=E[i+k[2]]*P[2],n+=E[i+k[3]]*S[3],s+=E[i+k[3]]*P[3],n+=E[i+k[5]]*S[5],s+=E[i+k[5]]*P[5],n+=E[i+k[6]]*S[6],s+=E[i+k[6]]*P[6],n+=E[i+k[7]]*S[7],s+=E[i+k[7]]*P[7],n+=E[i+k[8]]*S[8],s+=E[i+k[8]]*P[8];const o=I(b+(w*n+y*s)*C),r=4*i;if(f){const t=o-b;d[r]=I(x[r]+t),d[r+1]=I(x[r+1]+t),d[r+2]=I(x[r+2]+t),d[r+3]=x[r+3]}else d[r]=d[r+1]=d[r+2]=o,d[r+3]=x[r+3]}for(let t=0;t<c;t++){let e=4*t,i=4*((u-1)*c+t);d[e]=x[e],d[e+1]=x[e+1],d[e+2]=x[e+2],d[e+3]=x[e+3],d[i]=x[i],d[i+1]=x[i+1],d[i+2]=x[i+2],d[i+3]=x[i+3]}for(let t=1;t<u-1;t++){let e=t*c*4,i=4*(t*c+(c-1));d[e]=x[e],d[e+1]=x[e+1],d[e+2]=x[e+2],d[e+3]=x[e+3],d[i]=x[i],d[i+1]=x[i+1],d[i+2]=x[i+2],d[i+3]=x[i+3]}return t},Enhance:function(t){const e=t.data,i=e.length;let n,s,o,r=e[0],a=r,l=e[1],h=l,d=e[2],c=d;const u=this.enhance();if(0===u)return;for(let t=0;t<i;t+=4)n=e[t+0],n<r?r=n:n>a&&(a=n),s=e[t+1],s<l?l=s:s>h&&(h=s),o=e[t+2],o<d?d=o:o>c&&(c=o);let p,m,g,f,v,b;if(a===r&&(a=255,r=0),h===l&&(h=255,l=0),c===d&&(c=255,d=0),u>0)p=a+u*(255-a),m=r-u*(r-0),g=h+u*(255-h),f=l-u*(l-0),v=c+u*(255-c),b=d-u*(d-0);else{const t=.5*(a+r);p=a+u*(a-t),m=r+u*(r-t);const e=.5*(h+l);g=h+u*(h-e),f=l+u*(l-e);const i=.5*(c+d);v=c+u*(c-i),b=d+u*(d-i)}for(let t=0;t<i;t+=4)e[t+0]=qs(e[t+0],r,a,m,p),e[t+1]=qs(e[t+1],l,h,f,g),e[t+2]=qs(e[t+2],d,c,b,v)},Grayscale:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4){const i=.34*e[t]+.5*e[t+1]+.16*e[t+2];e[t]=i,e[t+1]=i,e[t+2]=i}},HSL:function(t){const e=t.data,i=e.length,n=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=127*this.luminance(),r=1*n*Math.cos(s*Math.PI/180),a=1*n*Math.sin(s*Math.PI/180),l=.299+.701*r+.167*a,h=.587-.587*r+.33*a,d=.114-.114*r-.497*a,c=.299-.299*r-.328*a,u=.587+.413*r+.035*a,p=.114-.114*r+.293*a,m=.299-.3*r+1.25*a,g=.587-.586*r-1.05*a,f=.114+.886*r-.2*a;let v,b,_,w;for(let t=0;t<i;t+=4)v=e[t+0],b=e[t+1],_=e[t+2],w=e[t+3],e[t+0]=l*v+h*b+d*_+o,e[t+1]=c*v+u*b+p*_+o,e[t+2]=m*v+g*b+f*_+o,e[t+3]=w},HSV:function(t){const e=t.data,i=e.length,n=Math.pow(2,this.value()),s=Math.pow(2,this.saturation()),o=Math.abs(this.hue()+360)%360,r=n*s*Math.cos(o*Math.PI/180),a=n*s*Math.sin(o*Math.PI/180),l=.299*n+.701*r+.167*a,h=.587*n-.587*r+.33*a,d=.114*n-.114*r-.497*a,c=.299*n-.299*r-.328*a,u=.587*n+.413*r+.035*a,p=.114*n-.114*r+.293*a,m=.299*n-.3*r+1.25*a,g=.587*n-.586*r-1.05*a,f=.114*n+.886*r-.2*a;for(let t=0;t<i;t+=4){const i=e[t+0],n=e[t+1],s=e[t+2],o=e[t+3];e[t+0]=l*i+h*n+d*s,e[t+1]=c*i+u*n+p*s,e[t+2]=m*i+g*n+f*s,e[t+3]=o}},Invert:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4)e[t]=255-e[t],e[t+1]=255-e[t+1],e[t+2]=255-e[t+2]},Kaleidoscope:function(t){const e=t.width,i=t.height;let n,s,o,r,a,l,h,d,c,u,p=Math.round(this.kaleidoscopePower());const m=Math.round(this.kaleidoscopeAngle()),g=Math.floor(e*(m%360)/360);if(p<1)return;const f=je.createCanvasElement();f.width=e,f.height=i;const v=f.getContext("2d").getImageData(0,0,e,i);je.releaseCanvas(f),function(t,e,i){const n=t.data,s=e.data,o=t.width,r=t.height,a=i.polarCenterX||o/2,l=i.polarCenterY||r/2;let h=Math.sqrt(a*a+l*l),d=o-a,c=r-l;const u=Math.sqrt(d*d+c*c);h=u>h?u:h;const p=r,m=o,g=360/m*Math.PI/180;for(let t=0;t<m;t+=1){const e=Math.sin(t*g),i=Math.cos(t*g);for(let r=0;r<p;r+=1){d=Math.floor(a+h*r/p*i),c=Math.floor(l+h*r/p*e);let u=4*(c*o+d);const m=n[u+0],g=n[u+1],f=n[u+2],v=n[u+3];u=4*(t+r*o),s[u+0]=m,s[u+1]=g,s[u+2]=f,s[u+3]=v}}}(t,v,{polarCenterX:e/2,polarCenterY:i/2});let b=e/Math.pow(2,p);for(;b<=8;)b*=2,p-=1;b=Math.ceil(b);let _=b,w=0,y=_,C=1;for(g+b>e&&(w=_,y=0,C=-1),s=0;s<i;s+=1)for(n=w;n!==y;n+=C)o=Math.round(n+g)%e,c=4*(e*s+o),a=v.data[c+0],l=v.data[c+1],h=v.data[c+2],d=v.data[c+3],u=4*(e*s+n),v.data[u+0]=a,v.data[u+1]=l,v.data[u+2]=h,v.data[u+3]=d;for(s=0;s<i;s+=1)for(_=Math.floor(b),r=0;r<p;r+=1){for(n=0;n<_+1;n+=1)c=4*(e*s+n),a=v.data[c+0],l=v.data[c+1],h=v.data[c+2],d=v.data[c+3],u=4*(e*s+2*_-n-1),v.data[u+0]=a,v.data[u+1]=l,v.data[u+2]=h,v.data[u+3]=d;_*=2}!function(t,e,i){const n=t.data,s=e.data,o=t.width,r=t.height,a=i.polarCenterX||o/2,l=i.polarCenterY||r/2;let h=Math.sqrt(a*a+l*l),d=o-a,c=r-l;const u=Math.sqrt(d*d+c*c);h=u>h?u:h;const p=r,m=o,g=i.polarRotation||0;let f,v;for(d=0;d<o;d+=1)for(c=0;c<r;c+=1){const t=d-a,e=c-l,i=Math.sqrt(t*t+e*e)*p/h;let r=(180*Math.atan2(e,t)/Math.PI+360+g)%360;r=r*m/360,f=Math.floor(r),v=Math.floor(i);let u=4*(v*o+f);const b=n[u+0],_=n[u+1],w=n[u+2],y=n[u+3];u=4*(c*o+d),s[u+0]=b,s[u+1]=_,s[u+2]=w,s[u+3]=y}}(v,t,{polarRotation:0})},Mask:function(t){let e=function(t,e){const i=$s(t,0,0),n=$s(t,t.width-1,0),s=$s(t,0,t.height-1),o=$s(t,t.width-1,t.height-1),r=e||10;if(Ks(i,n)<r&&Ks(n,o)<r&&Ks(o,s)<r&&Ks(s,i)<r){const e=function(t){const e=[0,0,0];for(let i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}([n,i,o,s]),a=[];for(let i=0;i<t.width*t.height;i++){const n=Ks(e,[t.data[4*i],t.data[4*i+1],t.data[4*i+2]]);a[i]=n<r?0:255}return a}}(t,this.threshold());return e&&(e=function(t,e,i){const n=[1,1,1,1,0,1,1,1,1],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=2040===d?255:0}return r}(e,t.width,t.height),e=function(t,e,i){const n=[1,1,1,1,1,1,1,1,1],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=d>=1020?255:0}return r}(e,t.width,t.height),e=function(t,e,i){const n=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],s=Math.round(Math.sqrt(n.length)),o=Math.floor(s/2),r=[];for(let a=0;a<i;a++)for(let l=0;l<e;l++){const h=a*e+l;let d=0;for(let r=0;r<s;r++)for(let h=0;h<s;h++){const c=a+r-o,u=l+h-o;if(c>=0&&c<i&&u>=0&&u<e){const i=n[r*s+h];d+=t[c*e+u]*i}}r[h]=d}return r}(e,t.width,t.height),function(t,e){for(let i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}(t,e)),t},Noise:function(t){const e=255*this.noise(),i=t.data,n=i.length,s=e/2;for(let t=0;t<n;t+=4)i[t+0]+=s-2*s*Math.random(),i[t+1]+=s-2*s*Math.random(),i[t+2]+=s-2*s*Math.random()},Pixelate:function(t){let e=Math.ceil(this.pixelSize()),i=t.width,n=t.height,s=Math.ceil(i/e),o=Math.ceil(n/e),r=t.data;if(e<=0)je.error("pixelSize value can not be <= 0");else for(let t=0;t<s;t+=1)for(let s=0;s<o;s+=1){let o=0,a=0,l=0,h=0;const d=t*e,c=d+e,u=s*e,p=u+e;let m=0;for(let t=d;t<c;t+=1)if(!(t>=i))for(let e=u;e<p;e+=1){if(e>=n)continue;const s=4*(i*e+t);o+=r[s+0],a+=r[s+1],l+=r[s+2],h+=r[s+3],m+=1}o/=m,a/=m,l/=m,h/=m;for(let t=d;t<c;t+=1)if(!(t>=i))for(let e=u;e<p;e+=1){if(e>=n)continue;const s=4*(i*e+t);r[s+0]=o,r[s+1]=a,r[s+2]=l,r[s+3]=h}}},Posterize:function(t){const e=Math.round(254*this.levels())+1,i=t.data,n=i.length,s=255/e;for(let t=0;t<n;t+=1)i[t]=Math.floor(i[t]/s)*s},RGB:function(t){const e=t.data,i=e.length,n=this.red(),s=this.green(),o=this.blue();for(let t=0;t<i;t+=4){const i=(.34*e[t]+.5*e[t+1]+.16*e[t+2])/255;e[t]=i*n,e[t+1]=i*s,e[t+2]=i*o,e[t+3]=e[t+3]}},RGBA:function(t){const e=t.data,i=e.length,n=this.red(),s=this.green(),o=this.blue(),r=this.alpha();for(let t=0;t<i;t+=4){const i=1-r;e[t]=n*r+e[t]*i,e[t+1]=s*r+e[t+1]*i,e[t+2]=o*r+e[t+2]*i}},Sepia:function(t){const e=t.data,i=e.length;for(let t=0;t<i;t+=4){const i=e[t+0],n=e[t+1],s=e[t+2];e[t+0]=Math.min(255,.393*i+.769*n+.189*s),e[t+1]=Math.min(255,.349*i+.686*n+.168*s),e[t+2]=Math.min(255,.272*i+.534*n+.131*s)}},Solarize:function(t){const e=t.data;for(let t=0;t<e.length;t+=4){const i=e[t],n=e[t+1],s=e[t+2];.2126*i+.7152*n+.0722*s>=128&&(e[t]=255-i,e[t+1]=255-n,e[t+2]=255-s)}return t},Threshold:function(t){const e=255*this.threshold(),i=t.data,n=i.length;for(let t=0;t<n;t+=1)i[t]=i[t]<e?0:255}}});let Xs=!1,Ys=null;function Zs(){return Xs}var Js=i(931);function Qs(t){return null==t}function to(t){return null!==t&&"object"==typeof t}function eo(t){return null!==t&&"object"==typeof t}function io(t,e){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function no(t,e){return Array.from(new Set([...Object.keys(t),...Object.keys(e)])).reduce((i,n)=>{const s=t[n],o=e[n];return eo(s)&&eo(o)?Object.assign(Object.assign({},i),{[n]:no(s,o)}):Object.assign(Object.assign({},i),{[n]:n in e?o:s})},{})}function so(t){return!!to(t)&&"target"in t}const oo={alreadydisposed:()=>"View has been already disposed",invalidparams:t=>`Invalid parameters for '${t.name}'`,nomatchingcontroller:t=>`No matching controller for '${t.key}'`,nomatchingview:t=>`No matching view for '${JSON.stringify(t.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:t=>`Not compatible with  plugin '${t.id}'`,propertynotfound:t=>`Property '${t.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class ro{static alreadyDisposed(){return new ro({type:"alreadydisposed"})}static notBindable(){return new ro({type:"notbindable"})}static notCompatible(t,e){return new ro({type:"notcompatible",context:{id:`${t}.${e}`}})}static propertyNotFound(t){return new ro({type:"propertynotfound",context:{name:t}})}static shouldNeverHappen(){return new ro({type:"shouldneverhappen"})}constructor(t){var e;this.message=null!==(e=oo[t.type](t.context))&&void 0!==e?e:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=t.type}toString(){return this.message}}class ao{constructor(t,e){this.obj_=t,this.key=e}static isBindable(t){return null!==t&&("object"==typeof t||"function"==typeof t)}read(){return this.obj_[this.key]}write(t){this.obj_[this.key]=t}writeProperty(t,e){const i=this.read();if(!ao.isBindable(i))throw ro.notBindable();if(!(t in i))throw ro.propertyNotFound(t);i[t]=e}}class lo{constructor(){this.observers_={}}on(t,e,i){var n;let s=this.observers_[t];return s||(s=this.observers_[t]=[]),s.push({handler:e,key:null!==(n=null==i?void 0:i.key)&&void 0!==n?n:e}),this}off(t,e){const i=this.observers_[t];return i&&(this.observers_[t]=i.filter(t=>t.key!==e)),this}emit(t,e){const i=this.observers_[t];i&&i.forEach(t=>{t.handler(e)})}}class ho{constructor(t,e){var i;this.constraint_=null==e?void 0:e.constraint,this.equals_=null!==(i=null==e?void 0:e.equals)&&void 0!==i?i:(t,e)=>t===e,this.emitter=new lo,this.rawValue_=t}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(t):t,s=this.rawValue_;(!this.equals_(s,n)||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:n,sender:this}))}}class co{constructor(t){this.emitter=new lo,this.value_=t}get rawValue(){return this.value_}set rawValue(t){this.setRawValue(t,{forceEmit:!1,last:!0})}setRawValue(t,e){const i=null!=e?e:{forceEmit:!1,last:!0},n=this.value_;(n!==t||i.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=t,this.emitter.emit("change",{options:i,previousRawValue:n,rawValue:this.value_,sender:this}))}}class uo{constructor(t){this.emitter=new lo,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function po(t,e){const i=null==e?void 0:e.constraint,n=null==e?void 0:e.equals;return i||n?new ho(t,e):new co(t)}class mo{constructor(t){this.emitter=new lo,this.valMap_=t;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(t){return Object.keys(t).reduce((e,i)=>Object.assign(e,{[i]:po(t[i])}),{})}static fromObject(t){const e=this.createCore(t);return new mo(e)}get(t){return this.valMap_[t].rawValue}set(t,e){this.valMap_[t].rawValue=e}value(t){return this.valMap_[t]}}class go{constructor(t){this.values=mo.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(t,i),e)}}class fo{constructor(t){this.values=mo.fromObject({max:t.max,min:t.min})}constrain(t){const e=this.values.get("max"),i=this.values.get("min");let n=t;return Qs(i)||(n=Math.max(n,i)),Qs(e)||(n=Math.min(n,e)),n}}class vo{constructor(t,e=0){this.step=t,this.origin=e}constrain(t){const e=this.origin%this.step;return e+Math.round((t-e)/this.step)*this.step}}class bo{constructor(t){this.text=t}evaluate(){return Number(this.text)}toString(){return this.text}}const _o={"**":(t,e)=>Math.pow(t,e),"*":(t,e)=>t*e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e,"&":(t,e)=>t&e,"^":(t,e)=>t^e,"|":(t,e)=>t|e};class wo{constructor(t,e,i){this.left=e,this.operator=t,this.right=i}evaluate(){const t=_o[this.operator];if(!t)throw new Error(`unexpected binary operator: '${this.operator}`);return t(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const yo={"+":t=>t,"-":t=>-t,"~":t=>~t};class Co{constructor(t,e){this.operator=t,this.expression=e}evaluate(){const t=yo[this.operator];if(!t)throw new Error(`unexpected unary operator: '${this.operator}`);return t(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function xo(t){return(e,i)=>{for(let n=0;n<t.length;n++){const s=t[n](e,i);if(""!==s)return s}return""}}function Eo(t,e){var i;const n=t.substr(e).match(/^\s+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function So(t,e){var i;const n=t.substr(e).match(/^[0-9]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}function Po(t,e){const i=t.substr(e,1);if(e+=1,"e"!==i.toLowerCase())return"";const n=function(t,e){const i=So(t,e);if(""!==i)return i;const n=t.substr(e,1);if("-"!==n&&"+"!==n)return"";const s=So(t,e+=1);return""===s?"":n+s}(t,e);return""===n?"":i+n}function ko(t,e){const i=t.substr(e,1);if("0"===i)return i;const n=function(t,e){const i=t.substr(e,1);return i.match(/^[1-9]$/)?i:""}(t,e);return e+=n.length,""===n?"":n+So(t,e)}const Io=xo([function(t,e){const i=ko(t,e);if(e+=i.length,""===i)return"";const n=t.substr(e,1);if(e+=n.length,"."!==n)return"";const s=So(t,e);return i+n+s+Po(t,e+=s.length)},function(t,e){const i=t.substr(e,1);if(e+=i.length,"."!==i)return"";const n=So(t,e);return e+=n.length,""===n?"":i+n+Po(t,e)},function(t,e){const i=ko(t,e);return e+=i.length,""===i?"":i+Po(t,e)}]),Ro=xo([function(t,e){const i=t.substr(e,2);if(e+=i.length,"0b"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[01]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0o"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-7]+/);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n},function(t,e){const i=t.substr(e,2);if(e+=i.length,"0x"!==i.toLowerCase())return"";const n=function(t,e){var i;const n=t.substr(e).match(/^[0-9a-f]+/i);return null!==(i=n&&n[0])&&void 0!==i?i:""}(t,e);return""===n?"":i+n}]),Mo=xo([Ro,Io]);function Lo(t,e,i){i+=Eo(e,i).length;const n=t.filter(t=>e.startsWith(t,i))[0];return n?(i+=n.length,{cursor:i+=Eo(e,i).length,operator:n}):null}const To=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((t,e)=>function(t,e){return(i,n)=>{const s=t(i,n);if(!s)return null;n=s.cursor;let o=s.evaluable;for(;;){const s=Lo(e,i,n);if(!s)break;n=s.cursor;const r=t(i,n);if(!r)return null;n=r.cursor,o=new wo(s.operator,o,r.evaluable)}return o?{cursor:n,evaluable:o}:null}}(t,e),function t(e,i){const n=function(t,e){var i;return null!==(i=function(t,e){const i=Mo(t,e);return e+=i.length,""===i?null:{evaluable:new bo(i),cursor:e}}(t,e))&&void 0!==i?i:function(t,e){const i=t.substr(e,1);if(e+=i.length,"("!==i)return null;const n=Ao(t,e);if(!n)return null;e=n.cursor,e+=Eo(t,e).length;const s=t.substr(e,1);return e+=s.length,")"!==s?null:{evaluable:n.evaluable,cursor:e}}(t,e)}(e,i);if(n)return n;const s=e.substr(i,1);if(i+=s.length,"+"!==s&&"-"!==s&&"~"!==s)return null;const o=t(e,i);return o?{cursor:i=o.cursor,evaluable:new Co(s,o.evaluable)}:null});function Ao(t,e){return e+=Eo(t,e).length,To(t,e)}function Do(t){var e;const i=function(t){const e=Ao(t,0);return e?e.cursor+Eo(t,e.cursor).length!==t.length?null:e.evaluable:null}(t);return null!==(e=null==i?void 0:i.evaluate())&&void 0!==e?e:null}function zo(t){if("number"==typeof t)return t;if("string"==typeof t){const e=Do(t);if(!Qs(e))return e}return 0}function Oo(t){return String(t)}function Bo(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}function Ho(t,e,i,n,s){return n+(t-e)/(i-e)*(s-n)}function No(t){return String(t.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Vo(t,e,i){return Math.min(Math.max(t,e),i)}function Fo(t,e){return(t%e+e)%e}function Go(t,e){return Qs(t.step)?Math.max(No(e),2):No(t.step)}function Wo(t){var e;return null!==(e=t.step)&&void 0!==e?e:1}function jo(t,e){var i;const n=Math.abs(null!==(i=t.step)&&void 0!==i?i:e);return 0===n?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function Uo(t,e){return Qs(t.step)?null:new vo(t.step,e)}function qo(t){return Qs(t.max)||Qs(t.min)?Qs(t.max)&&Qs(t.min)?null:new fo({max:t.max,min:t.min}):new go({max:t.max,min:t.min})}function $o(t,e){var i,n,s;return{formatter:null!==(i=t.format)&&void 0!==i?i:Bo(Go(t,e)),keyScale:null!==(n=t.keyScale)&&void 0!==n?n:Wo(t),pointerScale:null!==(s=t.pointerScale)&&void 0!==s?s:jo(t,e)}}function Ko(t){return{format:t.optional.function,keyScale:t.optional.number,max:t.optional.number,min:t.optional.number,pointerScale:t.optional.number,step:t.optional.number}}function Xo(t){return{constraint:t.constraint,textProps:mo.fromObject($o(t.params,t.initialValue))}}class Yo{constructor(t){this.controller=t}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(t){this.controller.viewProps.set("disabled",t)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(t){this.controller.viewProps.set("hidden",t)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(t){return this.controller.importState(t)}exportState(){return this.controller.exportState()}}class Zo{constructor(t){this.target=t}}class Jo extends Zo{constructor(t,e,i){super(t),this.value=e,this.last=null==i||i}}class Qo extends Zo{constructor(t,e){super(t),this.expanded=e}}class tr extends Zo{constructor(t,e){super(t),this.index=e}}class er extends Zo{constructor(t,e){super(t),this.native=e}}class ir extends Yo{constructor(t){super(t),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new lo,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(t){this.controller.tag=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.controller.value.fetch()}onValueChange_(t){const e=this.controller.value;this.emitter_.emit("change",new Jo(this,e.binding.target.read(),t.options.last))}}class nr{constructor(t,e){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e,this.value_=t,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new lo}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}function sr(t){return e=>i=>{if(!e&&void 0===i)return{succeeded:!1,value:void 0};if(e&&void 0===i)return{succeeded:!0,value:void 0};const n=t(i);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function or(t){return{custom:e=>sr(e)(t),boolean:sr(t=>"boolean"==typeof t?t:void 0)(t),number:sr(t=>"number"==typeof t?t:void 0)(t),string:sr(t=>"string"==typeof t?t:void 0)(t),function:sr(t=>"function"==typeof t?t:void 0)(t),constant:e=>sr(t=>t===e?e:void 0)(t),raw:sr(t=>t)(t),object:e=>sr(t=>{var i;if(null!==(i=t)&&"object"==typeof i)return function(t,e){return Object.keys(e).reduce((i,n)=>{if(void 0===i)return;const s=(0,e[n])(t[n]);return s.succeeded?Object.assign(Object.assign({},i),{[n]:s.value}):void 0},{})}(t,e)})(t),array:e=>sr(t=>{var i;if(Array.isArray(t))return i=e,t.reduce((t,e)=>{if(void 0===t)return;const n=i(e);return n.succeeded&&void 0!==n.value?[...t,n.value]:void 0},[])})(t)}}const rr={optional:or(!0),required:or(!1)};function ar(t,e){const i=e(rr),n=rr.required.object(i)(t);return n.succeeded?n.value:void 0}function lr(t,e,i,n){if(e&&!e(t))return!1;const s=ar(t,i);return!!s&&n(s)}function hr(t,e){var i;return no(null!==(i=null==t?void 0:t())&&void 0!==i?i:{},e)}function dr(t){return"value"in t}function cr(t){return!(!to(t)||!("binding"in t))&&so(t.binding)}const ur="http://www.w3.org/2000/svg";function pr(t){t.offsetHeight}function mr(t){return void 0!==t.ontouchstart}const gr={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function fr(t,e){const i=t.createElementNS(ur,"svg");return i.innerHTML=gr[e],i}function vr(t,e,i){t.insertBefore(e,t.children[i])}function br(t){t.parentElement&&t.parentElement.removeChild(t)}function _r(t){for(;t.children.length>0;)t.removeChild(t.children[0])}function wr(t){return t.relatedTarget?t.relatedTarget:"explicitOriginalTarget"in t?t.explicitOriginalTarget:null}function yr(t,e){t.emitter.on("change",t=>{e(t.rawValue)}),e(t.rawValue)}function Cr(t,e,i){yr(t.value(e),i)}const xr="tp";function Er(t){return(e,i)=>[xr,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}const Sr=Er("lbl");class Pr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sr()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Sr("l")),Cr(e.props,"label",e=>{Qs(e)?this.element.classList.add(Sr(void 0,"nol")):(this.element.classList.remove(Sr(void 0,"nol")),function(t){for(;t.childNodes.length>0;)t.removeChild(t.childNodes[0])}(i),i.appendChild(function(t,e){const i=t.createDocumentFragment();return e.split("\n").map(e=>t.createTextNode(e)).forEach((e,n)=>{n>0&&i.appendChild(t.createElement("br")),i.appendChild(e)}),i}(t,e)))}),this.element.appendChild(i),this.labelElement=i;const n=t.createElement("div");n.classList.add(Sr("v")),this.element.appendChild(n),this.valueElement=n}}class kr{constructor(t,e){this.props=e.props,this.valueController=e.valueController,this.viewProps=e.valueController.viewProps,this.view=new Pr(t,{props:e.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(t){return lr(t,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return hr(null,{label:this.props.get("label")})}}const Ir=Er(""),Rr={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Mr{constructor(t){this.parent_=null,this.blade=t.blade,this.view=t.view,this.viewProps=t.viewProps;const e=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(t=>{e.classList.remove(Ir(void 0,Rr[t]))}),this.blade.get("positions").forEach(t=>{e.classList.add(Ir(void 0,Rr[t]))})}),this.viewProps.handleDispose(()=>{br(e)})}get parent(){return this.parent_}set parent(t){this.parent_=t,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(t){return lr(t,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return hr(null,Object.assign({},this.viewProps.exportState()))}}class Lr extends Mr{constructor(t,e){if(e.value!==e.valueController.value)throw ro.shouldNeverHappen();const i=e.valueController.viewProps,n=new kr(t,{blade:e.blade,props:e.props,valueController:e.valueController});super(Object.assign(Object.assign({},e),{view:new Pr(t,{props:e.props,viewProps:i}),viewProps:i})),this.labelController=n,this.value=e.value,this.valueController=e.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(t){return lr(t,e=>{var i,n,s;return super.importState(e)&&this.labelController.importProps(e)&&(null===(s=null===(n=(i=this.valueController).importProps)||void 0===n?void 0:n.call(i,t))||void 0===s||s)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var t,e,i;return hr(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),null!==(i=null===(e=(t=this.valueController).exportProps)||void 0===e?void 0:e.call(t))&&void 0!==i?i:{}))}}function Tr(t){const e=Object.assign({},t);return delete e.value,e}class Ar extends Lr{constructor(t,e){super(t,e),this.tag=e.tag}importState(t){return lr(t,e=>super.importState(Tr(t)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return hr(()=>Tr(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}class Dr extends Ar{importState(t){return lr(t,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function zr(t,e){for(;t.length<e;)t.push(void 0)}function Or(t){const e=t.indexOf(void 0);return e<0?t:t.slice(0,e)}class Br{constructor(t){this.emitter=new lo,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t.binding,this.value_=po(function(t){const e=[];return zr(e,t),e}(t.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=t.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(t){this.value_.rawValue=t}setRawValue(t,e){this.value_.setRawValue(t,e)}fetch(){this.value_.rawValue=function(t,e){const i=[...Or(t),e];return i.length>t.length?i.splice(0,i.length-t.length):zr(i,t.length),i}(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(t){this.emitter.emit("beforechange",Object.assign(Object.assign({},t),{sender:this}))}onValueChange_(t){this.emitter.emit("change",Object.assign(Object.assign({},t),{sender:this}))}}class Hr extends Ar{exportState(){return hr(()=>super.exportState(),{binding:{readonly:!0}})}}class Nr extends Yo{get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get title(){var t;return null!==(t=this.controller.buttonController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.buttonController.props.set("title",t)}on(t,e){const i=e.bind(this);return this.controller.buttonController.emitter.on(t,t=>{i(new er(this,t.nativeEvent))}),this}off(t,e){return this.controller.buttonController.emitter.off(t,e),this}}function Vr(t,e){return i=>{!function(t,e,i){i?t.classList.add(e):t.classList.remove(e)}(t,e,i)}}function Fr(t,e){yr(t,t=>{e.textContent=null!=t?t:""})}const Gr=Er("btn");class Wr{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Gr()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("button");i.classList.add(Gr("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=t.createElement("div");n.classList.add(Gr("t")),Fr(e.props.value("title"),n),this.buttonElement.appendChild(n)}}class jr{constructor(t,e){this.emitter=new lo,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new Wr(t,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(t){return lr(t,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return hr(null,{title:this.props.get("title")})}onClick_(t){this.emitter.emit("click",{nativeEvent:t,sender:this})}}class Ur extends Mr{constructor(t,e){const i=new jr(t,{props:e.buttonProps,viewProps:e.viewProps}),n=new kr(t,{blade:e.blade,props:e.labelProps,valueController:i});super({blade:e.blade,view:n.view,viewProps:e.viewProps}),this.buttonController=i,this.labelController=n}importState(t){return lr(t,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return hr(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class qr{constructor(t){const[e,i]=t.split("-"),n=e.split(".");this.major=parseInt(n[0],10),this.minor=parseInt(n[1],10),this.patch=parseInt(n[2],10),this.prerelease=null!=i?i:null}toString(){const t=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[t,this.prerelease].join("-"):t}}const $r=new qr("2.0.5");function Kr(t){return Object.assign({core:$r},t)}const Xr=Kr({id:"button",type:"blade",accept(t){const e=ar(t,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller:t=>new Ur(t.document,{blade:t.blade,buttonProps:mo.fromObject({title:t.params.title}),labelProps:mo.fromObject({label:t.params.label}),viewProps:t.viewProps}),api:t=>t.controller instanceof Ur?new Nr(t.controller):null});class Yr{constructor(t,e){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=t,this.emitter_=new lo,this.pool_=e,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(t=>this.pool_.createApi(t))}addBinding(t,e,i){const n=null!=i?i:{},s=this.controller_.element.ownerDocument,o=this.pool_.createBinding(s,function(t,e){if(!ao.isBindable(t))throw ro.notBindable();return new ao(t,e)}(t,e),n),r=this.pool_.createBindingApi(o);return this.add(r,n.index)}addFolder(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}(this,t)}addButton(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}(this,t)}addTab(t){return function(t,e){return t.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}(this,t)}add(t,e){const i=t.controller;return this.controller_.rack.add(i,e),t}remove(t){this.controller_.rack.remove(t.controller)}addBlade(t){const e=this.controller_.element.ownerDocument,i=this.pool_.createBlade(e,t),n=this.pool_.createApi(i);return this.add(n,t.index)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}refresh(){this.children.forEach(t=>{var e;to(e=t)&&"refresh"in e&&"function"==typeof e.refresh&&t.refresh()})}onRackValueChange_(t){const e=t.bladeController,i=this.pool_.createApi(e),n=cr(e.value)?e.value.binding:null;this.emitter_.emit("change",new Jo(i,n?n.target.read():e.value.rawValue,t.options.last))}}class Zr extends Yo{constructor(t,e){super(t),this.rackApi_=new Yr(t.rackController,e)}refresh(){this.rackApi_.refresh()}}class Jr extends Mr{constructor(t){super({blade:t.blade,view:t.view,viewProps:t.rackController.viewProps}),this.rackController=t.rackController}importState(t){return lr(t,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((e,i)=>e.importState(t.children[i])))}exportState(){return hr(()=>super.exportState(),{children:this.rackController.rack.children.map(t=>t.exportState())})}}function Qr(t){return"rackController"in t}class ta{constructor(t){this.emitter=new lo,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=t}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(t){for(const e of this.allItems())if(t(e))return e;return null}includes(t){return this.cache_.has(t)}add(t,e){if(this.includes(t))throw ro.shouldNeverHappen();const i=void 0!==e?e:this.items_.length;this.items_.splice(i,0,t),this.cache_.add(t);const n=this.extract_(t);n&&(n.emitter.on("add",this.onSubListAdd_),n.emitter.on("remove",this.onSubListRemove_),n.allItems().forEach(t=>{this.cache_.add(t)})),this.emitter.emit("add",{index:i,item:t,root:this,target:this})}remove(t){const e=this.items_.indexOf(t);if(e<0)return;this.items_.splice(e,1),this.cache_.delete(t);const i=this.extract_(t);i&&(i.allItems().forEach(t=>{this.cache_.delete(t)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:e,item:t,root:this,target:this})}onSubListAdd_(t){this.cache_.add(t.item),this.emitter.emit("add",{index:t.index,item:t.item,root:this,target:t.target})}onSubListRemove_(t){this.cache_.delete(t.item),this.emitter.emit("remove",{index:t.index,item:t.item,root:this,target:t.target})}}function ea(t){return Qr(t)?t.rackController.rack.bcSet_:null}class ia{constructor(t){var e,i;this.emitter=new lo,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=null!==(e=t.blade)&&void 0!==e?e:null,null===(i=this.blade_)||void 0===i||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=t.viewProps,this.bcSet_=new ta(ea),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(t,e){var i;null===(i=t.parent)||void 0===i||i.remove(t),t.parent=this,this.bcSet_.add(t,e)}remove(t){t.parent=null,this.bcSet_.remove(t)}find(t){return this.bcSet_.allItems().filter(t)}onSetAdd_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("add",{bladeController:t.item,index:t.index,root:e,sender:this}),!e)return;const i=t.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),dr(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Qr(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.on("layout",this.onRackLayout_),e.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(t){this.updatePositions_();const e=t.target===t.root;if(this.emitter.emit("remove",{bladeController:t.item,root:e,sender:this}),!e)return;const i=t.item;if(dr(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Qr(i)){const t=i.rackController.rack;if(t){const e=t.emitter;e.off("layout",this.onRackLayout_),e.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const t=this.bcSet_.items.filter(t=>!t.viewProps.get("hidden")),e=t[0],i=t[t.length-1];this.bcSet_.items.forEach(t=>{const n=[];t===e&&(n.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||n.push("veryfirst")),t===i&&(n.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||n.push("verylast")),t.blade.set("positions",n)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(t){const e=function(t,e){for(let i=0;i<t.length;i++){const n=t[i];if(dr(n)&&n.value===e)return n}return null}(this.find(dr),t.sender);if(!e)throw ro.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:e,options:t.options,sender:this})}onRackLayout_(t){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(t){this.emitter.emit("valuechange",{bladeController:t.bladeController,options:t.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class na{constructor(t){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=t.element,this.viewProps=t.viewProps;const e=new ia({blade:t.root?void 0:t.blade,viewProps:t.viewProps});e.emitter.on("add",this.onRackAdd_),e.emitter.on("remove",this.onRackRemove_),this.rack=e,this.viewProps.handleDispose(()=>{for(let t=this.rack.children.length-1;t>=0;t--)this.rack.children[t].viewProps.set("disposed",!0)})}onRackAdd_(t){t.root&&vr(this.element,t.bladeController.view.element,t.index)}onRackRemove_(t){t.root&&br(t.bladeController.view.element)}}function sa(){return new mo({positions:po([],{equals:io})})}class oa extends mo{constructor(t){super(t)}static create(t){const e={completed:!0,expanded:t,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=mo.createCore(e);return new oa(i)}get styleExpanded(){var t;return null!==(t=this.get("temporaryExpanded"))&&void 0!==t?t:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const t=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Qs(t)?`${t}px`:"auto"}bindExpandedClass(t,e){const i=()=>{this.styleExpanded?t.classList.add(e):t.classList.remove(e)};Cr(this,"expanded",i),Cr(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function ra(t,e){e.style.height=t.styleHeight}function aa(t,e){t.value("expanded").emitter.on("beforechange",()=>{if(t.set("completed",!1),Qs(t.get("expandedHeight"))){const i=function(t,e){let i=0;return function(n){const s=n.style.transition;n.style.transition="none",t.set("expandedHeight",null),t.set("temporaryExpanded",!0),pr(e),i=e.clientHeight,t.set("temporaryExpanded",null),pr(e),n.style.transition=s}(e),i}(t,e);i>0&&t.set("expandedHeight",i)}t.set("shouldFixHeight",!0),pr(e)}),t.emitter.on("change",()=>{ra(t,e)}),ra(t,e),e.addEventListener("transitionend",e=>{"height"===e.propertyName&&t.cleanUpTransition()})}class la extends Zr{constructor(t,e){super(t,e),this.emitter_=new lo,this.controller.foldable.value("expanded").emitter.on("change",t=>{this.emitter_.emit("fold",new Qo(this,t.sender.rawValue))}),this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(t){this.controller.foldable.set("expanded",t)}get title(){return this.controller.props.get("title")}set title(t){this.controller.props.set("title",t)}get children(){return this.rackApi_.children}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addFolder(t){return this.rackApi_.addFolder(t)}addButton(t){return this.rackApi_.addButton(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){return this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBlade(t){return this.rackApi_.addBlade(t)}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const ha=Er("cnt");class da{constructor(t,e){var i;this.className_=Er(null!==(i=e.viewName)&&void 0!==i?i:"fld"),this.element=t.createElement("div"),this.element.classList.add(this.className_(),ha()),e.viewProps.bindClassModifiers(this.element),this.foldable_=e.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Cr(this.foldable_,"completed",Vr(this.element,this.className_(void 0,"cpl")));const n=t.createElement("button");n.classList.add(this.className_("b")),Cr(e.props,"title",t=>{Qs(t)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=t.createElement("div");s.classList.add(this.className_("i")),this.element.appendChild(s);const o=t.createElement("div");o.classList.add(this.className_("t")),Fr(e.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const r=t.createElement("div");r.classList.add(this.className_("m")),this.buttonElement.appendChild(r);const a=t.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class ca extends Jr{constructor(t,e){var i;const n=oa.create(null===(i=e.expanded)||void 0===i||i),s=new da(t,{foldable:n,props:e.props,viewName:e.root?"rot":void 0,viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new na({blade:e.blade,element:s.containerElement,root:e.root,viewProps:e.viewProps}),view:s})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=e.props,this.foldable=n,aa(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(t){return lr(t,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return hr(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const ua=Kr({id:"folder",type:"blade",accept(t){const e=ar(t,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller:t=>new ca(t.document,{blade:t.blade,expanded:t.params.expanded,props:mo.fromObject({title:t.params.title}),viewProps:t.viewProps}),api:t=>t.controller instanceof ca?new la(t.controller,t.pool):null}),pa=Er("");function ma(t,e){return Vr(t,pa(void 0,e))}class ga extends mo{constructor(t){var e,i;super(t),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=(i=po(this.getGlobalDisabled_()),[new uo(i),(t,e)=>{i.setRawValue(t,e)}]),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(t){var e,i,n;const s=null!=t?t:{};return new ga(mo.createCore({disabled:null!==(e=s.disabled)&&void 0!==e&&e,disposed:!1,hidden:null!==(i=s.hidden)&&void 0!==i&&i,parent:null!==(n=s.parent)&&void 0!==n?n:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(t){yr(this.globalDisabled_,ma(t,"disabled")),Cr(this,"hidden",ma(t,"hidden"))}bindDisabled(t){yr(this.globalDisabled_,e=>{t.disabled=e})}bindTabIndex(t){yr(this.globalDisabled_,e=>{t.tabIndex=e?-1:0})}handleDispose(t){this.value("disposed").emitter.on("change",e=>{e&&t()})}importState(t){this.set("disabled",t.disabled),this.set("hidden",t.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const t=this.get("parent");return!!t&&t.globalDisabled.rawValue||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(t){var e;const i=t.previousRawValue;null==i||i.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),null===(e=this.get("parent"))||void 0===e||e.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const fa=Er("tbp");class va{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(fa()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(fa("c")),this.element.appendChild(i),this.containerElement=i}}const ba=Er("tbi");class _a{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ba()),e.viewProps.bindClassModifiers(this.element),Cr(e.props,"selected",t=>{t?this.element.classList.add(ba(void 0,"sel")):this.element.classList.remove(ba(void 0,"sel"))});const i=t.createElement("button");i.classList.add(ba("b")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const n=t.createElement("div");n.classList.add(ba("t")),Fr(e.props.value("title"),n),this.buttonElement.appendChild(n),this.titleElement=n}}class wa{constructor(t,e){this.emitter=new lo,this.onClick_=this.onClick_.bind(this),this.props=e.props,this.viewProps=e.viewProps,this.view=new _a(t,{props:e.props,viewProps:e.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ya extends Jr{constructor(t,e){const i=new va(t,{viewProps:e.viewProps});super(Object.assign(Object.assign({},e),{rackController:new na({blade:e.blade,element:i.containerElement,viewProps:e.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new wa(t,{props:e.itemProps,viewProps:ga.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=e.props,Cr(this.props,"selected",t=>{this.itemController.props.set("selected",t),this.viewProps.set("hidden",!t)})}get itemController(){return this.ic_}importState(t){return lr(t,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return hr(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Ca extends Zr{constructor(t,e){super(t,e),this.emitter_=new lo,this.onSelect_=this.onSelect_.bind(this),this.pool_=e,this.rackApi_.on("change",t=>{this.emitter_.emit("change",t)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(t){const e=this.controller.view.element.ownerDocument,i=new ya(e,{blade:sa(),itemProps:mo.fromObject({selected:!1,title:t.title}),props:mo.fromObject({selected:!1}),viewProps:ga.create()}),n=this.pool_.createApi(i);return this.rackApi_.add(n,t.index)}removePage(t){this.rackApi_.remove(this.rackApi_.children[t])}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}onSelect_(t){this.emitter_.emit("select",new tr(this,t.rawValue))}}class xa extends Zr{get title(){var t;return null!==(t=this.controller.itemController.props.get("title"))&&void 0!==t?t:""}set title(t){this.controller.itemController.props.set("title",t)}get selected(){return this.controller.props.get("selected")}set selected(t){this.controller.props.set("selected",t)}get children(){return this.rackApi_.children}addButton(t){return this.rackApi_.addButton(t)}addFolder(t){return this.rackApi_.addFolder(t)}addTab(t){return this.rackApi_.addTab(t)}add(t,e){this.rackApi_.add(t,e)}remove(t){this.rackApi_.remove(t)}addBinding(t,e,i){return this.rackApi_.addBinding(t,e,i)}addBlade(t){return this.rackApi_.addBlade(t)}}class Ea{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=po(!0),this.selectedIndex=po(-1),this.items_=[]}add(t,e){const i=null!=e?e:this.items_.length;this.items_.splice(i,0,t),t.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(t){const e=this.items_.indexOf(t);e<0||(this.items_.splice(e,1),t.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(0===this.items_.length)return this.selectedIndex.rawValue=-1,void(this.empty.rawValue=!0);const t=this.items_.findIndex(t=>t.rawValue);t<0?(this.items_.forEach((t,e)=>{t.rawValue=0===e}),this.selectedIndex.rawValue=0):(this.items_.forEach((e,i)=>{e.rawValue=i===t}),this.selectedIndex.rawValue=t),this.empty.rawValue=!1}onItemSelectedChange_(t){if(t.rawValue){const e=this.items_.findIndex(e=>e===t.sender);this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e}else this.keepSelection_()}}const Sa=Er("tab");class Pa{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Sa(),ha()),e.viewProps.bindClassModifiers(this.element),yr(e.empty,Vr(this.element,Sa(void 0,"nop")));const i=t.createElement("div");i.classList.add(Sa("t")),this.element.appendChild(i),this.itemsElement=i;const n=t.createElement("div");n.classList.add(Sa("i")),this.element.appendChild(n);const s=t.createElement("div");s.classList.add(Sa("c")),this.element.appendChild(s),this.contentsElement=s}}class ka extends Jr{constructor(t,e){const i=new Ea,n=new Pa(t,{empty:i.empty,viewProps:e.viewProps});super({blade:e.blade,rackController:new na({blade:e.blade,element:n.contentsElement,viewProps:e.viewProps}),view:n}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const s=this.rackController.rack;s.emitter.on("add",this.onRackAdd_),s.emitter.on("remove",this.onRackRemove_),this.tab=i}add(t,e){this.rackController.rack.add(t,e)}remove(t){this.rackController.rack.remove(this.rackController.rack.children[t])}onRackAdd_(t){if(!t.root)return;const e=t.bladeController;vr(this.view.itemsElement,e.itemController.view.element,t.index),e.itemController.viewProps.set("parent",this.viewProps),this.tab.add(e.props.value("selected"))}onRackRemove_(t){if(!t.root)return;const e=t.bladeController;br(e.itemController.view.element),e.itemController.viewProps.set("parent",null),this.tab.remove(e.props.value("selected"))}}const Ia=Kr({id:"tab",type:"blade",accept(t){const e=ar(t,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return e&&0!==e.pages.length?{params:e}:null},controller(t){const e=new ka(t.document,{blade:t.blade,viewProps:t.viewProps});return t.params.pages.forEach(i=>{const n=new ya(t.document,{blade:sa(),itemProps:mo.fromObject({selected:!1,title:i.title}),props:mo.fromObject({selected:!1}),viewProps:ga.create()});e.add(n)}),e},api:t=>t.controller instanceof ka?new Ca(t.controller,t.pool):t.controller instanceof ya?new xa(t.controller,t.pool):null});class Ra extends ir{get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}}class Ma{constructor(){this.disabled=!1,this.emitter=new lo}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class La{constructor(t,e){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=t,this.emitter=new lo,this.interval_=e,this.setTimer_()}get disabled(){return this.disabled_}set disabled(t){this.disabled_=t,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(null===this.timerId_)return;const t=this.doc_.defaultView;t&&t.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const t=this.doc_.defaultView;t&&(this.timerId_=t.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Ta{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce((t,e)=>e.constrain(t),t)}}function Aa(t,e){if(t instanceof e)return t;if(t instanceof Ta){const i=t.constraints.reduce((t,i)=>t||(i instanceof e?i:null),null);if(i)return i}return null}class Da{constructor(t){this.values=mo.fromObject({options:t})}constrain(t){const e=this.values.get("options");return 0===e.length||e.filter(e=>e.value===t).length>0?t:e[0].value}}function za(t){var e;const i=rr;return Array.isArray(t)?null===(e=ar({items:t},t=>({items:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))})))||void 0===e?void 0:e.items:"object"==typeof t?i.required.raw(t).value:void 0}function Oa(t){if(Array.isArray(t))return t;const e=[];return Object.keys(t).forEach(i=>{e.push({text:i,value:t[i]})}),e}function Ba(t){return Qs(t)?null:new Da(Oa(t))}const Ha=Er("lst");class Na{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.element=t.createElement("div"),this.element.classList.add(Ha()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("select");i.classList.add(Ha("s")),e.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const n=t.createElement("div");n.classList.add(Ha("m")),n.appendChild(fr(t,"dropdown")),this.element.appendChild(n),e.value.emitter.on("change",this.onValueChange_),this.value_=e.value,Cr(this.props_,"options",e=>{_r(this.selectElement),e.forEach(e=>{const i=t.createElement("option");i.textContent=e.text,this.selectElement.appendChild(i)}),this.update_()})}update_(){const t=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=t.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class Va{constructor(t,e){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Na(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(t){const e=t.currentTarget;this.value.rawValue=this.props.get("options")[e.selectedIndex].value}importProps(t){return lr(t,null,t=>({options:t.required.custom(za)}),t=>(this.props.set("options",Oa(t.options)),!0))}exportProps(){return hr(null,{options:this.props.get("options")})}}const Fa=Er("pop");class Ga{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Fa()),e.viewProps.bindClassModifiers(this.element),yr(e.shows,Vr(this.element,Fa(void 0,"v")))}}class Wa{constructor(t,e){this.shows=po(!1),this.viewProps=e.viewProps,this.view=new Ga(t,{shows:this.shows,viewProps:this.viewProps})}}const ja=Er("txt");class Ua{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(ja()),e.viewProps.bindClassModifiers(this.element),this.props_=e.props,this.props_.emitter.on("change",this.onChange_);const i=t.createElement("input");i.classList.add(ja("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onChange_),this.value_=e.value,this.refresh()}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value_.rawValue)}onChange_(){this.refresh()}}class qa{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=e.parser,this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new Ua(t,{props:e.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Qs(i)||(this.value.rawValue=i),this.view.refresh()}}function $a(t){return"false"!==t&&!!t}function Ka(t){return function(t){return String(t)}(t)}const Xa=Bo(0);function Ya(t){return Xa(t)+"%"}function Za(t){return String(t)}function Ja(t){return t}function Qa({primary:t,secondary:e,forward:i,backward:n}){let s=!1;function o(t){s||(s=!0,t(),s=!1)}t.emitter.on("change",n=>{o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),n.options)})}),e.emitter.on("change",s=>{o(()=>{t.setRawValue(n(t.rawValue,e.rawValue),s.options)}),o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),s.options)})}),o(()=>{e.setRawValue(i(t.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function tl(t,e){const i=t*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+i:e.downKey?-i:0}function el(t){return{altKey:t.altKey,downKey:"ArrowDown"===t.key,shiftKey:t.shiftKey,upKey:"ArrowUp"===t.key}}function il(t){return{altKey:t.altKey,downKey:"ArrowLeft"===t.key,shiftKey:t.shiftKey,upKey:"ArrowRight"===t.key}}function nl(t){return function(t){return"ArrowUp"===t||"ArrowDown"===t}(t)||"ArrowLeft"===t||"ArrowRight"===t}function sl(t,e){var i,n;const s=e.ownerDocument.defaultView,o=e.getBoundingClientRect();return{x:t.pageX-((null!==(i=s&&s.scrollX)&&void 0!==i?i:0)+o.left),y:t.pageY-((null!==(n=s&&s.scrollY)&&void 0!==n?n:0)+o.top)}}class ol{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new lo,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(sl(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-i.left,y:e.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const i=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(i?{x:i.clientX-n.left,y:i.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey})}}const rl=Er("txt");class al{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(rl(),rl(void 0,"num")),e.arrayPosition&&this.element.classList.add(rl(void 0,e.arrayPosition)),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(rl("i")),i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=e.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(rl()),this.inputElement.classList.add(rl("i"));const n=t.createElement("div");n.classList.add(rl("k")),this.element.appendChild(n),this.knobElement=n;const s=t.createElementNS(ur,"svg");s.classList.add(rl("g")),this.knobElement.appendChild(s);const o=t.createElementNS(ur,"path");o.classList.add(rl("gb")),s.appendChild(o),this.guideBodyElem_=o;const r=t.createElementNS(ur,"path");r.classList.add(rl("gh")),s.appendChild(r),this.guideHeadElem_=r;const a=t.createElement("div");a.classList.add(Er("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.refresh()}onDraggingChange_(t){if(null===t.rawValue)return void this.element.classList.remove(rl(void 0,"drg"));this.element.classList.add(rl(void 0,"drg"));const e=t.rawValue/this.props_.get("pointerScale"),i=e+(e>0?-1:e<0?1:0),n=Vo(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+n},0 L${i},4 L${i+n},8`,`M ${e},-1 L${e},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${e},4`);const s=this.props_.get("formatter");this.tooltipElem_.textContent=s(this.value.rawValue),this.tooltipElem_.style.left=`${e}px`}refresh(){const t=this.props_.get("formatter");this.inputElement.value=t(this.value.rawValue)}onChange_(){this.refresh()}}class ll{constructor(t,e){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=e.parser,this.props=e.props,this.sliderProps_=null!==(i=e.sliderProps)&&void 0!==i?i:null,this.value=e.value,this.viewProps=e.viewProps,this.dragging_=po(null),this.view=new al(t,{arrayPosition:e.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const n=new ol(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}constrainValue_(t){var e,i;const n=null===(e=this.sliderProps_)||void 0===e?void 0:e.get("min"),s=null===(i=this.sliderProps_)||void 0===i?void 0:i.get("max");let o=t;return void 0!==n&&(o=Math.max(o,n)),void 0!==s&&(o=Math.min(o,s)),o}onInputChange_(t){const e=t.currentTarget.value,i=this.parser_(e);Qs(i)||(this.value.rawValue=this.constrainValue_(i)),this.view.refresh()}onInputKeyDown_(t){const e=tl(this.props.get("keyScale"),el(t));0!==e&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+e),{forceEmit:!1,last:!1})}onInputKeyUp_(t){0!==tl(this.props.get("keyScale"),el(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(t){if(!t.point)return null;const e=t.point.x-t.bounds.width/2;return this.constrainValue_(this.originRawValue_+e*this.props.get("pointerScale"))}onPointerMove_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(t){const e=this.computeDraggingValue_(t.data);null!==e&&(this.value.setRawValue(e,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const hl=Er("sld");class dl{constructor(t,e){this.onChange_=this.onChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onChange_),this.element=t.createElement("div"),this.element.classList.add(hl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(hl("t")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const n=t.createElement("div");n.classList.add(hl("k")),this.trackElement.appendChild(n),this.knobElement=n,e.value.emitter.on("change",this.onChange_),this.value=e.value,this.update_()}update_(){const t=Vo(Ho(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${t}%`}onChange_(){this.update_()}}class cl{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.props=e.props,this.view=new dl(t,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){t.point&&this.value.setRawValue(Ho(Vo(t.point.x,0,t.bounds.width),0,t.bounds.width,this.props.get("min"),this.props.get("max")),e)}onPointerDownOrMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(this.props.get("keyScale"),il(t));0!==e&&this.value.setRawValue(this.value.rawValue+e,{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(this.props.get("keyScale"),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ul=Er("sldtxt");class pl{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(ul());const i=t.createElement("div");i.classList.add(ul("s")),this.sliderView_=e.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(ul("t")),this.textView_=e.textView,n.appendChild(this.textView_.element),this.element.appendChild(n)}}class ml{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.sliderC_=new cl(t,{props:e.sliderProps,value:e.value,viewProps:this.viewProps}),this.textC_=new ll(t,{parser:e.parser,props:e.textProps,sliderProps:e.sliderProps,value:e.value,viewProps:e.viewProps}),this.view=new pl(t,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(t){return lr(t,null,t=>({max:t.required.number,min:t.required.number}),t=>{const e=this.sliderC_.props;return e.set("max",t.max),e.set("min",t.min),!0})}exportProps(){const t=this.sliderC_.props;return hr(null,{max:t.get("max"),min:t.get("min")})}}function gl(t){return{sliderProps:new mo({keyScale:t.keyScale,max:t.max,min:t.min}),textProps:new mo({formatter:po(t.formatter),keyScale:t.keyScale,pointerScale:po(t.pointerScale)})}}const fl={containerUnitSize:"cnt-usz"};function vl(t){return`--${fl[t]}`}function bl(t){return Ko(t)}function _l(t){if(eo(t))return ar(t,bl)}function wl(t,e){if(!t)return;const i=[],n=Uo(t,e);n&&i.push(n);const s=qo(t);return s&&i.push(s),new Ta(i)}function yl(t){if("inline"===t||"popup"===t)return t}function Cl(t,e){t.write(e)}const xl=Er("ckb");class El{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.element=t.createElement("div"),this.element.classList.add(xl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("label");i.classList.add(xl("l")),this.element.appendChild(i),this.labelElement=i;const n=t.createElement("input");n.classList.add(xl("i")),n.type="checkbox",this.labelElement.appendChild(n),this.inputElement=n,e.viewProps.bindDisabled(this.inputElement);const s=t.createElement("div");s.classList.add(xl("w")),this.labelElement.appendChild(s);const o=fr(t,"check");s.appendChild(o),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Sl{constructor(t,e){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new El(t,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(t){const e=t.currentTarget;this.value.rawValue=e.checked,t.preventDefault(),t.stopPropagation()}onLabelMouseDown_(t){t.preventDefault()}}const Pl=Kr({id:"input-bool",type:"input",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=ar(e,t=>({options:t.optional.custom(za),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>$a,constraint:t=>function(t){const e=[],i=Ba(t.options);return i&&e.push(i),new Ta(e)}(t.params),writer:t=>Cl},controller:t=>{const e=t.document,i=t.value,n=t.constraint,s=n&&Aa(n,Da);return s?new Va(e,{props:new mo({options:s.values.value("options")}),value:i,viewProps:t.viewProps}):new Sl(e,{value:i,viewProps:t.viewProps})},api:t=>"boolean"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Va?new Ra(t.controller):null}),kl=Er("col");class Il{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(kl()),e.foldable.bindExpandedClass(this.element,kl(void 0,"expanded")),Cr(e.foldable,"completed",Vr(this.element,kl(void 0,"cpl")));const i=t.createElement("div");i.classList.add(kl("h")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(kl("s")),i.appendChild(n),this.swatchElement=n;const s=t.createElement("div");if(s.classList.add(kl("t")),i.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(kl("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}function Rl(t,e,i){const n=Fo(t,360),s=Vo(e/100,0,1),o=Vo(i/100,0,1),r=o*s,a=r*(1-Math.abs(n/60%2-1)),l=o-r;let h,d,c;return[h,d,c]=n>=0&&n<60?[r,a,0]:n>=60&&n<120?[a,r,0]:n>=120&&n<180?[0,r,a]:n>=180&&n<240?[0,a,r]:n>=240&&n<300?[a,0,r]:[r,0,a],[255*(h+l),255*(d+l),255*(c+l)]}function Ml(t){return[t[0],t[1],t[2]]}function Ll(t,e){return[t[0],t[1],t[2],e]}const Tl={hsl:{hsl:(t,e,i)=>[t,e,i],hsv:function(t,e,i){const n=i+e*(100-Math.abs(2*i-100))/200;return[t,0!==n?e*(100-Math.abs(2*i-100))/n:0,i+e*(100-Math.abs(2*i-100))/200]},rgb:function(t,e,i){const n=(t%360+360)%360,s=Vo(e/100,0,1),o=Vo(i/100,0,1),r=(1-Math.abs(2*o-1))*s,a=r*(1-Math.abs(n/60%2-1)),l=o-r/2;let h,d,c;return[h,d,c]=n>=0&&n<60?[r,a,0]:n>=60&&n<120?[a,r,0]:n>=120&&n<180?[0,r,a]:n>=180&&n<240?[0,a,r]:n>=240&&n<300?[a,0,r]:[r,0,a],[255*(h+l),255*(d+l),255*(c+l)]}},hsv:{hsl:function(t,e,i){const n=100-Math.abs(i*(200-e)/100-100);return[t,0!==n?e*i/n:0,i*(200-e)/200]},hsv:(t,e,i)=>[t,e,i],rgb:Rl},rgb:{hsl:function(t,e,i){const n=Vo(t/255,0,1),s=Vo(e/255,0,1),o=Vo(i/255,0,1),r=Math.max(n,s,o),a=Math.min(n,s,o),l=r-a;let h=0,d=0;const c=(a+r)/2;return 0!==l&&(d=l/(1-Math.abs(r+a-1)),h=n===r?(s-o)/l:s===r?2+(o-n)/l:4+(n-s)/l,h=h/6+(h<0?1:0)),[360*h,100*d,100*c]},hsv:function(t,e,i){const n=Vo(t/255,0,1),s=Vo(e/255,0,1),o=Vo(i/255,0,1),r=Math.max(n,s,o),a=r-Math.min(n,s,o);let l;return l=0===a?0:r===n?((s-o)/a%6+6)%6*60:r===s?60*((o-n)/a+2):60*((n-s)/a+4),[l,100*(0===r?0:a/r),100*r]},rgb:(t,e,i)=>[t,e,i]}};function Al(t,e){return["float"===e?1:"rgb"===t?255:360,"float"===e?1:"rgb"===t?255:100,"float"===e?1:"rgb"===t?255:100]}function Dl(t,e,i){var n;const s=Al(e,i);return["rgb"===e?Vo(t[0],0,s[0]):(o=t[0],r=s[0],o===r?r:Fo(o,r)),Vo(t[1],0,s[1]),Vo(t[2],0,s[2]),Vo(null!==(n=t[3])&&void 0!==n?n:1,0,1)];var o,r}function zl(t,e,i,n){const s=Al(e,i),o=Al(e,n);return t.map((t,e)=>t/s[e]*o[e])}function Ol(t,e,i){const n=zl(t,e.mode,e.type,"int");return zl(Tl[e.mode][i.mode](...n),i.mode,"int",i.type)}class Bl{static black(){return new Bl([0,0,0],"rgb")}constructor(t,e){this.type="int",this.mode=e,this.comps_=Dl(t,e,this.type)}getComponents(t){return Ll(Ol(Ml(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Hl=Er("colp");class Nl{constructor(t,e){this.alphaViews_=null,this.element=t.createElement("div"),this.element.classList.add(Hl()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Hl("hsv"));const n=t.createElement("div");n.classList.add(Hl("sv")),this.svPaletteView_=e.svPaletteView,n.appendChild(this.svPaletteView_.element),i.appendChild(n);const s=t.createElement("div");s.classList.add(Hl("h")),this.hPaletteView_=e.hPaletteView,s.appendChild(this.hPaletteView_.element),i.appendChild(s),this.element.appendChild(i);const o=t.createElement("div");if(o.classList.add(Hl("rgb")),this.textsView_=e.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),e.alphaViews){this.alphaViews_={palette:e.alphaViews.palette,text:e.alphaViews.text};const i=t.createElement("div");i.classList.add(Hl("a"));const n=t.createElement("div");n.classList.add(Hl("ap")),n.appendChild(this.alphaViews_.palette.element),i.appendChild(n);const s=t.createElement("div");s.classList.add(Hl("at")),s.appendChild(this.alphaViews_.text.element),i.appendChild(s),this.element.appendChild(i)}}get allFocusableElements(){const t=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&t.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),t}}function Vl(t){return"int"===t?"int":"float"===t?"float":void 0}function Fl(t){return ar(t,t=>({color:t.optional.object({alpha:t.optional.boolean,type:t.optional.custom(Vl)}),expanded:t.optional.boolean,picker:t.optional.custom(yl),readonly:t.optional.constant(!1)}))}function Gl(t){return t?.1:1}function Wl(t){var e;return null===(e=t.color)||void 0===e?void 0:e.type}class jl{constructor(t,e){this.type="float",this.mode=e,this.comps_=Dl(t,e,this.type)}getComponents(t){return Ll(Ol(Ml(this.comps_),{mode:this.mode,type:this.type},{mode:null!=t?t:this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const t=this.getComponents("rgb");return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const Ul={int:(t,e)=>new Bl(t,e),float:(t,e)=>new jl(t,e)};function ql(t,e,i){return Ul[i](t,e)}function $l(t,e){if(t.type===e)return t;if(function(t){return"int"===t.type}(t)&&"float"===e)return function(t){const e=t.getComponents(),i=Al(t.mode,"int");return new jl([Ho(e[0],0,i[0],0,1),Ho(e[1],0,i[1],0,1),Ho(e[2],0,i[2],0,1),e[3]],t.mode)}(t);if(function(t){return"float"===t.type}(t)&&"int"===e)return function(t){const e=t.getComponents(),i=Al(t.mode,"int");return new Bl([Math.round(Ho(e[0],0,1,0,i[0])),Math.round(Ho(e[1],0,1,0,i[1])),Math.round(Ho(e[2],0,1,0,i[2])),e[3]],t.mode)}(t);throw ro.shouldNeverHappen()}function Kl(t,e){const i=t.match(/^(.+)%$/);return i?Math.min(.01*parseFloat(i[1])*e,e):Math.min(parseFloat(t),e)}const Xl={deg:t=>t,grad:t=>360*t/400,rad:t=>360*t/(2*Math.PI),turn:t=>360*t};function Yl(t){const e=t.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(t);const i=parseFloat(e[1]),n=e[2];return Xl[n](i)}function Zl(t){const e=t.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Kl(e[1],255),Kl(e[2],255),Kl(e[3],255)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function Jl(t){const e=Zl(t);return e?new Bl(e,"rgb"):null}function Ql(t){const e=t.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Kl(e[1],255),Kl(e[2],255),Kl(e[3],255),Kl(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function th(t){const e=Ql(t);return e?new Bl(e,"rgb"):null}function eh(t){const e=t.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Yl(e[1]),Kl(e[2],100),Kl(e[3],100)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function ih(t){const e=eh(t);return e?new Bl(e,"hsl"):null}function nh(t){const e=t.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const i=[Yl(e[1]),Kl(e[2],100),Kl(e[3],100),Kl(e[4],1)];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function sh(t){const e=nh(t);return e?new Bl(e,"hsl"):null}function oh(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const i=t.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16)]:null}function rh(t){const e=oh(t);return e?new Bl(e,"rgb"):null}function ah(t){const e=t.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Ho(parseInt(e[4]+e[4],16),0,255,0,1)];const i=t.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return i?[parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),Ho(parseInt(i[4],16),0,255,0,1)]:null}function lh(t){const e=ah(t);return e?new Bl(e,"rgb"):null}function hh(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])?null:i}function dh(t){return e=>{const i=hh(e);return i?ql(i,"rgb",t):null}}function ch(t){const e=t.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const i=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3])?null:i}function uh(t){return e=>{const i=ch(e);return i?ql(i,"rgb",t):null}}const ph=[{parser:oh,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ah,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Zl,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:Ql,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:eh,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:nh,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:hh,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ch,result:{alpha:!0,mode:"rgb",notation:"object"}}];function mh(t){const e=[rh,lh,Jl,th,ih,sh];"int"===t&&e.push(dh("int"),uh("int")),"float"===t&&e.push(dh("float"),uh("float"));const i=function(t){return e=>t.reduce((t,i)=>null!==t?t:i(e),null)}(e);return e=>{const n=i(e);return n?$l(n,t):null}}function gh(t){const e=mh("int");if("string"!=typeof t)return Bl.black();const i=e(t);return null!=i?i:Bl.black()}function fh(t){const e=Vo(Math.floor(t),0,255).toString(16);return 1===e.length?`0${e}`:e}function vh(t,e="#"){return`${e}${Ml(t.getComponents("rgb")).map(fh).join("")}`}function bh(t,e="#"){const i=t.getComponents("rgb");return`${e}${[i[0],i[1],i[2],255*i[3]].map(fh).join("")}`}function _h(t){const e=Bo(0);return`rgb(${Ml($l(t,"int").getComponents("rgb")).map(t=>e(t)).join(", ")})`}function wh(t){const e=Bo(2),i=Bo(0);return`rgba(${$l(t,"int").getComponents("rgb").map((t,n)=>(3===n?e:i)(t)).join(", ")})`}function yh(t,e){const i=Bo("float"===e?2:0),n=["r","g","b"];return`{${Ml($l(t,e).getComponents("rgb")).map((t,e)=>`${n[e]}: ${i(t)}`).join(", ")}}`}function Ch(t){return e=>yh(e,t)}function xh(t,e){const i=Bo(2),n=Bo("float"===e?2:0),s=["r","g","b","a"];return`{${$l(t,e).getComponents("rgb").map((t,e)=>`${s[e]}: ${(3===e?i:n)(t)}`).join(", ")}}`}function Eh(t){return e=>xh(e,t)}const Sh=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:vh},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:bh},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:_h},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:wh},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Bo(0),Ya,Ya];return`hsl(${Ml($l(t,"int").getComponents("hsl")).map((t,i)=>e[i](t)).join(", ")})`}},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:function(t){const e=[Bo(0),Ya,Ya,Bo(2)];return`hsla(${$l(t,"int").getComponents("hsl").map((t,i)=>e[i](t)).join(", ")})`}},...["int","float"].reduce((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Ch(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Eh(e)}],[])];function Ph(t){return Sh.reduce((e,i)=>{return e||(n=i.format,s=t,n.alpha===s.alpha&&n.mode===s.mode&&n.notation===s.notation&&n.type===s.type?i.stringifier:null);var n,s},null)}const kh=Er("apl");class Ih{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(kh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(kh("b")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(kh("c")),i.appendChild(n),this.colorElem_=n;const s=t.createElement("div");s.classList.add(kh("m")),this.element.appendChild(s),this.markerElem_=s;const o=t.createElement("div");o.classList.add(kh("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const t=this.value.rawValue,e=t.getComponents("rgb"),i=new Bl([e[0],e[1],e[2],0],"rgb"),n=new Bl([e[0],e[1],e[2],255],"rgb"),s=["to right",wh(i),wh(n)];this.colorElem_.style.background=`linear-gradient(${s.join(",")})`,this.previewElem_.style.backgroundColor=wh(t);const o=Ho(e[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class Rh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Ih(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=t.point.x/t.bounds.width,n=this.value.rawValue,[s,o,r]=n.getComponents("hsv");this.value.setRawValue(new Bl([s,o,r,i],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(Gl(!0),il(t));if(0===e)return;const i=this.value.rawValue,[n,s,o,r]=i.getComponents("hsv");this.value.setRawValue(new Bl([n,s,o,r+e],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(Gl(!0),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Mh=Er("coltxt");class Lh{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(Mh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Mh("m")),this.modeElem_=function(t){const e=t.createElement("select");return e.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}].reduce((e,i)=>{const n=t.createElement("option");return n.textContent=i.text,n.value=i.value,e.appendChild(n),e},t.createDocumentFragment())),e}(t),this.modeElem_.classList.add(Mh("ms")),i.appendChild(this.modeSelectElement),e.viewProps.bindDisabled(this.modeElem_);const n=t.createElement("div");n.classList.add(Mh("mm")),n.appendChild(fr(t,"dropdown")),i.appendChild(n),this.element.appendChild(i);const s=t.createElement("div");s.classList.add(Mh("w")),this.element.appendChild(s),this.inputsElem_=s,this.inputViews_=e.inputViews,this.applyInputViews_(),yr(e.mode,t=>{this.modeElem_.value=t})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(t){this.inputViews_=t,this.applyInputViews_()}applyInputViews_(){_r(this.inputsElem_);const t=this.element.ownerDocument;this.inputViews_.forEach(e=>{const i=t.createElement("div");i.classList.add(Mh("c")),i.appendChild(e.element),this.inputsElem_.appendChild(i)})}}function Th(t,e,i){const n=Al(t,e)[i];return new go({min:0,max:n})}class Ah{constructor(t,e){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=e.colorType,this.value=e.value,this.viewProps=e.viewProps,this.colorMode=po(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(t),this.view=new Lh(t,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(t){const e=this.colorMode.rawValue;return function(t){return"hex"!==t}(e)?function(t,e){const i={colorMode:e.colorMode,colorType:e.colorType,parser:Do,viewProps:e.viewProps};return[0,1,2].map(n=>{const s=function(t,e,i){return new ll(t,{arrayPosition:0===i?"fst":2===i?"lst":"mid",parser:e.parser,props:mo.fromObject({formatter:(n=e.colorType,Bo("float"===n?2:0)),keyScale:Gl(!1),pointerScale:"float"===e.colorType?.01:1}),value:po(0,{constraint:Th(e.colorMode,e.colorType,i)}),viewProps:e.viewProps});var n}(t,i,n);return Qa({primary:e.value,secondary:s.value,forward:t=>$l(t,e.colorType).getComponents(e.colorMode)[n],backward(t,i){const s=e.colorMode,o=$l(t,e.colorType).getComponents(s);return o[n]=i,$l(ql(Ll(Ml(o),o[3]),s,e.colorType),"int")}}),s})}(t,{colorMode:e,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):function(t,e){const i=new qa(t,{parser:mh("int"),props:mo.fromObject({formatter:vh}),value:po(Bl.black()),viewProps:e.viewProps});return Qa({primary:e.value,secondary:i.value,forward:t=>new Bl(Ml(t.getComponents()),t.mode),backward:(t,e)=>new Bl(Ll(Ml(e.getComponents(t.mode)),t.getComponents()[3]),t.mode)}),[i]}(t,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(t){const e=t.currentTarget;this.colorMode.rawValue=e.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(t=>t.view)}}const Dh=Er("hpl");class zh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Dh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("div");i.classList.add(Dh("c")),this.element.appendChild(i);const n=t.createElement("div");n.classList.add(Dh("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const t=this.value.rawValue,[e]=t.getComponents("hsv");this.markerElem_.style.backgroundColor=_h(new Bl([e,100,100],"hsv"));const i=Ho(e,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class Oh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new zh(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Ho(Vo(t.point.x,0,t.bounds.width),0,t.bounds.width,0,360),n=this.value.rawValue,[,s,o,r]=n.getComponents("hsv");this.value.setRawValue(new Bl([i,s,o,r],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){const e=tl(Gl(!1),il(t));if(0===e)return;const i=this.value.rawValue,[n,s,o,r]=i.getComponents("hsv");this.value.setRawValue(new Bl([n+e,s,o,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){0!==tl(Gl(!1),il(t))&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Bh=Er("svp");class Hh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.element=t.createElement("div"),this.element.classList.add(Bh()),e.viewProps.bindClassModifiers(this.element),e.viewProps.bindTabIndex(this.element);const i=t.createElement("canvas");i.height=64,i.width=64,i.classList.add(Bh("c")),this.element.appendChild(i),this.canvasElement=i;const n=t.createElement("div");n.classList.add(Bh("m")),this.element.appendChild(n),this.markerElem_=n,this.update_()}update_(){const t=function(t){const e=t.ownerDocument.defaultView;return e&&"document"in e?t.getContext("2d",{willReadFrequently:!0}):null}(this.canvasElement);if(!t)return;const e=this.value.rawValue.getComponents("hsv"),i=this.canvasElement.width,n=this.canvasElement.height,s=t.getImageData(0,0,i,n),o=s.data;for(let t=0;t<n;t++)for(let s=0;s<i;s++){const r=Ho(s,0,i,0,100),a=Ho(t,0,n,100,0),l=Rl(e[0],r,a),h=4*(t*i+s);o[h]=l[0],o[h+1]=l[1],o[h+2]=l[2],o[h+3]=255}t.putImageData(s,0,0);const r=Ho(e[1],0,100,0,100);this.markerElem_.style.left=`${r}%`;const a=Ho(e[2],0,100,100,0);this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}}class Nh{constructor(t,e){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.view=new Hh(t,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=Ho(t.point.x,0,t.bounds.width,0,100),n=Ho(t.point.y,0,t.bounds.height,100,0),[s,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Bl([s,i,n,o],"hsv"),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onKeyDown_(t){nl(t.key)&&t.preventDefault();const[e,i,n,s]=this.value.rawValue.getComponents("hsv"),o=Gl(!1),r=tl(o,il(t)),a=tl(o,el(t));0===r&&0===a||this.value.setRawValue(new Bl([e,i+r,n+a,s],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(t){const e=Gl(!1),i=tl(e,il(t)),n=tl(e,el(t));0===i&&0===n||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Vh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.hPaletteC_=new Oh(t,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Nh(t,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=e.supportsAlpha?{palette:new Rh(t,{value:this.value,viewProps:this.viewProps}),text:new ll(t,{parser:Do,props:mo.fromObject({pointerScale:.01,keyScale:.1,formatter:Bo(2)}),value:po(0,{constraint:new go({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Qa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:t=>t.getComponents()[3],backward:(t,e)=>{const i=t.getComponents();return i[3]=e,new Bl(i,t.mode)}}),this.textsC_=new Ah(t,{colorType:e.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Nl(t,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:e.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const Fh=Er("colsw");class Gh{constructor(t,e){this.onValueChange_=this.onValueChange_.bind(this),e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.element=t.createElement("div"),this.element.classList.add(Fh()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(Fh("sw")),this.element.appendChild(i),this.swatchElem_=i;const n=t.createElement("button");n.classList.add(Fh("b")),e.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n,this.update_()}update_(){const t=this.value.rawValue;this.swatchElem_.style.backgroundColor=bh(t)}onValueChange_(){this.update_()}}class Wh{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Gh(t,{value:this.value,viewProps:this.viewProps})}}class jh{constructor(t,e){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=oa.create(e.expanded),this.swatchC_=new Wh(t,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new qa(t,{parser:e.parser,props:mo.fromObject({formatter:e.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Il(t,{foldable:this.foldable_,pickerLayout:e.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_="popup"===e.pickerLayout?new Wa(t,{viewProps:this.viewProps}):null;const n=new Vh(t,{colorType:e.colorType,supportsAlpha:e.supportsAlpha,value:this.value,viewProps:this.viewProps});n.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=n,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(n.view.element),Qa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aa(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=wr(t);i&&e.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!mr(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.swatchC_.view.buttonElement.focus()}}function Uh(t){return Ml(t.getComponents("rgb")).reduce((t,e)=>t<<8|255&Math.floor(e),0)}function qh(t){return t.getComponents("rgb").reduce((t,e,i)=>t<<8|255&Math.floor(3===i?255*e:e),0)>>>0}function $h(t){return"number"!=typeof t?Bl.black():new Bl([(e=t)>>16&255,e>>8&255,255&e],"rgb");var e}function Kh(t){return"number"!=typeof t?Bl.black():new Bl([(e=t)>>24&255,e>>16&255,e>>8&255,Ho(255&e,0,255,0,1)],"rgb");var e}function Xh(t,e){return"object"==typeof t&&!Qs(t)&&e in t&&"number"==typeof t[e]}function Yh(t){return Xh(t,"r")&&Xh(t,"g")&&Xh(t,"b")}function Zh(t){return Yh(t)&&Xh(t,"a")}function Jh(t){return Yh(t)}function Qh(t,e){if(t.mode!==e.mode)return!1;if(t.type!==e.type)return!1;const i=t.getComponents(),n=e.getComponents();for(let t=0;t<i.length;t++)if(i[t]!==n[t])return!1;return!0}function td(t){return"a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b]}const ed=Kr({id:"input-color-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;if(!function(t){return"color"in t||"color"===t.view}(e))return null;const i=Fl(e);return i?{initialValue:t,params:Object.assign(Object.assign({},i),{supportsAlpha:(n=e,!!(null===(s=null==n?void 0:n.color)||void 0===s?void 0:s.alpha))})}:null;var n,s},binding:{reader:t=>t.params.supportsAlpha?Kh:$h,equals:Qh,writer:t=>function(t){const e=t?qh:Uh;return(t,i)=>{Cl(t,e(i))}}(t.params.supportsAlpha)},controller:t=>{var e,i,n;return new jh(t.document,{colorType:"int",expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:(n=t.params.supportsAlpha,n?t=>bh(t,"0x"):t=>vh(t,"0x")),parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.supportsAlpha,value:t.value,viewProps:t.viewProps})}});function id(t,e){return i=>t?xh(i,e):yh(i,e)}const nd=Kr({id:"input-color-object",type:"input",accept:(t,e)=>{var i;if(!Jh(t))return null;const n=Fl(e);return n?{initialValue:t,params:Object.assign(Object.assign({},n),{colorType:null!==(i=Wl(e))&&void 0!==i?i:"int"})}:null},binding:{reader:t=>{return e=t.params.colorType,t=>{const i=function(t,e){if(!Jh(t))return $l(Bl.black(),e);if("int"===e){const e=td(t);return new Bl(e,"rgb")}if("float"===e){const e=td(t);return new jl(e,"rgb")}return $l(Bl.black(),"int")}(t,e);return $l(i,"int")};var e},equals:Qh,writer:t=>{return e=Zh(t.initialValue),i=t.params.colorType,(t,n)=>{e?function(t,e,i){const n=$l(e,i).toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b),t.writeProperty("a",n.a)}(t,n,i):function(t,e,i){const n=$l(e,i).toRgbaObject();t.writeProperty("r",n.r),t.writeProperty("g",n.g),t.writeProperty("b",n.b)}(t,n,i)};var e,i}},controller:t=>{var e,i;const n=Zh(t.initialValue);return new jh(t.document,{colorType:t.params.colorType,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:id(n,t.params.colorType),parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:n,value:t.value,viewProps:t.viewProps})}}),sd=Kr({id:"input-color-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;if("text"===e.view)return null;const i=function(t,e="int"){const i=function(t){return ph.reduce((e,{parser:i,result:n})=>e||(i(t)?n:null),null)}(t);return i?"hex"===i.notation&&"float"!==e?Object.assign(Object.assign({},i),{type:"int"}):"func"===i.notation?Object.assign(Object.assign({},i),{type:e}):null:null}(t,Wl(e));if(!i)return null;const n=Ph(i);if(!n)return null;const s=Fl(e);return s?{initialValue:t,params:Object.assign(Object.assign({},s),{format:i,stringifier:n})}:null},binding:{reader:()=>gh,equals:Qh,writer:t=>{const e=function(t){const e=Ph(t);return e?(t,i)=>{Cl(t,e(i))}:null}(t.params.format);if(!e)throw ro.notBindable();return e}},controller:t=>{var e,i;return new jh(t.document,{colorType:t.params.format.type,expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,formatter:t.params.stringifier,parser:mh("int"),pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",supportsAlpha:t.params.format.alpha,value:t.value,viewProps:t.viewProps})}});class od{constructor(t){this.components=t.components,this.asm_=t.assembly}constrain(t){const e=this.asm_.toComponents(t).map((t,e)=>{var i,n;return null!==(n=null===(i=this.components[e])||void 0===i?void 0:i.constrain(t))&&void 0!==n?n:t});return this.asm_.fromComponents(e)}}const rd=Er("pndtxt");class ad{constructor(t,e){this.textViews=e.textViews,this.element=t.createElement("div"),this.element.classList.add(rd()),this.textViews.forEach(e=>{const i=t.createElement("div");i.classList.add(rd("a")),i.appendChild(e.element),this.element.appendChild(i)})}}class ld{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.acs_=e.axes.map((i,n)=>function(t,e,i){return new ll(t,{arrayPosition:0===i?"fst":i===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[i].textProps,value:po(0,{constraint:e.axes[i].constraint}),viewProps:e.viewProps})}(t,e,n)),this.acs_.forEach((t,i)=>{Qa({primary:this.value,secondary:t.value,forward:t=>e.assembly.toComponents(t)[i],backward:(t,n)=>{const s=e.assembly.toComponents(t);return s[i]=n,e.assembly.fromComponents(s)}})}),this.view=new ad(t,{textViews:this.acs_.map(t=>t.view)})}get textControllers(){return this.acs_}}class hd extends ir{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}}const dd=Kr({id:"input-number",type:"input",accept:(t,e)=>{if("number"!=typeof t)return null;const i=ar(e,t=>Object.assign(Object.assign({},Ko(t)),{options:t.optional.custom(za),readonly:t.optional.constant(!1)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>zo,constraint:t=>function(t,e){const i=[],n=Uo(t,e);n&&i.push(n);const s=qo(t);s&&i.push(s);const o=Ba(t.options);return o&&i.push(o),new Ta(i)}(t.params,t.initialValue),writer:t=>Cl},controller:t=>{const e=t.value,i=t.constraint,n=i&&Aa(i,Da);if(n)return new Va(t.document,{props:new mo({options:n.values.value("options")}),value:e,viewProps:t.viewProps});const s=$o(t.params,e.rawValue),o=i&&Aa(i,go);return o?new ml(t.document,Object.assign(Object.assign({},gl(Object.assign(Object.assign({},s),{keyScale:po(s.keyScale),max:o.values.value("max"),min:o.values.value("min")}))),{parser:Do,value:e,viewProps:t.viewProps})):new ll(t.document,{parser:Do,props:mo.fromObject(s),value:e,viewProps:t.viewProps})},api:t=>"number"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof ml?new hd(t.controller):t.controller.valueController instanceof Va?new Ra(t.controller):null});class cd{constructor(t=0,e=0){this.x=t,this.y=e}getComponents(){return[this.x,this.y]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y;return"number"==typeof e&&"number"==typeof i}static equals(t,e){return t.x===e.x&&t.y===e.y}toObject(){return{x:this.x,y:this.y}}}const ud={toComponents:t=>t.getComponents(),fromComponents:t=>new cd(...t)},pd=Er("p2d");class md{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(pd()),e.viewProps.bindClassModifiers(this.element),yr(e.expanded,Vr(this.element,pd(void 0,"expanded")));const i=t.createElement("div");i.classList.add(pd("h")),this.element.appendChild(i);const n=t.createElement("button");n.classList.add(pd("b")),n.appendChild(fr(t,"p2dpad")),e.viewProps.bindDisabled(n),i.appendChild(n),this.buttonElement=n;const s=t.createElement("div");if(s.classList.add(pd("t")),i.appendChild(s),this.textElement=s,"inline"===e.pickerLayout){const e=t.createElement("div");e.classList.add(pd("p")),this.element.appendChild(e),this.pickerElement=e}else this.pickerElement=null}}const gd=Er("p2dp");class fd{constructor(t,e){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=e.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=t.createElement("div"),this.element.classList.add(gd()),"popup"===e.layout&&this.element.classList.add(gd(void 0,"p")),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("div");i.classList.add(gd("p")),e.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const n=t.createElementNS(ur,"svg");n.classList.add(gd("g")),this.padElement.appendChild(n),this.svgElem_=n;const s=t.createElementNS(ur,"line");s.classList.add(gd("ax")),s.setAttributeNS(null,"x1","0"),s.setAttributeNS(null,"y1","50%"),s.setAttributeNS(null,"x2","100%"),s.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(s);const o=t.createElementNS(ur,"line");o.classList.add(gd("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const r=t.createElementNS(ur,"line");r.classList.add(gd("l")),r.setAttributeNS(null,"x1","50%"),r.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(r),this.lineElem_=r;const a=t.createElement("div");a.classList.add(gd("m")),this.padElement.appendChild(a),this.markerElem_=a,e.value.emitter.on("change",this.onValueChange_),this.value=e.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[t,e]=this.value.rawValue.getComponents(),i=this.props_.get("max"),n=Ho(t,-i,+i,0,100),s=Ho(e,-i,+i,0,100),o=this.props_.get("invertsY")?100-s:s;this.lineElem_.setAttributeNS(null,"x2",`${n}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${n}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function vd(t,e,i){return[tl(e[0],il(t)),tl(e[1],el(t))*(i?1:-1)]}class bd{constructor(t,e){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.view=new fd(t,{layout:e.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new ol(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(t,e){if(!t.point)return;const i=this.props.get("max"),n=Ho(t.point.x,0,t.bounds.width,-i,+i),s=Ho(this.props.get("invertsY")?t.bounds.height-t.point.y:t.point.y,0,t.bounds.height,-i,+i);this.value.setRawValue(new cd(n,s),e)}onPointerDown_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerMove_(t){this.handlePointerEvent_(t.data,{forceEmit:!1,last:!1})}onPointerUp_(t){this.handlePointerEvent_(t.data,{forceEmit:!0,last:!0})}onPadKeyDown_(t){nl(t.key)&&t.preventDefault();const[e,i]=vd(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(new cd(this.value.rawValue.x+e,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(t){const[e,i]=vd(t,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));0===e&&0===i||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class _d{constructor(t,e){var i,n;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=e.value,this.viewProps=e.viewProps,this.foldable_=oa.create(e.expanded),this.popC_="popup"===e.pickerLayout?new Wa(t,{viewProps:this.viewProps}):null;const s=new bd(t,{layout:e.pickerLayout,props:new mo({invertsY:po(e.invertsY),max:po(e.max),xKeyScale:e.axes[0].textProps.value("keyScale"),yKeyScale:e.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(t=>{t.addEventListener("blur",this.onPopupChildBlur_),t.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.textC_=new ld(t,{assembly:ud,axes:e.axes,parser:e.parser,value:this.value,viewProps:this.viewProps}),this.view=new md(t,{expanded:this.foldable_.value("expanded"),pickerLayout:e.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),null===(i=this.view.buttonElement)||void 0===i||i.addEventListener("blur",this.onPadButtonBlur_),null===(n=this.view.buttonElement)||void 0===n||n.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Qa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:t=>t,backward:(t,e)=>e})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aa(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(t){if(!this.popC_)return;const e=this.view.element,i=t.relatedTarget;i&&e.contains(i)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(t){if(!this.popC_)return;const e=this.popC_.view.element,i=wr(t);i&&e.contains(i)||i&&i===this.view.buttonElement&&!mr(e.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(t){this.popC_?"Escape"===t.key&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&"Escape"===t.key&&this.view.buttonElement.focus()}}function wd(t){return cd.isObject(t)?new cd(t.x,t.y):new cd}function yd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y)}function Cd(t,e){var i,n;if(!Qs(t.min)||!Qs(t.max))return Math.max(Math.abs(null!==(i=t.min)&&void 0!==i?i:0),Math.abs(null!==(n=t.max)&&void 0!==n?n:0));const s=Wo(t);return Math.max(10*Math.abs(s),10*Math.abs(e))}function xd(t,e){var i,n;const s=Cd(no(t,null!==(i=t.x)&&void 0!==i?i:{}),e.x),o=Cd(no(t,null!==(n=t.y)&&void 0!==n?n:{}),e.y);return Math.max(s,o)}function Ed(t){if(!("y"in t))return!1;const e=t.y;return!!e&&"inverted"in e&&!!e.inverted}const Sd=Kr({id:"input-point2d",type:"input",accept:(t,e)=>{if(!cd.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{expanded:t.optional.boolean,picker:t.optional.custom(yl),readonly:t.optional.constant(!1),x:t.optional.custom(_l),y:t.optional.object(Object.assign(Object.assign({},bl(t)),{inverted:t.optional.boolean}))}));return i?{initialValue:t,params:i}:null},binding:{reader:()=>wd,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:ud,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y)]});var e,i},equals:cd.equals,writer:()=>yd},controller:t=>{var e,i;const n=t.document,s=t.value,o=t.constraint,r=[t.params.x,t.params.y];return new _d(n,{axes:s.rawValue.getComponents().map((e,i)=>{var n;return Xo({constraint:o.components[i],initialValue:e,params:no(t.params,null!==(n=r[i])&&void 0!==n?n:{})})}),expanded:null!==(e=t.params.expanded)&&void 0!==e&&e,invertsY:Ed(t.params),max:xd(t.params,s.rawValue),parser:Do,pickerLayout:null!==(i=t.params.picker)&&void 0!==i?i:"popup",value:s,viewProps:t.viewProps})}});class Pd{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y,n=t.z;return"number"==typeof e&&"number"==typeof i&&"number"==typeof n}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const kd={toComponents:t=>t.getComponents(),fromComponents:t=>new Pd(...t)};function Id(t){return Pd.isObject(t)?new Pd(t.x,t.y,t.z):new Pd}function Rd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z)}const Md=Kr({id:"input-point3d",type:"input",accept:(t,e)=>{if(!Pd.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{readonly:t.optional.constant(!1),x:t.optional.custom(_l),y:t.optional.custom(_l),z:t.optional.custom(_l)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Id,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:kd,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y),wl(Object.assign(Object.assign({},e),e.z),i.z)]});var e,i},equals:Pd.equals,writer:t=>Rd},controller:t=>{const e=t.value,i=t.constraint,n=[t.params.x,t.params.y,t.params.z];return new ld(t.document,{assembly:kd,axes:e.rawValue.getComponents().map((e,s)=>{var o;return Xo({constraint:i.components[s],initialValue:e,params:no(t.params,null!==(o=n[s])&&void 0!==o?o:{})})}),parser:Do,value:e,viewProps:t.viewProps})}});class Ld{constructor(t=0,e=0,i=0,n=0){this.x=t,this.y=e,this.z=i,this.w=n}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(t){if(Qs(t))return!1;const e=t.x,i=t.y,n=t.z,s=t.w;return"number"==typeof e&&"number"==typeof i&&"number"==typeof n&&"number"==typeof s}static equals(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Td={toComponents:t=>t.getComponents(),fromComponents:t=>new Ld(...t)};function Ad(t){return Ld.isObject(t)?new Ld(t.x,t.y,t.z,t.w):new Ld}function Dd(t,e){t.writeProperty("x",e.x),t.writeProperty("y",e.y),t.writeProperty("z",e.z),t.writeProperty("w",e.w)}const zd=Kr({id:"input-point4d",type:"input",accept:(t,e)=>{if(!Ld.isObject(t))return null;const i=ar(e,t=>Object.assign(Object.assign({},bl(t)),{readonly:t.optional.constant(!1),w:t.optional.custom(_l),x:t.optional.custom(_l),y:t.optional.custom(_l),z:t.optional.custom(_l)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Ad,constraint:t=>{return e=t.params,i=t.initialValue,new od({assembly:Td,components:[wl(Object.assign(Object.assign({},e),e.x),i.x),wl(Object.assign(Object.assign({},e),e.y),i.y),wl(Object.assign(Object.assign({},e),e.z),i.z),wl(Object.assign(Object.assign({},e),e.w),i.w)]});var e,i},equals:Ld.equals,writer:t=>Dd},controller:t=>{const e=t.value,i=t.constraint,n=[t.params.x,t.params.y,t.params.z,t.params.w];return new ld(t.document,{assembly:Td,axes:e.rawValue.getComponents().map((e,s)=>{var o;return Xo({constraint:i.components[s],initialValue:e,params:no(t.params,null!==(o=n[s])&&void 0!==o?o:{})})}),parser:Do,value:e,viewProps:t.viewProps})}}),Od=Kr({id:"input-string",type:"input",accept:(t,e)=>{if("string"!=typeof t)return null;const i=ar(e,t=>({readonly:t.optional.constant(!1),options:t.optional.custom(za)}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Za,constraint:t=>function(t){const e=[],i=Ba(t.options);return i&&e.push(i),new Ta(e)}(t.params),writer:t=>Cl},controller:t=>{const e=t.document,i=t.value,n=t.constraint,s=n&&Aa(n,Da);return s?new Va(e,{props:new mo({options:s.values.value("options")}),value:i,viewProps:t.viewProps}):new qa(e,{parser:t=>t,props:mo.fromObject({formatter:Ja}),value:i,viewProps:t.viewProps})},api:t=>"string"!=typeof t.controller.value.rawValue?null:t.controller.valueController instanceof Va?new Ra(t.controller):null}),Bd=200,Hd=3,Nd=Er("mll");class Vd{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Nd()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("textarea");i.classList.add(Nd("i")),i.style.height=`calc(var(${vl("containerUnitSize")}) * ${e.rows})`,i.readOnly=!0,e.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.textareaElem_,e=t.scrollTop===t.scrollHeight-t.clientHeight,i=[];this.value.rawValue.forEach(t=>{void 0!==t&&i.push(this.formatter_(t))}),t.textContent=i.join("\n"),e&&(t.scrollTop=t.scrollHeight)}onValueUpdate_(){this.update_()}}class Fd{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Vd(t,{formatter:e.formatter,rows:e.rows,value:this.value,viewProps:this.viewProps})}}const Gd=Er("sgl");class Wd{constructor(t,e){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=e.formatter,this.element=t.createElement("div"),this.element.classList.add(Gd()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("input");i.classList.add(Gd("i")),i.readOnly=!0,i.type="text",e.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}update_(){const t=this.value.rawValue,e=t[t.length-1];this.inputElement.value=void 0!==e?this.formatter_(e):""}onValueUpdate_(){this.update_()}}class jd{constructor(t,e){this.value=e.value,this.viewProps=e.viewProps,this.view=new Wd(t,{formatter:e.formatter,value:this.value,viewProps:this.viewProps})}}const Ud=Kr({id:"monitor-bool",type:"monitor",accept:(t,e)=>{if("boolean"!=typeof t)return null;const i=ar(e,t=>({readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>$a},controller:t=>{var e;return 1===t.value.rawValue.length?new jd(t.document,{formatter:Ka,value:t.value,viewProps:t.viewProps}):new Fd(t.document,{formatter:Ka,rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:t.value,viewProps:t.viewProps})}});class qd extends ir{get max(){return this.controller.valueController.props.get("max")}set max(t){this.controller.valueController.props.set("max",t)}get min(){return this.controller.valueController.props.get("min")}set min(t){this.controller.valueController.props.set("min",t)}}const $d=Er("grl");class Kd{constructor(t,e){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=t.createElement("div"),this.element.classList.add($d()),e.viewProps.bindClassModifiers(this.element),this.formatter_=e.formatter,this.props_=e.props,this.cursor_=e.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=t.createElementNS(ur,"svg");i.classList.add($d("g")),i.style.height=`calc(var(${vl("containerUnitSize")}) * ${e.rows})`,this.element.appendChild(i),this.svgElem_=i;const n=t.createElementNS(ur,"polyline");this.svgElem_.appendChild(n),this.lineElem_=n;const s=t.createElement("div");s.classList.add($d("t"),Er("tt")()),this.element.appendChild(s),this.tooltipElem_=s,e.value.emitter.on("change",this.onValueUpdate_),this.value=e.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:t,clientHeight:e}=this.element,i=this.value.rawValue.length-1,n=this.props_.get("min"),s=this.props_.get("max"),o=[];this.value.rawValue.forEach((r,a)=>{if(void 0===r)return;const l=Ho(a,0,i,0,t),h=Ho(r,n,s,e,0);o.push([l,h].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const r=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(void 0===a)return void r.classList.remove($d("t","a"));const l=Ho(this.cursor_.rawValue,0,i,0,t),h=Ho(a,n,s,e,0);r.style.left=`${l}px`,r.style.top=`${h}px`,r.textContent=`${this.formatter_(a)}`,r.classList.contains($d("t","a"))||(r.classList.add($d("t","a"),$d("t","in")),pr(r),r.classList.remove($d("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Xd{constructor(t,e){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=e.props,this.value=e.value,this.viewProps=e.viewProps,this.cursor_=po(-1),this.view=new Kd(t,{cursor:this.cursor_,formatter:e.formatter,rows:e.rows,props:this.props,value:this.value,viewProps:this.viewProps}),mr(t)){const t=new ol(this.view.element);t.emitter.on("down",this.onGraphPointerDown_),t.emitter.on("move",this.onGraphPointerMove_),t.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}importProps(t){return lr(t,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return hr(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(t){const{clientWidth:e}=this.view.element;this.cursor_.rawValue=Math.floor(Ho(t.offsetX,0,e,0,this.value.rawValue.length))}onGraphPointerDown_(t){this.onGraphPointerMove_(t)}onGraphPointerMove_(t){t.data.point?this.cursor_.rawValue=Math.floor(Ho(t.data.point.x,0,t.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.rawValue=-1}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Yd(t){return Qs(t.format)?Bo(2):t.format}function Zd(t){return"graph"===t.view}const Jd=Kr({id:"monitor-number",type:"monitor",accept:(t,e)=>{if("number"!=typeof t)return null;const i=ar(e,t=>({format:t.optional.function,max:t.optional.number,min:t.optional.number,readonly:t.required.constant(!0),rows:t.optional.number,view:t.optional.string}));return i?{initialValue:t,params:i}:null},binding:{defaultBufferSize:t=>Zd(t)?64:1,reader:t=>zo},controller:t=>Zd(t.params)?function(t){var e,i,n;return new Xd(t.document,{formatter:Yd(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,props:mo.fromObject({max:null!==(i=t.params.max)&&void 0!==i?i:100,min:null!==(n=t.params.min)&&void 0!==n?n:0}),value:t.value,viewProps:t.viewProps})}(t):function(t){var e;return 1===t.value.rawValue.length?new jd(t.document,{formatter:Yd(t.params),value:t.value,viewProps:t.viewProps}):new Fd(t.document,{formatter:Yd(t.params),rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:t.value,viewProps:t.viewProps})}(t),api:t=>t.controller.valueController instanceof Xd?new qd(t.controller):null}),Qd=Kr({id:"monitor-string",type:"monitor",accept:(t,e)=>{if("string"!=typeof t)return null;const i=ar(e,t=>({multiline:t.optional.boolean,readonly:t.required.constant(!0),rows:t.optional.number}));return i?{initialValue:t,params:i}:null},binding:{reader:t=>Za},controller:t=>{var e;const i=t.value;return i.rawValue.length>1||t.params.multiline?new Fd(t.document,{formatter:Ja,rows:null!==(e=t.params.rows)&&void 0!==e?e:Hd,value:i,viewProps:t.viewProps}):new jd(t.document,{formatter:Ja,value:i,viewProps:t.viewProps})}});class tc{constructor(t){this.target=t.target,this.reader_=t.reader,this.writer_=t.writer}read(){return this.reader_(this.target.read())}write(t){this.writer_(this.target,t)}inject(t){this.write(this.reader_(t))}}class ec{constructor(t){this.target=t.target,this.reader_=t.reader}read(){return this.reader_(this.target.read())}}function ic(t,e){return 0===e?new Ma:new La(t,null!=e?e:Bd)}class nc{constructor(t){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=t}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(t,e){if(!(i=e.core)||i.major!==$r.major)throw ro.notCompatible(t,e.id);var i;"blade"===e.type?this.pluginsMap_.blades.unshift(e):"input"===e.type?this.pluginsMap_.inputs.unshift(e):"monitor"===e.type&&this.pluginsMap_.monitors.unshift(e)}createInput_(t,e,i){return this.pluginsMap_.inputs.reduce((n,s)=>null!=n?n:function(t,e){var i;const n=t.accept(e.target.read(),e.params);if(Qs(n))return null;const s={target:e.target,initialValue:n.initialValue,params:n.params},o=ar(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean,label:t.optional.string,tag:t.optional.string})),r=t.binding.reader(s),a=t.binding.constraint?t.binding.constraint(s):void 0,l=new tc({reader:r,target:e.target,writer:t.binding.writer(s)}),h=new nr(po(r(n.initialValue),{constraint:a,equals:t.binding.equals}),l),d=t.controller({constraint:a,document:e.document,initialValue:n.initialValue,params:n.params,value:h,viewProps:ga.create({disabled:null==o?void 0:o.disabled,hidden:null==o?void 0:o.hidden})});return new Dr(e.document,{blade:sa(),props:mo.fromObject({label:"label"in e.params?null!==(i=null==o?void 0:o.label)&&void 0!==i?i:null:e.target.key}),tag:null==o?void 0:o.tag,value:h,valueController:d})}(s,{document:t,target:e,params:i}),null)}createMonitor_(t,e,i){return this.pluginsMap_.monitors.reduce((n,s)=>null!=n?n:function(t,e){var i,n,s;const o=t.accept(e.target.read(),e.params);if(Qs(o))return null;const r={target:e.target,initialValue:o.initialValue,params:o.params},a=ar(e.params,t=>({bufferSize:t.optional.number,disabled:t.optional.boolean,hidden:t.optional.boolean,interval:t.optional.number,label:t.optional.string})),l=t.binding.reader(r),h=null!==(n=null!==(i=null==a?void 0:a.bufferSize)&&void 0!==i?i:t.binding.defaultBufferSize&&t.binding.defaultBufferSize(o.params))&&void 0!==n?n:1,d=new Br({binding:new ec({reader:l,target:e.target}),bufferSize:h,ticker:ic(e.document,null==a?void 0:a.interval)}),c=t.controller({document:e.document,params:o.params,value:d,viewProps:ga.create({disabled:null==a?void 0:a.disabled,hidden:null==a?void 0:a.hidden})});return c.viewProps.bindDisabled(d.ticker),c.viewProps.handleDispose(()=>{d.ticker.dispose()}),new Hr(e.document,{blade:sa(),props:mo.fromObject({label:"label"in e.params?null!==(s=null==a?void 0:a.label)&&void 0!==s?s:null:e.target.key}),value:d,valueController:c})}(s,{document:t,params:i,target:e}),null)}createBinding(t,e,i){if(Qs(e.read()))throw new ro({context:{key:e.key},type:"nomatchingcontroller"});const n=this.createInput_(t,e,i);if(n)return n;const s=this.createMonitor_(t,e,i);if(s)return s;throw new ro({context:{key:e.key},type:"nomatchingcontroller"})}createBlade(t,e){const i=this.pluginsMap_.blades.reduce((i,n)=>null!=i?i:function(t,e){const i=t.accept(e.params);if(!i)return null;const n=ar(e.params,t=>({disabled:t.optional.boolean,hidden:t.optional.boolean}));return t.controller({blade:sa(),document:e.document,params:Object.assign(Object.assign({},i.params),{disabled:null==n?void 0:n.disabled,hidden:null==n?void 0:n.hidden}),viewProps:ga.create({disabled:null==n?void 0:n.disabled,hidden:null==n?void 0:n.hidden})})}(n,{document:t,params:e}),null);if(!i)throw new ro({type:"nomatchingview",context:{params:e}});return i}createInputBindingApi_(t){const e=this.pluginsMap_.inputs.reduce((e,i)=>{var n,s;return e||(null!==(s=null===(n=i.api)||void 0===n?void 0:n.call(i,{controller:t}))&&void 0!==s?s:null)},null);return this.apiCache_.add(t,null!=e?e:new ir(t))}createMonitorBindingApi_(t){const e=this.pluginsMap_.monitors.reduce((e,i)=>{var n,s;return e||(null!==(s=null===(n=i.api)||void 0===n?void 0:n.call(i,{controller:t}))&&void 0!==s?s:null)},null);return this.apiCache_.add(t,null!=e?e:new ir(t))}createBindingApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return dr(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return so(e)&&"read"in e&&"write"in e}(t.value)}(t))return this.createInputBindingApi_(t);if(function(t){return dr(t)&&function(t){if(!("binding"in t))return!1;const e=t.binding;return so(e)&&"read"in e&&!("write"in e)}(t.value)}(t))return this.createMonitorBindingApi_(t);throw ro.shouldNeverHappen()}createApi(t){if(this.apiCache_.has(t))return this.apiCache_.get(t);if(function(t){return dr(t)&&cr(t.value)}(t))return this.createBindingApi(t);const e=this.pluginsMap_.blades.reduce((e,i)=>null!=e?e:i.api({controller:t,pool:this}),null);if(!e)throw ro.shouldNeverHappen();return this.apiCache_.add(t,e)}}const sc=new class{constructor(){this.map_=new Map}get(t){var e;return null!==(e=this.map_.get(t))&&void 0!==e?e:null}has(t){return this.map_.has(t)}add(t,e){return this.map_.set(t,e),t.viewProps.handleDispose(()=>{this.map_.delete(t)}),e}};class oc extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get options(){return this.controller.valueController.props.get("options")}set options(t){this.controller.valueController.props.set("options",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class rc extends Yo{}class ac extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(t){this.controller.valueController.sliderController.props.set("max",t)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(t){this.controller.valueController.sliderController.props.set("min",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}class lc extends Yo{constructor(t){super(t),this.emitter_=new lo,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new Jo(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(t){this.controller.labelController.props.set("label",t)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(t){this.controller.valueController.props.set("formatter",t)}get value(){return this.controller.value.rawValue}set value(t){this.controller.value.rawValue=t}on(t,e){const i=e.bind(this);return this.emitter_.on(t,t=>{i(t)},{key:e}),this}off(t,e){return this.emitter_.off(t,e),this}}const hc={id:"list",type:"blade",core:$r,accept(t){const e=ar(t,t=>({options:t.required.custom(za),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(t){const e=new Da(Oa(t.params.options)),i=po(t.params.value,{constraint:e}),n=new Va(t.document,{props:new mo({options:e.values.value("options")}),value:i,viewProps:t.viewProps});return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:i,valueController:n})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof Va?new oc(t.controller):null};class dc extends la{constructor(t,e){super(t,e)}get element(){return this.controller.view.element}}class cc extends ca{constructor(t,e){super(t,{expanded:e.expanded,blade:e.blade,props:e.props,root:!0,viewProps:e.viewProps})}}const uc=Er("spr");class pc{constructor(t,e){this.element=t.createElement("div"),this.element.classList.add(uc()),e.viewProps.bindClassModifiers(this.element);const i=t.createElement("hr");i.classList.add(uc("r")),this.element.appendChild(i)}}class mc extends Mr{constructor(t,e){super(Object.assign(Object.assign({},e),{view:new pc(t,{viewProps:e.viewProps})}))}}const gc={id:"separator",type:"blade",core:$r,accept(t){const e=ar(t,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller:t=>new mc(t.document,{blade:t.blade,viewProps:t.viewProps}),api:t=>t.controller instanceof mc?new rc(t.controller):null},fc={id:"slider",type:"blade",core:$r,accept(t){const e=ar(t,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(t){var e,i;const n=null!==(e=t.params.value)&&void 0!==e?e:0,s=new go({max:t.params.max,min:t.params.min}),o=po(n,{constraint:s}),r=new ml(t.document,Object.assign(Object.assign({},gl({formatter:null!==(i=t.params.format)&&void 0!==i?i:Oo,keyScale:po(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:jo(t.params,n)})),{parser:Do,value:o,viewProps:t.viewProps}));return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:o,valueController:r})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof ml?new ac(t.controller):null},vc={id:"text",type:"blade",core:$r,accept(t){const e=ar(t,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(t){var e;const i=po(t.params.value),n=new qa(t.document,{parser:t.params.parse,props:mo.fromObject({formatter:null!==(e=t.params.format)&&void 0!==e?e:t=>String(t)}),value:i,viewProps:t.viewProps});return new Lr(t.document,{blade:t.blade,props:mo.fromObject({label:t.params.label}),value:i,valueController:n})},api:t=>t.controller instanceof Lr&&t.controller.valueController instanceof qa?new lc(t.controller):null};class bc extends dc{constructor(t){var e,i;const n=null!=t?t:{},s=null!==(e=n.document)&&void 0!==e?e:globalThis.document,o=function(){const t=new nc(sc);return[Sd,Md,zd,Od,dd,sd,nd,ed,Pl,Ud,Qd,Jd,Xr,ua,Ia].forEach(e=>{t.register("core",e)}),t}();super(new cc(s,{expanded:n.expanded,blade:sa(),props:mo.fromObject({title:n.title}),viewProps:ga.create()}),o),this.pool_=o,this.containerElem_=null!==(i=n.container)&&void 0!==i?i:function(t){const e=t.createElement("div");return e.classList.add(Er("dfw")()),t.body&&t.body.appendChild(e),e}(s),this.containerElem_.appendChild(this.element),this.doc_=s,this.usesDefaultWrapper_=!n.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw ro.alreadyDisposed();return this.doc_}dispose(){const t=this.containerElem_;if(!t)throw ro.alreadyDisposed();if(this.usesDefaultWrapper_){const e=t.parentElement;e&&e.removeChild(t)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(t){t.css&&function(t,e,i){if(t.querySelector(`style[data-tp-style=${e}]`))return;const n=t.createElement("style");n.dataset.tpStyle=e,n.textContent=i,t.head.appendChild(n)}(this.document,`plugin-${t.id}`,t.css),("plugin"in t?[t.plugin]:"plugins"in t?t.plugins:[]).forEach(e=>{this.pool_.register(t.id,e)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[hc,gc,fc,Ia,vc]})}}new qr("4.0.5");var _c=i(790);const wc=[{key:"multiDragBox",label:"Show Multi-Drag Box",type:"boolean",default:!0},{key:"defaultRectWidth",label:"Default Rectangle Width",type:"number",default:50,min:10,max:300,step:1},{key:"defaultRectHeight",label:"Default Rectangle Height",type:"number",default:30,min:10,max:200,step:1},{key:"defaultCircleRadius",label:"Default Circle Radius",type:"number",default:15,min:4,max:100,step:1},{key:"defaultStrokeColor",label:"Default Stroke Color",type:"pickr",default:"#000000"},{key:"defaultFillColor",label:"Default Fill Color",type:"pickr",default:"#00000000"},{key:"canvasMaxWidth",label:"Canvas Max Width (px)",type:"number",default:430,min:100,max:4e3,step:10},{key:"canvasMaxHeight",label:"Canvas Max Height (px)",type:"number",default:9999,min:100,max:4e3,step:10},{key:"canvasScaleMode",label:"Image Scale Mode",type:"select",options:[{value:"fit",label:"Fit (aspect ratio, max width)"},{value:"fill",label:"Fill (aspect ratio, max w/h, may crop)"},{value:"stretch",label:"Stretch (fill max w/h, ignore ratio)"},{value:"actual",label:"Actual Size (image pixels, scroll if too large)"}],default:"fit"},{key:"canvasResponsive",label:"Responsive: Resize on Window Change",type:"boolean",default:!0},{key:"DEBUG_LOG_LEVEL",label:"Debug: Log Level",type:"select",options:[{value:"OFF",label:"Off"},{value:"ERROR",label:"Error"},{value:"WARN",label:"Warning"},{value:"INFO",label:"Info"},{value:"DEBUG",label:"Debug"},{value:"TRACE",label:"Trace (very verbose)"}],default:"OFF"},{key:"LOG_OUTPUT_DEST",label:"Log Output Destination",type:"select",options:[{value:"console",label:"Console Only"},{value:"server",label:"Remote Server Only"},{value:"both",label:"Both Console and Server"}],default:"console"},{key:"LOG_SERVER_URL",label:"Log Server URL",type:"text",default:""},{key:"LOG_SERVER_TOKEN",label:"Log Server Token",type:"text",default:""},{key:"INTERCEPT_CONSOLE",label:"Intercept All Console Logs (for Mobile/Dev)",type:"boolean",default:!1},{key:"showErrorLogPanel",label:"Show Error Log Panel",type:"boolean",default:!0}];async function yc(){Ot("TRACE","[settings] loadSettings entry");try{let t=await _c.getItem("sceneDesignerSettings")||{};t=function(t){let e={};return"undefined"!=typeof window&&window._settings&&"object"==typeof window._settings&&(e={...window._settings}),"undefined"!=typeof window&&window._externalLogServerURL&&(e.LOG_SERVER_URL=window._externalLogServerURL),"undefined"!=typeof window&&window._externalLogServerToken&&(e.LOG_SERVER_TOKEN=window._externalLogServerToken),{...t,...e}}(t);let e={};for(const i of wc)e[i.key]=i.key in t?t[i.key]:i.default;return Ft(e),Sc(e),Pc(e),Ot("DEBUG","[settings] Settings loaded",e),Ot("TRACE","[settings] loadSettings exit"),e}catch(t){throw Ot("ERROR","[settings] loadSettings error",t),Ot("TRACE","[settings] loadSettings exit (error)"),t}}async function Cc(){Ot("TRACE","[settings] saveSettings entry");try{await _c.setItem("sceneDesignerSettings",Bt.settings),Sc(Bt.settings),Pc(Bt.settings),Ot("DEBUG","[settings] Settings saved",Bt.settings),Ot("TRACE","[settings] saveSettings exit")}catch(t){throw Ot("ERROR","[settings] saveSettings error",t),Ot("TRACE","[settings] saveSettings exit (error)"),t}}_c.config({name:"scene-designer",storeName:"settings"});const xc=Gt;async function Ec(t,e){Ot("TRACE","[settings] setSettingAndSave entry",{key:t,value:e}),xc(t,e),await Cc(),Ot("DEBUG","[settings] setSettingAndSave",{key:t,value:e}),Ot("TRACE","[settings] setSettingAndSave exit")}function Sc(t){if(Ot("TRACE","[settings] updateLogConfigFromSettings entry",t),t){if("DEBUG_LOG_LEVEL"in t){let e=t.DEBUG_LOG_LEVEL;"OFF"!==e&&"off"!==e||(e="silent"),It(e)}"LOG_OUTPUT_DEST"in t&&Rt(t.LOG_OUTPUT_DEST),"LOG_SERVER_URL"in t&&Mt(t.LOG_SERVER_URL),"LOG_SERVER_TOKEN"in t&&Lt(t.LOG_SERVER_TOKEN),Ot("TRACE","[settings] updateLogConfigFromSettings exit")}else Ot("TRACE","[settings] updateLogConfigFromSettings exit (no settings)")}function Pc(t){Ot("TRACE","[settings] updateConsoleInterceptionFromSettings entry",t),t&&(t.INTERCEPT_CONSOLE?Zs()||(function({preserveOriginal:t=!0}={}){if(Xs)return;Xs=!0,Ys=Ys||{...console};const e={log:"INFO",info:"INFO",warn:"WARN",error:"ERROR",debug:"DEBUG",trace:"TRACE"};["log","info","warn","error","debug","trace"].forEach(i=>{console[i]=function(...n){try{Ot(e[i],...n)}catch(e){t&&Ys&&Ys[i]&&Ys[i].apply(console,n)}t&&Ys&&Ys[i]&&Ys[i].apply(console,n)}})}(),Ot("INFO","[settings] Console interception ENABLED")):Zs()&&(Xs&&Ys&&(["log","info","warn","error","debug","trace"].forEach(t=>{Ys[t]&&(console[t]=Ys[t])}),Xs=!1),Ot("INFO","[settings] Console interception DISABLED")),Ot("TRACE","[settings] updateConsoleInterceptionFromSettings exit"))}const kc=[];let Ic=null;function Rc(){if(!Ic)return;let t='<div id="error-log-scroll" style="overflow-y:auto;width:100%;height:100%;font-family:monospace;font-size:1em;background:#1a1a1a;color:#e6e6e6;padding:8px 6px;">';for(const e of kc)t+=`<div>${e}</div>`;t+="</div>",Ic.innerHTML=t,setTimeout(()=>{const t=Ic.querySelector("#error-log-scroll");t&&(t.scrollTop=t.scrollHeight)},1)}function Mc(t,...e){let i="#e6e6e6";"ERROR"===t?i="#ff5b6c":"WARN"===t?i="#ffe26b":"INFO"===t?i="#8be9fd":"DEBUG"===t?i="#b8e994":"TRACE"===t&&(i="#aaa");const n=`<span style="color:#666;">[${(new Date).toLocaleTimeString()}]</span> <span style="color:${i};">${t}</span> <span style="color:#e6e6e6;">${e.map(t=>"object"==typeof t?JSON.stringify(t):String(t)).join(" ")}</span>`;kc.push(n),kc.length>250&&kc.shift(),Rc()}Ot("INFO","[errorlog] errorlog.js module loaded and ready."),Ot("INFO","[layout] layout.js module loaded and ready!"),document.addEventListener("DOMContentLoaded",()=>{Ot("TRACE","[layout] DOMContentLoaded handler entry"),Ot("INFO","[layout] DOMContentLoaded fired");const t=document.getElementById("gl-root");if(Ot("INFO","[layout] glRoot found?",!!t,t),!t)return Ot("ERROR","[layout] #gl-root not found!"),void Ot("TRACE","[layout] DOMContentLoaded handler exit (no glRoot)");let e=!0;try{yc(),e=!1!==Wt("showErrorLogPanel"),Ot("DEBUG","[layout] Loaded settings, showErrorLogPanel:",e)}catch(t){Ot("ERROR","[layout] Error loading settings, defaulting showErrorLogPanel to true",t),e=!0}const i={root:{type:"row",content:[{type:"component",componentName:"SidebarPanel",title:"Sidebar",width:20},{type:"component",componentName:"CanvasPanel",title:"Canvas",width:60},{type:"component",componentName:"SettingsPanel",title:"Settings",width:20}]}};let n;e&&(i.root={type:"column",content:[i.root,{type:"component",componentName:"ErrorLogPanel",title:"Error Log",height:18}]},Ot("DEBUG","[layout] ErrorLogPanel added to layout"));try{Ot("INFO","[layout] About to create GoldenLayout instance..."),n=new yt(i,t),Ot("INFO","[layout] GoldenLayout instance created.")}catch(t){throw Ot("ERROR","[layout] ERROR while creating GoldenLayout instance:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (GoldenLayout error)"),t}try{n.registerComponent("SidebarPanel",t=>{Ot("TRACE","[layout] SidebarPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] SidebarPanel factory called",{title:t?.title,componentName:t?.componentName}),function(t,e){Ot("TRACE","[sidebar] buildSidebarPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{function i(){Ot("TRACE","[sidebar] makeTableData entry");const t=(Bt.shapes||[]).map((t,e)=>{const i=function(t){Ot("TRACE","[sidebar] getShapeAttrs entry",{s:t});try{if(!t||"function"!=typeof t.getAttrs)return Ot("TRACE","[sidebar] getShapeAttrs exit (no getAttrs)"),{};const e=t.getAttrs();return Ot("TRACE","[sidebar] getShapeAttrs exit",{attrs:e}),e}catch(t){return Ot("ERROR","[sidebar] getShapeAttrs error",t),Ot("TRACE","[sidebar] getShapeAttrs exit (error)"),{}}}(t);let n=0,s=0,o=0,r=0;return"rect"===t._type?(n=i.x,s=i.y,o=i.width,r=i.height):"circle"===t._type?(n=i.x,s=i.y,o=i.radius,r=i.radius):"point"===t._type&&(n=i.x,s=i.y,o="--",r="--"),{idx:e+1,label:t._label||"",type:t._type||"",locked:t.locked?"🔒":"",fillColor:t.fill?t.fill():"",strokeColor:t.stroke?t.stroke():"",x:Math.round(n),y:Math.round(s),w:o,h:r,_shape:t,selected:Bt.selectedShapes.includes(t)}});return Ot("TRACE","[sidebar] makeTableData exit",{rowCount:t.length}),t}Ot("INFO","[sidebar] buildSidebarPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),t.innerHTML='\n      <div id="sidebar-panel-container" style="width:100%;height:100%;background:#f4f8ff;display:flex;flex-direction:column;overflow:auto;">\n        <div style="padding:10px 8px 4px 8px;font-weight:bold;font-size:1.2em;color:#0057d8;">\n          Shape List\n          <button id="sidebar-select-all" style="float:right;font-size:0.9em;">Select All</button>\n        </div>\n        <div id="sidebar-table-div" style="flex:1 1 0;overflow:auto;"></div>\n      </div>\n    ',t.querySelector("#sidebar-select-all").onclick=()=>{Ot("TRACE","[sidebar] sidebar-select-all onclick entry"),Nt(Bt.shapes.slice()),Ot("INFO","[sidebar] Select All clicked"),Re&&Re.replaceData(i()),Ot("TRACE","[sidebar] sidebar-select-all onclick exit")};const n=[{title:"#",field:"idx",width:45,hozAlign:"center"},{title:"Label",field:"label",editor:"input",widthGrow:2},{title:"Type",field:"type",width:70},{title:"L",field:"locked",width:36,hozAlign:"center"},{title:"F",field:"fillColor",width:36,hozAlign:"center",formatter:t=>Me(t.getValue())},{title:"S",field:"strokeColor",width:36,hozAlign:"center",formatter:t=>Me(t.getValue())},{title:"X",field:"x",width:50},{title:"Y",field:"y",width:50},{title:"W/R",field:"w",width:50},{title:"H",field:"h",width:50}],s=t.querySelector("#sidebar-table-div");if(s.innerHTML="",Re&&"function"==typeof Re.destroy&&(Ot("TRACE","[sidebar] destroying old tabulatorInstance"),Re.destroy(),Re=null),Ot("TRACE","[sidebar] instantiating Tabulator"),Re=new Ie(s,{data:i(),layout:"fitColumns",columns:n,height:"100%",selectable:!0,rowFormatter:function(t){Ot("TRACE","[sidebar] Tabulator rowFormatter entry",{rowData:t.getData()}),t.getData().selected?t.getElement().style.background="#d0e7ff":t.getElement().style.background="",Ot("TRACE","[sidebar] Tabulator rowFormatter exit")},rowClick:function(t,e){Ot("TRACE","[sidebar] Tabulator rowClick entry",{idx:e.getData().idx-1}),Nt([e.getData()._shape]),Ot("INFO","[sidebar] Shape row clicked",{idx:e.getData().idx-1}),Re.replaceData(i()),Ot("TRACE","[sidebar] Tabulator rowClick exit")},cellEdited:function(t){Ot("TRACE","[sidebar] Tabulator cellEdited entry",{cell:t});const e=t.getField(),i=t.getData()._shape;"label"===e&&i&&(i._label=t.getValue(),Ot("DEBUG","[sidebar] Label edited",{newLabel:t.getValue(),shapeType:i._type,shapeId:i._id})),Ot("TRACE","[sidebar] Tabulator cellEdited exit")}}),!t._appStateUnsub){Ot("TRACE","[sidebar] registering AppState update subscriber");const o=()=>{Ot("TRACE","[sidebar] AppState update triggered"),Re&&Re.replaceData(i())};Bt._subscribers=Bt._subscribers||[],Bt._subscribers.push(o),t._appStateUnsub=o,e&&"function"==typeof e.on&&e.on("destroy",()=>{Ot("TRACE","[sidebar] panel destroy event");const t=Bt._subscribers.indexOf(o);-1!==t&&Bt._subscribers.splice(t,1)})}Ot("INFO","[sidebar] Sidebar panel fully initialized (Tabulator)")}catch(r){throw Ot("ERROR","[sidebar] buildSidebarPanel ERROR",r),alert("SidebarPanel ERROR: "+r.message),Ot("TRACE","[sidebar] buildSidebarPanel exit (error)"),r}Ot("TRACE","[sidebar] buildSidebarPanel exit",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName})}(t.element,t),Ot("TRACE","[layout] SidebarPanel factory exit")}),n.registerComponent("CanvasPanel",t=>{Ot("TRACE","[layout] CanvasPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] CanvasPanel factory called",{title:t?.title,componentName:t?.componentName}),function(t,e){Ot("TRACE","[canvas] buildCanvasPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{Ot("INFO","[canvas] buildCanvasPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),t.innerHTML='\n      <div id="canvas-panel-container" style="width:100%;height:100%;position:relative;">\n        <div id="canvas-toolbar-main" style="display:flex;flex-wrap:wrap;align-items:center;padding:6px 8px 4px 8px;background:#f7f7fa;border-bottom:1px solid #bbb;">\n          <input type="file" id="canvas-image-upload" accept="image/*" style="display:inline-block;">\n          <select id="canvas-server-image-select" style="margin-left:6px;">\n            <option value="">[Server image]</option>\n            <option value="sample1.png">sample1.png</option>\n            <option value="sample2.png">sample2.png</option>\n          </select>\n          <span style="margin-left:12px;">Shape:</span>\n          <select id="shape-type-select" style="margin-left:4px;">\n            <option value="point">Point</option>\n            <option value="rect">Rectangle</option>\n            <option value="circle">Circle</option>\n          </select>\n          <button id="add-shape-btn" style="margin-left:4px;">Add</button>\n          <button id="delete-shape-btn" style="margin-left:12px;">Delete</button>\n          <button id="duplicate-shape-btn" style="margin-left:4px;">Duplicate</button>\n          <button id="align-left-btn" style="margin-left:12px;">Align Left</button>\n          <button id="align-center-btn">Align Center</button>\n          <button id="align-right-btn">Align Right</button>\n          <button id="align-top-btn" style="margin-left:4px;">Align Top</button>\n          <button id="align-middle-btn">Align Middle</button>\n          <button id="align-bottom-btn">Align Bottom</button>\n          <button id="select-all-btn" style="margin-left:12px;">Select All</button>\n          <button id="lock-btn" style="margin-left:14px;">Lock</button>\n          <button id="unlock-btn" style="margin-left:4px;">Unlock</button>\n        </div>\n        <div id="konva-stage-div" style="width:100%;height:calc(100% - 44px);background:#eee;"></div>\n      </div>\n    ';const i=t.querySelector("#canvas-image-upload"),n=t.querySelector("#canvas-server-image-select");Ot("TRACE","[canvas] image upload DOM nodes",{imageUploadType:typeof i,serverImageSelectType:typeof n}),i?i.addEventListener("change",function(t){Ot("TRACE","[canvas] imageUpload changed",t);const e=t.target.files&&t.target.files[0];if(!e)return;const i=new FileReader;i.onload=function(t){Ot("TRACE","[canvas] FileReader onload",{resultLen:t.target.result.length}),Vt(t.target.result,null),n&&(n.value="")},i.readAsDataURL(e)}):Ot("ERROR","[canvas] imageUpload element not found in DOM"),n?n.addEventListener("change",function(t){Ot("TRACE","[canvas] serverImageSelect changed",t);const e=t.target.value;e?(Vt("./images/"+e,null),i&&(i.value="")):Vt(null,null)}):Ot("ERROR","[canvas] serverImageSelect element not found in DOM"),Ot("INFO","[canvas] Canvas panel fully initialized")}catch(t){throw Ot("ERROR","[canvas] buildCanvasPanel ERROR",t),alert("CanvasPanel ERROR: "+t.message),Ot("TRACE","[canvas] buildCanvasPanel exit (error)"),t}Ot("TRACE","[canvas] buildCanvasPanel exit",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName})}(t.element,t),Ot("TRACE","[layout] CanvasPanel factory exit")}),n.registerComponent("SettingsPanel",t=>{Ot("TRACE","[layout] SettingsPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] SettingsPanel factory called",{title:t?.title,componentName:t?.componentName}),t.on("open",()=>{Ot("TRACE","[layout] SettingsPanel container 'open' event"),function(t,e){Ot("TRACE","[settings] buildSettingsPanel entry",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName});try{if(Ot("INFO","[settings] buildSettingsPanel called",{rootElementType:t?.tagName,containerTitle:e?.title,containerComponentName:e?.componentName}),!t)return Ot("ERROR","[settings] buildSettingsPanel: rootElement is null or undefined"),void alert("Settings panel root element not found! (No content will be shown)");if(null===t.offsetParent&&Ot("ERROR","[settings] buildSettingsPanel: rootElement is not visible (may be hidden)"),Ot("DEBUG","[settings] Tweakpane import check",{PaneType:typeof bc,Pane:bc}),Ot("DEBUG","[settings] Pickr import check",{PickrType:typeof Js,Pickr:Js}),Ot("DEBUG","[settings] settingsRegistry length",{len:wc.length}),"function"!=typeof bc)return t.innerHTML="<div style=\"color:red;padding:2em;\">Settings panel failed: Tweakpane (Pane) not loaded as ES module.<br>\n      Check your webpack and npm dependencies: tweakpane@4.x must be imported as <code>import { Pane } from 'tweakpane'</code>.</div>",void Ot("ERROR","[settings] Pane (Tweakpane) is not a constructor/function! Check import.");yc().then(()=>{Ot("TRACE","[settings] buildSettingsPanel after loadSettings (resolved)",{AppStateSettings:Bt.settings});const e={};for(const t of wc)t.key in Bt.settings||(Bt.settings[t.key]=t.default),e[t.key]=Bt.settings[t.key];Ot("DEBUG","[settings] settingsPOJO plain object check",{proto:Object.getPrototypeOf(e),isPlain:Object.getPrototypeOf(e)===Object.prototype}),t.innerHTML='\n          <div id="settings-panel-container" style="width:100%;height:100%;background:#e7f8eb;display:flex;flex-direction:column;overflow:auto;">\n            <div style="padding:10px 8px 4px 8px;font-weight:bold;font-size:1.2em;color:#0a6e2c;">\n              Settings\n              <button id="settings-save-btn" style="float:right;font-size:0.9em;">Save</button>\n            </div>\n            <div id="tweakpane-fields-div" style="flex:1 1 0;overflow:auto;padding:0 8px 8px 8px;"></div>\n          </div>\n        ';const i=t.querySelector("#tweakpane-fields-div"),n=t.querySelector("#settings-save-btn");if(!i)return Ot("ERROR","[settings] tweakpane-fields-div not found in DOM"),t.innerHTML='<div style="color:red;padding:2em;">Settings panel failed to render (missing tweakpane-fields-div)</div>',void Ot("TRACE","[settings] buildSettingsPanel exit (missing fieldsDiv)");let s;try{s=new bc({container:i,title:"Settings",expanded:!0})}catch(t){return Ot("ERROR","[settings] Tweakpane instantiation failed",t),i.innerHTML=`<div style="color:red;padding:2em;">Settings panel failed: Tweakpane error (${t.message})</div>`,void Ot("TRACE","[settings] buildSettingsPanel exit (Tweakpane failed)")}const o={};wc.forEach(t=>{const n=t.key;try{if(Ot("DEBUG","[settings] addInput plainness",{key:n,value:e[n],hasKey:Object.prototype.hasOwnProperty.call(e,n),isPlain:Object.getPrototypeOf(e)===Object.prototype}),"boolean"===t.type)s.addInput(e,n,{label:t.label}).on("change",t=>{e[n]=t.value,Ec(n,t.value)});else if("number"===t.type)s.addInput(e,n,{label:t.label,min:t.min,max:t.max,step:t.step}).on("change",t=>{e[n]=t.value,Ec(n,t.value)});else if("pickr"===t.type){const s=document.createElement("div");s.id="pickr-"+n,s.style.display="inline-block",s.style.verticalAlign="middle",s.style.marginLeft="1em";const r=document.createElement("label");r.textContent=t.label,r.style.marginRight="0.7em";const a=document.createElement("div");a.style.margin="0.4em 0",a.appendChild(r),a.appendChild(s),i.appendChild(a),setTimeout(()=>{o[n]&&(o[n].destroyAndRemove(),delete o[n]),o[n]=Js.create({el:"#"+s.id,theme:"monolith",default:e[n],components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!0,rgba:!0,input:!0}}}),o[n].on("change",t=>{const i=t.toHEXA().toString();e[n]=i,Ec(n,i)}),o[n].setColor(e[n])},1)}else"select"===t.type?s.addInput(e,n,{label:t.label,options:t.options.reduce((t,e)=>(t[e.value]=e.label,t),{})}).on("change",t=>{e[n]=t.value,Ec(n,t.value)}):"text"===t.type&&s.addInput(e,n,{label:t.label}).on("change",t=>{e[n]=t.value,Ec(n,t.value)})}catch(e){Ot("ERROR","[settings] Error rendering registry field",{key:n,reg:t,error:e})}}),n?n.onclick=async()=>{await Cc(),Ot("INFO","[settings] Settings saved by user"),alert("Settings saved!")}:Ot("WARN","[settings] Save button not found"),Ot("INFO","[settings] Settings panel rendered (Tweakpane)"),Ot("TRACE","[settings] buildSettingsPanel exit (rendered)")}).catch(e=>{Ot("ERROR","[settings] Error in loadSettings().then for buildSettingsPanel",e),t.innerHTML=`<div style="color:red;padding:2em;">Settings failed to load: ${e.message}</div>`,Ot("TRACE","[settings] buildSettingsPanel exit (loadSettings error)")})}catch(t){throw Ot("ERROR","[settings] buildSettingsPanel ERROR",t),alert("SettingsPanel ERROR: "+t.message),Ot("TRACE","[settings] buildSettingsPanel exit (error)"),t}}(t.element,t)}),Ot("TRACE","[layout] SettingsPanel factory exit")}),n.registerComponent("ErrorLogPanel",t=>{var e;Ot("TRACE","[layout] ErrorLogPanel factory entry",{title:t?.title,componentName:t?.componentName}),Ot("INFO","[layout] ErrorLogPanel factory called",{title:t?.title,componentName:t?.componentName}),e=t.element,Ic=e,e.innerHTML='<div style="color:#888;font-family:monospace;">Error Log initializing...</div>',Rc(),Ot("TRACE","[layout] ErrorLogPanel factory exit")}),("function"==typeof(s=Mc)||s&&"function"==typeof s.sinkLog)&&kt.push(s),Ot("DEBUG","[layout] All panel factories registered, log sink registered")}catch(t){throw Ot("ERROR","[layout] ERROR in registerComponent:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (registerComponent error)"),t}var s;try{Ot("INFO","[layout] Calling layout.init..."),n.init(),Ot("INFO","[layout] layout.init called, done.")}catch(t){throw Ot("ERROR","[layout] ERROR during layout.init:",t?.message||t),Ot("TRACE","[layout] DOMContentLoaded handler exit (layout.init error)"),t}Ot("TRACE","[layout] DOMContentLoaded handler exit")})})()})();...
/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={790:(t,e,i)=>{t.exports=function t(e,i,n){function s(r,a){if(!i[r]){if(!e[r]){if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return s(e[r][1][t]||t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o=void 0,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,n){(function(t){"use strict";var i,n,s=t.MutationObserver||t.WebKitMutationObserver;if(s){var o=0,r=new s(d),a=t.document.createTextNode("");r.observe(a,{characterData:!0}),i=function(){a.data=o=++o%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){d(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(d,0)};else{var l=new t.MessageChannel;l.port1.onmessage=d,i=function(){l.port2.postMessage(0)}}var h=[];function d(){var t,e;n=!0;for(var i=h.length;i;){for(e=h,h=[],t=-1;++t<i;)e[t]();i=h.length}n=!1}e.exports=function(t){1!==h.push(t)||n||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,i){"use strict";var n=t(1);function s(){}var o={},r=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function h(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,t!==s&&p(this,t)}function d(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function c(t,e,i){n(function(){var n;try{n=e(i)}catch(e){return o.reject(t,e)}n===t?o.reject(t,new TypeError("Cannot resolve promise with itself")):o.resolve(t,n)})}function u(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var i=!1;function n(e){i||(i=!0,o.reject(t,e))}function s(e){i||(i=!0,o.resolve(t,e))}var r=m(function(){e(s,n)});"error"===r.status&&n(r.value)}function m(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}e.exports=h,h.prototype.catch=function(t){return this.then(null,t)},h.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===r)return this;var i=new this.constructor(s);return this.state!==l?c(i,this.state===a?t:e,this.outcome):this.queue.push(new d(i,t,e)),i},d.prototype.callFulfilled=function(t){o.resolve(this.promise,t)},d.prototype.otherCallFulfilled=function(t){c(this.promise,this.onFulfilled,t)},d.prototype.callRejected=function(t){o.reject(this.promise,t)},d.prototype.otherCallRejected=function(t){c(this.promise,this.onRejected,t)},o.resolve=function(t,e){var i=m(u,e);if("error"===i.status)return o.reject(t,i.value);var n=i.value;if(n)p(t,n);else{t.state=a,t.outcome=e;for(var s=-1,r=t.queue.length;++s<r;)t.queue[s].callFulfilled(e)}return t},o.reject=function(t,e){t.state=r,t.outcome=e;for(var i=-1,n=t.queue.length;++i<n;)t.queue[i].callRejected(e);return t},h.resolve=function(t){return t instanceof this?t:o.resolve(new this(s),t)},h.reject=function(t){var e=new this(s);return o.reject(e,t)},h.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var r=new Array(i),a=0,l=-1,h=new this(s);++l<i;)d(t[l],l);return h;function d(t,s){e.resolve(t).then(function(t){r[s]=t,++a!==i||n||(n=!0,o.resolve(h,r))},function(t){n||(n=!0,o.reject(h,t))})}},h.race=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,n=!1;if(!i)return this.resolve([]);for(var r=-1,a=new this(s);++r<i;)l(t[r]);return a;function l(t){e.resolve(t).then(function(t){n||(n=!0,o.resolve(a,t))},function(t){n||(n=!0,o.reject(a,t))})}}},{1:1}],3:[function(t,e,n){(function(e){"use strict";"function"!=typeof e.Promise&&(e.Promise=t(2))}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(t,e,i){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var s=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(t){return}}();function o(t,e){t=t||[],e=e||{};try{return new Blob(t,e)}catch(s){if("TypeError"!==s.name)throw s;for(var i=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<t.length;n+=1)i.append(t[n]);return i.getBlob(e.type)}}"undefined"==typeof Promise&&t(3);var r=Promise;function a(t,e){e&&t.then(function(t){e(null,t)},function(t){e(t)})}function l(t,e,i){"function"==typeof e&&t.then(e),"function"==typeof i&&t.catch(i)}function h(t){return"string"!=typeof t&&(console.warn(t+" used as a key, but it is not a string."),t=String(t)),t}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var c="local-forage-detect-blob-support",u=void 0,p={},m=Object.prototype.toString,g="readonly",f="readwrite";function v(t){for(var e=t.length,i=new ArrayBuffer(e),n=new Uint8Array(i),s=0;s<e;s++)n[s]=t.charCodeAt(s);return i}function b(t){return"boolean"==typeof u?r.resolve(u):function(t){return new r(function(e){var i=t.transaction(c,f),n=o([""]);i.objectStore(c).put(n,"key"),i.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},i.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),i=navigator.userAgent.match(/Edge\//);e(i||!t||parseInt(t[1],10)>=43)}}).catch(function(){return!1})}(t).then(function(t){return u=t})}function _(t){var e=p[t.name],i={};i.promise=new r(function(t,e){i.resolve=t,i.reject=e}),e.deferredOperations.push(i),e.dbReady?e.dbReady=e.dbReady.then(function(){return i.promise}):e.dbReady=i.promise}function w(t){var e=p[t.name].deferredOperations.pop();if(e)return e.resolve(),e.promise}function y(t,e){var i=p[t.name].deferredOperations.pop();if(i)return i.reject(e),i.promise}function C(t,e){return new r(function(i,n){if(p[t.name]=p[t.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},t.db){if(!e)return i(t.db);_(t),t.db.close()}var o=[t.name];e&&o.push(t.version);var r=s.open.apply(s,o);e&&(r.onupgradeneeded=function(e){var i=r.result;try{i.createObjectStore(t.storeName),e.oldVersion<=1&&i.createObjectStore(c)}catch(i){if("ConstraintError"!==i.name)throw i;console.warn('The database "'+t.name+'" has been upgraded from version '+e.oldVersion+" to version "+e.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),r.onerror=function(t){t.preventDefault(),n(r.error)},r.onsuccess=function(){var e=r.result;e.onversionchange=function(t){t.target.close()},i(e),w(t)}})}function x(t){return C(t,!1)}function E(t){return C(t,!0)}function S(t,e){if(!t.db)return!0;var i=!t.db.objectStoreNames.contains(t.storeName),n=t.version<t.db.version,s=t.version>t.db.version;if(n&&(t.version!==e&&console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),s||i){if(i){var o=t.db.version+1;o>t.version&&(t.version=o)}return!0}return!1}function P(t){return o([v(atob(t.data))],{type:t.type})}function k(t){return t&&t.__local_forage_encoded_blob}function I(t){var e=this,i=e._initReady().then(function(){var t=p[e._dbInfo.name];if(t&&t.dbReady)return t.dbReady});return l(i,t,t),i}function R(t,e,i,n){void 0===n&&(n=1);try{var s=t.db.transaction(t.storeName,e);i(null,s)}catch(s){if(n>0&&(!t.db||"InvalidStateError"===s.name||"NotFoundError"===s.name))return r.resolve().then(function(){if(!t.db||"NotFoundError"===s.name&&!t.db.objectStoreNames.contains(t.storeName)&&t.version<=t.db.version)return t.db&&(t.version=t.db.version+1),E(t)}).then(function(){return function(t){_(t);for(var e=p[t.name],i=e.forages,n=0;n<i.length;n++){var s=i[n];s._dbInfo.db&&(s._dbInfo.db.close(),s._dbInfo.db=null)}return t.db=null,x(t).then(function(e){return t.db=e,S(t)?E(t):e}).then(function(n){t.db=e.db=n;for(var s=0;s<i.length;s++)i[s]._dbInfo.db=n}).catch(function(e){throw y(t,e),e})}(t).then(function(){R(t,e,i,n-1)})}).catch(i);i(s)}}var M={_driver:"asyncStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]=t[n];var s=p[i.name];s||(s={forages:[],db:null,dbReady:null,deferredOperations:[]},p[i.name]=s),s.forages.push(e),e._initReady||(e._initReady=e.ready,e.ready=I);var o=[];function a(){return r.resolve()}for(var l=0;l<s.forages.length;l++){var h=s.forages[l];h!==e&&o.push(h._initReady().catch(a))}var d=s.forages.slice(0);return r.all(o).then(function(){return i.db=s.db,x(i)}).then(function(t){return i.db=t,S(i,e._defaultConfig.version)?E(i):t}).then(function(t){i.db=s.db=t,e._dbInfo=i;for(var n=0;n<d.length;n++){var o=d[n];o!==e&&(o._dbInfo.db=i.db,o._dbInfo.version=i.version)}})},_support:function(){try{if(!s||!s.open)return!1;var t="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),e="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!t||e)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).openCursor(),a=1;r.onsuccess=function(){var i=r.result;if(i){var n=i.value;k(n)&&(n=P(n));var s=t(n,i.key,a++);void 0!==s?e(s):i.continue()}else e()},r.onerror=function(){n(r.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).get(t);r.onsuccess=function(){var t=r.result;void 0===t&&(t=null),k(t)&&(t=P(t)),e(t)},r.onerror=function(){n(r.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){var n=this;t=h(t);var s=new r(function(i,s){var o;n.ready().then(function(){return o=n._dbInfo,"[object Blob]"===m.call(e)?b(o.db).then(function(t){return t?e:(i=e,new r(function(t,e){var n=new FileReader;n.onerror=e,n.onloadend=function(e){var n=btoa(e.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:i.type})},n.readAsBinaryString(i)}));var i}):e}).then(function(e){R(n._dbInfo,f,function(o,r){if(o)return s(o);try{var a=r.objectStore(n._dbInfo.storeName);null===e&&(e=void 0);var l=a.put(e,t);r.oncomplete=function(){void 0===e&&(e=null),i(e)},r.onabort=r.onerror=function(){var t=l.error?l.error:l.transaction.error;s(t)}}catch(t){s(t)}})}).catch(s)});return a(s,i),s},removeItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){R(i._dbInfo,f,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName).delete(t);o.oncomplete=function(){e()},o.onerror=function(){n(r.error)},o.onabort=function(){var t=r.error?r.error:r.transaction.error;n(t)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,f,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).clear();s.oncomplete=function(){t()},s.onabort=s.onerror=function(){var t=o.error?o.error:o.transaction.error;i(t)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,g,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).count();o.onsuccess=function(){t(o.result)},o.onerror=function(){i(o.error)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new r(function(e,n){t<0?e(null):i.ready().then(function(){R(i._dbInfo,g,function(s,o){if(s)return n(s);try{var r=o.objectStore(i._dbInfo.storeName),a=!1,l=r.openKeyCursor();l.onsuccess=function(){var i=l.result;i?0===t||a?e(i.key):(a=!0,i.advance(t)):e(null)},l.onerror=function(){n(l.error)}}catch(t){n(t)}})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){R(e._dbInfo,g,function(n,s){if(n)return i(n);try{var o=s.objectStore(e._dbInfo.storeName).openKeyCursor(),r=[];o.onsuccess=function(){var e=o.result;e?(r.push(e.key),e.continue()):t(r)},o.onerror=function(){i(o.error)}}catch(t){i(t)}})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i,n=this.config();if((t="function"!=typeof t&&t||{}).name||(t.name=t.name||n.name,t.storeName=t.storeName||n.storeName),t.name){var o=t.name===n.name&&this._dbInfo.db?r.resolve(this._dbInfo.db):x(t).then(function(e){var i=p[t.name],n=i.forages;i.db=e;for(var s=0;s<n.length;s++)n[s]._dbInfo.db=e;return e});i=t.storeName?o.then(function(e){if(e.objectStoreNames.contains(t.storeName)){var i=e.version+1;_(t);var n=p[t.name],o=n.forages;e.close();for(var a=0;a<o.length;a++){var l=o[a];l._dbInfo.db=null,l._dbInfo.version=i}var h=new r(function(e,n){var o=s.open(t.name,i);o.onerror=function(t){o.result.close(),n(t)},o.onupgradeneeded=function(){o.result.deleteObjectStore(t.storeName)},o.onsuccess=function(){var t=o.result;t.close(),e(t)}});return h.then(function(t){n.db=t;for(var e=0;e<o.length;e++){var i=o[e];i._dbInfo.db=t,w(i._dbInfo)}}).catch(function(e){throw(y(t,e)||r.resolve()).catch(function(){}),e})}}):o.then(function(e){_(t);var i=p[t.name],n=i.forages;e.close();for(var o=0;o<n.length;o++)n[o]._dbInfo.db=null;var a=new r(function(e,i){var n=s.deleteDatabase(t.name);n.onerror=function(){var t=n.result;t&&t.close(),i(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+t.name+'" until all open connections are closed')},n.onsuccess=function(){var t=n.result;t&&t.close(),e(t)}});return a.then(function(t){i.db=t;for(var e=0;e<n.length;e++)w(n[e]._dbInfo)}).catch(function(e){throw(y(t,e)||r.resolve()).catch(function(){}),e})})}else i=r.reject("Invalid arguments");return a(i,e),i}};var L="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",T=/^~~local_forage_type~([^~]+)~/,A="__lfsc__:",D="arbf",z="blob",O="si08",B="ui08",H="uic8",N="si16",V="si32",F="ur16",G="ui32",W="fl32",j="fl64",U=Object.prototype.toString;function q(t){var e,i,n,s,o,r=.75*t.length,a=t.length,l=0;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);var h=new ArrayBuffer(r),d=new Uint8Array(h);for(e=0;e<a;e+=4)i=L.indexOf(t[e]),n=L.indexOf(t[e+1]),s=L.indexOf(t[e+2]),o=L.indexOf(t[e+3]),d[l++]=i<<2|n>>4,d[l++]=(15&n)<<4|s>>2,d[l++]=(3&s)<<6|63&o;return h}function $(t){var e,i=new Uint8Array(t),n="";for(e=0;e<i.length;e+=3)n+=L[i[e]>>2],n+=L[(3&i[e])<<4|i[e+1]>>4],n+=L[(15&i[e+1])<<2|i[e+2]>>6],n+=L[63&i[e+2]];return i.length%3==2?n=n.substring(0,n.length-1)+"=":i.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var K={serialize:function(t,e){var i="";if(t&&(i=U.call(t)),t&&("[object ArrayBuffer]"===i||t.buffer&&"[object ArrayBuffer]"===U.call(t.buffer))){var n,s=A;t instanceof ArrayBuffer?(n=t,s+=D):(n=t.buffer,"[object Int8Array]"===i?s+=O:"[object Uint8Array]"===i?s+=B:"[object Uint8ClampedArray]"===i?s+=H:"[object Int16Array]"===i?s+=N:"[object Uint16Array]"===i?s+=F:"[object Int32Array]"===i?s+=V:"[object Uint32Array]"===i?s+=G:"[object Float32Array]"===i?s+=W:"[object Float64Array]"===i?s+=j:e(new Error("Failed to get type for BinaryArray"))),e(s+$(n))}else if("[object Blob]"===i){var o=new FileReader;o.onload=function(){var i="~~local_forage_type~"+t.type+"~"+$(this.result);e(A+z+i)},o.readAsArrayBuffer(t)}else try{e(JSON.stringify(t))}catch(i){console.error("Couldn't convert value into a JSON string: ",t),e(null,i)}},deserialize:function(t){if(t.substring(0,9)!==A)return JSON.parse(t);var e,i=t.substring(13),n=t.substring(9,13);if(n===z&&T.test(i)){var s=i.match(T);e=s[1],i=i.substring(s[0].length)}var r=q(i);switch(n){case D:return r;case z:return o([r],{type:e});case O:return new Int8Array(r);case B:return new Uint8Array(r);case H:return new Uint8ClampedArray(r);case N:return new Int16Array(r);case F:return new Uint16Array(r);case V:return new Int32Array(r);case G:return new Uint32Array(r);case W:return new Float32Array(r);case j:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:q,bufferToString:$};function X(t,e,i,n){t.executeSql("CREATE TABLE IF NOT EXISTS "+e.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],i,n)}function Y(t,e,i,n,s,o){t.executeSql(i,n,s,function(t,r){r.code===r.SYNTAX_ERR?t.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[e.storeName],function(t,a){a.rows.length?o(t,r):X(t,e,function(){t.executeSql(i,n,s,o)},o)},o):o(t,r)},o)}function Z(t,e,i,n){var s=this;t=h(t);var o=new r(function(o,r){s.ready().then(function(){void 0===e&&(e=null);var a=e,l=s._dbInfo;l.serializer.serialize(e,function(e,h){h?r(h):l.db.transaction(function(i){Y(i,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[t,e],function(){o(a)},function(t,e){r(e)})},function(e){if(e.code===e.QUOTA_ERR){if(n>0)return void o(Z.apply(s,[t,a,i,n-1]));r(e)}})})}).catch(r)});return a(o,i),o}var J={_driver:"webSQLStorage",_initStorage:function(t){var e=this,i={db:null};if(t)for(var n in t)i[n]="string"!=typeof t[n]?t[n].toString():t[n];var s=new r(function(t,n){try{i.db=openDatabase(i.name,String(i.version),i.description,i.size)}catch(t){return n(t)}i.db.transaction(function(s){X(s,i,function(){e._dbInfo=i,t()},function(t,e){n(e)})},n)});return i.serializer=K,s},_support:"function"==typeof openDatabase,iterate:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT * FROM "+s.storeName,[],function(i,n){for(var o=n.rows,r=o.length,a=0;a<r;a++){var l=o.item(a),h=l.value;if(h&&(h=s.serializer.deserialize(h)),void 0!==(h=t(h,l.key,a+1)))return void e(h)}e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT * FROM "+s.storeName+" WHERE key = ? LIMIT 1",[t],function(t,i){var n=i.rows.length?i.rows.item(0).value:null;n&&(n=s.serializer.deserialize(n)),e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},setItem:function(t,e,i){return Z.apply(this,[t,e,i,1])},removeItem:function(t,e){var i=this;t=h(t);var n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"DELETE FROM "+s.storeName+" WHERE key = ?",[t],function(){e()},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},clear:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"DELETE FROM "+n.storeName,[],function(){t()},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},length:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(e,i){var n=i.rows.item(0).c;t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},key:function(t,e){var i=this,n=new r(function(e,n){i.ready().then(function(){var s=i._dbInfo;s.db.transaction(function(i){Y(i,s,"SELECT key FROM "+s.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,i){var n=i.rows.length?i.rows.item(0).key:null;e(n)},function(t,e){n(e)})})}).catch(n)});return a(n,e),n},keys:function(t){var e=this,i=new r(function(t,i){e.ready().then(function(){var n=e._dbInfo;n.db.transaction(function(e){Y(e,n,"SELECT key FROM "+n.storeName,[],function(e,i){for(var n=[],s=0;s<i.rows.length;s++)n.push(i.rows.item(s).key);t(n)},function(t,e){i(e)})})}).catch(i)});return a(i,t),i},dropInstance:function(t,e){e=d.apply(this,arguments);var i=this.config();(t="function"!=typeof t&&t||{}).name||(t.name=t.name||i.name,t.storeName=t.storeName||i.storeName);var n,s=this;return a(n=t.name?new r(function(e){var n;n=t.name===i.name?s._dbInfo.db:openDatabase(t.name,"","",0),t.storeName?e({db:n,storeNames:[t.storeName]}):e(function(t){return new r(function(e,i){t.transaction(function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(i,n){for(var s=[],o=0;o<n.rows.length;o++)s.push(n.rows.item(o).name);e({db:t,storeNames:s})},function(t,e){i(e)})},function(t){i(t)})})}(n))}).then(function(t){return new r(function(e,i){t.db.transaction(function(n){function s(t){return new r(function(e,i){n.executeSql("DROP TABLE IF EXISTS "+t,[],function(){e()},function(t,e){i(e)})})}for(var o=[],a=0,l=t.storeNames.length;a<l;a++)o.push(s(t.storeNames[a]));r.all(o).then(function(){e()}).catch(function(t){i(t)})},function(t){i(t)})})}):r.reject("Invalid arguments"),e),n}};function Q(t,e){var i=t.name+"/";return t.storeName!==e.storeName&&(i+=t.storeName+"/"),i}function tt(){return!function(){var t="_localforage_support_test";try{return localStorage.setItem(t,!0),localStorage.removeItem(t),!1}catch(t){return!0}}()||localStorage.length>0}var et={_driver:"localStorageWrapper",_initStorage:function(t){var e={};if(t)for(var i in t)e[i]=t[i];return e.keyPrefix=Q(t,this._defaultConfig),tt()?(this._dbInfo=e,e.serializer=K,r.resolve()):r.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(t){return!1}}(),iterate:function(t,e){var i=this,n=i.ready().then(function(){for(var e=i._dbInfo,n=e.keyPrefix,s=n.length,o=localStorage.length,r=1,a=0;a<o;a++){var l=localStorage.key(a);if(0===l.indexOf(n)){var h=localStorage.getItem(l);if(h&&(h=e.serializer.deserialize(h)),void 0!==(h=t(h,l.substring(s),r++)))return h}}});return a(n,e),n},getItem:function(t,e){var i=this;t=h(t);var n=i.ready().then(function(){var e=i._dbInfo,n=localStorage.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return a(n,e),n},setItem:function(t,e,i){var n=this;t=h(t);var s=n.ready().then(function(){void 0===e&&(e=null);var i=e;return new r(function(s,o){var r=n._dbInfo;r.serializer.serialize(e,function(e,n){if(n)o(n);else try{localStorage.setItem(r.keyPrefix+t,e),s(i)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||o(t),o(t)}})})});return a(s,i),s},removeItem:function(t,e){var i=this;t=h(t);var n=i.ready().then(function(){var e=i._dbInfo;localStorage.removeItem(e.keyPrefix+t)});return a(n,e),n},clear:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo.keyPrefix,i=localStorage.length-1;i>=0;i--){var n=localStorage.key(i);0===n.indexOf(t)&&localStorage.removeItem(n)}});return a(i,t),i},length:function(t){var e=this.keys().then(function(t){return t.length});return a(e,t),e},key:function(t,e){var i=this,n=i.ready().then(function(){var e,n=i._dbInfo;try{e=localStorage.key(t)}catch(t){e=null}return e&&(e=e.substring(n.keyPrefix.length)),e});return a(n,e),n},keys:function(t){var e=this,i=e.ready().then(function(){for(var t=e._dbInfo,i=localStorage.length,n=[],s=0;s<i;s++){var o=localStorage.key(s);0===o.indexOf(t.keyPrefix)&&n.push(o.substring(t.keyPrefix.length))}return n});return a(i,t),i},dropInstance:function(t,e){if(e=d.apply(this,arguments),!(t="function"!=typeof t&&t||{}).name){var i=this.config();t.name=t.name||i.name,t.storeName=t.storeName||i.storeName}var n,s=this;return n=t.name?new r(function(e){t.storeName?e(Q(t,s._defaultConfig)):e(t.name+"/")}).then(function(t){for(var e=localStorage.length-1;e>=0;e--){var i=localStorage.key(e);0===i.indexOf(t)&&localStorage.removeItem(i)}}):r.reject("Invalid arguments"),a(n,e),n}},it=function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},nt=function(t,e){for(var i=t.length,n=0;n<i;){if(it(t[n],e))return!0;n++}return!1},st=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},ot={},rt={},at={INDEXEDDB:M,WEBSQL:J,LOCALSTORAGE:et},lt=[at.INDEXEDDB._driver,at.WEBSQL._driver,at.LOCALSTORAGE._driver],ht=["dropInstance"],dt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ht),ct={description:"",driver:lt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ut(t,e){t[e]=function(){var i=arguments;return t.ready().then(function(){return t[e].apply(t,i)})}}function pt(){for(var t=1;t<arguments.length;t++){var e=arguments[t];if(e)for(var i in e)e.hasOwnProperty(i)&&(st(e[i])?arguments[0][i]=e[i].slice():arguments[0][i]=e[i])}return arguments[0]}var mt=function(){function t(e){for(var i in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),at)if(at.hasOwnProperty(i)){var n=at[i],s=n._driver;this[i]=s,ot[s]||this.defineDriver(n)}this._defaultConfig=pt({},ct),this._config=pt({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return t.prototype.config=function(t){if("object"===(void 0===t?"undefined":n(t))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var e in t){if("storeName"===e&&(t[e]=t[e].replace(/\W/g,"_")),"version"===e&&"number"!=typeof t[e])return new Error("Database version must be a number.");this._config[e]=t[e]}return!("driver"in t)||!t.driver||this.setDriver(this._config.driver)}return"string"==typeof t?this._config[t]:this._config},t.prototype.defineDriver=function(t,e,i){var n=new r(function(e,i){try{var n=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver)return void i(s);for(var o=dt.concat("_initStorage"),l=0,h=o.length;l<h;l++){var d=o[l];if((!nt(ht,d)||t[d])&&"function"!=typeof t[d])return void i(s)}!function(){for(var e=function(t){return function(){var e=new Error("Method "+t+" is not implemented by the current driver"),i=r.reject(e);return a(i,arguments[arguments.length-1]),i}},i=0,n=ht.length;i<n;i++){var s=ht[i];t[s]||(t[s]=e(s))}}();var c=function(i){ot[n]&&console.info("Redefining LocalForage driver: "+n),ot[n]=t,rt[n]=i,e()};"_support"in t?t._support&&"function"==typeof t._support?t._support().then(c,i):c(!!t._support):c(!0)}catch(t){i(t)}});return l(n,e,i),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,e,i){var n=ot[t]?r.resolve(ot[t]):r.reject(new Error("Driver not found."));return l(n,e,i),n},t.prototype.getSerializer=function(t){var e=r.resolve(K);return l(e,t),e},t.prototype.ready=function(t){var e=this,i=e._driverSet.then(function(){return null===e._ready&&(e._ready=e._initDriver()),e._ready});return l(i,t,t),i},t.prototype.setDriver=function(t,e,i){var n=this;st(t)||(t=[t]);var s=this._getSupportedDrivers(t);function o(){n._config.driver=n.driver()}function a(t){return n._extend(t),o(),n._ready=n._initStorage(n._config),n._ready}var h=null!==this._driverSet?this._driverSet.catch(function(){return r.resolve()}):r.resolve();return this._driverSet=h.then(function(){var t=s[0];return n._dbInfo=null,n._ready=null,n.getDriver(t).then(function(t){n._driver=t._driver,o(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(t){return function(){var e=0;return function i(){for(;e<t.length;){var s=t[e];return e++,n._dbInfo=null,n._ready=null,n.getDriver(s).then(a).catch(i)}o();var l=new Error("No available storage method found.");return n._driverSet=r.reject(l),n._driverSet}()}}(s)})}).catch(function(){o();var t=new Error("No available storage method found.");return n._driverSet=r.reject(t),n._driverSet}),l(this._driverSet,e,i),this._driverSet},t.prototype.supports=function(t){return!!rt[t]},t.prototype._extend=function(t){pt(this,t)},t.prototype._getSupportedDrivers=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i];this.supports(s)&&e.push(s)}return e},t.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,e=dt.length;t<e;t++)ut(this,dt[t])},t.prototype.createInstance=function(e){return new t(e)},t}(),gt=new mt;e.exports=gt},{3:3}]},{},[4])(4)},931:t=>{var e;self,e=()=>(()=>{"use strict";var t={d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.d(e,{default:()=>P});var i={};function n(t,e,i,n,s={}){e instanceof HTMLCollection||e instanceof NodeList?e=Array.from(e):Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);for(const o of e)for(const e of i)o[t](e,n,{capture:!1,...s});return Array.prototype.slice.call(arguments,1)}t.r(i),t.d(i,{adjustableInputNumbers:()=>d,createElementFromString:()=>r,createFromTemplate:()=>a,eventPath:()=>l,off:()=>o,on:()=>s,resolveElement:()=>h});const s=n.bind(null,"addEventListener"),o=n.bind(null,"removeEventListener");function r(t){const e=document.createElement("div");return e.innerHTML=t.trim(),e.firstElementChild}function a(t){const e=(t,e)=>{const i=t.getAttribute(e);return t.removeAttribute(e),i},i=(t,n={})=>{const s=e(t,":obj"),o=e(t,":ref"),r=s?n[s]={}:n;o&&(n[o]=t);for(const n of Array.from(t.children)){const t=e(n,":arr"),s=i(n,t?{}:r);t&&(r[t]||(r[t]=[])).push(Object.keys(s).length?s:n)}return n};return i(r(t))}function l(t){let e=t.path||t.composedPath&&t.composedPath();if(e)return e;let i=t.target.parentElement;for(e=[t.target,i];i=i.parentElement;)e.push(i);return e.push(document,window),e}function h(t){return t instanceof Element?t:"string"==typeof t?t.split(/>>/g).reduce((t,e,i,n)=>(t=t.querySelector(e),i<n.length-1?t.shadowRoot:t),document):null}function d(t,e=t=>t){function i(i){const n=[.001,.01,.1][Number(i.shiftKey||2*i.ctrlKey)]*(i.deltaY<0?1:-1);let s=0,o=t.selectionStart;t.value=t.value.replace(/[\d.]+/g,(t,i)=>i<=o&&i+t.length>=o?(o=i,e(Number(t),n,s)):(s++,t)),t.focus(),t.setSelectionRange(o,o),i.preventDefault(),t.dispatchEvent(new Event("input"))}s(t,"focus",()=>s(window,"wheel",i,{passive:!1})),s(t,"blur",()=>o(window,"wheel",i))}const{min:c,max:u,floor:p,round:m}=Math;function g(t,e,i){e/=100,i/=100;const n=p(t=t/360*6),s=t-n,o=i*(1-e),r=i*(1-s*e),a=i*(1-(1-s)*e),l=n%6;return[255*[i,r,o,o,a,i][l],255*[a,i,i,r,o,o][l],255*[o,o,a,i,i,r][l]]}function f(t,e,i){const n=(2-(e/=100))*(i/=100)/2;return 0!==n&&(e=1===n?0:n<.5?e*i/(2*n):e*i/(2-2*n)),[t,100*e,100*n]}function v(t,e,i){const n=c(t/=255,e/=255,i/=255),s=u(t,e,i),o=s-n;let r,a;if(0===o)r=a=0;else{a=o/s;const n=((s-t)/6+o/2)/o,l=((s-e)/6+o/2)/o,h=((s-i)/6+o/2)/o;t===s?r=h-l:e===s?r=1/3+n-h:i===s&&(r=2/3+l-n),r<0?r+=1:r>1&&(r-=1)}return[360*r,100*a,100*s]}function b(t,e,i,n){return e/=100,i/=100,[...v(255*(1-c(1,(t/=100)*(1-(n/=100))+n)),255*(1-c(1,e*(1-n)+n)),255*(1-c(1,i*(1-n)+n)))]}function _(t,e,i){e/=100;const n=2*(e*=(i/=100)<.5?i:1-i)/(i+e)*100,s=100*(i+e);return[t,isNaN(n)?0:n,s]}function w(t){return v(...t.match(/.{2}/g).map(t=>parseInt(t,16)))}function y(t=0,e=0,i=0,n=1){const s=(t,e)=>(i=-1)=>e(~i?t.map(t=>Number(t.toFixed(i))):t),o={h:t,s:e,v:i,a:n,toHSVA(){const t=[o.h,o.s,o.v,o.a];return t.toString=s(t,t=>`hsva(${t[0]}, ${t[1]}%, ${t[2]}%, ${o.a})`),t},toHSLA(){const t=[...f(o.h,o.s,o.v),o.a];return t.toString=s(t,t=>`hsla(${t[0]}, ${t[1]}%, ${t[2]}%, ${o.a})`),t},toRGBA(){const t=[...g(o.h,o.s,o.v),o.a];return t.toString=s(t,t=>`rgba(${t[0]}, ${t[1]}, ${t[2]}, ${o.a})`),t},toCMYK(){const t=function(t,e,i){const n=g(t,e,i),s=n[0]/255,o=n[1]/255,r=n[2]/255,a=c(1-s,1-o,1-r);return[100*(1===a?0:(1-s-a)/(1-a)),100*(1===a?0:(1-o-a)/(1-a)),100*(1===a?0:(1-r-a)/(1-a)),100*a]}(o.h,o.s,o.v);return t.toString=s(t,t=>`cmyk(${t[0]}%, ${t[1]}%, ${t[2]}%, ${t[3]}%)`),t},toHEXA(){const t=function(t,e,i){return g(t,e,i).map(t=>m(t).toString(16).padStart(2,"0"))}(o.h,o.s,o.v),e=o.a>=1?"":Number((255*o.a).toFixed(0)).toString(16).toUpperCase().padStart(2,"0");return e&&t.push(e),t.toString=()=>`#${t.join("").toUpperCase()}`,t},clone:()=>y(o.h,o.s,o.v,o.a)};return o}const C=t=>Math.max(Math.min(t,1),0);function x(t){const e={options:Object.assign({lock:null,onchange:()=>0,onstop:()=>0},t),_keyboard(t){const{options:i}=e,{type:n,key:s}=t;if(document.activeElement===i.wrapper){const{lock:i}=e.options,o="ArrowUp"===s,r="ArrowRight"===s,a="ArrowDown"===s,l="ArrowLeft"===s;if("keydown"===n&&(o||r||a||l)){let n=0,s=0;"v"===i?n=o||r?1:-1:"h"===i?n=o||r?-1:1:(s=o?-1:a?1:0,n=l?-1:r?1:0),e.update(C(e.cache.x+.01*n),C(e.cache.y+.01*s)),t.preventDefault()}else s.startsWith("Arrow")&&(e.options.onstop(),t.preventDefault())}},_tapstart(t){s(document,["mouseup","touchend","touchcancel"],e._tapstop),s(document,["mousemove","touchmove"],e._tapmove),t.cancelable&&t.preventDefault(),e._tapmove(t)},_tapmove(t){const{options:i,cache:n}=e,{lock:s,element:o,wrapper:r}=i,a=r.getBoundingClientRect();let l=0,h=0;if(t){const e=t&&t.touches&&t.touches[0];l=t?(e||t).clientX:0,h=t?(e||t).clientY:0,l<a.left?l=a.left:l>a.left+a.width&&(l=a.left+a.width),h<a.top?h=a.top:h>a.top+a.height&&(h=a.top+a.height),l-=a.left,h-=a.top}else n&&(l=n.x*a.width,h=n.y*a.height);"h"!==s&&(o.style.left=`calc(${l/a.width*100}% - ${o.offsetWidth/2}px)`),"v"!==s&&(o.style.top=`calc(${h/a.height*100}% - ${o.offsetHeight/2}px)`),e.cache={x:l/a.width,y:h/a.height};const d=C(l/a.width),c=C(h/a.height);switch(s){case"v":return i.onchange(d);case"h":return i.onchange(c);default:return i.onchange(d,c)}},_tapstop(){e.options.onstop(),o(document,["mouseup","touchend","touchcancel"],e._tapstop),o(document,["mousemove","touchmove"],e._tapmove)},trigger(){e._tapmove()},update(t=0,i=0){const{left:n,top:s,width:o,height:r}=e.options.wrapper.getBoundingClientRect();"h"===e.options.lock&&(i=t),e._tapmove({clientX:n+o*t,clientY:s+r*i})},destroy(){const{options:t,_tapstart:i,_keyboard:n}=e;o(document,["keydown","keyup"],n),o([t.wrapper,t.element],"mousedown",i),o([t.wrapper,t.element],"touchstart",i,{passive:!1})}},{options:i,_tapstart:n,_keyboard:r}=e;return s([i.wrapper,i.element],"mousedown",n),s([i.wrapper,i.element],"touchstart",n,{passive:!1}),s(document,["keydown","keyup"],r),e}function E(t={}){t=Object.assign({onchange:()=>0,className:"",elements:[]},t);const e=s(t.elements,"click",e=>{t.elements.forEach(i=>i.classList[e.target===i?"add":"remove"](t.className)),t.onchange(e),e.stopPropagation()});return{destroy:()=>o(...e)}}const S={variantFlipOrder:{start:"sme",middle:"mse",end:"ems"},positionFlipOrder:{top:"tbrl",right:"rltb",bottom:"btrl",left:"lrbt"},position:"bottom",margin:8,padding:0};class P{static utils=i;static version="1.9.1";static I18N_DEFAULTS={"ui:dialog":"color picker dialog","btn:toggle":"toggle color picker dialog","btn:swatch":"color swatch","btn:last-color":"use previous color","btn:save":"Save","btn:cancel":"Cancel","btn:clear":"Clear","aria:btn:save":"save and close","aria:btn:cancel":"cancel and close","aria:btn:clear":"clear and close","aria:input":"color input field","aria:palette":"color selection area","aria:hue":"hue selection slider","aria:opacity":"selection slider"};static DEFAULT_OPTIONS={appClass:null,theme:"classic",useAsButton:!1,padding:8,disabled:!1,comparison:!0,closeOnScroll:!1,outputPrecision:0,lockOpacity:!1,autoReposition:!0,container:"body",components:{interaction:{}},i18n:{},swatches:null,inline:!1,sliders:null,default:"#42445a",defaultRepresentation:null,position:"bottom-middle",adjustableNumbers:!0,showAlways:!1,closeWithKey:"Escape"};_initializingActive=!0;_recalc=!0;_nanopop=null;_root=null;_color=y();_lastColor=y();_swatchColors=[];_setupAnimationFrame=null;_eventListener={init:[],save:[],hide:[],show:[],clear:[],change:[],changestop:[],cancel:[],swatchselect:[]};constructor(t){this.options=t=Object.assign({...P.DEFAULT_OPTIONS},t);const{swatches:e,components:i,theme:n,sliders:s,lockOpacity:o,padding:r}=t;["nano","monolith"].includes(n)&&!s&&(t.sliders="h"),i.interaction||(i.interaction={});const{preview:a,opacity:l,hue:h,palette:d}=i;i.opacity=!o&&l,i.palette=d||a||l||h,this._preBuild(),this._buildComponents(),this._bindEvents(),this._finalBuild(),e&&e.length&&e.forEach(t=>this.addSwatch(t));const{button:c,app:u}=this._root;this._nanopop=((t,e,i)=>{const n="object"!=typeof t||t instanceof HTMLElement?{reference:t,popper:e,...i}:t;return{update(t=n){const{reference:e,popper:i}=Object.assign(n,t);if(!i||!e)throw new Error("Popper- or reference-element missing.");return((t,e,i)=>{const{container:n,arrow:s,margin:o,padding:r,position:a,variantFlipOrder:l,positionFlipOrder:h}={container:document.documentElement.getBoundingClientRect(),...S,...i},{left:d,top:c}=e.style;e.style.left="0",e.style.top="0";const u=t.getBoundingClientRect(),p=e.getBoundingClientRect(),m={t:u.top-p.height-o,b:u.bottom+o,r:u.right+o,l:u.left-p.width-o},g={vs:u.left,vm:u.left+u.width/2-p.width/2,ve:u.left+u.width-p.width,hs:u.top,hm:u.bottom-u.height/2-p.height/2,he:u.bottom-p.height},[f,v="middle"]=a.split("-"),b=h[f],_=l[v],{top:w,left:y,bottom:C,right:x}=n;for(const t of b){const i="t"===t||"b"===t;let n=m[t];const[o,a]=i?["top","left"]:["left","top"],[l,h]=i?[p.height,p.width]:[p.width,p.height],[d,c]=i?[C,x]:[x,C],[f,v]=i?[w,y]:[y,w];if(!(n<f||n+l+r>d))for(const d of _){let m=g[(i?"v":"h")+d];if(!(m<v||m+h+r>c)){if(m-=p[a],n-=p[o],e.style[a]=`${m}px`,e.style[o]=`${n}px`,s){const e=i?u.width/2:u.height/2,r=h/2,c=e>r,p=m+{s:c?r:e,m:r,e:c?r:h-e}[d],g=n+{t:l,b:0,r:0,l}[t];s.style[a]=`${p}px`,s.style[o]=`${g}px`}return t+d}}}return e.style.left=d,e.style.top=c,null})(e,i,n)}}})(c,u,{margin:r}),c.setAttribute("role","button"),c.setAttribute("aria-label",this._t("btn:toggle"));const p=this;this._setupAnimationFrame=requestAnimationFrame(function e(){if(!u.offsetWidth)return requestAnimationFrame(e);p.setColor(t.default),p._rePositioningPicker(),t.defaultRepresentation&&(p._representation=t.defaultRepresentation,p.setColorRepresentation(p._representation)),t.showAlways&&p.show(),p._initializingActive=!1,p._emit("init")})}static create=t=>new P(t);_preBuild(){const{options:t}=this;for(const e of["el","container"])t[e]=h(t[e]);this._root=(t=>{const{components:e,useAsButton:i,inline:n,appClass:s,theme:o,lockOpacity:r}=t.options,l=t=>t?"":'style="display:none" hidden',h=e=>t._t(e),d=a(`\n      <div :ref="root" class="pickr">\n\n        ${i?"":'<button type="button" :ref="button" class="pcr-button"></button>'}\n\n        <div :ref="app" class="pcr-app ${s||""}" data-theme="${o}" ${n?'style="position: unset"':""} aria-label="${h("ui:dialog")}" role="window">\n          <div class="pcr-selection" ${l(e.palette)}>\n            <div :obj="preview" class="pcr-color-preview" ${l(e.preview)}>\n              <button type="button" :ref="lastColor" class="pcr-last-color" aria-label="${h("btn:last-color")}"></button>\n              <div :ref="currentColor" class="pcr-current-color"></div>\n            </div>\n\n            <div :obj="palette" class="pcr-color-palette">\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="palette" class="pcr-palette" tabindex="0" aria-label="${h("aria:palette")}" role="listbox"></div>\n            </div>\n\n            <div :obj="hue" class="pcr-color-chooser" ${l(e.hue)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-hue pcr-slider" tabindex="0" aria-label="${h("aria:hue")}" role="slider"></div>\n            </div>\n\n            <div :obj="opacity" class="pcr-color-opacity" ${l(e.opacity)}>\n              <div :ref="picker" class="pcr-picker"></div>\n              <div :ref="slider" class="pcr-opacity pcr-slider" tabindex="0" aria-label="${h("aria:opacity")}" role="slider"></div>\n            </div>\n          </div>\n\n          <div class="pcr-swatches ${e.palette?"":"pcr-last"}" :ref="swatches"></div>\n\n          <div :obj="interaction" class="pcr-interaction" ${l(Object.keys(e.interaction).length)}>\n            <input :ref="result" class="pcr-result" type="text" spellcheck="false" ${l(e.interaction.input)} aria-label="${h("aria:input")}">\n\n            <input :arr="options" class="pcr-type" data-type="HEXA" value="${r?"HEX":"HEXA"}" type="button" ${l(e.interaction.hex)}>\n            <input :arr="options" class="pcr-type" data-type="RGBA" value="${r?"RGB":"RGBA"}" type="button" ${l(e.interaction.rgba)}>\n            <input :arr="options" class="pcr-type" data-type="HSLA" value="${r?"HSL":"HSLA"}" type="button" ${l(e.interaction.hsla)}>\n            <input :arr="options" class="pcr-type" data-type="HSVA" value="${r?"HSV":"HSVA"}" type="button" ${l(e.interaction.hsva)}>\n            <input :arr="options" class="pcr-type" data-type="CMYK" value="CMYK" type="button" ${l(e.interaction.cmyk)}>\n\n            <input :ref="save" class="pcr-save" value="${h("btn:save")}" type="button" ${l(e.interaction.save)} aria-label="${h("aria:btn:save")}">\n            <input :ref="cancel" class="pcr-cancel" value="${h("btn:cancel")}" type="button" ${l(e.interaction.cancel)} aria-label="${h("aria:btn:cancel")}">\n            <input :ref="clear" class="pcr-clear" value="${h("btn:clear")}" type="button" ${l(e.interaction.clear)} aria-label="${h("aria:btn:clear")}">\n          </div>\n        </div>\n      </div>\n    `),c=d.interaction;return c.options.find(t=>!t.hidden&&!t.classList.add("active")),c.type=()=>c.options.find(t=>t.classList.contains("active")),d})(this),t.useAsButton&&(this._root.button=t.el),t.container.appendChild(this._root.root)}_finalBuild(){const t=this.options,e=this._root;if(t.container.removeChild(e.root),t.inline){const i=t.el.parentElement;t.el.nextSibling?i.insertBefore(e.app,t.el.nextSibling):i.appendChild(e.app)}else t.container.appendChild(e.app);t.useAsButton?t.inline&&t.el.remove():t.el.parentNode.replaceChild(e.root,t.el),t.disabled&&this.disable(),t.comparison||(e.button.style.transition="none",t.useAsButton||(e.preview.lastColor.style.transition="none")),this.hide()}_buildComponents(){const t=this,e=this.options.components,i=(t.options.sliders||"v").repeat(2),[n,s]=i.match(/^[vh]+$/g)?i:[],o=()=>this._color||(this._color=this._lastColor.clone()),r={palette:x({element:t._root.palette.picker,wrapper:t._root.palette.palette,onstop:()=>t._emit("changestop","slider",t),onchange(i,n){if(!e.palette)return;const s=o(),{_root:r,options:a}=t,{lastColor:l,currentColor:h}=r.preview;t._recalc&&(s.s=100*i,s.v=100-100*n,s.v<0&&(s.v=0),t._updateOutput("slider"));const d=s.toRGBA().toString(0);this.element.style.background=d,this.wrapper.style.background=`\n                        linear-gradient(to top, rgba(0, 0, 0, ${s.a}), transparent),\n                        linear-gradient(to left, hsla(${s.h}, 100%, 50%, ${s.a}), rgba(255, 255, 255, ${s.a}))\n                    `,a.comparison?a.useAsButton||t._lastColor||l.style.setProperty("--pcr-color",d):(r.button.style.setProperty("--pcr-color",d),r.button.classList.remove("clear"));const c=s.toHEXA().toString();for(const{el:e,color:i}of t._swatchColors)e.classList[c===i.toHEXA().toString()?"add":"remove"]("pcr-active");h.style.setProperty("--pcr-color",d)}}),hue:x({lock:"v"===s?"h":"v",element:t._root.hue.picker,wrapper:t._root.hue.slider,onstop:()=>t._emit("changestop","slider",t),onchange(i){if(!e.hue||!e.palette)return;const n=o();t._recalc&&(n.h=360*i),this.element.style.backgroundColor=`hsl(${n.h}, 100%, 50%)`,r.palette.trigger()}}),opacity:x({lock:"v"===n?"h":"v",element:t._root.opacity.picker,wrapper:t._root.opacity.slider,onstop:()=>t._emit("changestop","slider",t),onchange(i){if(!e.opacity||!e.palette)return;const n=o();t._recalc&&(n.a=Math.round(100*i)/100),this.element.style.background=`rgba(0, 0, 0, ${n.a})`,r.palette.trigger()}}),selectable:E({elements:t._root.interaction.options,className:"active",onchange(e){t._representation=e.target.getAttribute("data-type").toUpperCase(),t._recalc&&t._updateOutput("swatch")}})};this._components=r}_bindEvents(){const{_root:t,options:e}=this,i=[s(t.interaction.clear,"click",()=>this._clearColor()),s([t.interaction.cancel,t.preview.lastColor],"click",()=>{this.setHSVA(...(this._lastColor||this._color).toHSVA(),!0),this._emit("cancel")}),s(t.interaction.save,"click",()=>{!this.applyColor()&&!e.showAlways&&this.hide()}),s(t.interaction.result,["keyup","input"],t=>{this.setColor(t.target.value,!0)&&!this._initializingActive&&(this._emit("change",this._color,"input",this),this._emit("changestop","input",this)),t.stopImmediatePropagation()}),s(t.interaction.result,["focus","blur"],t=>{this._recalc="blur"===t.type,this._recalc&&this._updateOutput(null)}),s([t.palette.palette,t.palette.picker,t.hue.slider,t.hue.picker,t.opacity.slider,t.opacity.picker],["mousedown","touchstart"],()=>this._recalc=!0,{passive:!0})];if(!e.showAlways){const n=e.closeWithKey;i.push(s(t.button,"click",()=>this.isOpen()?this.hide():this.show()),s(document,"keyup",t=>this.isOpen()&&(t.key===n||t.code===n)&&this.hide()),s(document,["touchstart","mousedown"],e=>{this.isOpen()&&!l(e).some(e=>e===t.app||e===t.button)&&this.hide()},{capture:!0}))}if(e.adjustableNumbers){const e={rgba:[255,255,255,1],hsva:[360,100,100,1],hsla:[360,100,100,1],cmyk:[100,100,100,100]};d(t.interaction.result,(t,i,n)=>{const s=e[this.getColorRepresentation().toLowerCase()];if(s){const e=s[n],o=t+(e>=100?1e3*i:i);return o<=0?0:Number((o<e?o:e).toPrecision(3))}return t})}if(e.autoReposition&&!e.inline){let t=null;const n=this;i.push(s(window,["scroll","resize"],()=>{n.isOpen()&&(e.closeOnScroll&&n.hide(),null===t?(t=setTimeout(()=>t=null,100),requestAnimationFrame(function e(){n._rePositioningPicker(),null!==t&&requestAnimationFrame(e)})):(clearTimeout(t),t=setTimeout(()=>t=null,100)))},{capture:!0}))}this._eventBindings=i}_rePositioningPicker(){const{options:t}=this;if(!t.inline&&!this._nanopop.update({container:document.body.getBoundingClientRect(),position:t.position})){const t=this._root.app,e=t.getBoundingClientRect();t.style.top=(window.innerHeight-e.height)/2+"px",t.style.left=(window.innerWidth-e.width)/2+"px"}}_updateOutput(t){const{_root:e,_color:i,options:n}=this;if(e.interaction.type()){const t=`to${e.interaction.type().getAttribute("data-type")}`;e.interaction.result.value="function"==typeof i[t]?i[t]().toString(n.outputPrecision):""}!this._initializingActive&&this._recalc&&this._emit("change",i,t,this)}_clearColor(t=!1){const{_root:e,options:i}=this;i.useAsButton||e.button.style.setProperty("--pcr-color","rgba(0, 0, 0, 0.15)"),e.button.classList.add("clear"),i.showAlways||this.hide(),this._lastColor=null,this._initializingActive||t||(this._emit("save",null),this._emit("clear"))}_parseLocalColor(t){const{values:e,type:i,a:n}=function(t){t=t.match(/^[a-zA-Z]+$/)?function(t){if("black"===t.toLowerCase())return"#000";const e=document.createElement("canvas").getContext("2d");return e.fillStyle=t,"#000"===e.fillStyle?null:e.fillStyle}(t):t;const e={cmyk:/^cmyk\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)/i,rgba:/^rgba?\D+([\d.]+)(%?)\D+([\d.]+)(%?)\D+([\d.]+)(%?)\D*?(([\d.]+)(%?)|$)/i,hsla:/^hsla?\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D*?(([\d.]+)(%?)|$)/i,hsva:/^hsva?\D+([\d.]+)\D+([\d.]+)\D+([\d.]+)\D*?(([\d.]+)(%?)|$)/i,hexa:/^#?(([\dA-Fa-f]{3,4})|([\dA-Fa-f]{6})|([\dA-Fa-f]{8}))$/i},i=t=>t.map(t=>/^(|\d+)\.\d+|\d+$/.test(t)?Number(t):void 0);let n;t:for(const s in e)if(n=e[s].exec(t))switch(s){case"cmyk":{const[,t,e,o,r]=i(n);if(t>100||e>100||o>100||r>100)break t;return{values:b(t,e,o,r),type:s}}case"rgba":{let[,t,,e,,o,,,r]=i(n);if(t="%"===n[2]?t/100*255:t,e="%"===n[4]?e/100*255:e,o="%"===n[6]?o/100*255:o,r="%"===n[9]?r/100:r,t>255||e>255||o>255||r<0||r>1)break t;return{values:[...v(t,e,o),r],a:r,type:s}}case"hexa":{let[,t]=n;4!==t.length&&3!==t.length||(t=t.split("").map(t=>t+t).join(""));const e=t.substring(0,6);let i=t.substring(6);return i=i?parseInt(i,16)/255:void 0,{values:[...w(e),i],a:i,type:s}}case"hsla":{let[,t,e,o,,r]=i(n);if(r="%"===n[6]?r/100:r,t>360||e>100||o>100||r<0||r>1)break t;return{values:[..._(t,e,o),r],a:r,type:s}}case"hsva":{let[,t,e,o,,r]=i(n);if(r="%"===n[6]?r/100:r,t>360||e>100||o>100||r<0||r>1)break t;return{values:[t,e,o,r],a:r,type:s}}}return{values:null,type:null}}(t),{lockOpacity:s}=this.options,o=void 0!==n&&1!==n;return e&&3===e.length&&(e[3]=void 0),{values:!e||s&&o?null:e,type:i}}_t(t){return this.options.i18n[t]||P.I18N_DEFAULTS[t]}_emit(t,...e){this._eventListener[t].forEach(t=>t(...e,this))}on(t,e){return this._eventListener[t].push(e),this}off(t,e){const i=this._eventListener[t]||[],n=i.indexOf(e);return~n&&i.splice(n,1),this}addSwatch(t){const{values:e}=this._parseLocalColor(t);if(e){const{_swatchColors:t,_root:i}=this,n=y(...e),o=r(`<button type="button" style="--pcr-color: ${n.toRGBA().toString(0)}" aria-label="${this._t("btn:swatch")}"/>`);return i.swatches.appendChild(o),t.push({el:o,color:n}),this._eventBindings.push(s(o,"click",()=>{this.setHSVA(...n.toHSVA(),!0),this._emit("swatchselect",n),this._emit("change",n,"swatch",this)})),!0}return!1}removeSwatch(t){const e=this._swatchColors[t];if(e){const{el:i}=e;return this._root.swatches.removeChild(i),this._swatchColors.splice(t,1),!0}return!1}applyColor(t=!1){const{preview:e,button:i}=this._root,n=this._color.toRGBA().toString(0);return e.lastColor.style.setProperty("--pcr-color",n),this.options.useAsButton||i.style.setProperty("--pcr-color",n),i.classList.remove("clear"),this._lastColor=this._color.clone(),this._initializingActive||t||this._emit("save",this._color),this}destroy(){cancelAnimationFrame(this._setupAnimationFrame),this._eventBindings.forEach(t=>o(...t)),Object.keys(this._components).forEach(t=>this._components[t].destroy())}destroyAndRemove(){this.destroy();const{root:t,app:e}=this._root;t.parentElement&&t.parentElement.removeChild(t),e.parentElement.removeChild(e),Object.keys(this).forEach(t=>this[t]=null)}hide(){return!!this.isOpen()&&(this._root.app.classList.remove("visible"),this._emit("hide"),!0)}show(){return!this.options.disabled&&!this.isOpen()&&(this._root.app.classList.add("visible"),this._rePositioningPicker(),this._emit("show",this._color),this)}isOpen(){return this._root.app.classList.contains("visible")}setHSVA(t=360,e=0,i=0,n=1,s=!1){const o=this._recalc;if(this._recalc=!1,t<0||t>360||e<0||e>100||i<0||i>100||n<0||n>1)return!1;this._color=y(t,e,i,n);const{hue:r,opacity:a,palette:l}=this._components;return r.update(t/360),a.update(n),l.update(e/100,1-i/100),s||this.applyColor(),o&&this._updateOutput(),this._recalc=o,!0}setColor(t,e=!1){if(null===t)return this._clearColor(e),!0;const{values:i,type:n}=this._parseLocalColor(t);if(i){const t=n.toUpperCase(),{options:s}=this._root.interaction,o=s.find(e=>e.getAttribute("data-type")===t);if(o&&!o.hidden)for(const t of s)t.classList[t===o?"add":"remove"]("active");return!!this.setHSVA(...i,e)&&this.setColorRepresentation(t)}return!1}setColorRepresentation(t){return t=t.toUpperCase(),!!this._root.interaction.options.find(e=>e.getAttribute("data-type").startsWith(t)&&!e.click())}getColorRepresentation(){return this._representation}getColor(){return this._color}getSelectedColor(){return this._lastColor}getRoot(){return this._root}disable(){return this.hide(),this.options.disabled=!0,this._root.button.classList.add("disabled"),this}enable(){return this.options.disabled=!1,this._root.button.classList.remove("disabled"),this}}return e.default})(),t.exports=e()}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";class t extends Error{constructor(t,e,i){super(`${t}: ${e}${void 0===i?"":": "+i}`)}}class e extends t{constructor(t,e){super("Assert",t,e)}}class n extends t{constructor(t,e,i){super("UnreachableCase",t,`${e}${void 0===i?"":": "+i}`)}}class s extends t{constructor(t,e){super("UnexpectedNull",t,e)}}class o extends t{constructor(t,e){super("UnexpectedUndefined",t,e)}}var r,a,l,h,d;!function(t){const e=["settings","hasHeaders","constrainDragToContainer","selectionEnabled","dimensions","borderWidth","minItemHeight","minItemWidth","headerHeight","dragProxyWidth","dragProxyHeight","labels","close","maximise","minimise","popout","content","componentType","componentState","id","width","type","height","isClosable","title","popoutWholeStack","openPopouts","parentId","activeItemIndex","reorderEnabled","borderGrabWidth"],i=[!0,!1,"row","column","stack","component","close","maximise","minimise","open in new window"];function n(t,e){const i={};for(const n in t)if(t.hasOwnProperty(n)){let a;a=e?o(n):r(n);const l=t[n];i[a]=s(l,e)}return i}function s(t,e){return"object"==typeof t?null===t?null:Array.isArray(t)?function(t,e){const i=t.length,n=new Array(i);for(let o=0;o<i;o++){const i=t[o];n[o]=s(i,e)}return n}(t,e):n(t,e):e?function(t){if("string"==typeof t&&1===t.length)return"___"+t;const e=function(t){for(let e=0;e<i.length;e++)if(i[e]===t)return e;return-1}(t);return-1===e?t:e.toString(36)}(t):"string"==typeof(o=t)&&1===o.length?i[parseInt(o,36)]:"string"==typeof o&&"___"===o.substr(0,3)?o[3]:o;var o}function o(t){if("string"==typeof t&&1===t.length)return"___"+t;const i=function(t){for(let i=0;i<e.length;i++)if(e[i]===t)return i;return-1}(t);return-1===i?t:i.toString(36)}function r(t){return 1===t.length?e[parseInt(t,36)]:"___"===t.substr(0,3)?t[3]:t}t.checkInitialise=function(){if(e.length>36)throw new Error("Too many keys in config minifier map")},t.translateObject=n}(r||(r={})),function(t){t.defaultComponentBaseZIndex="auto",t.defaultComponentDragZIndex="32",t.defaultComponentStackMaximisedZIndex="41"}(a||(a={})),function(t){t.width="width",t.height="height"}(l||(l={})),function(t){t.top="top",t.left="left",t.right="right",t.bottom="bottom"}(h||(h={})),function(t){t.base="base",t.drag="drag",t.stackMaximised="stackMaximised"}(d||(d={}));const c={base:a.defaultComponentBaseZIndex,drag:a.defaultComponentDragZIndex,stackMaximised:a.defaultComponentStackMaximisedZIndex};var u,p,m,g,f,v,b,_,w,y,C,x,E,S;function P(t){return t.toString(10)+"px"}function k(t){const e=t.replace("px","");return parseFloat(e)}function I(t){return t>="0"&&t<="9"}function R(t,e){const i=P(e);t.style.width=i}function M(t,e){const i=P(e);t.style.height=i}function L(t){return{width:t.offsetWidth,height:t.offsetHeight}}function T(t,e){t.style.display=e?"":"none"}function A(t,e){if(void 0!==e)for(const i in e)if(e.hasOwnProperty(i)){const n=e[i],s=t[i];t[i]=D(s,n)}return t}function D(t,e){if("object"!=typeof e)return e;if(Array.isArray(e)){const t=e.length,i=new Array(t);for(let n=0;n<t;n++){const t=e[n];i[n]=D({},t)}return i}if(null===e)return null;{const i=e;return void 0===t||("object"!=typeof t||Array.isArray(t))?A({},i):A(null===t?{}:t,i)}}function z(){return(1e15*Math.random()).toString(36).replace(".","")}!function(t){function e(t){return!Array.isArray(t)&&null!==t&&"object"==typeof t}t.isJson=function(t){return e(t)},t.isJsonObject=e}(u||(u={})),function(t){t.ground="ground",t.row="row",t.column="column",t.stack="stack",t.component="component"}(p||(p={})),function(t){t.none="none",t.always="always",t.onload="onload"}(m||(m={})),function(t){t.Pixel="px",t.Percent="%",t.Fractional="fr",t.Em="em"}(g||(g={})),function(t){t.tryParse=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:return}},t.format=function(e){switch(e){case t.Pixel:return t.Pixel;case t.Percent:return t.Percent;case t.Fractional:return t.Fractional;case t.Em:return t.Em;default:throw new n("SUEF44998",e)}}}(g||(g={})),function(t){t.defaults={type:p.ground,content:[],size:1,sizeUnit:g.Fractional,minSize:void 0,minSizeUnit:g.Pixel,id:"",isClosable:!0},t.createCopy=function(t,e){switch(t.type){case p.ground:case p.row:case p.column:return w.createCopy(t,e);case p.stack:return b.createCopy(t,e);case p.component:return _.createCopy(t);default:throw new n("CICC91354",t.type,"Invalid Config Item type specified")}},t.createDefault=function(t){switch(t){case p.ground:throw new e("CICCDR91562");case p.row:case p.column:return w.createDefault(t);case p.stack:return b.createDefault();case p.component:return _.createDefault();default:throw new n("CICCDD91563",t,"Invalid Config Item type specified")}},t.isComponentItem=function(t){return t.type===p.component},t.isStackItem=function(t){return t.type===p.stack},t.isGroundItem=function(t){return t.type===p.ground}}(f||(f={})),function(t){let e;t.defaultMaximised=!1,function(t){t.createCopy=function(t,e){return void 0===t?void 0:{show:null!=e?e:t.show,popout:t.popout,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}}}(e=t.Header||(t.Header={}))}(v||(v={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=f.createCopy(t[n]);return i}t.defaultActiveItemIndex=0,t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:v.Header.createCopy(t.header)}},t.copyContent=e,t.createDefault=function(){return{type:p.stack,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,maximised:v.defaultMaximised,isClosable:f.defaults.isClosable,activeItemIndex:t.defaultActiveItemIndex,header:void 0}}}(b||(b={})),function(t){t.defaultReorderEnabled=!0,t.resolveComponentTypeName=function(t){const e=t.componentType;return"string"==typeof e?e:void 0},t.createCopy=function(t){return{type:t.type,content:[],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:v.Header.createCopy(t.header),componentType:t.componentType,componentState:D(void 0,t.componentState)}},t.createDefault=function(e="",i,n=""){return{type:p.component,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,maximised:v.defaultMaximised,isClosable:f.defaults.isClosable,reorderEnabled:t.defaultReorderEnabled,title:n,header:void 0,componentType:e,componentState:i}},t.copyComponentType=function(t){return D({},t)}}(_||(_={})),function(t){function e(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=f.createCopy(t[n]);return i}t.isChildItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("CROCOSPCICIC13687",t.type)}},t.createCopy=function(t,i){return{type:t.type,content:e(void 0!==i?i:t.content),size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,isClosable:t.isClosable}},t.copyContent=e,t.createDefault=function(t){return{type:t,content:[],size:f.defaults.size,sizeUnit:f.defaults.sizeUnit,minSize:f.defaults.minSize,minSizeUnit:f.defaults.minSizeUnit,id:f.defaults.id,isClosable:f.defaults.isClosable}}}(w||(w={})),function(t){t.createCopy=function(t){return f.createCopy(t)},t.isRootItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("CROCOSPCICIC13687",t.type)}}}(y||(y={})),function(t){t.create=function(t){const e=void 0===t?[]:[t];return{type:p.ground,content:e,size:100,sizeUnit:g.Percent,minSize:0,minSizeUnit:g.Pixel,id:"",isClosable:!1,title:"",reorderEnabled:!1}}}(C||(C={})),function(t){let e,i,n;function s(t){return"parentId"in t}!function(t){t.defaults={constrainDragToContainer:!0,reorderEnabled:!0,popoutWholeStack:!1,blockedPopoutsThrowError:!0,closePopoutsOnUnload:!0,responsiveMode:m.none,tabOverlapAllowance:0,reorderOnTabMenuClick:!0,tabControlOffset:10,popInOnClose:!1},t.createCopy=function(t){return{constrainDragToContainer:t.constrainDragToContainer,reorderEnabled:t.reorderEnabled,popoutWholeStack:t.popoutWholeStack,blockedPopoutsThrowError:t.blockedPopoutsThrowError,closePopoutsOnUnload:t.closePopoutsOnUnload,responsiveMode:t.responsiveMode,tabOverlapAllowance:t.tabOverlapAllowance,reorderOnTabMenuClick:t.reorderOnTabMenuClick,tabControlOffset:t.tabControlOffset,popInOnClose:t.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.createCopy=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,defaultMinItemHeight:t.defaultMinItemHeight,defaultMinItemHeightUnit:t.defaultMinItemHeightUnit,defaultMinItemWidth:t.defaultMinItemWidth,defaultMinItemWidthUnit:t.defaultMinItemWidthUnit,headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.defaults={borderWidth:5,borderGrabWidth:5,defaultMinItemHeight:0,defaultMinItemHeightUnit:g.Pixel,defaultMinItemWidth:10,defaultMinItemWidthUnit:g.Pixel,headerHeight:20,dragProxyWidth:300,dragProxyHeight:200}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.createCopy=function(t){return{show:t.show,popout:t.popout,dock:t.dock,close:t.close,maximise:t.maximise,minimise:t.minimise,tabDropdown:t.tabDropdown}},t.defaults={show:h.top,popout:"open in new window",dock:"dock",maximise:"maximise",minimise:"minimise",close:"close",tabDropdown:"additional tabs"}}(n=t.Header||(t.Header={})),t.isPopout=s,t.createDefault=function(){return{root:void 0,openPopouts:[],dimensions:t.Dimensions.defaults,settings:t.Settings.defaults,header:t.Header.defaults,resolved:!0}},t.createCopy=function(e){return s(e)?E.createCopy(e):{root:void 0===e.root?void 0:y.createCopy(e.root),openPopouts:t.copyOpenPopouts(e.openPopouts),settings:t.Settings.createCopy(e.settings),dimensions:t.Dimensions.createCopy(e.dimensions),header:t.Header.createCopy(e.header),resolved:e.resolved}},t.copyOpenPopouts=function(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=E.createCopy(t[n]);return i},t.minifyConfig=function(t){return r.translateObject(t,!0)},t.unminifyConfig=function(t){return r.translateObject(t,!1)}}(x||(x={})),function(t){let e;!function(t){t.createCopy=function(t){return{width:t.width,height:t.height,left:t.left,top:t.top}},t.defaults={width:null,height:null,left:null,top:null}}(e=t.Window||(t.Window={})),t.createCopy=function(e){return{root:void 0===e.root?void 0:y.createCopy(e.root),openPopouts:x.copyOpenPopouts(e.openPopouts),settings:x.Settings.createCopy(e.settings),dimensions:x.Dimensions.createCopy(e.dimensions),header:x.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.createCopy(e.window),resolved:e.resolved}}}(E||(E={}));class O extends Error{constructor(t,e){super(e),this.type=t}}class B extends O{constructor(t,e){super("Configuration",t),this.node=e}}class H extends O{constructor(t){super("PopoutBlocked",t)}}class N extends O{constructor(t){super("API",t)}}class V extends O{constructor(t){super("Bind",t)}}!function(t){let i=!1;const n={PopoutCannotBeCreatedWithGroundItemConfig:{id:0,default:"Popout cannot be created with ground ItemConfig"},PleaseRegisterAConstructorFunction:{id:1,default:"Please register a constructor function"},ComponentTypeNotRegisteredAndBindComponentEventHandlerNotAssigned:{id:2,default:"Component type not registered and BindComponentEvent handler not assigned"},ComponentIsAlreadyRegistered:{id:3,default:"Component is already registered"},ComponentIsNotVirtuable:{id:4,default:"Component is not virtuable. Requires rootHtmlElement field/getter"},VirtualComponentDoesNotHaveRootHtmlElement:{id:5,default:'Virtual component does not have getter "rootHtmlElement"'},ItemConfigIsNotTypeComponent:{id:6,default:"ItemConfig is not of type component"},InvalidNumberPartInSizeString:{id:7,default:"Invalid number part in size string"},UnknownUnitInSizeString:{id:8,default:"Unknown unit in size string"},UnsupportedUnitInSizeString:{id:9,default:"Unsupported unit in size string"}};t.idCount=Object.keys(n).length;const s=Object.values(n);t.checkInitialise=function(){if(!i)for(let i=0;i<t.idCount;i++){const t=s[i];if(t.id!==i)throw new e("INSI00110",`${i}: ${t.id}`);F[i]=t.default}i=!0}}(S||(S={}));const F=new Array(S.idCount);var G,W,j,U,q,$,K,X;function Y(t,e){const{numericPart:i,firstNonNumericCharPart:n}=function(t){const e=(t=t.trimStart()).length;if(0===e)return{numericPart:"",firstNonNumericCharPart:""};{let i=e,n=!1;for(let s=0;s<e;s++){const e=t[s];if(!I(e)){if("."!==e){i=s;break}if(n){i=s;break}n=!0}}return{numericPart:t.substring(0,i),firstNonNumericCharPart:t.substring(i).trim()}}}(t),s=Number.parseInt(i,10);if(isNaN(s))throw new B(`${F[7]}: ${t}`);{const i=g.tryParse(n);if(void 0===i)throw new B(`${F[8]}: ${t}`);if(e.includes(i))return{size:s,sizeUnit:i};throw new B(`${F[9]}: ${t}`)}}function Z(t,e){return t.toString(10)+g.format(e)}function J(t,e){return void 0===t?void 0:t.toString(10)+g.format(e)}!function(t){t.resolve=function(t,e){switch(t.type){case p.ground:throw new B("ItemConfig cannot specify type ground",JSON.stringify(t));case p.row:case p.column:return q.resolve(t,e);case p.stack:return j.resolve(t,e);case p.component:return U.resolve(t,e);default:throw new n("UCUICR55499",t.type)}},t.resolveContent=function(e){if(void 0===e)return[];{const i=e.length,n=new Array(i);for(let s=0;s<i;s++)n[s]=t.resolve(e[s],!1);return n}},t.resolveId=function(t){return void 0===t?f.defaults.id:Array.isArray(t)?0===t.length?f.defaults.id:t[0]:t},t.resolveSize=function(t,e,i,n){if(void 0!==t)return Y(t,[g.Percent,g.Fractional]);if(void 0!==e||void 0!==i){if(void 0!==e)return{size:e,sizeUnit:g.Percent};if(void 0!==i)return{size:i,sizeUnit:g.Percent};throw new o("CRS33390")}return n?{size:50,sizeUnit:g.Percent}:{size:f.defaults.size,sizeUnit:f.defaults.sizeUnit}},t.resolveMinSize=function(t,e,i){if(void 0!==t)return Y(t,[g.Pixel]);{const t=void 0!==e;return t||void 0!==i?t?{size:e,sizeUnit:g.Pixel}:{size:i,sizeUnit:g.Pixel}:{size:f.defaults.minSize,sizeUnit:f.defaults.minSizeUnit}}},t.calculateSizeWidthHeightSpecificationType=function(t){return void 0!==t.size?1:void 0!==t.width||void 0!==t.height?2:0},t.isGround=function(t){return t.type===p.ground},t.isRow=function(t){return t.type===p.row},t.isColumn=function(t){return t.type===p.column},t.isStack=function(t){return t.type===p.stack},t.isComponent=function(t){return t.type===p.component}}(G||(G={})),function(t){let e;!function(t){t.resolve=function(t,e){var i;if(void 0!==t||void 0!==e)return{show:null!==(i=null==t?void 0:t.show)&&void 0!==i?i:void 0===e?void 0:!!e&&x.Header.defaults.show,popout:null==t?void 0:t.popout,maximise:null==t?void 0:t.maximise,close:null==t?void 0:t.close,minimise:null==t?void 0:t.minimise,tabDropdown:null==t?void 0:t.tabDropdown}}}(e=t.Header||(t.Header={})),t.resolveIdAndMaximised=function(t){let e,i,n=t.id,s=!1;if(void 0===n)e=f.defaults.id;else if(Array.isArray(n)){const t=n.findIndex(t=>"__glMaximised"===t);t>0&&(s=!0,n=n.splice(t,1)),e=n.length>0?n[0]:f.defaults.id}else e=n;return i=void 0!==t.maximised?t.maximised:s,{id:e,maximised:i}}}(W||(W={})),function(t){function i(t){if(void 0===t)return[];{const i=t.length,n=new Array(i);for(let s=0;s<i;s++){const i=t[s],o=G.resolve(i,!1);if(!f.isComponentItem(o))throw new e("UCUSICRC91114",JSON.stringify(o));n[s]=o}return n}}function n(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=U.fromResolved(e)}return i}t.resolve=function(t,e){var n,s;const{id:o,maximised:r}=W.resolveIdAndMaximised(t),{size:a,sizeUnit:l}=G.resolveSize(t.size,t.width,t.height,e),{size:h,sizeUnit:d}=G.resolveMinSize(t.minSize,t.minWidth,t.minHeight);return{type:p.stack,content:i(t.content),size:a,sizeUnit:l,minSize:h,minSizeUnit:d,id:o,maximised:r,isClosable:null!==(n=t.isClosable)&&void 0!==n?n:f.defaults.isClosable,activeItemIndex:null!==(s=t.activeItemIndex)&&void 0!==s?s:b.defaultActiveItemIndex,header:W.Header.resolve(t.header,t.hasHeaders)}},t.fromResolved=function(t){return{type:p.stack,content:n(t.content),size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:t.activeItemIndex,header:v.Header.createCopy(t.header)}}}(j||(j={})),function(t){t.resolve=function(e,i){var n,s,o;let r=e.componentType;if(void 0===r&&(r=e.componentName),void 0===r)throw new Error("ComponentItemConfig.componentType is undefined");{const{id:a,maximised:l}=W.resolveIdAndMaximised(e);let h;h=void 0===e.title||""===e.title?t.componentTypeToTitle(r):e.title;const{size:d,sizeUnit:c}=G.resolveSize(e.size,e.width,e.height,i),{size:u,sizeUnit:p}=G.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:[],size:d,sizeUnit:c,minSize:u,minSizeUnit:p,id:a,maximised:l,isClosable:null!==(n=e.isClosable)&&void 0!==n?n:f.defaults.isClosable,reorderEnabled:null!==(s=e.reorderEnabled)&&void 0!==s?s:_.defaultReorderEnabled,title:h,header:W.Header.resolve(e.header,e.hasHeaders),componentType:r,componentState:null!==(o=e.componentState)&&void 0!==o?o:{}}}},t.fromResolved=function(t){return{type:p.component,size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,maximised:t.maximised,isClosable:t.isClosable,reorderEnabled:t.reorderEnabled,title:t.title,header:v.Header.createCopy(t.header),componentType:t.componentType,componentState:D(void 0,t.componentState)}},t.componentTypeToTitle=function(t){switch(typeof t){case"string":return t;case"number":case"boolean":return t.toString();default:return""}}}(U||(U={})),function(t){function i(e){const i=e.length,s=new Array(i);for(let o=0;o<i;o++){const i=e[o],r=i.type;let a;switch(r){case p.row:case p.column:a=t.fromResolved(i);break;case p.stack:a=j.fromResolved(i);break;case p.component:a=U.fromResolved(i);break;default:throw new n("ROCICFRC44797",r)}s[o]=a}return s}t.isChildItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("UROCOSPCICIC13687",t.type)}},t.resolve=function(e,i){var n;const{size:s,sizeUnit:o}=G.resolveSize(e.size,e.width,e.height,i),{size:r,sizeUnit:a}=G.resolveMinSize(e.minSize,e.minWidth,e.minHeight);return{type:e.type,content:t.resolveContent(e.content),size:s,sizeUnit:o,minSize:r,minSizeUnit:a,id:G.resolveId(e.id),isClosable:null!==(n=e.isClosable)&&void 0!==n?n:f.defaults.isClosable}},t.fromResolved=function(t){return{type:t.type,content:i(t.content),size:Z(t.size,t.sizeUnit),minSize:J(t.minSize,t.minSizeUnit),id:t.id,isClosable:t.isClosable}},t.resolveContent=function(i){if(void 0===i)return[];{const s=i.length,o=new Array(s);let r,a=!1,l=!1;for(let e=0;e<s;e++){const s=i[e];if(!t.isChildItemConfig(s))throw new B("ItemConfig is not Row, Column or Stack",s);if(!l){const t=G.calculateSizeWidthHeightSpecificationType(s);switch(t){case 0:break;case 2:a=!0;break;case 1:l=!0;break;default:throw new n("ROCICRC87556",t)}}o[e]=s}r=!l&&!!a;const h=new Array(s);for(let t=0;t<s;t++){const i=o[t],n=G.resolve(i,r);if(!w.isChildItemConfig(n))throw new e("UROCOSPIC99512",JSON.stringify(n));h[t]=n}return h}}}(q||(q={})),function(t){t.isRootItemConfig=function(t){switch(t.type){case p.row:case p.column:case p.stack:case p.component:return!0;case p.ground:return!1;default:throw new n("URICIR23687",t.type)}},t.resolve=function(t){if(void 0!==t){const e=G.resolve(t,!1);if(y.isRootItemConfig(e))return e;throw new B("ItemConfig is not Row, Column or Stack",JSON.stringify(t))}},t.fromResolvedOrUndefined=function(t){if(void 0!==t){const e=t.type;switch(e){case p.row:case p.column:return q.fromResolved(t);case p.stack:return j.fromResolved(t);case p.component:return U.fromResolved(t);default:throw new n("RICFROU89921",e)}}}}($||($={})),function(t){let e,i,n;function s(t){return"parentId"in t||"indexInParent"in t||"window"in t}!function(t){t.resolve=function(t){var e,i,n,s,o,r,a,l,h,d;return{constrainDragToContainer:null!==(e=null==t?void 0:t.constrainDragToContainer)&&void 0!==e?e:x.Settings.defaults.constrainDragToContainer,reorderEnabled:null!==(i=null==t?void 0:t.reorderEnabled)&&void 0!==i?i:x.Settings.defaults.reorderEnabled,popoutWholeStack:null!==(n=null==t?void 0:t.popoutWholeStack)&&void 0!==n?n:x.Settings.defaults.popoutWholeStack,blockedPopoutsThrowError:null!==(s=null==t?void 0:t.blockedPopoutsThrowError)&&void 0!==s?s:x.Settings.defaults.blockedPopoutsThrowError,closePopoutsOnUnload:null!==(o=null==t?void 0:t.closePopoutsOnUnload)&&void 0!==o?o:x.Settings.defaults.closePopoutsOnUnload,responsiveMode:null!==(r=null==t?void 0:t.responsiveMode)&&void 0!==r?r:x.Settings.defaults.responsiveMode,tabOverlapAllowance:null!==(a=null==t?void 0:t.tabOverlapAllowance)&&void 0!==a?a:x.Settings.defaults.tabOverlapAllowance,reorderOnTabMenuClick:null!==(l=null==t?void 0:t.reorderOnTabMenuClick)&&void 0!==l?l:x.Settings.defaults.reorderOnTabMenuClick,tabControlOffset:null!==(h=null==t?void 0:t.tabControlOffset)&&void 0!==h?h:x.Settings.defaults.tabControlOffset,popInOnClose:null!==(d=null==t?void 0:t.popInOnClose)&&void 0!==d?d:x.Settings.defaults.popInOnClose}}}(e=t.Settings||(t.Settings={})),function(t){t.resolve=function(e){var i,n,s,o,r;const{size:a,sizeUnit:l}=t.resolveDefaultMinItemHeight(e),{size:h,sizeUnit:d}=t.resolveDefaultMinItemWidth(e);return{borderWidth:null!==(i=null==e?void 0:e.borderWidth)&&void 0!==i?i:x.Dimensions.defaults.borderWidth,borderGrabWidth:null!==(n=null==e?void 0:e.borderGrabWidth)&&void 0!==n?n:x.Dimensions.defaults.borderGrabWidth,defaultMinItemHeight:a,defaultMinItemHeightUnit:l,defaultMinItemWidth:h,defaultMinItemWidthUnit:d,headerHeight:null!==(s=null==e?void 0:e.headerHeight)&&void 0!==s?s:x.Dimensions.defaults.headerHeight,dragProxyWidth:null!==(o=null==e?void 0:e.dragProxyWidth)&&void 0!==o?o:x.Dimensions.defaults.dragProxyWidth,dragProxyHeight:null!==(r=null==e?void 0:e.dragProxyHeight)&&void 0!==r?r:x.Dimensions.defaults.dragProxyHeight}},t.fromResolved=function(t){return{borderWidth:t.borderWidth,borderGrabWidth:t.borderGrabWidth,defaultMinItemHeight:Z(t.defaultMinItemHeight,t.defaultMinItemHeightUnit),defaultMinItemWidth:Z(t.defaultMinItemWidth,t.defaultMinItemWidthUnit),headerHeight:t.headerHeight,dragProxyWidth:t.dragProxyWidth,dragProxyHeight:t.dragProxyHeight}},t.resolveDefaultMinItemHeight=function(t){const e=null==t?void 0:t.defaultMinItemHeight;return void 0===e?{size:x.Dimensions.defaults.defaultMinItemHeight,sizeUnit:x.Dimensions.defaults.defaultMinItemHeightUnit}:Y(e,[g.Pixel])},t.resolveDefaultMinItemWidth=function(t){const e=null==t?void 0:t.defaultMinItemWidth;return void 0===e?{size:x.Dimensions.defaults.defaultMinItemWidth,sizeUnit:x.Dimensions.defaults.defaultMinItemWidthUnit}:Y(e,[g.Pixel])}}(i=t.Dimensions||(t.Dimensions={})),function(t){t.resolve=function(t,e,i){var n,s,o,r,a,l,h,d,c,u,p,m;let g;return g=void 0!==(null==t?void 0:t.show)?t.show:void 0!==e&&void 0!==e.hasHeaders?!!e.hasHeaders&&x.Header.defaults.show:x.Header.defaults.show,{show:g,popout:null!==(s=null!==(n=null==t?void 0:t.popout)&&void 0!==n?n:null==i?void 0:i.popout)&&void 0!==s?s:!1!==(null==e?void 0:e.showPopoutIcon)&&x.Header.defaults.popout,dock:null!==(r=null!==(o=null==t?void 0:t.popin)&&void 0!==o?o:null==i?void 0:i.popin)&&void 0!==r?r:x.Header.defaults.dock,maximise:null!==(l=null!==(a=null==t?void 0:t.maximise)&&void 0!==a?a:null==i?void 0:i.maximise)&&void 0!==l?l:!1!==(null==e?void 0:e.showMaximiseIcon)&&x.Header.defaults.maximise,close:null!==(d=null!==(h=null==t?void 0:t.close)&&void 0!==h?h:null==i?void 0:i.close)&&void 0!==d?d:!1!==(null==e?void 0:e.showCloseIcon)&&x.Header.defaults.close,minimise:null!==(u=null!==(c=null==t?void 0:t.minimise)&&void 0!==c?c:null==i?void 0:i.minimise)&&void 0!==u?u:x.Header.defaults.minimise,tabDropdown:null!==(m=null!==(p=null==t?void 0:t.tabDropdown)&&void 0!==p?p:null==i?void 0:i.tabDropdown)&&void 0!==m?m:x.Header.defaults.tabDropdown}}}(n=t.Header||(t.Header={})),t.isPopout=s,t.resolve=function(e){if(s(e))return X.resolve(e);{let i;return i=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{resolved:!0,root:$.resolve(i),openPopouts:t.resolveOpenPopouts(e.openPopouts),dimensions:t.Dimensions.resolve(e.dimensions),settings:t.Settings.resolve(e.settings),header:t.Header.resolve(e.header,e.settings,e.labels)}}},t.fromResolved=function(e){return{root:$.fromResolvedOrUndefined(e.root),openPopouts:X.fromResolvedArray(e.openPopouts),settings:x.Settings.createCopy(e.settings),dimensions:t.Dimensions.fromResolved(e.dimensions),header:x.Header.createCopy(e.header)}},t.isResolved=function(t){const e=t;return void 0!==e.resolved&&!0===e.resolved},t.resolveOpenPopouts=function(t){if(void 0===t)return[];{const e=t.length,i=new Array(e);for(let n=0;n<e;n++)i[n]=X.resolve(t[n]);return i}}}(K||(K={})),function(t){let e;function i(e){const i=e.length,n=new Array(i);for(let s=0;s<i;s++){const i=e[s];n[s]=t.fromResolved(i)}return n}!function(t){t.resolve=function(t,e){var i,n,s,o,r,a,l,h;let d;const c=E.Window.defaults;return d=void 0!==t?{width:null!==(i=t.width)&&void 0!==i?i:c.width,height:null!==(n=t.height)&&void 0!==n?n:c.height,left:null!==(s=t.left)&&void 0!==s?s:c.left,top:null!==(o=t.top)&&void 0!==o?o:c.top}:{width:null!==(r=null==e?void 0:e.width)&&void 0!==r?r:c.width,height:null!==(a=null==e?void 0:e.height)&&void 0!==a?a:c.height,left:null!==(l=null==e?void 0:e.left)&&void 0!==l?l:c.left,top:null!==(h=null==e?void 0:e.top)&&void 0!==h?h:c.top},d},t.fromResolved=function(t){return{width:null===t.width?void 0:t.width,height:null===t.height?void 0:t.height,left:null===t.left?void 0:t.left,top:null===t.top?void 0:t.top}}}(e=t.Window||(t.Window={})),t.resolve=function(e){var i,n;let s;return s=void 0!==e.root?e.root:void 0!==e.content&&e.content.length>0?e.content[0]:void 0,{root:$.resolve(s),openPopouts:K.resolveOpenPopouts(e.openPopouts),dimensions:K.Dimensions.resolve(e.dimensions),settings:K.Settings.resolve(e.settings),header:K.Header.resolve(e.header,e.settings,e.labels),parentId:null!==(i=e.parentId)&&void 0!==i?i:null,indexInParent:null!==(n=e.indexInParent)&&void 0!==n?n:null,window:t.Window.resolve(e.window,e.dimensions),resolved:!0}},t.fromResolved=function(e){return{root:$.fromResolvedOrUndefined(e.root),openPopouts:i(e.openPopouts),dimensions:K.Dimensions.fromResolved(e.dimensions),settings:x.Settings.createCopy(e.settings),header:x.Header.createCopy(e.header),parentId:e.parentId,indexInParent:e.indexInParent,window:t.Window.fromResolved(e.window)}},t.fromResolvedArray=i}(X||(X={}));class Q{constructor(){this._allEventSubscriptions=[],this._subscriptionsMap=new Map,this.unbind=this.removeEventListener,this.trigger=this.emit}tryBubbleEvent(t,e){}emit(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)(0,i[t])(...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitUnknown(t,...e){let i=this._subscriptionsMap.get(t);if(void 0!==i){i=i.slice();for(let t=0;t<i.length;t++)i[t](...e)}this.emitAllEvent(t,e),this.tryBubbleEvent(t,e)}emitBaseBubblingEvent(t){const e=new Q.BubblingEvent(t,this);this.emitUnknown(t,e)}emitUnknownBubblingEvent(t){const e=new Q.BubblingEvent(t,this);this.emitUnknown(t,e)}removeEventListener(t,e){const i=e;this.removeUnknownEventListener(t,i)}off(t,e){this.removeEventListener(t,e)}addEventListener(t,e){const i=e;this.addUnknownEventListener(t,i)}on(t,e){this.addEventListener(t,e)}addUnknownEventListener(t,e){if(t===Q.ALL_EVENT)this._allEventSubscriptions.push(e);else{let i=this._subscriptionsMap.get(t);void 0!==i?i.push(e):(i=[e],this._subscriptionsMap.set(t,i))}}removeUnknownEventListener(t,e){if(t===Q.ALL_EVENT)this.removeSubscription(t,this._allEventSubscriptions,e);else{const i=this._subscriptionsMap.get(t);if(void 0===i)throw new Error("No subscribtions to unsubscribe for event "+t);this.removeSubscription(t,i,e)}}removeSubscription(t,e,i){const n=e.indexOf(i);if(n<0)throw new Error("Nothing to unbind for "+t);e.splice(n,1)}emitAllEvent(t,e){const i=this._allEventSubscriptions.length;if(i>0){const n=e.slice();n.unshift(t);const s=this._allEventSubscriptions.slice();for(let t=0;t<i;t++)s[t](...n)}}}!function(t){t.ALL_EVENT="__all",t.headerClickEventName="stackHeaderClick",t.headerTouchStartEventName="stackHeaderTouchStart";class e{constructor(t,e){this._name=t,this._target=e,this._isPropagationStopped=!1}get name(){return this._name}get target(){return this._target}get origin(){return this._target}get isPropagationStopped(){return this._isPropagationStopped}stopPropagation(){this._isPropagationStopped=!0}}t.BubblingEvent=e,t.ClickBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._mouseEvent=i}get mouseEvent(){return this._mouseEvent}},t.TouchStartBubblingEvent=class extends e{constructor(t,e,i){super(t,e),this._touchEvent=i}get touchEvent(){return this._touchEvent}}}(Q||(Q={}));class tt extends Q{constructor(t,e,i){super(),this._config=t,this._initialWindowSize=e,this._layoutManager=i,this._isInitialised=!1,this._popoutWindow=null,this.createWindow()}toConfig(){var t,e;if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");const i=this.getGlInstance().saveLayout();let n,s;null===this._popoutWindow?(n=null,s=null):(n=null!==(t=this._popoutWindow.screenX)&&void 0!==t?t:this._popoutWindow.screenLeft,s=null!==(e=this._popoutWindow.screenY)&&void 0!==e?e:this._popoutWindow.screenTop);const o={width:this.getGlInstance().width,height:this.getGlInstance().height,left:n,top:s};return{root:i.root,openPopouts:i.openPopouts,settings:i.settings,dimensions:i.dimensions,header:i.header,window:o,parentId:this._config.parentId,indexInParent:this._config.indexInParent,resolved:!0}}getGlInstance(){if(null===this._popoutWindow)throw new s("BPGGI24693");return this._popoutWindow.__glInstance}getWindow(){if(null===this._popoutWindow)throw new s("BPGW087215");return this._popoutWindow}close(){if(this.getGlInstance())this.getGlInstance().closeWindow();else try{this.getWindow().close()}catch(t){}}popIn(){let t,e=this._config.indexInParent;if(!this._config.parentId)return;const i=A({},this.getGlInstance().saveLayout()).root;if(void 0===i)throw new o("BPPIR19998");const n=this._layoutManager.groundItem;if(void 0===n)throw new o("BPPIG34972");t=n.getItemsByPopInParentId(this._config.parentId)[0],t||(t=n.contentItems.length>0?n.contentItems[0]:n,e=0);const s=this._layoutManager.createAndInitContentItem(i,t);t.addChild(s,e),this._layoutManager.layoutConfig.settings.popInOnClose?this._onClose():this.close()}createWindow(){const t=this.createUrl(),e=Math.floor(1e6*Math.random()).toString(36),i=this.serializeWindowFeatures({width:this._initialWindowSize.width,height:this._initialWindowSize.height,innerWidth:this._initialWindowSize.width,innerHeight:this._initialWindowSize.height,menubar:"no",toolbar:"no",location:"no",personalbar:"no",resizable:"yes",scrollbars:"no",status:"no"});if(this._popoutWindow=globalThis.open(t,e,i),this._popoutWindow)this._popoutWindow.addEventListener("load",()=>this.positionWindow(),{passive:!0}),this._popoutWindow.addEventListener("beforeunload",()=>{this._layoutManager.layoutConfig.settings.popInOnClose?this.popIn():this._onClose()},{passive:!0}),this._checkReadyInterval=setInterval(()=>this.checkReady(),10);else if(!0===this._layoutManager.layoutConfig.settings.blockedPopoutsThrowError)throw new H("Popout blocked")}checkReady(){if(null===this._popoutWindow)throw new s("BPCR01844");this._popoutWindow.__glInstance&&this._popoutWindow.__glInstance.isInitialised&&(this.onInitialised(),void 0!==this._checkReadyInterval&&(clearInterval(this._checkReadyInterval),this._checkReadyInterval=void 0))}serializeWindowFeatures(t){const e=[];for(const i in t)e.push(i+"="+t[i].toString());return e.join(",")}createUrl(){const t="gl-window-config-"+z(),e=x.minifyConfig(this._config);try{localStorage.setItem(t,JSON.stringify(e))}catch(t){throw new Error("Error while writing to localStorage "+function(t){return t instanceof Error?t.message:"string"==typeof t?t:"Unknown Error"}(t))}const i=new URL(location.href);return i.searchParams.set("gl-window",t),i.toString()}positionWindow(){if(null===this._popoutWindow)throw new Error("BrowserPopout.positionWindow: null popoutWindow");this._popoutWindow.moveTo(this._initialWindowSize.left,this._initialWindowSize.top),this._popoutWindow.focus()}onInitialised(){this._isInitialised=!0,this.getGlInstance().on("popIn",()=>this.popIn()),this.emit("initialised")}_onClose(){setTimeout(()=>this.emit("closed"),50)}}class et{constructor(t,e,i,n){this._header=t,this._pushEvent=n,this._clickEventListener=t=>this.onClick(t),this._touchStartEventListener=t=>this.onTouchStart(t),this._element=document.createElement("div"),this._element.classList.add(i),this._element.title=e,this._header.on("destroy",()=>this.destroy()),this._element.addEventListener("click",this._clickEventListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartEventListener,{passive:!0}),this._header.controlsContainerElement.appendChild(this._element)}get element(){return this._element}destroy(){var t;this._element.removeEventListener("click",this._clickEventListener),this._element.removeEventListener("touchstart",this._touchStartEventListener),null===(t=this._element.parentNode)||void 0===t||t.removeChild(this._element)}onClick(t){this._pushEvent(t)}onTouchStart(t){this._pushEvent(t)}}class it extends Q{constructor(t,e){super(),this._eElement=t,this._pointerTracking=!1,this._pointerDownEventListener=t=>this.onPointerDown(t),this._pointerMoveEventListener=t=>this.onPointerMove(t),this._pointerUpEventListener=t=>this.onPointerUp(t),this._timeout=void 0,this._allowableTargets=[t,...e],this._oDocument=document,this._eBody=document.body,this._nDelay=1800,this._nDistance=10,this._nX=0,this._nY=0,this._nOriginalX=0,this._nOriginalY=0,this._dragging=!1,this._eElement.addEventListener("pointerdown",this._pointerDownEventListener,{passive:!0})}destroy(){this.checkRemovePointerTrackingEventListeners(),this._eElement.removeEventListener("pointerdown",this._pointerDownEventListener)}cancelDrag(){this.processDragStop(void 0)}onPointerDown(t){if(this._allowableTargets.includes(t.target)&&t.isPrimary){const e=this.getPointerCoordinates(t);this.processPointerDown(e)}}processPointerDown(t){this._nOriginalX=t.x,this._nOriginalY=t.y,this._oDocument.addEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.addEventListener("pointerup",this._pointerUpEventListener,{passive:!0}),this._pointerTracking=!0,this._timeout=setTimeout(()=>{try{this.startDrag()}catch(t){throw console.error(t),t}},this._nDelay)}onPointerMove(t){this._pointerTracking&&(this.processDragMove(t),t.preventDefault())}processDragMove(t){this._nX=t.pageX-this._nOriginalX,this._nY=t.pageY-this._nOriginalY,!1===this._dragging&&(Math.abs(this._nX)>this._nDistance||Math.abs(this._nY)>this._nDistance)&&this.startDrag(),this._dragging&&this.emit("drag",this._nX,this._nY,t)}onPointerUp(t){this.processDragStop(t)}processDragStop(t){var e;void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this.checkRemovePointerTrackingEventListeners(),!0===this._dragging&&(this._eBody.classList.remove("lm_dragging"),this._eElement.classList.remove("lm_dragging"),null===(e=this._oDocument.querySelector("iframe"))||void 0===e||e.style.setProperty("pointer-events",""),this._dragging=!1,this.emit("dragStop",t))}checkRemovePointerTrackingEventListeners(){this._pointerTracking&&(this._oDocument.removeEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.removeEventListener("pointerup",this._pointerUpEventListener),this._pointerTracking=!1)}startDrag(){var t;void 0!==this._timeout&&(clearTimeout(this._timeout),this._timeout=void 0),this._dragging=!0,this._eBody.classList.add("lm_dragging"),this._eElement.classList.add("lm_dragging"),null===(t=this._oDocument.querySelector("iframe"))||void 0===t||t.style.setProperty("pointer-events","none"),this.emit("dragStart",this._nOriginalX,this._nOriginalY)}getPointerCoordinates(t){return{x:t.pageX,y:t.pageY}}}class nt{constructor(t,e,i,n,s){var o;this._layoutManager=t,this._componentItem=e,this._closeEvent=i,this._focusEvent=n,this._dragStartEvent=s,this._isActive=!1,this._tabClickListener=t=>this.onTabClickDown(t),this._tabTouchStartListener=t=>this.onTabTouchStart(t),this._closeClickListener=()=>this.onCloseClick(),this._closeTouchStartListener=()=>this.onCloseTouchStart(),this._dragStartListener=(t,e)=>this.onDragStart(t,e),this._contentItemDestroyListener=()=>this.onContentItemDestroy(),this._tabTitleChangedListener=t=>this.setTitle(t),this._element=document.createElement("div"),this._element.classList.add("lm_tab"),this._titleElement=document.createElement("span"),this._titleElement.classList.add("lm_title"),this._closeElement=document.createElement("div"),this._closeElement.classList.add("lm_close_tab"),this._element.appendChild(this._titleElement),this._element.appendChild(this._closeElement),e.isClosable?this._closeElement.style.display="":this._closeElement.style.display="none",this.setTitle(e.title),this._componentItem.on("titleChanged",this._tabTitleChangedListener),(null!==(o=e.reorderEnabled)&&void 0!==o?o:this._layoutManager.layoutConfig.settings.reorderEnabled)&&this.enableReorder(),this._element.addEventListener("click",this._tabClickListener,{passive:!0}),this._element.addEventListener("touchstart",this._tabTouchStartListener,{passive:!0}),this._componentItem.isClosable?(this._closeElement.addEventListener("click",this._closeClickListener,{passive:!0}),this._closeElement.addEventListener("touchstart",this._closeTouchStartListener,{passive:!0})):(this._closeElement.remove(),this._closeElement=void 0),this._componentItem.setTab(this),this._layoutManager.emit("tabCreated",this)}get isActive(){return this._isActive}get componentItem(){return this._componentItem}get contentItem(){return this._componentItem}get element(){return this._element}get titleElement(){return this._titleElement}get closeElement(){return this._closeElement}get reorderEnabled(){return void 0!==this._dragListener}set reorderEnabled(t){t!==this.reorderEnabled&&(t?this.enableReorder():this.disableReorder())}setTitle(t){this._titleElement.innerText=t,this._element.title=t}setActive(t){t!==this._isActive&&(this._isActive=t,t?this._element.classList.add("lm_active"):this._element.classList.remove("lm_active"))}destroy(){var t,e;this._closeEvent=void 0,this._focusEvent=void 0,this._dragStartEvent=void 0,this._element.removeEventListener("click",this._tabClickListener),this._element.removeEventListener("touchstart",this._tabTouchStartListener),null===(t=this._closeElement)||void 0===t||t.removeEventListener("click",this._closeClickListener),null===(e=this._closeElement)||void 0===e||e.removeEventListener("touchstart",this._closeTouchStartListener),this._componentItem.off("titleChanged",this._tabTitleChangedListener),this.reorderEnabled&&this.disableReorder(),this._element.remove()}setBlurred(){this._element.classList.remove("lm_focused"),this._titleElement.classList.remove("lm_focused")}setFocused(){this._element.classList.add("lm_focused"),this._titleElement.classList.add("lm_focused")}onDragStart(t,e){if(void 0===this._dragListener)throw new o("TODSDLU10093");if(void 0===this._dragStartEvent)throw new o("TODS23309");this._dragStartEvent(t,e,this._dragListener,this.componentItem)}onContentItemDestroy(){void 0!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=void 0)}onTabClickDown(t){const e=t.target;e!==this._element&&e!==this._titleElement||(0===t.button?this.notifyFocus():1===t.button&&this._componentItem.isClosable&&this.notifyClose())}onTabTouchStart(t){t.target===this._element&&this.notifyFocus()}onCloseClick(){this.notifyClose()}onCloseTouchStart(){this.notifyClose()}notifyClose(){if(void 0===this._closeEvent)throw new o("TNC15007");this._closeEvent(this._componentItem)}notifyFocus(){if(void 0===this._focusEvent)throw new o("TNA15007");this._focusEvent(this._componentItem)}enableReorder(){this._dragListener=new it(this._element,[this._titleElement]),this._dragListener.on("dragStart",this._dragStartListener),this._componentItem.on("destroy",this._contentItemDestroyListener)}disableReorder(){if(void 0===this._dragListener)throw new o("TDR87745");this._componentItem.off("destroy",this._contentItemDestroyListener),this._dragListener.off("dragStart",this._dragStartListener),this._dragListener=void 0}}class st{constructor(t,e,i,n,s){this._layoutManager=t,this._componentRemoveEvent=e,this._componentFocusEvent=i,this._componentDragStartEvent=n,this._dropdownActiveChangedEvent=s,this._tabs=[],this._lastVisibleTabIndex=-1,this._dropdownActive=!1,this._element=document.createElement("section"),this._element.classList.add("lm_tabs"),this._dropdownElement=document.createElement("section"),this._dropdownElement.classList.add("lm_tabdropdown_list"),this._dropdownElement.style.display="none"}get tabs(){return this._tabs}get tabCount(){return this._tabs.length}get lastVisibleTabIndex(){return this._lastVisibleTabIndex}get element(){return this._element}get dropdownElement(){return this._dropdownElement}get dropdownActive(){return this._dropdownActive}destroy(){for(let t=0;t<this._tabs.length;t++)this._tabs[t].destroy()}createTab(t,e){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return;const i=new nt(this._layoutManager,t,t=>this.handleTabCloseEvent(t),t=>this.handleTabFocusEvent(t),(t,e,i,n)=>this.handleTabDragStartEvent(t,e,i,n));void 0===e&&(e=this._tabs.length),this._tabs.splice(e,0,i),e<this._element.childNodes.length?this._element.insertBefore(i.element,this._element.childNodes[e]):this._element.appendChild(i.element)}removeTab(t){for(let e=0;e<this._tabs.length;e++)if(this._tabs[e].componentItem===t)return this._tabs[e].destroy(),void this._tabs.splice(e,1);throw new Error("contentItem is not controlled by this header")}processActiveComponentChanged(t){let i=-1;for(let e=0;e<this._tabs.length;e++){const n=this._tabs[e].componentItem===t;this._tabs[e].setActive(n),n&&(i=e)}if(i<0)throw new e("HSACI56632");if(this._layoutManager.layoutConfig.settings.reorderOnTabMenuClick&&-1!==this._lastVisibleTabIndex&&i>this._lastVisibleTabIndex){const t=this._tabs[i];for(let t=i;t>0;t--)this._tabs[t]=this._tabs[t-1];this._tabs[0]=t}}updateTabSizes(t,e){let i=!1;this.tryUpdateTabSizes(i,t,e)||(i=!0,this.tryUpdateTabSizes(i,t,e)),i!==this._dropdownActive&&(this._dropdownActive=i,this._dropdownActiveChangedEvent())}tryUpdateTabSizes(t,e,i){if(this._tabs.length>0){if(void 0===i)throw new Error("non-empty tabs must have active component item");let n=0,s=!1;const o=this._layoutManager.layoutConfig.settings.tabOverlapAllowance,r=this._tabs.indexOf(i.tab),a=this._tabs[r];this._lastVisibleTabIndex=-1;for(let i=0;i<this._tabs.length;i++){const l=this._tabs[i].element;l.parentElement!==this._element&&this._element.appendChild(l);const h=k(getComputedStyle(a.element).marginRight);n+=l.offsetWidth+h;let d=0;if(r<=i)d=n;else{const t=k(getComputedStyle(a.element).marginRight);d=n+a.element.offsetWidth+t}if(d>e){if(s)i===r&&(l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._element&&this._element.appendChild(l));else{let t;if(t=r>0&&r<=i?(d-e)/(i-1):(d-e)/i,t<o){for(let e=0;e<=i;e++){const n=e!==r&&0!==e?"-"+P(t):"";this._tabs[e].element.style.zIndex=P(i-e),this._tabs[e].element.style.marginLeft=n}this._lastVisibleTabIndex=i,l.parentElement!==this._element&&this._element.appendChild(l)}else s=!0}if(s&&i!==r){if(!t)return!1;l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._dropdownElement&&this._dropdownElement.appendChild(l)}}else this._lastVisibleTabIndex=i,l.style.zIndex="auto",l.style.marginLeft="",l.parentElement!==this._element&&this._element.appendChild(l)}}return!0}showAdditionalTabsDropdown(){this._dropdownElement.style.display=""}hideAdditionalTabsDropdown(){this._dropdownElement.style.display="none"}handleTabCloseEvent(t){this._componentRemoveEvent(t)}handleTabFocusEvent(t){this._componentFocusEvent(t)}handleTabDragStartEvent(t,e,i,n){this._componentDragStartEvent(t,e,i,n)}}class ot extends Q{constructor(t,e,i,n,s,o,r,a,l,h,d,c,u){super(),this._layoutManager=t,this._parent=e,this._configClosable=n,this._getActiveComponentItemEvent=s,this._popoutEvent=r,this._maximiseToggleEvent=a,this._clickEvent=l,this._touchStartEvent=h,this._componentRemoveEvent=d,this._componentFocusEvent=c,this._componentDragStartEvent=u,this._clickListener=t=>this.onClick(t),this._touchStartListener=t=>this.onTouchStart(t),this._rowColumnClosable=!0,this._closeButton=null,this._popoutButton=null,this._tabsContainer=new st(this._layoutManager,t=>this.handleTabInitiatedComponentRemoveEvent(t),t=>this.handleTabInitiatedComponentFocusEvent(t),(t,e,i,n)=>this.handleTabInitiatedDragStartEvent(t,e,i,n),()=>this.processTabDropdownActiveChanged()),this._show=i.show,this._popoutEnabled=i.popoutEnabled,this._popoutLabel=i.popoutLabel,this._maximiseEnabled=i.maximiseEnabled,this._maximiseLabel=i.maximiseLabel,this._minimiseEnabled=i.minimiseEnabled,this._minimiseLabel=i.minimiseLabel,this._closeEnabled=i.closeEnabled,this._closeLabel=i.closeLabel,this._tabDropdownEnabled=i.tabDropdownEnabled,this._tabDropdownLabel=i.tabDropdownLabel,this.setSide(i.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this._element.appendChild(this._tabsContainer.element),this._element.appendChild(this._controlsContainerElement),this._element.appendChild(this._tabsContainer.dropdownElement),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartListener,{passive:!0}),this._documentMouseUpListener=()=>this._tabsContainer.hideAdditionalTabsDropdown(),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownEnabled&&(this._tabDropdownButton=new et(this,this._tabDropdownLabel,"lm_tabdropdown",()=>this._tabsContainer.showAdditionalTabsDropdown())),this._popoutEnabled&&(this._popoutButton=new et(this,this._popoutLabel,"lm_popout",()=>this.handleButtonPopoutEvent())),this._maximiseEnabled&&(this._maximiseButton=new et(this,this._maximiseLabel,"lm_maximise",t=>this.handleButtonMaximiseToggleEvent(t))),this._configClosable&&(this._closeButton=new et(this,this._closeLabel,"lm_close",()=>o())),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get lastVisibleTabIndex(){return this._tabsContainer.lastVisibleTabIndex}get element(){return this._element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}destroy(){this.emit("destroy"),this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove()}createTab(t,e){this._tabsContainer.createTab(t,e)}removeTab(t){this._tabsContainer.removeTab(t)}processActiveComponentChanged(t){this._tabsContainer.processActiveComponentChanged(t),this.updateTabSizes()}setSide(t){this._side=t,this._leftRightSided=[h.right,h.left].includes(this._side)}setRowColumnClosable(t){this._rowColumnClosable=t,this.updateClosability()}updateClosability(){let t;if(this._configClosable)if(this._rowColumnClosable){t=!0;const e=this.tabs.length;for(let i=0;i<e;i++)if(!this._tabsContainer.tabs[i].componentItem.isClosable){t=!1;break}}else t=!1;else t=!1;null!==this._closeButton&&T(this._closeButton.element,t),null!==this._popoutButton&&T(this._popoutButton.element,t),this._canRemoveComponent=t||this._tabsContainer.tabCount>1}applyFocusedValue(t){t?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(void 0===this._maximiseButton)throw new o("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(void 0===this._maximiseButton)throw new o("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){if(this._tabsContainer.tabCount>0){const t=this._show?this._layoutManager.layoutConfig.dimensions.headerHeight:0;let e;this._leftRightSided?(this._element.style.height="",this._element.style.width=P(t)):(this._element.style.width="",this._element.style.height=P(t)),e=this._leftRightSided?this._element.offsetHeight-this._controlsContainerElement.offsetHeight-this._tabControlOffset:this._element.offsetWidth-this._controlsContainerElement.offsetWidth-this._tabControlOffset,this._tabsContainer.updateTabSizes(e,this._getActiveComponentItemEvent())}}handleTabInitiatedComponentRemoveEvent(t){if(this._canRemoveComponent){if(void 0===this._componentRemoveEvent)throw new o("HHTCE22294");this._componentRemoveEvent(t)}}handleTabInitiatedComponentFocusEvent(t){if(void 0===this._componentFocusEvent)throw new o("HHTAE22294");this._componentFocusEvent(t)}handleTabInitiatedDragStartEvent(t,e,i,n){if(this._canRemoveComponent){if(void 0===this._componentDragStartEvent)throw new o("HHTDSE22294");this._componentDragStartEvent(t,e,i,n)}else i.cancelDrag()}processTabDropdownActiveChanged(){void 0!==this._tabDropdownButton&&T(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonPopoutEvent(){if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(void 0===this._popoutEvent)throw new o("HHBPOE17834");this._popoutEvent()}else{const t=this._getActiveComponentItemEvent();t&&t.popout()}}handleButtonMaximiseToggleEvent(t){if(void 0===this._maximiseToggleEvent)throw new o("HHBMTE16834");this._maximiseToggleEvent()}onClick(t){t.target===this._element&&this.notifyClick(t)}onTouchStart(t){t.target===this._element&&this.notifyTouchStart(t)}notifyClick(t){if(void 0===this._clickEvent)throw new o("HNHC46834");this._clickEvent(t)}notifyTouchStart(t){if(void 0===this._touchStartEvent)throw new o("HNHTS46834");this._touchStartEvent(t)}}class rt extends Q{constructor(t,e,i,n,s,o,r,a,l){super(),this._config=t,this._parent=e,this._layoutManager=i,this._element=n,this._updateItemConfigEvent=s,this._showEvent=o,this._hideEvent=r,this._focusEvent=a,this._blurEvent=l,this._stackMaximised=!1,this._width=0,this._height=0,this._visible=!0,this._isShownWithZeroDimensions=!0,this._componentType=t.componentType,this._isClosable=t.isClosable,this._initialState=t.componentState,this._state=this._initialState,this._boundComponent=this.layoutManager.bindComponent(this,t),this.updateElementPositionPropertyFromBoundComponent()}get width(){return this._width}get height(){return this._height}get parent(){return this._parent}get componentName(){return this._componentType}get componentType(){return this._componentType}get virtual(){return this._boundComponent.virtual}get component(){return this._boundComponent.component}get tab(){return this._tab}get title(){return this._parent.title}get layoutManager(){return this._layoutManager}get isHidden(){return!this._visible}get visible(){return this._visible}get state(){return this._state}get initialState(){return this._initialState}get element(){return this._element}destroy(){this.releaseComponent(),this.stateRequestEvent=void 0,this.emit("destroy")}getElement(){return this._element}hide(){this._hideEvent()}show(){this._showEvent()}focus(t=!1){this._focusEvent(t)}blur(t=!1){this._blurEvent(t)}setSize(t,i){let n=this._parent;if(n.isColumn||n.isRow||null===n.parent)throw new e("ICSSPRC","ComponentContainer cannot have RowColumn Parent");{let e;do{e=n,n=n.parent}while(null!==n&&!n.isColumn&&!n.isRow);if(null===n)return!1;{const o=n.isColumn?"height":"width",r=this[o];if(null===r)throw new s("ICSSCS11194");{const s=("height"===o?i:t)/(r*(1/(e.size/100)))*100,a=(e.size-s)/(n.contentItems.length-1);for(let t=0;t<n.contentItems.length;t++){const i=n.contentItems[t];i===e?i.size=s:i.size+=a}return n.updateSize(!1),!0}}}}close(){this._isClosable&&(this.emit("close"),this._parent.close())}replaceComponent(t){if(this.releaseComponent(),!G.isComponent(t))throw new Error("ReplaceComponent not passed a component ItemConfig");{const e=U.resolve(t,!1);if(this._initialState=e.componentState,this._state=this._initialState,this._componentType=e.componentType,this._updateItemConfigEvent(e),this._boundComponent=this.layoutManager.bindComponent(this,e),this.updateElementPositionPropertyFromBoundComponent(),this._boundComponent.virtual){if(void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,this._visible),void 0!==this.virtualRectingRequiredEvent){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}this.setBaseLogicalZIndex()}this.emit("stateChanged")}}getState(){return this._state}extendState(t){const e=A(this._state,t);this.setState(e)}setState(t){this._state=t,this._parent.emitBaseBubblingEvent("stateChanged")}setTitle(t){this._parent.setTitle(t)}setTab(t){this._tab=t,this.emit("tab",t)}setVisibility(t){this._boundComponent.virtual&&void 0!==this.virtualVisibilityChangeRequiredEvent&&this.virtualVisibilityChangeRequiredEvent(this,t),t?this._visible?!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow()):(this._visible=!0,0===this._height&&0===this._width?this._isShownWithZeroDimensions=!0:(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow())):this._visible&&(this._visible=!1,this._isShownWithZeroDimensions=!1,this.emitHide())}setBaseLogicalZIndex(){this.setLogicalZIndex(d.base)}setLogicalZIndex(t){t!==this._logicalZIndex&&(this._logicalZIndex=t,this.notifyVirtualZIndexChangeRequired())}enterDragMode(t,e){this._width=t,this._height=e,R(this._element,t),M(this._element,e),this.setLogicalZIndex(d.drag),this.drag()}exitDragMode(){this.setBaseLogicalZIndex()}enterStackMaximised(){this._stackMaximised=!0,this.setLogicalZIndex(d.stackMaximised)}exitStackMaximised(){this.setBaseLogicalZIndex(),this._stackMaximised=!1}drag(){if(this._boundComponent.virtual&&void 0!==this.virtualRectingRequiredEvent){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}}setSizeToNodeSize(t,e,i){(t!==this._width||e!==this._height||i)&&(this._width=t,this._height=e,R(this._element,t),M(this._element,e),this._boundComponent.virtual?this.addVirtualSizedContainerToLayoutManager():(this.emit("resize"),this.checkShownFromZeroDimensions()))}notifyVirtualRectingRequired(){void 0!==this.virtualRectingRequiredEvent&&(this.virtualRectingRequiredEvent(this,this._width,this._height),this.emit("resize"),this.checkShownFromZeroDimensions())}notifyVirtualZIndexChangeRequired(){if(void 0!==this.virtualZIndexChangeRequiredEvent){const t=this._logicalZIndex,e=c[t];this.virtualZIndexChangeRequiredEvent(this,t,e)}}updateElementPositionPropertyFromBoundComponent(){this._boundComponent.virtual?this._element.style.position="static":this._element.style.position=""}addVirtualSizedContainerToLayoutManager(){this._layoutManager.beginVirtualSizedContainerAdding();try{this._layoutManager.addVirtualSizedContainer(this)}finally{this._layoutManager.endVirtualSizedContainerAdding()}}checkShownFromZeroDimensions(){!this._isShownWithZeroDimensions||0===this._height&&0===this._width||(this._isShownWithZeroDimensions=!1,this.emitShow())}emitShow(){this.emit("shown"),this.emit("show")}emitHide(){this.emit("hide")}releaseComponent(){this._stackMaximised&&this.exitStackMaximised(),this.emit("beforeComponentRelease",this._boundComponent.component),this.layoutManager.unbindComponent(this,this._boundComponent.virtual,this._boundComponent.component)}}class at extends Q{constructor(t,e,i,n){super(),this.layoutManager=t,this._parent=i,this._element=n,this._popInParentIds=[],this._type=e.type,this._id=e.id,this._isInitialised=!1,this.isGround=!1,this.isRow=!1,this.isColumn=!1,this.isStack=!1,this.isComponent=!1,this.size=e.size,this.sizeUnit=e.sizeUnit,this.minSize=e.minSize,this.minSizeUnit=e.minSizeUnit,this._isClosable=e.isClosable,this._pendingEventPropagations={},this._throttledEvents=["stateChanged"],this._contentItems=this.createContentItems(e.content)}get type(){return this._type}get id(){return this._id}set id(t){this._id=t}get popInParentIds(){return this._popInParentIds}get parent(){return this._parent}get contentItems(){return this._contentItems}get isClosable(){return this._isClosable}get element(){return this._element}get isInitialised(){return this._isInitialised}static isStack(t){return t.isStack}static isComponentItem(t){return t.isComponent}static isComponentParentableItem(t){return t.isStack||t.isGround}removeChild(t,e=!1){const i=this._contentItems.indexOf(t);if(-1===i)throw new Error("Can't remove child item. Unknown content item");if(e||this._contentItems[i].destroy(),this._contentItems.splice(i,1),this._contentItems.length>0)this.updateSize(!1);else if(!this.isGround&&!0===this._isClosable){if(null===this._parent)throw new s("CIUC00874");this._parent.removeChild(this)}}addChild(t,e,i){return null!=e||(e=this._contentItems.length),this._contentItems.splice(e,0,t),t.setParent(this),!0===this._isInitialised&&!1===t._isInitialised&&t.init(),e}replaceChild(t,i,n=!1){const o=this._contentItems.indexOf(t),r=t._element.parentNode;if(-1===o)throw new e("CIRCI23232","Can't replace child. oldChild is not child of this");if(null===r)throw new s("CIRCP23232");if(r.replaceChild(i._element,t._element),!0===n&&(t._parent=null,t.destroy()),this._contentItems[o]=i,i.setParent(this),i.size=t.size,i.sizeUnit=t.sizeUnit,i.minSize=t.minSize,i.minSizeUnit=t.minSizeUnit,null===i._parent)throw new s("CIRCNC45699");!0===i._parent._isInitialised&&!1===i._isInitialised&&i.init(),this.updateSize(!1)}remove(){if(null===this._parent)throw new s("CIR11110");this._parent.removeChild(this)}popout(){const t=z(),e=this.layoutManager.createPopoutFromContentItem(this,void 0,t,void 0);return this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this._contentItems,e=t.length,i=new Array(e);for(let n=0;n<e;n++){const e=t[n];i[n]=e.toConfig()}return i}highlightDropZone(t,e,i){const n=this.layoutManager.dropTargetIndicator;if(null===n)throw new s("ACIHDZ5593");n.highlightArea(i,1)}onDrop(t,e){this.addChild(t)}show(){this.layoutManager.beginSizeInvalidation();try{T(this._element,!0);for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].show()}finally{this.layoutManager.endSizeInvalidation()}}destroy(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].destroy();this._contentItems=[],this.emitBaseBubblingEvent("beforeItemDestroyed"),this._element.remove(),this.emitBaseBubblingEvent("itemDestroyed")}getElementArea(t){const e=(t=null!=t?t:this._element).getBoundingClientRect(),i=e.top+document.body.scrollTop,n=e.left+document.body.scrollLeft,s=e.width,o=e.height;return{x1:n,y1:i,x2:n+s,y2:i+o,surface:s*o,contentItem:this}}init(){this._isInitialised=!0,this.emitBaseBubblingEvent("itemCreated"),this.emitUnknownBubblingEvent(this.type+"Created")}setParent(t){this._parent=t}addPopInParentId(t){this.popInParentIds.includes(t)||this.popInParentIds.push(t)}initContentItems(){for(let t=0;t<this._contentItems.length;t++)this._contentItems[t].init()}hide(){this.layoutManager.beginSizeInvalidation();try{T(this._element,!1)}finally{this.layoutManager.endSizeInvalidation()}}updateContentItemsSize(t){for(let e=0;e<this._contentItems.length;e++)this._contentItems[e].updateSize(t)}createContentItems(t){const e=t.length,i=new Array(e);for(let e=0;e<t.length;e++)i[e]=this.layoutManager.createContentItem(t[e],this);return i}propagateEvent(t,e){if(1===e.length){const i=e[0];i instanceof Q.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}tryBubbleEvent(t,e){if(1===e.length){const i=e[0];i instanceof Q.BubblingEvent&&!1===i.isPropagationStopped&&!0===this._isInitialised&&(!1===this.isGround&&this._parent?this._parent.emitUnknown(t,i):this.scheduleEventPropagationToLayoutManager(t,i))}}scheduleEventPropagationToLayoutManager(t,e){-1===this._throttledEvents.indexOf(t)?this.layoutManager.emitUnknown(t,e):!0!==this._pendingEventPropagations[t]&&(this._pendingEventPropagations[t]=!0,globalThis.requestAnimationFrame(()=>this.propagateEventToLayoutManager(t,e)))}propagateEventToLayoutManager(t,e){this._pendingEventPropagations[t]=!1,this.layoutManager.emitUnknown(t,e)}}class lt extends at{constructor(t,e,i){super(t,e,i,document.createElement("div")),this._parentItem=i,this._focused=!1,this.isComponent=!0,this._reorderEnabled=e.reorderEnabled,this.applyUpdatableConfig(e),this._initialWantMaximise=e.maximised;const n=document.createElement("div");n.classList.add("lm_content"),this.element.appendChild(n),this._container=new rt(e,this,t,n,t=>this.handleUpdateItemConfigEvent(t),()=>this.show(),()=>this.hide(),t=>this.focus(t),t=>this.blur(t))}get componentName(){return this._container.componentType}get componentType(){return this._container.componentType}get reorderEnabled(){return this._reorderEnabled}get initialWantMaximise(){return this._initialWantMaximise}get component(){return this._container.component}get container(){return this._container}get parentItem(){return this._parentItem}get headerConfig(){return this._headerConfig}get title(){return this._title}get tab(){return this._tab}get focused(){return this._focused}destroy(){this._container.destroy(),super.destroy()}applyUpdatableConfig(t){this.setTitle(t.title),this._headerConfig=t.header}toConfig(){const t=this._container.stateRequestEvent,e=void 0===t?this._container.state:t();return{type:p.component,content:[],size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,maximised:!1,isClosable:this.isClosable,reorderEnabled:this._reorderEnabled,title:this._title,header:v.Header.createCopy(this._headerConfig),componentType:_.copyComponentType(this.componentType),componentState:e}}close(){if(null===this.parent)throw new s("CIC68883");this.parent.removeChild(this,!1)}enterDragMode(t,e){R(this.element,t),M(this.element,e),this._container.enterDragMode(t,e)}exitDragMode(){this._container.exitDragMode()}enterStackMaximised(){this._container.enterStackMaximised()}exitStackMaximised(){this._container.exitStackMaximised()}drag(){this._container.drag()}updateSize(t){this.updateNodeSize(t)}init(){this.updateNodeSize(!1),super.init(),this._container.emit("open"),this.initContentItems()}setTitle(t){this._title=t,this.emit("titleChanged",t),this.emit("stateChanged")}setTab(t){this._tab=t,this.emit("tab",t),this._container.setTab(t)}hide(){super.hide(),this._container.setVisibility(!1)}show(){super.show(),this._container.setVisibility(!0)}focus(t=!1){this.parentItem.setActiveComponentItem(this,!0,t)}setFocused(t){this._focused=!0,this.tab.setFocused(),t||this.emitBaseBubblingEvent("focus")}blur(t=!1){this._focused&&this.layoutManager.setFocusedComponentItem(void 0,t)}setBlurred(t){this._focused=!1,this.tab.setBlurred(),t||this.emitBaseBubblingEvent("blur")}setParent(t){this._parentItem=t,super.setParent(t)}handleUpdateItemConfigEvent(t){this.applyUpdatableConfig(t)}updateNodeSize(t){if("none"!==this.element.style.display){const{width:e,height:i}=L(this.element);this._container.setSizeToNodeSize(e,i,t)}}}class ht extends at{constructor(){super(...arguments),this._focused=!1}get focused(){return this._focused}setFocusedValue(t){this._focused=t}}class dt extends ht{constructor(t,e,i){var n,s,o,r,a,l,d,c,u,p,m,g,f,v,b,_,w,y,C;super(t,e,i,dt.createElement(document)),this._headerSideChanged=!1,this._resizeListener=()=>this.handleResize(),this._maximisedListener=()=>this.handleMaximised(),this._minimisedListener=()=>this.handleMinimised(),this._headerConfig=e.header;const x=t.layoutConfig.header,E=e.content;let S;S=1!==E.length?void 0:E[0].header,this._initialWantMaximise=e.maximised,this._initialActiveItemIndex=null!==(n=e.activeItemIndex)&&void 0!==n?n:0;const P=null!==(r=null!==(o=null===(s=this._headerConfig)||void 0===s?void 0:s.show)&&void 0!==o?o:null==S?void 0:S.show)&&void 0!==r?r:x.show,k=null!==(d=null!==(l=null===(a=this._headerConfig)||void 0===a?void 0:a.popout)&&void 0!==l?l:null==S?void 0:S.popout)&&void 0!==d?d:x.popout,I=null!==(p=null!==(u=null===(c=this._headerConfig)||void 0===c?void 0:c.maximise)&&void 0!==u?u:null==S?void 0:S.maximise)&&void 0!==p?p:x.maximise,R=null!==(f=null!==(g=null===(m=this._headerConfig)||void 0===m?void 0:m.close)&&void 0!==g?g:null==S?void 0:S.close)&&void 0!==f?f:x.close,M=null!==(_=null!==(b=null===(v=this._headerConfig)||void 0===v?void 0:v.minimise)&&void 0!==b?b:null==S?void 0:S.minimise)&&void 0!==_?_:x.minimise,L=null!==(C=null!==(y=null===(w=this._headerConfig)||void 0===w?void 0:w.tabDropdown)&&void 0!==y?y:null==S?void 0:S.tabDropdown)&&void 0!==C?C:x.tabDropdown;this._maximisedEnabled=!1!==I;const T={show:!1!==P,side:!1===P?h.top:P,popoutEnabled:!1!==k,popoutLabel:!1===k?"":k,maximiseEnabled:this._maximisedEnabled,maximiseLabel:!1===I?"":I,closeEnabled:!1!==R,closeLabel:!1===R?"":R,minimiseEnabled:!0,minimiseLabel:M,tabDropdownEnabled:!1!==L,tabDropdownLabel:!1===L?"":L};this._header=new ot(t,this,T,e.isClosable&&!1!==R,()=>this.getActiveComponentItem(),()=>this.remove(),()=>this.handlePopoutEvent(),()=>this.toggleMaximise(),t=>this.handleHeaderClickEvent(t),t=>this.handleHeaderTouchStartEvent(t),t=>this.handleHeaderComponentRemoveEvent(t),t=>this.handleHeaderComponentFocusEvent(t),(t,e,i,n)=>this.handleHeaderComponentStartDragEvent(t,e,i,n)),this.isStack=!0,this._childElementContainer=document.createElement("section"),this._childElementContainer.classList.add("lm_items"),this.on("resize",this._resizeListener),this._maximisedEnabled&&(this.on("maximised",this._maximisedListener),this.on("minimised",this._minimisedListener)),this.element.appendChild(this._header.element),this.element.appendChild(this._childElementContainer),this.setupHeaderPosition(),this._header.updateClosability()}get childElementContainer(){return this._childElementContainer}get header(){return this._header}get headerShow(){return this._header.show}get headerSide(){return this._header.side}get headerLeftRightSided(){return this._header.leftRightSided}get contentAreaDimensions(){return this._contentAreaDimensions}get initialWantMaximise(){return this._initialWantMaximise}get isMaximised(){return this===this.layoutManager.maximisedStack}get stackParent(){if(!this.parent)throw new Error("Stack should always have a parent");return this.parent}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(!0===this.isInitialised)return;this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();const t=this.contentItems,e=t.length;if(e>0){if(this._initialActiveItemIndex<0||this._initialActiveItemIndex>=e)throw new Error(`ActiveItemIndex out of range: ${this._initialActiveItemIndex} id: ${this.id}`);for(let i=0;i<e;i++){const e=t[i];if(!(e instanceof lt))throw new Error(`Stack Content Item is not of type ComponentItem: ${i} id: ${this.id}`);this._header.createTab(e,i),e.hide(),e.container.setBaseLogicalZIndex()}this.setActiveComponentItem(t[this._initialActiveItemIndex],!1),this._header.updateTabSizes()}this._header.updateClosability(),this.initContentItems()}setActiveContentItem(t){if(!at.isComponentItem(t))throw new Error("Stack.setActiveContentItem: item is not a ComponentItem");this.setActiveComponentItem(t,!1)}setActiveComponentItem(t,e,i=!1){if(this._activeComponentItem!==t){if(-1===this.contentItems.indexOf(t))throw new Error("componentItem is not a child of this stack");this.layoutManager.beginSizeInvalidation();try{void 0!==this._activeComponentItem&&this._activeComponentItem.hide(),this._activeComponentItem=t,this._header.processActiveComponentChanged(t),t.show()}finally{this.layoutManager.endSizeInvalidation()}this.emit("activeContentItemChanged",t),this.layoutManager.emit("activeContentItemChanged",t),this.emitStateChangedEvent()}(this.focused||e)&&this.layoutManager.setFocusedComponentItem(t,i)}getActiveContentItem(){var t;return null!==(t=this.getActiveComponentItem())&&void 0!==t?t:null}getActiveComponentItem(){return this._activeComponentItem}focusActiveContentItem(){var t;null===(t=this._activeComponentItem)||void 0===t||t.focus()}setFocusedValue(t){this._header.applyFocusedValue(t),super.setFocusedValue(t)}setRowColumnClosable(t){this._header.setRowColumnClosable(t)}newComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.newItem(s,n)}addComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItem(s,n)}newItem(t,e){return e=this.addItem(t,e),this.contentItems[e]}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e)}addChild(t,i,n=!1){if(void 0!==i&&i>this.contentItems.length)throw i-=1,new e("SAC99728");if(t instanceof lt)return i=super.addChild(t,i),this._childElementContainer.appendChild(t.element),this._header.createTab(t,i),this.setActiveComponentItem(t,n),this._header.updateTabSizes(),this.updateSize(!1),t.container.setBaseLogicalZIndex(),this._header.updateClosability(),this.emitStateChangedEvent(),i;throw new e("SACC88532")}removeChild(t,e){const i=t,n=this.contentItems.indexOf(i),s=1===this.contentItems.length;if(this._activeComponentItem===i&&(i.focused&&i.blur(),!s)){const t=0===n?1:n-1;this.setActiveComponentItem(this.contentItems[t],!1)}this._header.removeTab(i),super.removeChild(i,e),s||this._header.updateClosability(),this.emitStateChangedEvent()}toggleMaximise(){this.isMaximised?this.minimise():this.maximise()}maximise(){if(!this.isMaximised){this.layoutManager.setMaximisedStack(this);const t=this.contentItems,i=t.length;for(let n=0;n<i;n++){const i=t[n];if(!(i instanceof lt))throw new e("SMAXI87773");i.enterStackMaximised()}this.emitStateChangedEvent()}}minimise(){if(this.isMaximised){this.layoutManager.setMaximisedStack(void 0);const t=this.contentItems,i=t.length;for(let n=0;n<i;n++){const i=t[n];if(!(i instanceof lt))throw new e("SMINI87773");i.exitStackMaximised()}this.emitStateChangedEvent()}}destroy(){var t;(null===(t=this._activeComponentItem)||void 0===t?void 0:t.focused)&&this._activeComponentItem.blur(),super.destroy(),this.off("resize",this._resizeListener),this._maximisedEnabled&&(this.off("maximised",this._maximisedListener),this.off("minimised",this._minimisedListener)),this._header.destroy()}toConfig(){let t;if(this._activeComponentItem&&(t=this.contentItems.indexOf(this._activeComponentItem),t<0))throw new Error("active component item not found in stack");if(this.contentItems.length>0&&void 0===t)throw new Error("expected non-empty stack to have an active component item");return{type:"stack",content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable,maximised:this.isMaximised,header:this.createHeaderConfig(),activeItemIndex:t}}onDrop(t,e){if("header"===this._dropSegment){if(this.resetHeaderDropZone(),void 0===this._dropIndex)throw new o("SODDI68990");return void this.addChild(t,this._dropIndex)}if("body"===this._dropSegment)return void this.addChild(t,0,!0);const i="top"===this._dropSegment||"bottom"===this._dropSegment,n="left"===this._dropSegment||"right"===this._dropSegment,s="top"===this._dropSegment||"left"===this._dropSegment,r=i&&this.stackParent.isColumn||n&&this.stackParent.isRow;if(t.isComponent){const e=b.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createAndInitContentItem(e,this);i.addChild(t),t=i}if(t.type===p.row||t.type===p.column){const e=b.createDefault();e.header=this.createHeaderConfig();const i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}if(r){const e=this.stackParent.contentItems.indexOf(this);this.stackParent.addChild(t,s?e:e+1,!0),this.size*=.5,t.size=this.size,t.sizeUnit=this.sizeUnit,this.stackParent.updateSize(!1)}else{const e=i?p.column:p.row,n=f.createDefault(e),o=this.layoutManager.createContentItem(n,this);this.stackParent.replaceChild(this,o),o.addChild(t,s?0:void 0,!0),o.addChild(this,s?void 0:0,!0),this.size=50,t.size=50,t.sizeUnit=g.Percent,o.updateSize(!1)}}highlightDropZone(t,e){for(const i in this._contentAreaDimensions){const n=i,s=this._contentAreaDimensions[n].hoverArea;if(s.x1<t&&s.x2>t&&s.y1<e&&s.y2>e)return void("header"===n?(this._dropSegment="header",this.highlightHeaderDropZone(this._header.leftRightSided?e:t)):(this.resetHeaderDropZone(),this.highlightBodyDropZone(n)))}}getArea(){if("none"===this.element.style.display)return null;const t=super.getElementArea(this._header.element),e=super.getElementArea(this._childElementContainer);if(null===t||null===e)throw new s("SGAHC13086");const i=e.x2-e.x1,n=e.y2-e.y1;return this._contentAreaDimensions={header:{hoverArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2},highlightArea:{x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}}},0===this.contentItems.length?(this._contentAreaDimensions.body={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}},super.getElementArea(this.element)):(this._contentAreaDimensions.left={hoverArea:{x1:e.x1,y1:e.y1,x2:e.x1+.25*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x1+.5*i,y2:e.y2}},this._contentAreaDimensions.top={hoverArea:{x1:e.x1+.25*i,y1:e.y1,x2:e.x1+.75*i,y2:e.y1+.5*n},highlightArea:{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y1+.5*n}},this._contentAreaDimensions.right={hoverArea:{x1:e.x1+.75*i,y1:e.y1,x2:e.x2,y2:e.y2},highlightArea:{x1:e.x1+.5*i,y1:e.y1,x2:e.x2,y2:e.y2}},this._contentAreaDimensions.bottom={hoverArea:{x1:e.x1+.25*i,y1:e.y1+.5*n,x2:e.x1+.75*i,y2:e.y2},highlightArea:{x1:e.x1,y1:e.y1+.5*n,x2:e.x2,y2:e.y2}},super.getElementArea(this.element))}positionHeader(t){this._header.side!==t&&(this._header.setSide(t),this._headerSideChanged=!0,this.setupHeaderPosition())}updateNodeSize(){if("none"!==this.element.style.display){const t=L(this.element);this._header.show&&(t[this._header.leftRightSided?l.width:l.height]-=this.layoutManager.layoutConfig.dimensions.headerHeight),this._childElementContainer.style.width=P(t.width),this._childElementContainer.style.height=P(t.height);for(let e=0;e<this.contentItems.length;e++)this.contentItems[e].element.style.width=P(t.width),this.contentItems[e].element.style.height=P(t.height);this.emit("resize"),this.emitStateChangedEvent()}}highlightHeaderDropZone(t){const e=this._header.lastVisibleTabIndex+1,i=this._header.tabsContainerElement.childNodes,n=new Array(e);let o=0,r=0;for(;r<e;){const t=i[o++];t!==this.layoutManager.tabDropPlaceholder&&(n[r++]=t)}const a=this.layoutManager.dropTargetIndicator;if(null===a)throw new s("SHHDZDTI97110");let l;if(0===e){const t=this._header.element.getBoundingClientRect(),e=t.top+document.body.scrollTop,i=t.left+document.body.scrollLeft;l={x1:i,x2:i+100,y1:e+t.height-20,y2:e+t.height},this._dropIndex=0}else{let i,s,o,r,a=0,h=!1;do{r=n[a];const e=r.getBoundingClientRect(),l=e.top+document.body.scrollTop,d=e.left+document.body.scrollLeft;this._header.leftRightSided?(s=l,i=d,o=e.height):(s=d,i=l,o=e.width),t>=s&&t<s+o?h=!0:a++}while(a<e&&!h);if(!1===h&&t<s)return;t<s+o/2?(this._dropIndex=a,r.insertAdjacentElement("beforebegin",this.layoutManager.tabDropPlaceholder)):(this._dropIndex=Math.min(a+1,e),r.insertAdjacentElement("afterend",this.layoutManager.tabDropPlaceholder));const d=this.layoutManager.tabDropPlaceholder.getBoundingClientRect(),c=d.top+document.body.scrollTop,u=d.left+document.body.scrollLeft,p=d.width;if(this._header.leftRightSided){const t=c;l={x1:i,x2:i+r.clientHeight,y1:t,y2:t+p}}else l={x1:u,x2:u+p,y1:i,y2:i+r.clientHeight}}a.highlightArea(l,0)}resetHeaderDropZone(){this.layoutManager.tabDropPlaceholder.remove()}setupHeaderPosition(){T(this._header.element,this._header.show),this.element.classList.remove("lm_left","lm_right","lm_bottom"),this._header.leftRightSided&&this.element.classList.add("lm_"+this._header.side),this.updateSize(!1)}highlightBodyDropZone(t){if(void 0===this._contentAreaDimensions)throw new o("SHBDZC82265");{const e=this._contentAreaDimensions[t].highlightArea,i=this.layoutManager.dropTargetIndicator;if(null===i)throw new s("SHBDZD96110");i.highlightArea(e,1),this._dropSegment=t}}handleResize(){this._header.updateTabSizes()}handleMaximised(){this._header.processMaximised()}handleMinimised(){this._header.processMinimised()}handlePopoutEvent(){this.popout()}handleHeaderClickEvent(t){const e=Q.headerClickEventName,i=new Q.ClickBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderTouchStartEvent(t){const e=Q.headerTouchStartEventName,i=new Q.TouchStartBubblingEvent(e,this,t);this.emit(e,i)}handleHeaderComponentRemoveEvent(t){this.removeChild(t,!1)}handleHeaderComponentFocusEvent(t){this.setActiveComponentItem(t,!0)}handleHeaderComponentStartDragEvent(t,e,i,n){!0===this.isMaximised&&this.toggleMaximise(),this.layoutManager.startComponentDrag(t,e,i,n,this)}createHeaderConfig(){if(this._headerSideChanged){const t=!!this._header.show&&this._header.side;let e=v.Header.createCopy(this._headerConfig,t);return void 0===e&&(e={show:t,popout:void 0,maximise:void 0,close:void 0,minimise:void 0,tabDropdown:void 0}),e}return v.Header.createCopy(this._headerConfig)}emitStateChangedEvent(){this.emitBaseBubblingEvent("stateChanged")}}!function(t){t.createElement=function(t){const e=t.createElement("div");return e.classList.add("lm_item"),e.classList.add("lm_stack"),e}}(dt||(dt={}));class ct extends Q{constructor(t,e,i,n,o,r){if(super(),this._dragListener=i,this._layoutManager=n,this._componentItem=o,this._originalParent=r,this._area=null,this._lastValidArea=null,this._dragListener.on("drag",(t,e,i)=>this.onDrag(t,e,i)),this._dragListener.on("dragStop",()=>this.onDrop()),this.createDragProxyElements(t,e),null===this._componentItem.parent)throw new s("DPC10097");this._componentItemFocused=this._componentItem.focused,this._componentItemFocused&&this._componentItem.blur(),this._componentItem.parent.removeChild(this._componentItem,!0),this.setDimensions(),document.body.appendChild(this._element),this.determineMinMaxXY(),this._layoutManager.calculateItemAreas(),this.setDropPosition(t,e)}get element(){return this._element}createDragProxyElements(t,e){this._element=document.createElement("div"),this._element.classList.add("lm_dragProxy");const i=document.createElement("div");i.classList.add("lm_header");const n=document.createElement("div");n.classList.add("lm_tabs");const s=document.createElement("div");s.classList.add("lm_tab");const o=document.createElement("span");o.classList.add("lm_title"),s.appendChild(o),n.appendChild(s),i.appendChild(n),this._proxyContainerElement=document.createElement("div"),this._proxyContainerElement.classList.add("lm_content"),this._element.appendChild(i),this._element.appendChild(this._proxyContainerElement),this._originalParent instanceof dt&&this._originalParent.headerShow&&(this._sided=this._originalParent.headerLeftRightSided,this._element.classList.add("lm_"+this._originalParent.headerSide),[h.right,h.bottom].indexOf(this._originalParent.headerSide)>=0&&this._proxyContainerElement.insertAdjacentElement("afterend",i)),this._element.style.left=P(t),this._element.style.top=P(e),s.setAttribute("title",this._componentItem.title),o.insertAdjacentText("afterbegin",this._componentItem.title),this._proxyContainerElement.appendChild(this._componentItem.element)}determineMinMaxXY(){const t=this._layoutManager.groundItem;if(void 0===t)throw new o("DPDMMXY73109");{const e=t.element.getBoundingClientRect();this._minX=e.left+document.body.scrollLeft,this._minY=e.top+document.body.scrollTop,this._maxX=this._minX+e.width,this._maxY=this._minY+e.height}}onDrag(t,e,i){const n=i.pageX,s=i.pageY;this.setDropPosition(n,s),this._componentItem.drag()}setDropPosition(t,e){this._layoutManager.layoutConfig.settings.constrainDragToContainer&&(t<=this._minX?t=Math.ceil(this._minX):t>=this._maxX&&(t=Math.floor(this._maxX)),e<=this._minY?e=Math.ceil(this._minY):e>=this._maxY&&(e=Math.floor(this._maxY))),this._element.style.left=P(t),this._element.style.top=P(e),this._area=this._layoutManager.getArea(t,e),null!==this._area&&(this._lastValidArea=this._area,this._area.contentItem.highlightDropZone(t,e,this._area))}onDrop(){const t=this._layoutManager.dropTargetIndicator;if(null===t)throw new s("DPOD30011");let e;t.hide(),this._componentItem.exitDragMode(),null!==this._area?(e=this._componentItem,this._area.contentItem.onDrop(e,this._area)):null!==this._lastValidArea?(e=this._componentItem,this._lastValidArea.contentItem.onDrop(e,this._lastValidArea)):this._originalParent?(e=this._componentItem,this._originalParent.addChild(e)):this._componentItem.destroy(),this._element.remove(),this._layoutManager.emit("itemDropped",this._componentItem),this._componentItemFocused&&void 0!==e&&e.focus()}setDimensions(){const t=this._layoutManager.layoutConfig.dimensions;if(void 0===t)throw new Error("DragProxy.setDimensions: dimensions undefined");let e=t.dragProxyWidth,i=t.dragProxyHeight;if(void 0===e||void 0===i)throw new Error("DragProxy.setDimensions: width and/or height undefined");const n=!1===this._layoutManager.layoutConfig.header.show?0:t.headerHeight;this._element.style.width=P(e),this._element.style.height=P(i),e-=this._sided?n:0,i-=this._sided?0:n,this._proxyContainerElement.style.width=P(e),this._proxyContainerElement.style.height=P(i),this._componentItem.enterDragMode(e,i),this._componentItem.show()}}class ut{constructor(t,e,i){this._isVertical=t,this._size=e,this._grabSize=i<this._size?this._size:i,this._element=document.createElement("div"),this._element.classList.add("lm_splitter");const n=document.createElement("div");n.classList.add("lm_drag_handle");const s=this._grabSize-this._size,o=s/2;this._isVertical?(n.style.top=P(-o),n.style.height=P(this._size+s),this._element.classList.add("lm_vertical"),this._element.style.height=P(this._size)):(n.style.left=P(-o),n.style.width=P(this._size+s),this._element.classList.add("lm_horizontal"),this._element.style.width=P(this._size)),this._element.appendChild(n),this._dragListener=new it(this._element,[n])}get element(){return this._element}destroy(){this._element.remove()}on(t,e){this._dragListener.on(t,e)}}class pt extends at{constructor(t,i,n,s){switch(super(i,n,s,pt.createElement(document,t)),this._rowOrColumnParent=s,this._splitter=[],this.isRow=!t,this.isColumn=t,this._childElementContainer=this.element,this._splitterSize=i.layoutConfig.dimensions.borderWidth,this._splitterGrabSize=i.layoutConfig.dimensions.borderGrabWidth,this._isColumn=t,this._dimension=t?"height":"width",this._splitterPosition=null,this._splitterMinPosition=null,this._splitterMaxPosition=null,n.type){case p.row:case p.column:this._configType=n.type;break;default:throw new e("ROCCCT00925")}}newComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.newItem(s,n)}addComponent(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItem(s,n)}newItem(t,e){e=this.addItem(t,e);const i=this.contentItems[e];return at.isStack(i)&&G.isComponent(t)?i.contentItems[0]:i}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1),n=this.layoutManager.createAndInitContentItem(i,this);return this.addChild(n,e,!1)}addChild(t,e,i){if(void 0===e&&(e=this.contentItems.length),this.contentItems.length>0){const i=this.createSplitter(Math.max(0,e-1)).element;e>0?(this.contentItems[e-1].element.insertAdjacentElement("afterend",i),i.insertAdjacentElement("afterend",t.element)):(this.contentItems[0].element.insertAdjacentElement("beforebegin",i),i.insertAdjacentElement("beforebegin",t.element))}else this._childElementContainer.appendChild(t.element);super.addChild(t,e);const n=1/this.contentItems.length*100;if(!0===i)return this.emitBaseBubblingEvent("stateChanged"),e;for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];if(i===t)t.size=n;else{const t=i.size*=(100-n)/100;i.size=t}}return this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),e}removeChild(t,e){const i=this.contentItems.indexOf(t),n=Math.max(i-1,0);if(-1===i)throw new Error("Can't remove child. ContentItem is not child of this Row or Column");if(this._splitter[n]&&(this._splitter[n].destroy(),this._splitter.splice(n,1)),super.removeChild(t,e),1===this.contentItems.length&&!0===this.isClosable){const t=this.contentItems[0];this.contentItems.length=0,this._rowOrColumnParent.replaceChild(this,t,!0)}else this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}replaceChild(t,e){const i=t.size;super.replaceChild(t,e),e.size=i,this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init();for(let t=0;t<this.contentItems.length-1;t++)this.contentItems[t].element.insertAdjacentElement("afterend",this.createSplitter(t).element);this.initContentItems()}}toConfig(){return{type:this.type,content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable}}setParent(t){this._rowOrColumnParent=t,super.setParent(t)}updateNodeSize(){this.contentItems.length>0&&(this.calculateRelativeSizes(),this.setAbsoluteSizes()),this.emitBaseBubblingEvent("stateChanged"),this.emit("resize")}setAbsoluteSizes(){const t=this.calculateAbsoluteSizes();for(let e=0;e<this.contentItems.length;e++)t.additionalPixel-e>0&&t.itemSizes[e]++,this._isColumn?(R(this.contentItems[e].element,t.crossAxisSize),M(this.contentItems[e].element,t.itemSizes[e])):(R(this.contentItems[e].element,t.itemSizes[e]),M(this.contentItems[e].element,t.crossAxisSize))}calculateAbsoluteSizes(){const t=(this.contentItems.length-1)*this._splitterSize,{width:i,height:n}=L(this.element);let s,o;this._isColumn?(s=n-t,o=i):(s=i-t,o=n);let r=0;const a=[];for(let t=0;t<this.contentItems.length;t++){const i=this.contentItems[t];let n;if(i.sizeUnit!==g.Percent)throw new e("ROCCAS6692");n=Math.floor(s*(i.size/100)),r+=n,a.push(n)}return{itemSizes:a,additionalPixel:Math.floor(s-r),totalSize:s,crossAxisSize:o}}calculateRelativeSizes(){let t=0;const i=[];let n=0;for(let s=0;s<this.contentItems.length;s++){const o=this.contentItems[s];switch(o.sizeUnit){case g.Percent:t+=o.size;break;case g.Fractional:i.push(o),n+=o.size;break;default:throw new e("ROCCRS49110",JSON.stringify(o))}}if(100!==Math.round(t)){if(Math.round(t)<100&&i.length>0){const e=100-t;for(let t=0;t<i.length;t++){const s=i[t];s.size=e*(s.size/n),s.sizeUnit=g.Percent}return void this.respectMinItemSize()}if(Math.round(t)>100&&i.length>0){for(let t=0;t<i.length;t++){const e=i[t];e.size=e.size/n*50,e.sizeUnit=g.Percent}t+=50}for(let e=0;e<this.contentItems.length;e++){const i=this.contentItems[e];i.size=i.size/t*100}this.respectMinItemSize()}else this.respectMinItemSize()}respectMinItemSize(){const t=this.calculateContentItemMinSize(this);if(!(t<=0||this.contentItems.length<=1)){let e=0,i=0;const n=[],s=[],o=this.calculateAbsoluteSizes();for(let r=0;r<o.itemSizes.length;r++){const a=o.itemSizes[r];let l;a<t?(i+=t-a,l={size:t}):(e+=a-t,l={size:a},n.push(l)),s.push(l)}if(0===i||i>e)return;{const r=i/e;let a=i;for(let e=0;e<n.length;e++){const i=n[e],s=Math.round((i.size-t)*r);a-=s,i.size-=s}0!==a&&(s[s.length-1].size-=a);for(let t=0;t<this.contentItems.length;t++)this.contentItems[t].size=s[t].size/o.totalSize*100}}}createSplitter(t){const e=new ut(this._isColumn,this._splitterSize,this._splitterGrabSize);return e.on("drag",(t,i)=>this.onSplitterDrag(e,t,i)),e.on("dragStop",()=>this.onSplitterDragStop(e)),e.on("dragStart",()=>this.onSplitterDragStart(e)),this._splitter.splice(t,0,e),e}getSplitItems(t){const e=this._splitter.indexOf(t);return{before:this.contentItems[e],after:this.contentItems[e+1]}}calculateContentItemMinSize(t){const i=t.minSize;if(void 0!==i){if(t.minSizeUnit===g.Pixel)return i;throw new e("ROCGMD98831",JSON.stringify(t))}{const t=this.layoutManager.layoutConfig.dimensions;return this._isColumn?t.defaultMinItemHeight:t.defaultMinItemWidth}}calculateContentItemsTotalMinSize(t){let e=0;for(const i of t)e+=this.calculateContentItemMinSize(i);return e}onSplitterDragStart(t){const e=this.getSplitItems(t),i=k(e.before.element.style[this._dimension]),n=k(e.after.element.style[this._dimension]),s=this.calculateContentItemsTotalMinSize(e.before.contentItems),o=this.calculateContentItemsTotalMinSize(e.after.contentItems);this._splitterPosition=0,this._splitterMinPosition=-1*(i-s),this._splitterMaxPosition=n-o}onSplitterDrag(t,e,i){let n=this._isColumn?i:e;if(null===this._splitterMinPosition||null===this._splitterMaxPosition)throw new s("ROCOSD59226");n=Math.max(n,this._splitterMinPosition),n=Math.min(n,this._splitterMaxPosition),this._splitterPosition=n;const o=P(n);this._isColumn?t.element.style.top=o:t.element.style.left=o}onSplitterDragStop(t){if(null===this._splitterPosition)throw new s("ROCOSDS66932");{const e=this.getSplitItems(t),i=k(e.before.element.style[this._dimension]),n=k(e.after.element.style[this._dimension]),s=(this._splitterPosition+i)/(i+n),o=e.before.size+e.after.size;e.before.size=s*o,e.after.size=(1-s)*o,t.element.style.top=P(0),t.element.style.left=P(0),globalThis.requestAnimationFrame(()=>this.updateSize(!1))}}}!function(t){t.getElementDimensionSize=function(t,e){return"width"===e?function(t){return t.offsetWidth}(t):function(t){return t.offsetHeight}(t)},t.setElementDimensionSize=function(t,e,i){return"width"===e?R(t,i):M(t,i)},t.createElement=function(t,e){const i=t.createElement("div");return i.classList.add("lm_item"),e?i.classList.add("lm_column"):i.classList.add("lm_row"),i}}(pt||(pt={}));class mt extends ht{constructor(t,e,i){super(t,C.create(e),null,mt.createElement(document)),this.isGround=!0,this._childElementContainer=this.element,this._containerElement=i;let n=null;for(;;){const t=n?n.previousSibling:this._containerElement.lastChild;if(!(t instanceof Element&&t.classList.contains("lm_content")))break;n=t}this._containerElement.insertBefore(this.element,n)}init(){if(!0!==this.isInitialised){this.updateNodeSize();for(let t=0;t<this.contentItems.length;t++)this._childElementContainer.appendChild(this.contentItems[t].element);super.init(),this.initContentItems()}}loadRoot(t){if(this.clearRoot(),void 0!==t){const e=this.layoutManager.createAndInitContentItem(t,this);this.addChild(e,0)}}clearRoot(){const t=this.contentItems;switch(t.length){case 0:return;case 1:return void t[0].remove();default:throw new e("GILR07721")}}addItem(t,e){this.layoutManager.checkMinimiseMaximisedStack();const i=G.resolve(t,!1);let n;if(n=this.contentItems.length>0?this.contentItems[0]:this,n.isComponent)throw new Error("Cannot add item as child to ComponentItem");{const t=this.layoutManager.createAndInitContentItem(i,n);return e=n.addChild(t,e),n===this?-1:e}}loadComponentAsRoot(t){this.clearRoot();const e=G.resolve(t,!1);if(e.maximised)throw new Error("Root Component cannot be maximised");{const t=new lt(this.layoutManager,e,this);t.init(),this.addChild(t,0)}}addChild(t,e){if(this.contentItems.length>0)throw new Error("Ground node can only have a single child");return this._childElementContainer.appendChild(t.element),e=super.addChild(t,e),this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),e}calculateConfigContent(){const t=this.contentItems,i=t.length,n=new Array(i);for(let s=0;s<i;s++){const i=t[s].toConfig();if(!y.isRootItemConfig(i))throw new e("RCCC66832");n[s]=i}return n}setSize(t,e){void 0===t||void 0===e?this.updateSize(!1):(R(this.element,t),M(this.element,e),this.contentItems.length>0&&(R(this.contentItems[0].element,t),M(this.contentItems[0].element,e)),this.updateContentItemsSize(!1))}updateSize(t){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(t)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}createSideAreas(){const t=mt.Area.oppositeSides,e=new Array(Object.keys(t).length);let i=0;for(const n in t){const o=n,r=this.getElementArea();if(null===r)throw new s("RCSA77553");r.side=o,"2"===t[o][1]?r[o]=r[t[o]]-50:r[o]=r[t[o]]+50,r.surface=(r.x2-r.x1)*(r.y2-r.y1),e[i++]=r}return e}highlightDropZone(t,e,i){this.layoutManager.tabDropPlaceholder.remove(),super.highlightDropZone(t,e,i)}onDrop(t,e){if(t.isComponent){const e=b.createDefault(),i=t;e.header=v.Header.createCopy(i.headerConfig);const n=this.layoutManager.createAndInitContentItem(e,this);n.addChild(t),t=n}if(0===this.contentItems.length)this.addChild(t);else{if(t.type===p.row||t.type===p.column){const e=b.createDefault(),i=this.layoutManager.createContentItem(e,this);i.addChild(t),t=i}const i="x"==e.side[0]?p.row:p.column,n="2"==e.side[1],s=this.contentItems[0];if(s instanceof pt&&s.type===i){const e=s.contentItems[n?0:s.contentItems.length-1];s.addChild(t,n?0:void 0,!0),e.size*=.5,t.size=e.size,t.sizeUnit=g.Percent,s.updateSize(!1)}else{const e=f.createDefault(i),o=this.layoutManager.createContentItem(e,this);this.replaceChild(s,o),o.addChild(t,n?0:void 0,!0),o.addChild(s,n?void 0:0,!0),s.size=50,t.size=50,t.sizeUnit=g.Percent,o.updateSize(!1)}}}dock(){throw new e("GID87731")}validateDocking(){throw new e("GIVD87732")}getAllContentItems(){const t=[this];return this.deepGetAllContentItems(this.contentItems,t),t}getConfigMaximisedItems(){const t=[];return this.deepFilterContentItems(this.contentItems,t,t=>!(!at.isStack(t)||!t.initialWantMaximise)||!(!at.isComponentItem(t)||!t.initialWantMaximise)),t}getItemsByPopInParentId(t){const e=[];return this.deepFilterContentItems(this.contentItems,e,e=>e.popInParentIds.includes(t)),e}toConfig(){throw new Error("Cannot generate GroundItem config")}setActiveComponentItem(t,e,i){}updateNodeSize(){const{width:t,height:e}=L(this._containerElement);R(this.element,t),M(this.element,e),this.contentItems.length>0&&(R(this.contentItems[0].element,t),M(this.contentItems[0].element,e))}deepGetAllContentItems(t,e){for(let i=0;i<t.length;i++){const n=t[i];e.push(n),this.deepGetAllContentItems(n.contentItems,e)}}deepFilterContentItems(t,e,i){for(let n=0;n<t.length;n++){const s=t[n];i(s)&&e.push(s),this.deepFilterContentItems(s.contentItems,e,i)}}}!function(t){let e;!function(t){t.oppositeSides={y2:"y1",x2:"x1",y1:"y2",x1:"x2"}}(e=t.Area||(t.Area={})),t.createElement=function(t){const e=t.createElement("div");return e.classList.add("lm_goldenlayout"),e.classList.add("lm_item"),e.classList.add("lm_root"),e}}(mt||(mt={}));class gt{constructor(t,e,i,n,s,o,r){this._layoutManager=t,this._element=e,this._extraAllowableChildTargets=i,this._componentTypeOrFtn=n,this._componentState=s,this._title=o,this._id=r,this._dragListener=null,this._dummyGroundContainer=document.createElement("div");const a=w.createDefault("row");this._dummyGroundContentItem=new mt(this._layoutManager,a,this._dummyGroundContainer),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new it(this._element,this._extraAllowableChildTargets),this._dragListener.on("dragStart",(t,e)=>this.onDragStart(t,e)),this._dragListener.on("dragStop",()=>this.onDragStop())}onDragStart(t,e){var i;const n="component";let o;if("function"==typeof this._componentTypeOrFtn){const t=this._componentTypeOrFtn();o=gt.isDragSourceComponentItemConfig(t)?{type:n,componentState:t.state,componentType:t.type,title:null!==(i=t.title)&&void 0!==i?i:this._title}:t}else o={type:n,componentState:this._componentState,componentType:this._componentTypeOrFtn,title:this._title,id:this._id};const r=U.resolve(o,!1),a=new lt(this._layoutManager,r,this._dummyGroundContentItem);if(this._dummyGroundContentItem.contentItems.push(a),null===this._dragListener)throw new s("DSODSD66746");{const i=new ct(t,e,this._dragListener,this._layoutManager,a,this._dummyGroundContentItem),n=this._layoutManager.transitionIndicator;if(null===n)throw new s("DSODST66746");n.transitionElements(this._element,i.element)}}onDragStop(){this.createDragListener()}removeDragListener(){null!==this._dragListener&&(this._dragListener.destroy(),this._dragListener=null)}}!function(t){t.isDragSourceComponentItemConfig=function(t){return!("componentType"in t)}}(gt||(gt={}));class ft{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_dropTargetIndicator");const t=document.createElement("div");t.classList.add("lm_inner"),this._element.appendChild(t),document.body.appendChild(this._element)}destroy(){this._element.remove()}highlightArea(t,e){this._element.style.left=P(t.x1+e),this._element.style.top=P(t.y1+e),this._element.style.width=P(t.x2-t.x1-e),this._element.style.height=P(t.y2-t.y1-e),this._element.style.display="block"}hide(){T(this._element,!1)}}class vt{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_transition_indicator"),document.body.appendChild(this._element),this._toElement=null,this._fromDimensions=null,this._totalAnimationDuration=200,this._animationStartTime=null}destroy(){this._element.remove()}transitionElements(t,e){}nextAnimationFrame(){}measure(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,width:t.offsetWidth,height:t.offsetHeight}}}class bt extends Q{constructor(t){super(),this._layoutManager=t,this._childEventListener=t=>this.onEventFromChild(t),globalThis.addEventListener(bt.ChildEventName,this._childEventListener,{passive:!0})}emit(t,...e){"userBroadcast"===t?this.emitUserBroadcast(...e):super.emit(t,...e)}emitUserBroadcast(...t){this.handleUserBroadcastEvent("userBroadcast",t)}destroy(){globalThis.removeEventListener(bt.ChildEventName,this._childEventListener)}handleUserBroadcastEvent(t,e){this._layoutManager.isSubWindow?this.propagateToParent(t,e):this.propagateToThisAndSubtree(t,e)}onEventFromChild(t){const e=t.detail;this.handleUserBroadcastEvent(e.eventName,e.args)}propagateToParent(t,e){const i={bubbles:!0,cancelable:!0,detail:{layoutManager:this._layoutManager,eventName:t,args:e}},n=new CustomEvent(bt.ChildEventName,i),o=globalThis.opener;if(null===o)throw new s("EHPTP15778");o.dispatchEvent(n)}propagateToThisAndSubtree(t,e){this.emitUnknown(t,...e);for(let i=0;i<this._layoutManager.openPopouts.length;i++){const n=this._layoutManager.openPopouts[i].getGlInstance();n&&n.eventHub.propagateToThisAndSubtree(t,e)}}}!function(t){t.ChildEventName="gl_child_event"}(bt||(bt={}));class _t extends Q{constructor(t){super(),this.resizeWithContainerAutomatically=!1,this.resizeDebounceInterval=100,this.resizeDebounceExtendedWhenPossible=!0,this._isInitialised=!1,this._groundItem=void 0,this._openPopouts=[],this._dropTargetIndicator=null,this._transitionIndicator=null,this._itemAreas=[],this._maximisePlaceholder=_t.createMaximisePlaceElement(document),this._tabDropPlaceholder=_t.createTabDropPlaceholderElement(document),this._dragSources=[],this._updatingColumnsResponsive=!1,this._firstLoad=!0,this._eventHub=new bt(this),this._width=null,this._height=null,this._virtualSizedContainers=[],this._virtualSizedContainerAddingBeginCount=0,this._sizeInvalidationBeginCount=0,this._resizeObserver=new ResizeObserver(()=>this.handleContainerResize()),this._windowBeforeUnloadListener=()=>this.onBeforeUnload(),this._windowBeforeUnloadListening=!1,this._maximisedStackBeforeDestroyedListener=t=>this.cleanupBeforeMaximisedStackDestroyed(t),this.isSubWindow=t.isSubWindow,this._constructorOrSubWindowLayoutConfig=t.constructorOrSubWindowLayoutConfig,S.checkInitialise(),r.checkInitialise(),void 0!==t.containerElement&&(this._containerElement=t.containerElement)}get container(){return this._containerElement}get isInitialised(){return this._isInitialised}get groundItem(){return this._groundItem}get root(){return this._groundItem}get openPopouts(){return this._openPopouts}get dropTargetIndicator(){return this._dropTargetIndicator}get transitionIndicator(){return this._transitionIndicator}get width(){return this._width}get height(){return this._height}get eventHub(){return this._eventHub}get rootItem(){if(void 0===this._groundItem)throw new Error("Cannot access rootItem before init");return 0===this._groundItem.contentItems.length?void 0:this._groundItem.contentItems[0]}get focusedComponentItem(){return this._focusedComponentItem}get tabDropPlaceholder(){return this._tabDropPlaceholder}get maximisedStack(){return this._maximisedStack}get deprecatedConstructor(){return!this.isSubWindow&&void 0!==this._constructorOrSubWindowLayoutConfig}destroy(){if(this._isInitialised){this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1),!0===this.layoutConfig.settings.closePopoutsOnUnload&&this.closeAllOpenPopouts(),this._resizeObserver.disconnect(),this.checkClearResizeTimeout(),void 0!==this._groundItem&&this._groundItem.destroy(),this._tabDropPlaceholder.remove(),null!==this._dropTargetIndicator&&this._dropTargetIndicator.destroy(),null!==this._transitionIndicator&&this._transitionIndicator.destroy(),this._eventHub.destroy();for(const t of this._dragSources)t.destroy();this._dragSources=[],this._isInitialised=!1}}minifyConfig(t){return x.minifyConfig(t)}unminifyConfig(t){return x.unminifyConfig(t)}init(){let t;if(this.setContainer(),this._dropTargetIndicator=new ft,this._transitionIndicator=new vt,this.updateSizeFromContainer(),this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new o("LMIU07155");{const i=this._constructorOrSubWindowLayoutConfig.root;if(void 0===i)throw new e("LMIC07156");if(!G.isComponent(i))throw new e("LMIC07157");t=i;const n=K.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},n),{root:void 0})}}else void 0===this._constructorOrSubWindowLayoutConfig?this.layoutConfig=x.createDefault():this.layoutConfig=K.resolve(this._constructorOrSubWindowLayoutConfig);const i=this.layoutConfig;this._groundItem=new mt(this,i.root,this._containerElement),this._groundItem.init(),this.checkLoadedLayoutMaximiseItem(),this._resizeObserver.observe(this._containerElement),this._isInitialised=!0,this.adjustColumnsResponsive(),this.emit("initialised"),void 0!==t&&this.loadComponentAsRoot(t)}loadLayout(t){if(!this.isInitialised)throw new Error("GoldenLayout: Need to call init() if LayoutConfig with defined root passed to constructor");if(void 0===this._groundItem)throw new o("LMLL11119");this.createSubWindows(),this.layoutConfig=K.resolve(t),this._groundItem.loadRoot(this.layoutConfig.root),this.checkLoadedLayoutMaximiseItem(),this.adjustColumnsResponsive()}saveLayout(){if(!1===this._isInitialised)throw new Error("Can't create config, layout not yet initialised");if(void 0===this._groundItem)throw new o("LMTC18244");{const t=this._groundItem.calculateConfigContent();let e;e=1!==t.length?void 0:t[0],this.reconcilePopoutWindows();const i=[];for(let t=0;t<this._openPopouts.length;t++)i.push(this._openPopouts[t].toConfig());return{root:e,openPopouts:i,settings:x.Settings.createCopy(this.layoutConfig.settings),dimensions:x.Dimensions.createCopy(this.layoutConfig.dimensions),header:x.Header.createCopy(this.layoutConfig.header),resolved:!0}}}clear(){if(void 0===this._groundItem)throw new o("LMCL11129");this._groundItem.clearRoot()}toConfig(){return this.saveLayout()}newComponent(t,i,n){const s=this.newComponentAtLocation(t,i,n);if(void 0===s)throw new e("LMNC65588");return s}newComponentAtLocation(t,i,n,s){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const o=this.addComponentAtLocation(t,i,n,s);if(void 0===o)return;{const t=o.parentItem.contentItems[o.index];if(at.isComponentItem(t))return t;throw new e("LMNC992877533")}}}addComponent(t,i,n){const s=this.addComponentAtLocation(t,i,n);if(void 0===s)throw new e("LMAC99943");return s}addComponentAtLocation(t,e,i,n){const s={type:"component",componentType:t,componentState:e,title:i};return this.addItemAtLocation(s,n)}newItem(t){const i=this.newItemAtLocation(t);if(void 0===i)throw new e("LMNC65588");return i}newItemAtLocation(t,e){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{const i=this.addItemAtLocation(t,e);if(void 0===i)return;return i.parentItem.contentItems[i.index]}}addItem(t){const i=this.addItemAtLocation(t);if(void 0===i)throw new e("LMAI99943");return i}addItemAtLocation(t,i){if(void 0===this._groundItem)throw new Error("Cannot add component before init");{void 0===i&&(i=_t.defaultLocationSelectors);const s=this.findFirstLocation(i);if(void 0===s)return;{let i,o=s.parentItem;switch(o.type){case p.ground:i=o.addItem(t,s.index),i>=0?o=this._groundItem.contentItems[0]:i=0;break;case p.row:case p.column:i=o.addItem(t,s.index);break;case p.stack:if(G.isComponent(t)){i=o.addItem(t,s.index);break}throw Error(F[6]);case p.component:throw new e("LMAIALC87444602");default:throw new n("LMAIALU98881733",o.type)}if(G.isComponent(t)){const t=o.contentItems[i];at.isStack(t)&&(o=t,i=0)}return s.parentItem=o,s.index=i,s}}}loadComponentAsRoot(t){if(void 0===this._groundItem)throw new Error("Cannot add item before init");this._groundItem.loadComponentAsRoot(t)}updateSize(t,e){this.setSize(t,e)}setSize(t,e){if(this._width=t,this._height=e,!0===this._isInitialised){if(void 0===this._groundItem)throw new o("LMUS18881");if(this._groundItem.setSize(this._width,this._height),this._maximisedStack){const{width:t,height:e}=L(this._containerElement);R(this._maximisedStack.element,t),M(this._maximisedStack.element,e),this._maximisedStack.updateSize(!1)}this.adjustColumnsResponsive()}}beginSizeInvalidation(){this._sizeInvalidationBeginCount++}endSizeInvalidation(){0===--this._sizeInvalidationBeginCount&&this.updateSizeFromContainer()}updateSizeFromContainer(){const{width:t,height:e}=L(this._containerElement);this.setSize(t,e)}updateRootSize(t=!1){if(void 0===this._groundItem)throw new o("LMURS28881");this._groundItem.updateSize(t)}createAndInitContentItem(t,e){const i=this.createContentItem(t,e);return i.init(),i}createContentItem(t,e){if("string"!=typeof t.type)throw new B("Missing parameter 'type'",JSON.stringify(t));return!f.isComponentItem(t)||e instanceof dt||!e||!0===this.isSubWindow&&e instanceof mt||(t={type:p.stack,content:[t],size:t.size,sizeUnit:t.sizeUnit,minSize:t.minSize,minSizeUnit:t.minSizeUnit,id:t.id,maximised:t.maximised,isClosable:t.isClosable,activeItemIndex:0,header:void 0}),this.createContentItemFromConfig(t,e)}findFirstComponentItemById(t){if(void 0===this._groundItem)throw new o("LMFFCIBI82446");return this.findFirstContentItemTypeByIdRecursive(p.component,t,this._groundItem)}createPopout(t,e,i,n){return t instanceof at?this.createPopoutFromContentItem(t,e,i,n):this.createPopoutFromItemConfig(t,e,i,n)}createPopoutFromContentItem(t,e,i,n){let o=t.parent,r=t;for(;null!==o&&1===o.contentItems.length&&!o.isGround;)r=o,o=o.parent;if(null===o)throw new s("LMCPFCI00834");{if(void 0===n&&(n=o.contentItems.indexOf(r)),null!==i&&o.addPopInParentId(i),void 0===e){const i=globalThis.screenX||globalThis.screenLeft,n=globalThis.screenY||globalThis.screenTop,s=t.element.offsetLeft,o=t.element.offsetTop,{width:r,height:a}=L(t.element);e={left:i+s,top:n+o,width:r,height:a}}const s=t.toConfig();if(t.remove(),y.isRootItemConfig(s))return this.createPopoutFromItemConfig(s,e,i,n);throw new Error(`${F[0]}`)}}beginVirtualSizedContainerAdding(){0===++this._virtualSizedContainerAddingBeginCount&&(this._virtualSizedContainers.length=0)}addVirtualSizedContainer(t){this._virtualSizedContainers.push(t)}endVirtualSizedContainerAdding(){if(0===--this._virtualSizedContainerAddingBeginCount){const t=this._virtualSizedContainers.length;if(t>0){this.fireBeforeVirtualRectingEvent(t);for(let e=0;e<t;e++)this._virtualSizedContainers[e].notifyVirtualRectingRequired();this.fireAfterVirtualRectingEvent(),this._virtualSizedContainers.length=0}}}fireBeforeVirtualRectingEvent(t){void 0!==this.beforeVirtualRectingEvent&&this.beforeVirtualRectingEvent(t)}fireAfterVirtualRectingEvent(){void 0!==this.afterVirtualRectingEvent&&this.afterVirtualRectingEvent()}createPopoutFromItemConfig(t,e,i,n){const s=this.toConfig(),o={root:t,openPopouts:[],settings:s.settings,dimensions:s.dimensions,header:s.header,window:e,parentId:i,indexInParent:n,resolved:!0};return this.createPopoutFromPopoutLayoutConfig(o)}createPopoutFromPopoutLayoutConfig(t){var e,i,n,s;const o=t.window,r={left:null!==(e=o.left)&&void 0!==e?e:globalThis.screenX||globalThis.screenLeft+20,top:null!==(i=o.top)&&void 0!==i?i:globalThis.screenY||globalThis.screenTop+20,width:null!==(n=o.width)&&void 0!==n?n:500,height:null!==(s=o.height)&&void 0!==s?s:309},a=new tt(t,r,this);return a.on("initialised",()=>this.emit("windowOpened",a)),a.on("closed",()=>this.reconcilePopoutWindows()),this._openPopouts.push(a),this.layoutConfig.settings.closePopoutsOnUnload&&!this._windowBeforeUnloadListening&&(globalThis.addEventListener("beforeunload",this._windowBeforeUnloadListener,{passive:!0}),this._windowBeforeUnloadListening=!0),a}closeAllOpenPopouts(){for(let t=0;t<this._openPopouts.length;t++)this._openPopouts[t].close();this._openPopouts.length=0,this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1)}newDragSource(t,e,i,n,s){const o=new gt(this,t,[],e,i,n,s);return this._dragSources.push(o),o}removeDragSource(t){!function(t,e){const i=e.indexOf(t);if(-1===i)throw new Error("Can't remove item from array. Item is not in the array");e.splice(i,1)}(t,this._dragSources),t.destroy()}startComponentDrag(t,e,i,n,s){new ct(t,e,i,this,n,s)}focusComponent(t,e=!1){t.focus(e)}clearComponentFocus(t=!1){this.setFocusedComponentItem(void 0,t)}setFocusedComponentItem(t,e=!1){if(t!==this._focusedComponentItem){let i;if(void 0===t||(i=t.parentItem),void 0!==this._focusedComponentItem){const t=this._focusedComponentItem;this._focusedComponentItem=void 0,t.setBlurred(e);const n=t.parentItem;i===n?i=void 0:n.setFocusedValue(!1)}void 0!==t&&(this._focusedComponentItem=t,t.setFocused(e),void 0!==i&&i.setFocusedValue(!0))}}createContentItemFromConfig(t,i){switch(t.type){case p.ground:throw new e("LMCCIFC68871");case p.row:return new pt(!1,this,t,i);case p.column:return new pt(!0,this,t,i);case p.stack:return new dt(this,t,i);case p.component:return new lt(this,t,i);default:throw new n("CCC913564",t.type,"Invalid Config Item type specified")}}setMaximisedStack(t){void 0===t?void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack():t!==this._maximisedStack&&(void 0!==this._maximisedStack&&this.processMinimiseMaximisedStack(),this.processMaximiseStack(t))}checkMinimiseMaximisedStack(){void 0!==this._maximisedStack&&this._maximisedStack.minimise()}cleanupBeforeMaximisedStackDestroyed(t){null!==this._maximisedStack&&this._maximisedStack===t.target&&(this._maximisedStack.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),this._maximisedStack=void 0)}closeWindow(){globalThis.setTimeout(()=>globalThis.close(),1)}getArea(t,e){let i=null,n=1/0;for(let s=0;s<this._itemAreas.length;s++){const o=this._itemAreas[s];t>=o.x1&&t<o.x2&&e>=o.y1&&e<o.y2&&n>o.surface&&(n=o.surface,i=o)}return i}calculateItemAreas(){const t=this.getAllContentItems(),e=this._groundItem;if(void 0===e)throw new o("LMCIAR44365");if(1===t.length){const t=e.getElementArea();if(null===t)throw new s("LMCIARA44365");return void(this._itemAreas=[t])}e.contentItems[0].isStack?this._itemAreas=[]:this._itemAreas=e.createSideAreas();for(let e=0;e<t.length;e++){const i=t[e];if(at.isStack(i)){const t=i.getArea();if(null===t)continue;{this._itemAreas.push(t);const e=i.contentAreaDimensions;if(void 0===e)throw new o("LMCIASC45599");{const t=e.header.highlightArea,n=(t.x2-t.x1)*(t.y2-t.y1),s={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,contentItem:i,surface:n};this._itemAreas.push(s)}}}}}checkLoadedLayoutMaximiseItem(){if(void 0===this._groundItem)throw new o("LMCLLMI43432");{const t=this._groundItem.getConfigMaximisedItems();if(t.length>0){let i=t[0];if(at.isComponentItem(i)){const t=i.parent;if(null===t)throw new s("LMXLLMI69999");i=t}if(!at.isStack(i))throw new e("LMCLLMI19993");i.maximise()}}}processMaximiseStack(t){if(this._maximisedStack=t,t.on("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.element.classList.add("lm_maximised"),t.element.insertAdjacentElement("afterend",this._maximisePlaceholder),void 0===this._groundItem)throw new o("LMMXI19993");{this._groundItem.element.prepend(t.element);const{width:e,height:i}=L(this._containerElement);R(t.element,e),M(t.element,i),t.updateSize(!0),t.focusActiveContentItem(),this._maximisedStack.emit("maximised"),this.emit("stateChanged")}}processMinimiseMaximisedStack(){if(void 0===this._maximisedStack)throw new e("LMMMS74422");{const t=this._maximisedStack;if(null===t.parent)throw new s("LMMI13668");t.element.classList.remove("lm_maximised"),this._maximisePlaceholder.insertAdjacentElement("afterend",t.element),this._maximisePlaceholder.remove(),this.updateRootSize(!0),this._maximisedStack=void 0,t.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),t.emit("minimised"),this.emit("stateChanged")}}reconcilePopoutWindows(){const t=[];for(let e=0;e<this._openPopouts.length;e++)!1===this._openPopouts[e].getWindow().closed?t.push(this._openPopouts[e]):this.emit("windowClosed",this._openPopouts[e]);this._openPopouts.length!==t.length&&(this._openPopouts=t,this.emit("stateChanged"))}getAllContentItems(){if(void 0===this._groundItem)throw new o("LMGACI13130");return this._groundItem.getAllContentItems()}createSubWindows(){for(let t=0;t<this.layoutConfig.openPopouts.length;t++){const e=this.layoutConfig.openPopouts[t];this.createPopoutFromPopoutLayoutConfig(e)}}handleContainerResize(){this.resizeWithContainerAutomatically&&this.processResizeWithDebounce()}processResizeWithDebounce(){this.resizeDebounceExtendedWhenPossible&&this.checkClearResizeTimeout(),void 0===this._resizeTimeoutId&&(this._resizeTimeoutId=setTimeout(()=>{this._resizeTimeoutId=void 0,this.beginSizeInvalidation(),this.endSizeInvalidation()},this.resizeDebounceInterval))}checkClearResizeTimeout(){void 0!==this._resizeTimeoutId&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=void 0)}setContainer(){var t;const e=document.body,i=null!==(t=this._containerElement)&&void 0!==t?t:e;if(i===e){this.resizeWithContainerAutomatically=!0;const t=document.documentElement;t.style.height="100%",t.style.margin="0",t.style.padding="0",t.style.overflow="clip",e.style.height="100%",e.style.margin="0",e.style.padding="0",e.style.overflow="clip"}this._containerElement=i}onBeforeUnload(){this.destroy()}adjustColumnsResponsive(){if(void 0===this._groundItem)throw new o("LMACR20883");if(this._firstLoad=!1,this.useResponsiveLayout()&&!this._updatingColumnsResponsive&&this._groundItem.contentItems.length>0&&this._groundItem.contentItems[0].isRow){if(void 0===this._groundItem||null===this._width)throw new o("LMACR77412");{const t=this._groundItem.contentItems[0].contentItems.length;if(t<=1)return;{const i=this.layoutConfig.dimensions.defaultMinItemWidth;if(t*i<=this._width)return;{this._updatingColumnsResponsive=!0;const n=t-Math.max(Math.floor(this._width/i),1),s=this._groundItem.contentItems[0],o=this.getAllStacks();if(0===o.length)throw new e("LMACRS77413");{const t=o[0];for(let e=0;e<n;e++){const e=s.contentItems[s.contentItems.length-1];this.addChildContentItemsToContainer(t,e)}this._updatingColumnsResponsive=!1}}}}}}useResponsiveLayout(){const t=this.layoutConfig.settings,e=t.responsiveMode===m.always,i=t.responsiveMode===m.onload&&this._firstLoad;return e||i}addChildContentItemsToContainer(t,e){const i=e.contentItems;if(e instanceof dt)for(let n=0;n<i.length;n++){const s=i[n];e.removeChild(s,!0),t.addChild(s)}else for(let e=0;e<i.length;e++){const n=i[e];this.addChildContentItemsToContainer(t,n)}}getAllStacks(){if(void 0===this._groundItem)throw new o("LMFASC52778");{const t=[];return this.findAllStacksRecursive(t,this._groundItem),t}}findFirstContentItemType(t){if(void 0===this._groundItem)throw new o("LMFFCIT82446");return this.findFirstContentItemTypeRecursive(t,this._groundItem)}findFirstContentItemTypeRecursive(t,e){const i=e.contentItems,n=i.length;if(0!==n){for(let e=0;e<n;e++){const n=i[e];if(n.type===t)return n}for(let e=0;e<n;e++){const n=i[e],s=this.findFirstContentItemTypeRecursive(t,n);if(void 0!==s)return s}}}findFirstContentItemTypeByIdRecursive(t,e,i){const n=i.contentItems,s=n.length;if(0!==s){for(let i=0;i<s;i++){const s=n[i];if(s.type===t&&s.id===e)return s}for(let i=0;i<s;i++){const s=n[i],o=this.findFirstContentItemTypeByIdRecursive(t,e,s);if(void 0!==o)return o}}}findAllStacksRecursive(t,e){const i=e.contentItems;for(let e=0;e<i.length;e++){const n=i[e];n instanceof dt?t.push(n):n.isComponent||this.findAllStacksRecursive(t,n)}}findFirstLocation(t){const e=t.length;for(let i=0;i<e;i++){const e=t[i],n=this.findLocation(e);if(void 0!==n)return n}}findLocation(t){const e=t.index;switch(t.typeId){case 0:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem,i=t.contentItems,n=i.length;if(void 0===e)return{parentItem:t,index:n};{const s=i.indexOf(this._focusedComponentItem)+e;return s<0||s>n?void 0:{parentItem:t,index:s}}}case 1:if(void 0===this._focusedComponentItem)return;{const t=this._focusedComponentItem.parentItem;return this.tryCreateLocationFromParentItem(t,e)}case 2:{const t=this.findFirstContentItemType(p.stack);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 3:{let t=this.findFirstContentItemType(p.row);return void 0!==t?this.tryCreateLocationFromParentItem(t,e):(t=this.findFirstContentItemType(p.column),void 0!==t?this.tryCreateLocationFromParentItem(t,e):void 0)}case 4:{const t=this.findFirstContentItemType(p.row);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 5:{const t=this.findFirstContentItemType(p.column);return void 0===t?void 0:this.tryCreateLocationFromParentItem(t,e)}case 6:if(void 0===this._groundItem)throw new o("LMFLRIF18244");return void 0!==this.rootItem?void 0:void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;case 7:if(void 0===this._groundItem)throw new o("LMFLF18244");{const t=this._groundItem.contentItems;if(0===t.length)return void 0===e||0===e?{parentItem:this._groundItem,index:0}:void 0;{const i=t[0];return this.tryCreateLocationFromParentItem(i,e)}}}}tryCreateLocationFromParentItem(t,e){const i=t.contentItems.length;return void 0===e?{parentItem:t,index:i}:e<0||e>i?void 0:{parentItem:t,index:e}}}!function(t){t.createMaximisePlaceElement=function(t){const e=t.createElement("div");return e.classList.add("lm_maximise_place"),e},t.createTabDropPlaceholderElement=function(t){const e=t.createElement("div");return e.classList.add("lm_drop_tab_placeholder"),e},t.defaultLocationSelectors=[{typeId:1,index:void 0},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}],t.afterFocusedItemIfPossibleLocationSelectors=[{typeId:0,index:1},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}]}(_t||(_t={}));class wt extends _t{constructor(t,e,i,n){if(super(wt.createLayoutManagerConstructorParameters(t,e)),this._bindComponentEventHanlderPassedInConstructor=!1,this._creationTimeoutPassed=!1,void 0!==e&&"function"==typeof e&&(this.bindComponentEvent=e,this._bindComponentEventHanlderPassedInConstructor=!0,void 0!==i&&(this.unbindComponentEvent=i)),!this._bindComponentEventHanlderPassedInConstructor&&this.isSubWindow){if(void 0===this._constructorOrSubWindowLayoutConfig)throw new o("VLC98823");{const t=K.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},t),{root:void 0})}}!0!==n&&(this.deprecatedConstructor||this.init())}destroy(){this.bindComponentEvent=void 0,this.unbindComponentEvent=void 0,super.destroy()}init(){if(this._bindComponentEventHanlderPassedInConstructor||"loading"!==document.readyState&&null!==document.body){if(!this._bindComponentEventHanlderPassedInConstructor&&!0===this.isSubWindow&&!this._creationTimeoutPassed)return setTimeout(()=>this.init(),7),void(this._creationTimeoutPassed=!0);!0===this.isSubWindow&&(this._bindComponentEventHanlderPassedInConstructor||this.clearHtmlAndAdjustStylesForSubWindow(),window.__glInstance=this),super.init()}else document.addEventListener("DOMContentLoaded",()=>this.init(),{passive:!0})}clearHtmlAndAdjustStylesForSubWindow(){const t=document.head,e=new Array(4);e[0]=document.querySelectorAll("body link"),e[1]=document.querySelectorAll("body style"),e[2]=document.querySelectorAll("template"),e[3]=document.querySelectorAll(".gl_keep");for(let i=0;i<e.length;i++){const n=e[i];for(let e=0;e<n.length;e++){const i=n[e];t.appendChild(i)}}const i=document.body;i.innerHTML="",i.style.visibility="visible",this.checkAddDefaultPopinButton(),document.body.offsetHeight}checkAddDefaultPopinButton(){if(this.layoutConfig.settings.popInOnClose)return!1;{const t=document.createElement("div");t.classList.add("lm_popin"),t.setAttribute("title",this.layoutConfig.header.dock);const e=document.createElement("div");e.classList.add("lm_icon");const i=document.createElement("div");return i.classList.add("lm_bg"),t.appendChild(e),t.appendChild(i),t.addEventListener("click",()=>this.emit("popIn")),document.body.appendChild(t),!0}}bindComponent(t,e){if(void 0!==this.bindComponentEvent)return this.bindComponentEvent(t,e);if(void 0!==this.getComponentEvent)return{virtual:!1,component:this.getComponentEvent(t,e)};{const t=`${F[2]}: ${JSON.stringify(e)}`;throw new V(t)}}unbindComponent(t,e,i){if(void 0!==this.unbindComponentEvent)this.unbindComponentEvent(t);else if(!e&&void 0!==this.releaseComponentEvent){if(void 0===i)throw new o("VCUCRCU333998");this.releaseComponentEvent(t,i)}}}!function(t){let e=!1;t.createLayoutManagerConstructorParameters=function(t,i){const n=e?null:new URL(document.location.href).searchParams.get("gl-window");e=!0;const s=null!==n;let o,r;if(null!==n){const e=localStorage.getItem(n);if(null===e)throw new Error("Null gl-window Config");localStorage.removeItem(n);const i=JSON.parse(e),s=x.unminifyConfig(i);r=K.fromResolved(s),t instanceof HTMLElement&&(o=t)}else void 0===t?r=void 0:t instanceof HTMLElement?(r=void 0,o=t):r=t,void 0===o&&i instanceof HTMLElement&&(o=i);return{constructorOrSubWindowLayoutConfig:r,isSubWindow:s,containerElement:o}}}(wt||(wt={}));class yt extends wt{constructor(t,e,i){super(t,e,i,!0),this._componentTypesMap=new Map,this._registeredComponentMap=new Map,this._virtuableComponentMap=new Map,this._containerVirtualRectingRequiredEventListener=(t,e,i)=>this.handleContainerVirtualRectingRequiredEvent(t,e,i),this._containerVirtualVisibilityChangeRequiredEventListener=(t,e)=>this.handleContainerVirtualVisibilityChangeRequiredEvent(t,e),this._containerVirtualZIndexChangeRequiredEventListener=(t,e,i)=>this.handleContainerVirtualZIndexChangeRequiredEvent(t,e,i),this.deprecatedConstructor||this.init()}registerComponent(t,e,i=!1){if("function"!=typeof e)throw new N("registerComponent() componentConstructorOrFactoryFtn parameter is not a function");if(e.hasOwnProperty("prototype")){const n=e;this.registerComponentConstructor(t,n,i)}else{const n=e;this.registerComponentFactoryFunction(t,n,i)}}registerComponentConstructor(t,e,i=!1){if("function"!=typeof e)throw new Error(F[1]);if(void 0!==this._componentTypesMap.get(t))throw new V(`${F[3]}: ${t}`);this._componentTypesMap.set(t,{constructor:e,factoryFunction:void 0,virtual:i})}registerComponentFactoryFunction(t,e,i=!1){if("function"!=typeof e)throw new V("Please register a constructor function");if(void 0!==this._componentTypesMap.get(t))throw new V(`${F[3]}: ${t}`);this._componentTypesMap.set(t,{constructor:void 0,factoryFunction:e,virtual:i})}registerComponentFunction(t){this.registerGetComponentConstructorCallback(t)}registerGetComponentConstructorCallback(t){if("function"!=typeof t)throw new Error("Please register a callback function");void 0!==this._getComponentConstructorFtn&&console.warn("Multiple component functions are being registered.  Only the final registered function will be used."),this._getComponentConstructorFtn=t}getRegisteredComponentTypeNames(){const t=this._componentTypesMap.keys();return Array.from(t)}getComponentInstantiator(t){let e;const i=_.resolveComponentTypeName(t);return void 0!==i&&(e=this._componentTypesMap.get(i)),void 0===e&&void 0!==this._getComponentConstructorFtn&&(e={constructor:this._getComponentConstructorFtn(t),factoryFunction:void 0,virtual:!1}),e}bindComponent(t,i){let n;const s=_.resolveComponentTypeName(i);let r;if(void 0!==s&&(n=this._componentTypesMap.get(s)),void 0===n&&void 0!==this._getComponentConstructorFtn&&(n={constructor:this._getComponentConstructorFtn(i),factoryFunction:void 0,virtual:!1}),void 0!==n){const a=n.virtual;let l,h;l=void 0===i.componentState?void 0:D({},i.componentState);const d=n.constructor;if(void 0!==d)h=new d(t,l,a);else{const i=n.factoryFunction;if(void 0===i)throw new e("LMBCFFU10008");h=i(t,l,a)}if(a){if(void 0===h)throw new o("GLBCVCU988774");{const e=h,i=e.rootHtmlElement;if(void 0===i)throw new V(`${F[5]}: ${s}`);!function(t){const e="absolute";t.style.position!==e&&(t.style.position=e)}(i),this.container.appendChild(i),this._virtuableComponentMap.set(t,e),t.virtualRectingRequiredEvent=this._containerVirtualRectingRequiredEventListener,t.virtualVisibilityChangeRequiredEvent=this._containerVirtualVisibilityChangeRequiredEventListener,t.virtualZIndexChangeRequiredEvent=this._containerVirtualZIndexChangeRequiredEventListener}}this._registeredComponentMap.set(t,h),r={virtual:n.virtual,component:h}}else r=super.bindComponent(t,i);return r}unbindComponent(t,i,n){if(void 0===this._registeredComponentMap.get(t))super.unbindComponent(t,i,n);else{const i=this._virtuableComponentMap.get(t);if(void 0!==i){const n=i.rootHtmlElement;if(void 0===n)throw new e("GLUC77743",t.title);this.container.removeChild(n),this._virtuableComponentMap.delete(t)}}}fireBeforeVirtualRectingEvent(t){this._goldenLayoutBoundingClientRect=this.container.getBoundingClientRect(),super.fireBeforeVirtualRectingEvent(t)}handleContainerVirtualRectingRequiredEvent(t,e,i){const n=this._virtuableComponentMap.get(t);if(void 0===n)throw new o("GLHCSCE55933");{const s=n.rootHtmlElement;if(void 0===s)throw new V(F[4]+" "+t.title);{const n=t.element.getBoundingClientRect(),o=n.left-this._goldenLayoutBoundingClientRect.left;s.style.left=P(o);const r=n.top-this._goldenLayoutBoundingClientRect.top;s.style.top=P(r),R(s,e),M(s,i)}}}handleContainerVirtualVisibilityChangeRequiredEvent(t,e){const i=this._virtuableComponentMap.get(t);if(void 0===i)throw new o("GLHCVVCRE55934");{const n=i.rootHtmlElement;if(void 0===n)throw new V(F[4]+" "+t.title);T(n,e)}}handleContainerVirtualZIndexChangeRequiredEvent(t,e,i){const n=this._virtuableComponentMap.get(t);if(void 0===n)throw new o("GLHCVZICRE55935");{const e=n.rootHtmlElement;if(void 0===e)throw new V(F[4]+" "+t.title);e.style.zIndex=i}}}const Ct={silent:0,ERROR:1,WARN:2,INFO:3,DEBUG:4,TRACE:5};let xt="INFO",Et="console",St="",Pt="";const kt=[];function It(t){xt=Tt(t)}function Rt(t){["console","server","both"].includes(t)&&(Et=t)}function Mt(t){St=t||""}function Lt(t){Pt=t||""}function Tt(t){if(!t)return"INFO";const e=String(t).toUpperCase();return"OFF"===e||"SILENT"===e?"silent":e in Ct||Ct.hasOwnProperty(e)?e:"INFO"}function At(t){const e=Tt(t);return Ct[e]??99}function Dt(t){if(t instanceof Error)return`[Error: ${t.message}]${t.stack?"\n"+t.stack:""}`;try{const e=new WeakSet;return JSON.stringify(t,function(t,i){if("object"==typeof i&&null!==i){if(e.has(i))return"[Cyclic]";e.add(i)}return i})}catch(e){return"object"==typeof t&&null!==t?"[Unserializable Object: "+(t.constructor?.name||"Object")+"]":String(t)}}function zt(t){try{if("undefined"!=typeof Element&&t instanceof Element)return`<${t.tagName.toLowerCase()} id="${t.id}" class="${t.className}">`;if(t&&t.constructor&&t.constructor.name&&/Container|Layout|Panel|Manager/.test(t.constructor.name))return`[${t.constructor.name}]`;if(t&&t._id&&t._type)return`{type:"${t._type}", id:"${t._id}"}`;if("object"==typeof t&&null!==t){const e={};for(const i in t)"object"!=typeof t[i]&&"function"!=typeof t[i]&&(e[i]=t[i]);if(Object.keys(e).length>0)return e}return t}catch(e){return`[Unserializable: ${t&&t.constructor&&t.constructor.name}]`}}function Ot(t,...e){if(!(At(t)>At(xt))){if("console"===Et||"both"===Et){const i=String(t).toUpperCase(),n=e.map(zt);"undefined"!=typeof console&&("ERROR"===i&&console.error?console.error("[log]",t,...n):"WARN"===i&&console.warn?console.warn("[log]",t,...n):"INFO"===i&&console.info?console.info("[log]",t,...n):"DEBUG"===i&&console.debug||"TRACE"===i&&console.debug?console.debug("[log]",t,...n):console.log&&console.log("[log]",t,...n))}"server"!==Et&&"both"!==Et||!St||async function(t,...e){if(St)try{const i={level:t,message:e.map(Dt).join(" "),timestamp:(new Date).toISOString(),page:"object"==typeof location&&location.pathname,userAgent:"object"==typeof navigator&&navigator.userAgent,token:Pt};await fetch(St,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(i){"undefined"!=typeof console&&console.error&&console.error("[log]",t,"Failed to stream log",...e,i)}}(t,...e);for(const i of kt)try{"function"==typeof i?i(t,...e):i&&"function"==typeof i.sinkLog&&i.sinkLog(t,...e)}catch(t){"undefined"!=typeof console&&console.warn&&console.warn("[log]","Log sink error",t)}}}"undefined"!=typeof window&&(window.log=Ot,window.setLogLevel=It,window.setLogDestination=Rt,window.setLogServerURL=Mt,window.setLogServerToken=Lt,window.LOG_LEVELS=Ct);const Bt={imageObj:null,imageURL:null,sceneName:"",sceneLogic:"AND",shapes:[],selectedShape:null,selectedShapes:[],transformer:null,konvaStage:null,konvaLayer:null,konvaDiv:null,multiDrag:{moving:!1,dragOrigin:null,origPositions:null},settings:{},settingsRegistry:[],logLevel:"ERROR",logDest:"console",_subscribers:[]};function Ht(t={}){Ot("TRACE","[state] notifySubscribers entry",t);for(const e of Bt._subscribers)try{e(Bt,t)}catch(t){Ot("ERROR","[state] Subscriber error",t)}Ot("TRACE","[state] notifySubscribers exit")}function Nt(t){Ot("TRACE","[state] setSelectedShapes() entry",t),Bt.selectedShapes=Array.isArray(t)?t:[],Bt.selectedShape=1===Bt.selectedShapes.length?Bt.selectedShapes[0]:null,Ht({type:"selection",selectedShapes:Bt.selectedShapes}),Ot("DEBUG","[state] setSelectedShapes: selection updated",Bt.selectedShapes),Ot("TRACE","[state] setSelectedShapes() exit")}function Vt(t,e=null){Ot("TRACE","[state] setImage() entry",{url:t,imgObj:e}),Bt.imageURL=t||null,Bt.imageObj=e||null,Ht({type:"image",imageURL:Bt.imageURL,imageObj:Bt.imageObj}),Ot("DEBUG","[state] setImage: image updated",{url:Bt.imageURL,imgObj:!!Bt.imageObj}),Ot("TRACE","[state] setImage() exit")}function Ft(t){Ot("TRACE","[state] setSettings() entry",t),Bt.settings={...Bt.settings,...t},Ht({type:"settings",settings:Bt.settings}),Ot("DEBUG","[state] setSettings: settings updated",Bt.settings),Ot("TRACE","[state] setSettings() exit")}function Gt(t,e){Ot("TRACE","[state] setSetting() entry",{key:t,value:e}),Bt.settings[t]=e,Ht({type:"setting",key:t,value:e}),Ot("DEBUG","[state] setSetting: setting updated",{key:t,value:e}),Ot("TRACE","[state] setSetting() exit")}function Wt(t){Ot("TRACE","[state] getSetting() entry",{key:t});const e=Bt.settings[t];return Ot("TRACE","[state] getSetting() exit",{value:e}),e}Ot("INFO","[state] state.js module loaded and ready."),"undefined"!=typeof window&&(window.AppState=Bt,window.setShapes=function(t){Ot("TRACE","[state] setShapes() entry",t),Bt.shapes=Array.isArray(t)?t:[],Ht({type:"shapes",shapes:Bt.shapes}),Ot("DEBUG","[state] setShapes: shapes updated",Bt.shapes),Ot("TRACE","[state] setShapes() exit")},window.setSelectedShapes=Nt,window.addShape=function(t){Ot("TRACE","[state] addShape() entry",t),t?(Bt.shapes.push(t),Ht({type:"addShape",shape:t}),Ot("DEBUG","[state] addShape: shape added",t),Ot("TRACE","[state] addShape() exit")):Ot("TRACE","[state] addShape() exit (no shape)")},window.removeShape=function(t){Ot("TRACE","[state] removeShape() entry",t),t?(Bt.shapes=Bt.shapes.filter(e=>e!==t),Ht({type:"removeShape",shape:t}),Ot("DEBUG","[state] removeShape: shape removed",t),Ot("TRACE","[state] removeShape() exit")):Ot("TRACE","[state] removeShape() exit (no shape)")},window.setSceneName=function(t){Ot("TRACE","[state] setSceneName() entry",t),Bt.sceneName=t||"",Ht({type:"sceneName",sceneName:Bt.sceneName}),Ot("DEBUG","[state] setSceneName: sceneName updated",Bt.sceneName),Ot("TRACE","[state] setSceneName() exit")},window.setSceneLogic=function(t){Ot("TRACE","[state] setSceneLogic() entry",t),Bt.sceneLogic=["AND","OR"].includes(t)?t:"AND",Ht({type:"sceneLogic",sceneLogic:Bt.sceneLogic}),Ot("DEBUG","[state] setSceneLogic: sceneLogic updated",Bt.sceneLogic),Ot("TRACE","[state] setSceneLogic() exit")},window.setImage=Vt,window.setSettings=Ft,window.setSetting=Gt,window.getSetting=Wt,window.subscribeAppState=function(t){return Ot("TRACE","[state] subscribe() entry",t),"function"!=typeof t?(Ot("TRACE","[state] subscribe() exit (not a function)"),()=>{}):(Bt._subscribers.push(t),Ot("TRACE","[state] subscribe() exit (subscribed)"),()=>{const e=Bt._subscribers.indexOf(t);-1!==e&&Bt._subscribers.splice(e,1),Ot("TRACE","[state] unsubscribe() called",t)})});class jt{constructor(t){this.table=t}reloadData(t,e,i){return this.table.dataLoader.load(t,void 0,void 0,void 0,e,i)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(t){return this.table.modules.layout.layout(t)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(t){return this.table.eventBus.subscribed(t)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(t){return this.table.externalEvents.subscribed(t)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(t){return this.table.options[t]}setOption(t,e){return void 0!==e&&(this.table.options[t]=e),this.table.options[t]}deprecationCheck(t,e,i){return this.table.deprecationAdvisor.check(t,e,i)}deprecationCheckMsg(t,e){return this.table.deprecationAdvisor.checkMsg(t,e)}deprecationMsg(t){return this.table.deprecationAdvisor.msg(t)}module(t){return this.table.module(t)}}class Ut{static elVisible(t){return!(t.offsetWidth<=0&&t.offsetHeight<=0)}static elOffset(t){var e=t.getBoundingClientRect();return{top:e.top+window.pageYOffset-document.documentElement.clientTop,left:e.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(t,e,i){var n,s=t?e.split(t):[e],o=s.length;for(let t=0;t<o&&(n=i=i[s[t]],i);t++);return n}static deepClone(t,e,i=[]){var n={}.__proto__,s=[].__proto__;for(var o in e||(e=Object.assign(Array.isArray(t)?[]:{},t)),t){let r,a,l=t[o];null==l||"object"!=typeof l||l.__proto__!==n&&l.__proto__!==s||(r=i.findIndex(t=>t.subject===l),r>-1?e[o]=i[r].copy:(a=Object.assign(Array.isArray(l)?[]:{},l),i.unshift({subject:l,copy:a}),e[o]=this.deepClone(l,a,i)))}return e}}let qt=class t extends jt{constructor(t,e,i){super(t),this.element=e,this.container=this._lookupContainer(),this.parent=i,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var t=this.table.options.popupContainer;return"string"==typeof t?(t=document.querySelector(t))||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)"):!0===t&&(t=this.table.element),t&&!this._checkContainerIsParent(t)&&(t=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),t||(t=document.body),t}_checkContainerIsParent(t,e=this.table.element){return t===e||!!e.parentNode&&this._checkContainerIsParent(t,e.parentNode)}renderCallback(t){this.renderedCallback=t}containerEventCoords(t){var e=!(t instanceof MouseEvent),i=e?t.touches[0].pageX:t.pageX,n=e?t.touches[0].pageY:t.pageY;if(this.container!==document.body){let t=Ut.elOffset(this.container);i-=t.left,n-=t.top}return{x:i,y:n}}elementPositionCoords(t,e="right"){var i,n,s,o=Ut.elOffset(t);switch(this.container!==document.body&&(i=Ut.elOffset(this.container),o.left-=i.left,o.top-=i.top),e){case"right":n=o.left+t.offsetWidth,s=o.top-1;break;case"bottom":n=o.left,s=o.top+t.offsetHeight;break;case"left":n=o.left,s=o.top-1;break;case"top":n=o.left,s=o.top;break;case"center":n=o.left+t.offsetWidth/2,s=o.top+t.offsetHeight/2}return{x:n,y:s,offset:o}}show(t,e){var i,n,s,o,r;return this.destroyed||this.table.destroyed||(t instanceof HTMLElement?(s=t,o=(r=this.elementPositionCoords(t,e)).offset,i=r.x,n=r.y):"number"==typeof t?(o={top:0,left:0},i=t,n=e):(i=(r=this.containerEventCoords(t)).x,n=r.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=i+"px",this.container.appendChild(this.element),"function"==typeof this.renderedCallback&&this.renderedCallback(),this._fitToScreen(i,n,s,o,e),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",t=>{t.stopPropagation()})),this}_fitToScreen(t,e,i,n,s){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;(t+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",this.element.style.right=i?this.container.offsetWidth-n.left+"px":this.container.offsetWidth-t+"px",this.reversedX=!0);let r=Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0);e+this.element.offsetHeight>r&&(i?this.element.style.top="bottom"===s?parseInt(this.element.style.top)-this.element.offsetHeight-i.offsetHeight-1+"px":parseInt(this.element.style.top)-this.element.offsetHeight+i.offsetHeight+1+"px":this.element.style.height=r+"px")}isVisible(){return this.visible}hideOnBlur(t){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=t),this}_escapeCheck(t){27==t.keyCode&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(t=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!t&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new t(this.table,e,this),this.childPopup}};class $t extends jt{constructor(t,e){super(t),this._handler=null}initialize(){}registerTableOption(t,e){this.table.optionsList.register(t,e)}registerColumnOption(t,e){this.table.columnManager.optionsList.register(t,e)}registerTableFunction(t,e){void 0===this.table[t]?this.table[t]=(...i)=>(this.table.initGuard(t),e(...i)):console.warn("Unable to bind table function, name already in use",t)}registerComponentFunction(t,e,i){return this.table.componentFunctionBinder.bind(t,e,i)}registerDataHandler(t,e){this.table.rowManager.registerDataPipelineHandler(t,e),this._handler=t}registerDisplayHandler(t,e){this.table.rowManager.registerDisplayPipelineHandler(t,e),this._handler=t}displayRows(t){var e,i=this.table.rowManager.displayRows.length-1;if(this._handler&&(e=this.table.rowManager.displayPipeline.findIndex(t=>t.handler===this._handler))>-1&&(i=e),t&&(i+=t),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(t,e){e||(e=this._handler),e&&this.table.rowManager.refreshActiveData(e,!1,t)}footerAppend(t){return this.table.footerManager.append(t)}footerPrepend(t){return this.table.footerManager.prepend(t)}footerRemove(t){return this.table.footerManager.remove(t)}popup(t,e){return new qt(this.table,t,e)}alert(t,e){return this.table.alertManager.alert(t,e)}clearAlert(){return this.table.alertManager.clear()}}class Kt{constructor(t){return this._cell=t,new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._cell.table.componentFunctionBinder.handle("cell",t._cell,e)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(t){return this._cell.row.getData(t)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(t,e){void 0===e&&(e=!0),this._cell.setValue(t,e)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Xt extends jt{constructor(t,e){super(t.table),this.table=t.table,this.column=t,this.row=e,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var t=this.element,e=this.column.getField();t.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(t.style.display="inline-flex",t.style.alignItems={top:"flex-start",bottom:"flex-end",middle:"center"}[this.column.vertAlign]||"",this.column.hozAlign&&(t.style.justifyContent={left:"flex-start",right:"flex-end",center:"center"}[this.column.hozAlign]||"")),e&&t.setAttribute("tabulator-field",e),this.column.definition.cssClass&&this.column.definition.cssClass.split(" ").forEach(e=>{t.classList.add(e)}),this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var t;switch(typeof(t=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value))){case"object":if(t instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(t)}else this.element.innerHTML="",null!=t&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",t);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=t}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(t){return this.loaded||(this.loaded=!0,t||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(t,e,i){this.setValueProcessData(t,e,i)&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(t,e,i){var n=!1;return(this.value!==t||i)&&(n=!0,e&&(t=this.chain("cell-value-changing",[this,t],null,t))),this.setValueActual(t),n&&this.dispatch("cell-value-changed",this),n}setValueActual(t){this.oldValue=this.value,this.value=t,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,t),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new Kt(this)),this.component}}class Yt{constructor(t){return this._column=t,this.type="ColumnComponent",new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._column.table.componentFunctionBinder.handle("column",t._column,e)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var t=[];return this._column.cells.forEach(function(e){t.push(e.getComponent())}),t}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(t){t.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(t){t.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var t=[];return this._column.columns.length&&this._column.columns.forEach(function(e){t.push(e.getComponent())}),t}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(t,e){return this._column.table.columnManager.scrollToColumn(this._column,t,e)}getTable(){return this._column.table}move(t,e){var i=this._column.table.columnManager.findColumn(t);i?this._column.table.columnManager.moveColumn(this._column,i,e):console.warn("Move Error - No matching column found:",i)}getNextColumn(){var t=this._column.nextColumn();return!!t&&t.getComponent()}getPrevColumn(){var t=this._column.prevColumn();return!!t&&t.getComponent()}updateDefinition(t){return this._column.updateDefinition(t)}getWidth(){return this._column.getWidth()}setWidth(t){var e;return e=!0===t?this._column.reinitializeWidth(!0):this._column.setWidth(t),this._column.table.columnManager.rerenderColumns(!0),e}}var Zt={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Jt extends jt{static defaultOptionList=Zt;constructor(t,e,i){super(e.table),this.definition=t,this.parent=e,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=i,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((t,e)=>{var i=new Jt(t,this);this.attachColumn(i)}),this.checkColumnVisibility()):e.registerColumnField(this),this._initialize()}createElement(){var t=document.createElement("div");switch(t.classList.add("tabulator-col"),t.setAttribute("role","columnheader"),t.setAttribute("aria-sort","none"),this.isRowHeader&&t.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":t.style.justifyContent="center";break;case"bottom":t.style.justifyContent="flex-end"}return t}createGroupElement(){var t=document.createElement("div");return t.classList.add("tabulator-col-group-cols"),t}mapDefinitions(){var t=this.table.options.columnDefaults;if(t)for(let e in t)void 0===this.definition[e]&&(this.definition[e]=t[e]);this.definition=this.table.columnManager.optionsList.generate(Jt.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(t=>{-1===Jt.defaultOptionList.indexOf(t)&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",t)})}setField(t){this.field=t,this.fieldStructure=t?this.table.options.nestedFieldSeparator?t.split(this.table.options.nestedFieldSeparator):[t]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(t){this.parent.registerColumnPosition(t)}registerColumnField(t){this.parent.registerColumnField(t)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(t){t.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var t=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);t.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),"flip"===t.headerVertical&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var t=this.definition;this.dispatch("column-layout",this),void 0!==t.visible&&(t.visible?this.show(!0):this.hide(!0)),t.cssClass&&t.cssClass.split(" ").forEach(t=>{this.element.classList.add(t)}),t.field&&this.element.setAttribute("tabulator-field",t.field),this.setMinWidth(parseInt(t.minWidth)),t.maxInitialWidth&&(this.maxInitialWidth=parseInt(t.maxInitialWidth)),t.maxWidth&&this.setMaxWidth(parseInt(t.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var t=document.createElement("div");return t.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),t.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),t}_buildColumnHeaderTitle(){var t=this.definition,e=document.createElement("div");if(e.classList.add("tabulator-col-title"),t.headerWordWrap&&e.classList.add("tabulator-col-title-wrap"),t.editableTitle){var i=document.createElement("input");i.classList.add("tabulator-title-editor"),i.addEventListener("click",t=>{t.stopPropagation(),i.focus()}),i.addEventListener("mousedown",t=>{t.stopPropagation()}),i.addEventListener("change",()=>{t.title=i.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),e.appendChild(i),t.field?this.langBind("columns|"+t.field,e=>{i.value=e||t.title||"&nbsp;"}):i.value=t.title||"&nbsp;"}else t.field?this.langBind("columns|"+t.field,i=>{this._formatColumnHeaderTitle(e,i||t.title||"&nbsp;")}):this._formatColumnHeaderTitle(e,t.title||"&nbsp;");return e}_formatColumnHeaderTitle(t,e){var i=this.chain("column-format",[this,e,t],null,()=>e);switch(typeof i){case"object":i instanceof Node?t.appendChild(i):(t.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",i));break;case"undefined":t.innerHTML="";break;default:t.innerHTML=i}}_buildGroupHeader(){this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass&&this.definition.cssClass.split(" ").forEach(t=>{this.element.classList.add(t)}),this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(t){return t[this.field]}_getNestedData(t){var e,i=t,n=this.fieldStructure,s=n.length;for(let t=0;t<s&&(e=i=i[n[t]],i);t++);return e}_setFlatData(t,e){this.field&&(t[this.field]=e)}_setNestedData(t,e){var i=t,n=this.fieldStructure,s=n.length;for(let t=0;t<s;t++)if(t==s-1)i[n[t]]=e;else{if(!i[n[t]]){if(void 0===e)break;i[n[t]]={}}i=i[n[t]]}}attachColumn(t){this.groupElement?(this.columns.push(t),this.groupElement.appendChild(t.getElement()),t.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(t,e){var i=this.parent.isGroup?this.parent.getGroupElement().clientHeight:e||this.parent.getHeadersElement().clientHeight;this.element.style.height=i+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=i-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(e){e.verticalAlign(t)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(t){t.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?!!this.columns.length&&this.columns[0].getFirstColumn():this}getLastColumn(){return this.isGroup?!!this.columns.length&&this.columns[this.columns.length-1].getLastColumn():this}getColumns(t){var e=[];return t?this.columns.forEach(t=>{e.push(t),e=e.concat(t.getColumns(!0))}):e=this.columns,e}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(t){var e=[];return this.isGroup&&t&&(this.columns.forEach(function(t){e.push(t.getDefinition(!0))}),this.definition.columns=e),this.definition}checkColumnVisibility(){var t=!1;this.columns.forEach(function(e){e.visible&&(t=!0)}),t?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(t,e){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.show()}),this.isGroup||null!==this.width||this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,e),t||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(t,e){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(t){t.hide()}),this.dispatch("column-hide",this,e),t||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var t=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(e){e.visible&&(t+=e.getWidth())}),this.contentElement.style.maxWidth=t-1+"px",this.table.initialized&&(this.element.style.width=t+"px"),this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(t){var e=this.columns.indexOf(t);e>-1&&this.columns.splice(e,1),this.columns.length||this.delete()}setWidth(t){this.widthFixed=!0,this.setWidthActual(t)}setWidthActual(t){isNaN(t)&&(t=Math.floor(this.table.element.clientWidth/100*parseInt(t))),t=Math.max(this.minWidth,t),this.maxWidth&&(t=Math.min(this.maxWidth,t)),this.width=t,this.widthStyled=t?t+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(t){t.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var t=[];this.cells.forEach(function(e){e.row.heightInitialized&&(null!==e.row.getElement().offsetParent?(t.push(e.row),e.row.clearCellHeight()):e.row.heightInitialized=!1)}),t.forEach(function(t){t.calcHeight()}),t.forEach(function(t){t.setCellHeight()})}getWidth(){var t=0;return this.isGroup?this.columns.forEach(function(e){e.visible&&(t+=e.getWidth())}):t=this.width,t}getLeftOffset(){var t=this.element.offsetLeft;return this.parent.isGroup&&(t+=this.parent.getLeftOffset()),t}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(t){this.maxWidth&&t>this.maxWidth&&(t=this.maxWidth,console.warn("the minWidth ("+t+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=t,this.minWidthStyled=t?t+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(t){t.setMinWidth()})}setMaxWidth(t){this.minWidth&&t<this.minWidth&&(t=this.minWidth,console.warn("the maxWidth ("+t+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=t,this.maxWidthStyled=t?t+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(t){t.setMaxWidth()})}delete(){return new Promise((t,e)=>{this.isGroup&&this.columns.forEach(function(t){t.delete()}),this.dispatch("column-delete",this);var i=this.cells.length;for(let t=0;t<i;t++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),t()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(t){var e=new Xt(this,t);return this.cells.push(e),e}nextColumn(){var t=this.table.columnManager.findColumnIndex(this);return t>-1&&this._nextVisibleColumn(t+1)}_nextVisibleColumn(t){var e=this.table.columnManager.getColumnByIndex(t);return!e||e.visible?e:this._nextVisibleColumn(t+1)}prevColumn(){var t=this.table.columnManager.findColumnIndex(this);return t>-1&&this._prevVisibleColumn(t-1)}_prevVisibleColumn(t){var e=this.table.columnManager.getColumnByIndex(t);return!e||e.visible?e:this._prevVisibleColumn(t-1)}reinitializeWidth(t){this.widthFixed=!1,void 0===this.definition.width||t||this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(t),this.dispatch("column-width-fit-after",this)}fitToData(t){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(t=>{t.clearWidth()}));var e=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(t=>{var i=t.getWidth();i>e&&(e=i)}),e)){var i=e+1;t?this.setWidth(i):(this.maxInitialWidth&&!t&&(i=Math.min(i,this.maxInitialWidth)),this.setWidthActual(i))}}}updateDefinition(t){var e;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(e=Object.assign({},this.getDefinition()),e=Object.assign(e,t),this.table.columnManager.addColumn(e,!1,this).then(t=>(e.field==this.field&&(this.field=!1),this.delete().then(()=>t.getComponent()))))}deleteCell(t){var e=this.cells.indexOf(t);e>-1&&this.cells.splice(e,1)}getComponent(){return this.component||(this.component=new Yt(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof Jt&&this.parent.getComponent()}}class Qt{constructor(t){return this._row=t,new Proxy(this,{get:function(t,e,i){return void 0!==t[e]?t[e]:t._row.table.componentFunctionBinder.handle("row",t._row,e)}})}getData(t){return this._row.getData(t)}getElement(){return this._row.getElement()}getCells(){var t=[];return this._row.getCells().forEach(function(e){t.push(e.getComponent())}),t}getCell(t){var e=this._row.getCell(t);return!!e&&e.getComponent()}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(t){return this._row.watchPosition(t)}delete(){return this._row.delete()}scrollTo(t,e){return this._row.table.rowManager.scrollToRow(this._row,t,e)}move(t,e){this._row.moveToRow(t,e)}update(t){return this._row.updateData(t)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var t=this._row.nextRow();return t?t.getComponent():t}getPrevRow(){var t=this._row.prevRow();return t?t.getComponent():t}}class te extends jt{constructor(t,e,i="row"){super(e.table),this.parent=e,this.data={},this.type=i,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(t)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var t=document.createElement("div");t.classList.add("tabulator-row"),t.setAttribute("role","row"),this.element=t}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(t,e){if(this.create(),!this.initialized||t){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,e),t&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,e)}rendered(){this.cells.forEach(t=>{t.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&null!==this.element.offsetParent&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(t){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&null!==this.element.offsetParent&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(t){var e=0,i=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(i=this.calcMinHeight(),e=this.calcMaxHeight(),this.height=t?Math.max(e,i):this.manualHeight?this.height:Math.max(e,i)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var t=0;return this.cells.forEach(function(e){var i=e.getHeight();i>t&&(t=i)}),t}setCellHeight(){this.cells.forEach(function(t){t.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(t){t.clearHeight()})}normalizeHeight(t){t&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(t),this.setCellHeight()}setHeight(t,e){(this.height!=t||e)&&(this.manualHeight=!0,this.height=t,this.heightStyled=t?t+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(t){var e=this.cells.indexOf(t);e>-1&&this.cells.splice(e,1)}setData(t){this.data=this.chain("row-data-init-before",[this,t],void 0,t),this.dispatch("row-data-init-after",this)}updateData(t){var e,i=this.element&&Ut.elVisible(this.element),n={};return new Promise((s,o)=>{"string"==typeof t&&(t=JSON.parse(t)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,t)),e=this.chain("row-data-changing",[this,n,t],null,t);for(let t in e)this.data[t]=e[t];this.dispatch("row-data-save-after",this);for(let n in t)this.table.columnManager.getColumnsByFieldRoot(n).forEach(t=>{let n=this.getCell(t.getField());if(n){let s=t.getFieldValue(e);n.getValue()!==s&&(n.setValueProcessData(s),i&&n.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,t),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),s()})}getData(t){return t?this.chain("row-data-retrieve",[this,t],null,this.data):this.data}getCell(t){return t=this.table.columnManager.findColumn(t),this.initialized||0!==this.cells.length||this.generateCells(),this.cells.find(function(e){return e.column===t})}getCellIndex(t){return this.cells.findIndex(function(e){return e===t})}findCell(t){return this.cells.find(e=>e.element===t)}getCells(){return this.initialized||0!==this.cells.length||this.generateCells(),this.cells}nextRow(){return this.table.rowManager.nextDisplayRow(this,!0)||!1}prevRow(){return this.table.rowManager.prevDisplayRow(this,!0)||!1}moveToRow(t,e){var i=this.table.rowManager.findRow(t);i?(this.table.rowManager.moveRowActual(this,i,!e),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",t)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(t){this.detachModules(),this.table.rowManager.deleteRow(this,t),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var t=this.cells.length;for(let e=0;e<t;e++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return!!this.isDisplayed()&&this.position}setPosition(t){t!=this.position&&(this.position=t,this.positionWatchers.forEach(t=>{t(this.position)}))}watchPosition(t){this.positionWatchers.push(t),t(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Qt(this)),this.component}}var ee={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{},dependencies:{}};class ie{constructor(t,e,i={}){this.table=t,this.msgType=e,this.registeredDefaults=Object.assign({},i)}register(t,e){this.registeredDefaults[t]=e}generate(t,e={}){var i=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||!0===e.debugInvalidOptions;Object.assign(i,t);for(let t in e)i.hasOwnProperty(t)||(n&&console.warn("Invalid "+this.msgType+" option:",t),i[t]=e.key);for(let t in i)t in e?i[t]=e[t]:Array.isArray(i[t])?i[t]=Object.assign([],i[t]):"object"==typeof i[t]&&null!==i[t]?i[t]=Object.assign({},i[t]):void 0===i[t]&&delete i[t];return i}}class ne extends jt{constructor(t){super(t),this.elementVertical=t.rowManager.element,this.elementHorizontal=t.columnManager.element,this.tableElement=t.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(t){}renderRows(){}renderColumns(){}rerenderRows(t){t&&t()}rerenderColumns(t,e){}renderRowCells(t){}rerenderRowCells(t,e){}scrollColumns(t,e){}scrollRows(t,e){}resize(){}scrollToRow(t){}scrollToRowNearestTop(t){}visibleRows(t){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(t,e){var i=t.getElement();e%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(t){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(t,e,i){var n=this.rows().indexOf(t),s=t.getElement(),o=0;return new Promise((r,a)=>{if(n>-1){if(void 0===i&&(i=this.table.options.scrollToRowIfVisible),!i&&Ut.elVisible(s)&&(o=Ut.elOffset(s).top-Ut.elOffset(this.elementVertic